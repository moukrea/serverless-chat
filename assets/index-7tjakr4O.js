var ta=Object.defineProperty;var na=(r,e,t)=>e in r?ta(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var Me=(r,e,t)=>na(r,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}})();function ar(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,r=>{const e=Math.random()*16|0;return(r==="x"?e:e&3|8).toString(16)})}const Mi=["Happy","Clever","Brave","Bright","Swift","Gentle","Noble","Wise","Calm","Bold","Kind","Quick","Warm","Cool","Free","Pure","Wild","Keen","Zesty","Merry","Jolly","Proud","Lucky","Sunny"],xi=["Penguin","Dolphin","Eagle","Tiger","Panda","Fox","Wolf","Bear","Owl","Hawk","Lion","Lynx","Otter","Seal","Whale","Falcon","Raven","Swan","Deer","Rabbit","Badger","Moose","Elk","Phoenix"];function cr(){const r=Mi[Math.floor(Math.random()*Mi.length)],e=xi[Math.floor(Math.random()*xi.length)];return`${r} ${e}`}class ra{constructor(){this.isNew=this.load()}load(){try{let e=!1;const t=localStorage.getItem("p2p_identity");if(t){const i=JSON.parse(t);this.uuid=i.uuid,this.displayName=i.displayName}else this.uuid=ar(),this.displayName=cr(),this.save(),e=!0;const n=localStorage.getItem("p2p_peer_renames");return this.peerRenames=n?JSON.parse(n):{},e}catch(e){console.error("[Identity] Failed to load identity from storage:",e),this.uuid=ar(),this.displayName=cr(),this.peerRenames={};try{this.save()}catch(t){console.error("[Identity] Failed to save recovered identity:",t)}return!0}}save(){localStorage.setItem("p2p_identity",JSON.stringify({uuid:this.uuid,displayName:this.displayName}))}saveRenames(){localStorage.setItem("p2p_peer_renames",JSON.stringify(this.peerRenames))}setDisplayName(e){this.displayName=e,this.save()}setPeerRename(e,t){t&&t.trim()?this.peerRenames[e]=t.trim():delete this.peerRenames[e],this.saveRenames()}getPeerDisplayName(e,t){return this.peerRenames[e]||t||e.substring(0,8)}reset(){this.uuid=ar(),this.displayName=cr(),this.save()}}var Ke=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Bs(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function ia(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Us={exports:{}},ze=Us.exports={},bt,Et;function Fr(){throw new Error("setTimeout has not been defined")}function Br(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?bt=setTimeout:bt=Fr}catch{bt=Fr}try{typeof clearTimeout=="function"?Et=clearTimeout:Et=Br}catch{Et=Br}})();function js(r){if(bt===setTimeout)return setTimeout(r,0);if((bt===Fr||!bt)&&setTimeout)return bt=setTimeout,setTimeout(r,0);try{return bt(r,0)}catch{try{return bt.call(null,r,0)}catch{return bt.call(this,r,0)}}}function sa(r){if(Et===clearTimeout)return clearTimeout(r);if((Et===Br||!Et)&&clearTimeout)return Et=clearTimeout,clearTimeout(r);try{return Et(r)}catch{try{return Et.call(null,r)}catch{return Et.call(this,r)}}}var Ct=[],Gt=!1,xt,On=-1;function oa(){!Gt||!xt||(Gt=!1,xt.length?Ct=xt.concat(Ct):On=-1,Ct.length&&$s())}function $s(){if(!Gt){var r=js(oa);Gt=!0;for(var e=Ct.length;e;){for(xt=Ct,Ct=[];++On<e;)xt&&xt[On].run();On=-1,e=Ct.length}xt=null,Gt=!1,sa(r)}}ze.nextTick=function(r){var e=new Array(arguments.length-1);if(arguments.length>1)for(var t=1;t<arguments.length;t++)e[t-1]=arguments[t];Ct.push(new Hs(r,e)),Ct.length===1&&!Gt&&js($s)};function Hs(r,e){this.fun=r,this.array=e}Hs.prototype.run=function(){this.fun.apply(null,this.array)};ze.title="browser";ze.browser=!0;ze.env={};ze.argv=[];ze.version="";ze.versions={};function It(){}ze.on=It;ze.addListener=It;ze.once=It;ze.off=It;ze.removeListener=It;ze.removeAllListeners=It;ze.emit=It;ze.prependListener=It;ze.prependOnceListener=It;ze.listeners=function(r){return[]};ze.binding=function(r){throw new Error("process.binding is not supported")};ze.cwd=function(){return"/"};ze.chdir=function(r){throw new Error("process.chdir is not supported")};ze.umask=function(){return 0};var aa=Us.exports;const Ee=ia(aa);var Ur={exports:{}},lr,Li;function ca(){if(Li)return lr;Li=1;var r=1e3,e=r*60,t=e*60,n=t*24,i=n*7,o=n*365.25;lr=function(b,d){d=d||{};var w=typeof b;if(w==="string"&&b.length>0)return a(b);if(w==="number"&&isFinite(b))return d.long?f(b):l(b);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(b))};function a(b){if(b=String(b),!(b.length>100)){var d=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(b);if(d){var w=parseFloat(d[1]),T=(d[2]||"ms").toLowerCase();switch(T){case"years":case"year":case"yrs":case"yr":case"y":return w*o;case"weeks":case"week":case"w":return w*i;case"days":case"day":case"d":return w*n;case"hours":case"hour":case"hrs":case"hr":case"h":return w*t;case"minutes":case"minute":case"mins":case"min":case"m":return w*e;case"seconds":case"second":case"secs":case"sec":case"s":return w*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return w;default:return}}}}function l(b){var d=Math.abs(b);return d>=n?Math.round(b/n)+"d":d>=t?Math.round(b/t)+"h":d>=e?Math.round(b/e)+"m":d>=r?Math.round(b/r)+"s":b+"ms"}function f(b){var d=Math.abs(b);return d>=n?p(b,d,n,"day"):d>=t?p(b,d,t,"hour"):d>=e?p(b,d,e,"minute"):d>=r?p(b,d,r,"second"):b+" ms"}function p(b,d,w,T){var v=d>=w*1.5;return Math.round(b/w)+" "+T+(v?"s":"")}return lr}function la(r){t.debug=t,t.default=t,t.coerce=f,t.disable=a,t.enable=i,t.enabled=l,t.humanize=ca(),t.destroy=p,Object.keys(r).forEach(b=>{t[b]=r[b]}),t.names=[],t.skips=[],t.formatters={};function e(b){let d=0;for(let w=0;w<b.length;w++)d=(d<<5)-d+b.charCodeAt(w),d|=0;return t.colors[Math.abs(d)%t.colors.length]}t.selectColor=e;function t(b){let d,w=null,T,v;function C(...F){if(!C.enabled)return;const S=C,N=Number(new Date),g=N-(d||N);S.diff=g,S.prev=d,S.curr=N,d=N,F[0]=t.coerce(F[0]),typeof F[0]!="string"&&F.unshift("%O");let _=0;F[0]=F[0].replace(/%([a-zA-Z%])/g,(M,I)=>{if(M==="%%")return"%";_++;const x=t.formatters[I];if(typeof x=="function"){const K=F[_];M=x.call(S,K),F.splice(_,1),_--}return M}),t.formatArgs.call(S,F),(S.log||t.log).apply(S,F)}return C.namespace=b,C.useColors=t.useColors(),C.color=t.selectColor(b),C.extend=n,C.destroy=t.destroy,Object.defineProperty(C,"enabled",{enumerable:!0,configurable:!1,get:()=>w!==null?w:(T!==t.namespaces&&(T=t.namespaces,v=t.enabled(b)),v),set:F=>{w=F}}),typeof t.init=="function"&&t.init(C),C}function n(b,d){const w=t(this.namespace+(typeof d>"u"?":":d)+b);return w.log=this.log,w}function i(b){t.save(b),t.namespaces=b,t.names=[],t.skips=[];const d=(typeof b=="string"?b:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(const w of d)w[0]==="-"?t.skips.push(w.slice(1)):t.names.push(w)}function o(b,d){let w=0,T=0,v=-1,C=0;for(;w<b.length;)if(T<d.length&&(d[T]===b[w]||d[T]==="*"))d[T]==="*"?(v=T,C=w,T++):(w++,T++);else if(v!==-1)T=v+1,C++,w=C;else return!1;for(;T<d.length&&d[T]==="*";)T++;return T===d.length}function a(){const b=[...t.names,...t.skips.map(d=>"-"+d)].join(",");return t.enable(""),b}function l(b){for(const d of t.skips)if(o(b,d))return!1;for(const d of t.names)if(o(b,d))return!0;return!1}function f(b){return b instanceof Error?b.stack||b.message:b}function p(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}var ua=la;(function(r,e){var t={};e.formatArgs=i,e.save=o,e.load=a,e.useColors=n,e.storage=l(),e.destroy=(()=>{let p=!1;return()=>{p||(p=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function n(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let p;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(p=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(p[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function i(p){if(p[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+p[0]+(this.useColors?"%c ":" ")+"+"+r.exports.humanize(this.diff),!this.useColors)return;const b="color: "+this.color;p.splice(1,0,b,"color: inherit");let d=0,w=0;p[0].replace(/%[a-zA-Z%]/g,T=>{T!=="%%"&&(d++,T==="%c"&&(w=d))}),p.splice(w,0,b)}e.log=console.debug||console.log||(()=>{});function o(p){try{p?e.storage.setItem("debug",p):e.storage.removeItem("debug")}catch{}}function a(){let p;try{p=e.storage.getItem("debug")||e.storage.getItem("DEBUG")}catch{}return!p&&typeof Ee<"u"&&"env"in Ee&&(p=t.DEBUG),p}function l(){try{return localStorage}catch{}}r.exports=ua(e);const{formatters:f}=r.exports;f.j=function(p){try{return JSON.stringify(p)}catch(b){return"[UnexpectedJSONParseError]: "+b.message}}})(Ur,Ur.exports);var fa=Ur.exports,ha=function(){if(typeof globalThis>"u")return null;var e={RTCPeerConnection:globalThis.RTCPeerConnection||globalThis.mozRTCPeerConnection||globalThis.webkitRTCPeerConnection,RTCSessionDescription:globalThis.RTCSessionDescription||globalThis.mozRTCSessionDescription||globalThis.webkitRTCSessionDescription,RTCIceCandidate:globalThis.RTCIceCandidate||globalThis.mozRTCIceCandidate||globalThis.webkitRTCIceCandidate};return e.RTCPeerConnection?e:null},jr={exports:{}},$r={exports:{}},Jt={};(function(r){Object.defineProperties(r,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});var e={},t={};t.byteLength=b,t.toByteArray=w,t.fromByteArray=C;for(var n=[],i=[],o=typeof Uint8Array<"u"?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",l=0,f=a.length;l<f;++l)n[l]=a[l],i[a.charCodeAt(l)]=l;i[45]=62,i[95]=63;function p(N){var g=N.length;if(g%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var _=N.indexOf("=");_===-1&&(_=g);var R=_===g?0:4-_%4;return[_,R]}function b(N){var g=p(N),_=g[0],R=g[1];return(_+R)*3/4-R}function d(N,g,_){return(g+_)*3/4-_}function w(N){var g,_=p(N),R=_[0],M=_[1],I=new o(d(N,R,M)),x=0,K=M>0?R-4:R,L;for(L=0;L<K;L+=4)g=i[N.charCodeAt(L)]<<18|i[N.charCodeAt(L+1)]<<12|i[N.charCodeAt(L+2)]<<6|i[N.charCodeAt(L+3)],I[x++]=g>>16&255,I[x++]=g>>8&255,I[x++]=g&255;return M===2&&(g=i[N.charCodeAt(L)]<<2|i[N.charCodeAt(L+1)]>>4,I[x++]=g&255),M===1&&(g=i[N.charCodeAt(L)]<<10|i[N.charCodeAt(L+1)]<<4|i[N.charCodeAt(L+2)]>>2,I[x++]=g>>8&255,I[x++]=g&255),I}function T(N){return n[N>>18&63]+n[N>>12&63]+n[N>>6&63]+n[N&63]}function v(N,g,_){for(var R,M=[],I=g;I<_;I+=3)R=(N[I]<<16&16711680)+(N[I+1]<<8&65280)+(N[I+2]&255),M.push(T(R));return M.join("")}function C(N){for(var g,_=N.length,R=_%3,M=[],I=16383,x=0,K=_-R;x<K;x+=I)M.push(v(N,x,x+I>K?K:x+I));return R===1?(g=N[_-1],M.push(n[g>>2]+n[g<<4&63]+"==")):R===2&&(g=(N[_-2]<<8)+N[_-1],M.push(n[g>>10]+n[g>>4&63]+n[g<<2&63]+"=")),M.join("")}var F={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */F.read=function(N,g,_,R,M){var I,x,K=M*8-R-1,L=(1<<K)-1,B=L>>1,O=-7,ne=_?M-1:0,ue=_?-1:1,fe=N[g+ne];for(ne+=ue,I=fe&(1<<-O)-1,fe>>=-O,O+=K;O>0;I=I*256+N[g+ne],ne+=ue,O-=8);for(x=I&(1<<-O)-1,I>>=-O,O+=R;O>0;x=x*256+N[g+ne],ne+=ue,O-=8);if(I===0)I=1-B;else{if(I===L)return x?NaN:(fe?-1:1)*(1/0);x=x+Math.pow(2,R),I=I-B}return(fe?-1:1)*x*Math.pow(2,I-R)},F.write=function(N,g,_,R,M,I){var x,K,L,B=I*8-M-1,O=(1<<B)-1,ne=O>>1,ue=M===23?Math.pow(2,-24)-Math.pow(2,-77):0,fe=R?0:I-1,pe=R?1:-1,ve=g<0||g===0&&1/g<0?1:0;for(g=Math.abs(g),isNaN(g)||g===1/0?(K=isNaN(g)?1:0,x=O):(x=Math.floor(Math.log(g)/Math.LN2),g*(L=Math.pow(2,-x))<1&&(x--,L*=2),x+ne>=1?g+=ue/L:g+=ue*Math.pow(2,1-ne),g*L>=2&&(x++,L/=2),x+ne>=O?(K=0,x=O):x+ne>=1?(K=(g*L-1)*Math.pow(2,M),x=x+ne):(K=g*Math.pow(2,ne-1)*Math.pow(2,M),x=0));M>=8;N[_+fe]=K&255,fe+=pe,K/=256,M-=8);for(x=x<<M|K,B+=M;B>0;N[_+fe]=x&255,fe+=pe,x/=256,B-=8);N[_+fe-pe]|=ve*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(N){const g=t,_=F,R=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;N.Buffer=O,N.SlowBuffer=W,N.INSPECT_MAX_BYTES=50;const M=2147483647;N.kMaxLength=M;const{Uint8Array:I,ArrayBuffer:x,SharedArrayBuffer:K}=globalThis;O.TYPED_ARRAY_SUPPORT=L(),!O.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function L(){try{const E=new I(1),c={foo:function(){return 42}};return Object.setPrototypeOf(c,I.prototype),Object.setPrototypeOf(E,c),E.foo()===42}catch{return!1}}Object.defineProperty(O.prototype,"parent",{enumerable:!0,get:function(){if(O.isBuffer(this))return this.buffer}}),Object.defineProperty(O.prototype,"offset",{enumerable:!0,get:function(){if(O.isBuffer(this))return this.byteOffset}});function B(E){if(E>M)throw new RangeError('The value "'+E+'" is invalid for option "size"');const c=new I(E);return Object.setPrototypeOf(c,O.prototype),c}function O(E,c,u){if(typeof E=="number"){if(typeof c=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return pe(E)}return ne(E,c,u)}O.poolSize=8192;function ne(E,c,u){if(typeof E=="string")return ve(E,c);if(x.isView(E))return he(E);if(E==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof E);if(et(E,x)||E&&et(E.buffer,x)||typeof K<"u"&&(et(E,K)||E&&et(E.buffer,K)))return ke(E,c,u);if(typeof E=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const k=E.valueOf&&E.valueOf();if(k!=null&&k!==E)return O.from(k,c,u);const q=be(E);if(q)return q;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof E[Symbol.toPrimitive]=="function")return O.from(E[Symbol.toPrimitive]("string"),c,u);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof E)}O.from=function(E,c,u){return ne(E,c,u)},Object.setPrototypeOf(O.prototype,I.prototype),Object.setPrototypeOf(O,I);function ue(E){if(typeof E!="number")throw new TypeError('"size" argument must be of type number');if(E<0)throw new RangeError('The value "'+E+'" is invalid for option "size"')}function fe(E,c,u){return ue(E),E<=0?B(E):c!==void 0?typeof u=="string"?B(E).fill(c,u):B(E).fill(c):B(E)}O.alloc=function(E,c,u){return fe(E,c,u)};function pe(E){return ue(E),B(E<0?0:Le(E)|0)}O.allocUnsafe=function(E){return pe(E)},O.allocUnsafeSlow=function(E){return pe(E)};function ve(E,c){if((typeof c!="string"||c==="")&&(c="utf8"),!O.isEncoding(c))throw new TypeError("Unknown encoding: "+c);const u=Y(E,c)|0;let k=B(u);const q=k.write(E,c);return q!==u&&(k=k.slice(0,q)),k}function Ie(E){const c=E.length<0?0:Le(E.length)|0,u=B(c);for(let k=0;k<c;k+=1)u[k]=E[k]&255;return u}function he(E){if(et(E,I)){const c=new I(E);return ke(c.buffer,c.byteOffset,c.byteLength)}return Ie(E)}function ke(E,c,u){if(c<0||E.byteLength<c)throw new RangeError('"offset" is outside of buffer bounds');if(E.byteLength<c+(u||0))throw new RangeError('"length" is outside of buffer bounds');let k;return c===void 0&&u===void 0?k=new I(E):u===void 0?k=new I(E,c):k=new I(E,c,u),Object.setPrototypeOf(k,O.prototype),k}function be(E){if(O.isBuffer(E)){const c=Le(E.length)|0,u=B(c);return u.length===0||E.copy(u,0,0,c),u}if(E.length!==void 0)return typeof E.length!="number"||rn(E.length)?B(0):Ie(E);if(E.type==="Buffer"&&Array.isArray(E.data))return Ie(E.data)}function Le(E){if(E>=M)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+M.toString(16)+" bytes");return E|0}function W(E){return+E!=E&&(E=0),O.alloc(+E)}O.isBuffer=function(c){return c!=null&&c._isBuffer===!0&&c!==O.prototype},O.compare=function(c,u){if(et(c,I)&&(c=O.from(c,c.offset,c.byteLength)),et(u,I)&&(u=O.from(u,u.offset,u.byteLength)),!O.isBuffer(c)||!O.isBuffer(u))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(c===u)return 0;let k=c.length,q=u.length;for(let V=0,ee=Math.min(k,q);V<ee;++V)if(c[V]!==u[V]){k=c[V],q=u[V];break}return k<q?-1:q<k?1:0},O.isEncoding=function(c){switch(String(c).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},O.concat=function(c,u){if(!Array.isArray(c))throw new TypeError('"list" argument must be an Array of Buffers');if(c.length===0)return O.alloc(0);let k;if(u===void 0)for(u=0,k=0;k<c.length;++k)u+=c[k].length;const q=O.allocUnsafe(u);let V=0;for(k=0;k<c.length;++k){let ee=c[k];if(et(ee,I))V+ee.length>q.length?(O.isBuffer(ee)||(ee=O.from(ee)),ee.copy(q,V)):I.prototype.set.call(q,ee,V);else if(O.isBuffer(ee))ee.copy(q,V);else throw new TypeError('"list" argument must be an Array of Buffers');V+=ee.length}return q};function Y(E,c){if(O.isBuffer(E))return E.length;if(x.isView(E)||et(E,x))return E.byteLength;if(typeof E!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof E);const u=E.length,k=arguments.length>2&&arguments[2]===!0;if(!k&&u===0)return 0;let q=!1;for(;;)switch(c){case"ascii":case"latin1":case"binary":return u;case"utf8":case"utf-8":return Nt(E).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return u*2;case"hex":return u>>>1;case"base64":return Ot(E).length;default:if(q)return k?-1:Nt(E).length;c=(""+c).toLowerCase(),q=!0}}O.byteLength=Y;function J(E,c,u){let k=!1;if((c===void 0||c<0)&&(c=0),c>this.length||((u===void 0||u>this.length)&&(u=this.length),u<=0)||(u>>>=0,c>>>=0,u<=c))return"";for(E||(E="utf8");;)switch(E){case"hex":return s(this,c,u);case"utf8":case"utf-8":return $(this,c,u);case"ascii":return ce(this,c,u);case"latin1":case"binary":return m(this,c,u);case"base64":return oe(this,c,u);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return h(this,c,u);default:if(k)throw new TypeError("Unknown encoding: "+E);E=(E+"").toLowerCase(),k=!0}}O.prototype._isBuffer=!0;function U(E,c,u){const k=E[c];E[c]=E[u],E[u]=k}O.prototype.swap16=function(){const c=this.length;if(c%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let u=0;u<c;u+=2)U(this,u,u+1);return this},O.prototype.swap32=function(){const c=this.length;if(c%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let u=0;u<c;u+=4)U(this,u,u+3),U(this,u+1,u+2);return this},O.prototype.swap64=function(){const c=this.length;if(c%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let u=0;u<c;u+=8)U(this,u,u+7),U(this,u+1,u+6),U(this,u+2,u+5),U(this,u+3,u+4);return this},O.prototype.toString=function(){const c=this.length;return c===0?"":arguments.length===0?$(this,0,c):J.apply(this,arguments)},O.prototype.toLocaleString=O.prototype.toString,O.prototype.equals=function(c){if(!O.isBuffer(c))throw new TypeError("Argument must be a Buffer");return this===c?!0:O.compare(this,c)===0},O.prototype.inspect=function(){let c="";const u=N.INSPECT_MAX_BYTES;return c=this.toString("hex",0,u).replace(/(.{2})/g,"$1 ").trim(),this.length>u&&(c+=" ... "),"<Buffer "+c+">"},R&&(O.prototype[R]=O.prototype.inspect),O.prototype.compare=function(c,u,k,q,V){if(et(c,I)&&(c=O.from(c,c.offset,c.byteLength)),!O.isBuffer(c))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof c);if(u===void 0&&(u=0),k===void 0&&(k=c?c.length:0),q===void 0&&(q=0),V===void 0&&(V=this.length),u<0||k>c.length||q<0||V>this.length)throw new RangeError("out of range index");if(q>=V&&u>=k)return 0;if(q>=V)return-1;if(u>=k)return 1;if(u>>>=0,k>>>=0,q>>>=0,V>>>=0,this===c)return 0;let ee=V-q,we=k-u;const Ue=Math.min(ee,we),Fe=this.slice(q,V),Be=c.slice(u,k);for(let Ne=0;Ne<Ue;++Ne)if(Fe[Ne]!==Be[Ne]){ee=Fe[Ne],we=Be[Ne];break}return ee<we?-1:we<ee?1:0};function H(E,c,u,k,q){if(E.length===0)return-1;if(typeof u=="string"?(k=u,u=0):u>2147483647?u=2147483647:u<-2147483648&&(u=-2147483648),u=+u,rn(u)&&(u=q?0:E.length-1),u<0&&(u=E.length+u),u>=E.length){if(q)return-1;u=E.length-1}else if(u<0)if(q)u=0;else return-1;if(typeof c=="string"&&(c=O.from(c,k)),O.isBuffer(c))return c.length===0?-1:X(E,c,u,k,q);if(typeof c=="number")return c=c&255,typeof I.prototype.indexOf=="function"?q?I.prototype.indexOf.call(E,c,u):I.prototype.lastIndexOf.call(E,c,u):X(E,[c],u,k,q);throw new TypeError("val must be string, number or Buffer")}function X(E,c,u,k,q){let V=1,ee=E.length,we=c.length;if(k!==void 0&&(k=String(k).toLowerCase(),k==="ucs2"||k==="ucs-2"||k==="utf16le"||k==="utf-16le")){if(E.length<2||c.length<2)return-1;V=2,ee/=2,we/=2,u/=2}function Ue(Be,Ne){return V===1?Be[Ne]:Be.readUInt16BE(Ne*V)}let Fe;if(q){let Be=-1;for(Fe=u;Fe<ee;Fe++)if(Ue(E,Fe)===Ue(c,Be===-1?0:Fe-Be)){if(Be===-1&&(Be=Fe),Fe-Be+1===we)return Be*V}else Be!==-1&&(Fe-=Fe-Be),Be=-1}else for(u+we>ee&&(u=ee-we),Fe=u;Fe>=0;Fe--){let Be=!0;for(let Ne=0;Ne<we;Ne++)if(Ue(E,Fe+Ne)!==Ue(c,Ne)){Be=!1;break}if(Be)return Fe}return-1}O.prototype.includes=function(c,u,k){return this.indexOf(c,u,k)!==-1},O.prototype.indexOf=function(c,u,k){return H(this,c,u,k,!0)},O.prototype.lastIndexOf=function(c,u,k){return H(this,c,u,k,!1)};function re(E,c,u,k){u=Number(u)||0;const q=E.length-u;k?(k=Number(k),k>q&&(k=q)):k=q;const V=c.length;k>V/2&&(k=V/2);let ee;for(ee=0;ee<k;++ee){const we=parseInt(c.substr(ee*2,2),16);if(rn(we))return ee;E[u+ee]=we}return ee}function ae(E,c,u,k){return $t(Nt(c,E.length-u),E,u,k)}function A(E,c,u,k){return $t(ir(c),E,u,k)}function P(E,c,u,k){return $t(Ot(c),E,u,k)}function Z(E,c,u,k){return $t(jt(c,E.length-u),E,u,k)}O.prototype.write=function(c,u,k,q){if(u===void 0)q="utf8",k=this.length,u=0;else if(k===void 0&&typeof u=="string")q=u,k=this.length,u=0;else if(isFinite(u))u=u>>>0,isFinite(k)?(k=k>>>0,q===void 0&&(q="utf8")):(q=k,k=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const V=this.length-u;if((k===void 0||k>V)&&(k=V),c.length>0&&(k<0||u<0)||u>this.length)throw new RangeError("Attempt to write outside buffer bounds");q||(q="utf8");let ee=!1;for(;;)switch(q){case"hex":return re(this,c,u,k);case"utf8":case"utf-8":return ae(this,c,u,k);case"ascii":case"latin1":case"binary":return A(this,c,u,k);case"base64":return P(this,c,u,k);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Z(this,c,u,k);default:if(ee)throw new TypeError("Unknown encoding: "+q);q=(""+q).toLowerCase(),ee=!0}},O.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function oe(E,c,u){return c===0&&u===E.length?g.fromByteArray(E):g.fromByteArray(E.slice(c,u))}function $(E,c,u){u=Math.min(E.length,u);const k=[];let q=c;for(;q<u;){const V=E[q];let ee=null,we=V>239?4:V>223?3:V>191?2:1;if(q+we<=u){let Ue,Fe,Be,Ne;switch(we){case 1:V<128&&(ee=V);break;case 2:Ue=E[q+1],(Ue&192)===128&&(Ne=(V&31)<<6|Ue&63,Ne>127&&(ee=Ne));break;case 3:Ue=E[q+1],Fe=E[q+2],(Ue&192)===128&&(Fe&192)===128&&(Ne=(V&15)<<12|(Ue&63)<<6|Fe&63,Ne>2047&&(Ne<55296||Ne>57343)&&(ee=Ne));break;case 4:Ue=E[q+1],Fe=E[q+2],Be=E[q+3],(Ue&192)===128&&(Fe&192)===128&&(Be&192)===128&&(Ne=(V&15)<<18|(Ue&63)<<12|(Fe&63)<<6|Be&63,Ne>65535&&Ne<1114112&&(ee=Ne))}}ee===null?(ee=65533,we=1):ee>65535&&(ee-=65536,k.push(ee>>>10&1023|55296),ee=56320|ee&1023),k.push(ee),q+=we}return te(k)}const z=4096;function te(E){const c=E.length;if(c<=z)return String.fromCharCode.apply(String,E);let u="",k=0;for(;k<c;)u+=String.fromCharCode.apply(String,E.slice(k,k+=z));return u}function ce(E,c,u){let k="";u=Math.min(E.length,u);for(let q=c;q<u;++q)k+=String.fromCharCode(E[q]&127);return k}function m(E,c,u){let k="";u=Math.min(E.length,u);for(let q=c;q<u;++q)k+=String.fromCharCode(E[q]);return k}function s(E,c,u){const k=E.length;(!c||c<0)&&(c=0),(!u||u<0||u>k)&&(u=k);let q="";for(let V=c;V<u;++V)q+=sr[E[V]];return q}function h(E,c,u){const k=E.slice(c,u);let q="";for(let V=0;V<k.length-1;V+=2)q+=String.fromCharCode(k[V]+k[V+1]*256);return q}O.prototype.slice=function(c,u){const k=this.length;c=~~c,u=u===void 0?k:~~u,c<0?(c+=k,c<0&&(c=0)):c>k&&(c=k),u<0?(u+=k,u<0&&(u=0)):u>k&&(u=k),u<c&&(u=c);const q=this.subarray(c,u);return Object.setPrototypeOf(q,O.prototype),q};function y(E,c,u){if(E%1!==0||E<0)throw new RangeError("offset is not uint");if(E+c>u)throw new RangeError("Trying to access beyond buffer length")}O.prototype.readUintLE=O.prototype.readUIntLE=function(c,u,k){c=c>>>0,u=u>>>0,k||y(c,u,this.length);let q=this[c],V=1,ee=0;for(;++ee<u&&(V*=256);)q+=this[c+ee]*V;return q},O.prototype.readUintBE=O.prototype.readUIntBE=function(c,u,k){c=c>>>0,u=u>>>0,k||y(c,u,this.length);let q=this[c+--u],V=1;for(;u>0&&(V*=256);)q+=this[c+--u]*V;return q},O.prototype.readUint8=O.prototype.readUInt8=function(c,u){return c=c>>>0,u||y(c,1,this.length),this[c]},O.prototype.readUint16LE=O.prototype.readUInt16LE=function(c,u){return c=c>>>0,u||y(c,2,this.length),this[c]|this[c+1]<<8},O.prototype.readUint16BE=O.prototype.readUInt16BE=function(c,u){return c=c>>>0,u||y(c,2,this.length),this[c]<<8|this[c+1]},O.prototype.readUint32LE=O.prototype.readUInt32LE=function(c,u){return c=c>>>0,u||y(c,4,this.length),(this[c]|this[c+1]<<8|this[c+2]<<16)+this[c+3]*16777216},O.prototype.readUint32BE=O.prototype.readUInt32BE=function(c,u){return c=c>>>0,u||y(c,4,this.length),this[c]*16777216+(this[c+1]<<16|this[c+2]<<8|this[c+3])},O.prototype.readBigUInt64LE=De(function(c){c=c>>>0,Je(c,"offset");const u=this[c],k=this[c+7];(u===void 0||k===void 0)&&He(c,this.length-8);const q=u+this[++c]*2**8+this[++c]*2**16+this[++c]*2**24,V=this[++c]+this[++c]*2**8+this[++c]*2**16+k*2**24;return BigInt(q)+(BigInt(V)<<BigInt(32))}),O.prototype.readBigUInt64BE=De(function(c){c=c>>>0,Je(c,"offset");const u=this[c],k=this[c+7];(u===void 0||k===void 0)&&He(c,this.length-8);const q=u*2**24+this[++c]*2**16+this[++c]*2**8+this[++c],V=this[++c]*2**24+this[++c]*2**16+this[++c]*2**8+k;return(BigInt(q)<<BigInt(32))+BigInt(V)}),O.prototype.readIntLE=function(c,u,k){c=c>>>0,u=u>>>0,k||y(c,u,this.length);let q=this[c],V=1,ee=0;for(;++ee<u&&(V*=256);)q+=this[c+ee]*V;return V*=128,q>=V&&(q-=Math.pow(2,8*u)),q},O.prototype.readIntBE=function(c,u,k){c=c>>>0,u=u>>>0,k||y(c,u,this.length);let q=u,V=1,ee=this[c+--q];for(;q>0&&(V*=256);)ee+=this[c+--q]*V;return V*=128,ee>=V&&(ee-=Math.pow(2,8*u)),ee},O.prototype.readInt8=function(c,u){return c=c>>>0,u||y(c,1,this.length),this[c]&128?(255-this[c]+1)*-1:this[c]},O.prototype.readInt16LE=function(c,u){c=c>>>0,u||y(c,2,this.length);const k=this[c]|this[c+1]<<8;return k&32768?k|4294901760:k},O.prototype.readInt16BE=function(c,u){c=c>>>0,u||y(c,2,this.length);const k=this[c+1]|this[c]<<8;return k&32768?k|4294901760:k},O.prototype.readInt32LE=function(c,u){return c=c>>>0,u||y(c,4,this.length),this[c]|this[c+1]<<8|this[c+2]<<16|this[c+3]<<24},O.prototype.readInt32BE=function(c,u){return c=c>>>0,u||y(c,4,this.length),this[c]<<24|this[c+1]<<16|this[c+2]<<8|this[c+3]},O.prototype.readBigInt64LE=De(function(c){c=c>>>0,Je(c,"offset");const u=this[c],k=this[c+7];(u===void 0||k===void 0)&&He(c,this.length-8);const q=this[c+4]+this[c+5]*2**8+this[c+6]*2**16+(k<<24);return(BigInt(q)<<BigInt(32))+BigInt(u+this[++c]*2**8+this[++c]*2**16+this[++c]*2**24)}),O.prototype.readBigInt64BE=De(function(c){c=c>>>0,Je(c,"offset");const u=this[c],k=this[c+7];(u===void 0||k===void 0)&&He(c,this.length-8);const q=(u<<24)+this[++c]*2**16+this[++c]*2**8+this[++c];return(BigInt(q)<<BigInt(32))+BigInt(this[++c]*2**24+this[++c]*2**16+this[++c]*2**8+k)}),O.prototype.readFloatLE=function(c,u){return c=c>>>0,u||y(c,4,this.length),_.read(this,c,!0,23,4)},O.prototype.readFloatBE=function(c,u){return c=c>>>0,u||y(c,4,this.length),_.read(this,c,!1,23,4)},O.prototype.readDoubleLE=function(c,u){return c=c>>>0,u||y(c,8,this.length),_.read(this,c,!0,52,8)},O.prototype.readDoubleBE=function(c,u){return c=c>>>0,u||y(c,8,this.length),_.read(this,c,!1,52,8)};function D(E,c,u,k,q,V){if(!O.isBuffer(E))throw new TypeError('"buffer" argument must be a Buffer instance');if(c>q||c<V)throw new RangeError('"value" argument is out of bounds');if(u+k>E.length)throw new RangeError("Index out of range")}O.prototype.writeUintLE=O.prototype.writeUIntLE=function(c,u,k,q){if(c=+c,u=u>>>0,k=k>>>0,!q){const we=Math.pow(2,8*k)-1;D(this,c,u,k,we,0)}let V=1,ee=0;for(this[u]=c&255;++ee<k&&(V*=256);)this[u+ee]=c/V&255;return u+k},O.prototype.writeUintBE=O.prototype.writeUIntBE=function(c,u,k,q){if(c=+c,u=u>>>0,k=k>>>0,!q){const we=Math.pow(2,8*k)-1;D(this,c,u,k,we,0)}let V=k-1,ee=1;for(this[u+V]=c&255;--V>=0&&(ee*=256);)this[u+V]=c/ee&255;return u+k},O.prototype.writeUint8=O.prototype.writeUInt8=function(c,u,k){return c=+c,u=u>>>0,k||D(this,c,u,1,255,0),this[u]=c&255,u+1},O.prototype.writeUint16LE=O.prototype.writeUInt16LE=function(c,u,k){return c=+c,u=u>>>0,k||D(this,c,u,2,65535,0),this[u]=c&255,this[u+1]=c>>>8,u+2},O.prototype.writeUint16BE=O.prototype.writeUInt16BE=function(c,u,k){return c=+c,u=u>>>0,k||D(this,c,u,2,65535,0),this[u]=c>>>8,this[u+1]=c&255,u+2},O.prototype.writeUint32LE=O.prototype.writeUInt32LE=function(c,u,k){return c=+c,u=u>>>0,k||D(this,c,u,4,4294967295,0),this[u+3]=c>>>24,this[u+2]=c>>>16,this[u+1]=c>>>8,this[u]=c&255,u+4},O.prototype.writeUint32BE=O.prototype.writeUInt32BE=function(c,u,k){return c=+c,u=u>>>0,k||D(this,c,u,4,4294967295,0),this[u]=c>>>24,this[u+1]=c>>>16,this[u+2]=c>>>8,this[u+3]=c&255,u+4};function G(E,c,u,k,q){at(c,k,q,E,u,7);let V=Number(c&BigInt(4294967295));E[u++]=V,V=V>>8,E[u++]=V,V=V>>8,E[u++]=V,V=V>>8,E[u++]=V;let ee=Number(c>>BigInt(32)&BigInt(4294967295));return E[u++]=ee,ee=ee>>8,E[u++]=ee,ee=ee>>8,E[u++]=ee,ee=ee>>8,E[u++]=ee,u}function Q(E,c,u,k,q){at(c,k,q,E,u,7);let V=Number(c&BigInt(4294967295));E[u+7]=V,V=V>>8,E[u+6]=V,V=V>>8,E[u+5]=V,V=V>>8,E[u+4]=V;let ee=Number(c>>BigInt(32)&BigInt(4294967295));return E[u+3]=ee,ee=ee>>8,E[u+2]=ee,ee=ee>>8,E[u+1]=ee,ee=ee>>8,E[u]=ee,u+8}O.prototype.writeBigUInt64LE=De(function(c,u=0){return G(this,c,u,BigInt(0),BigInt("0xffffffffffffffff"))}),O.prototype.writeBigUInt64BE=De(function(c,u=0){return Q(this,c,u,BigInt(0),BigInt("0xffffffffffffffff"))}),O.prototype.writeIntLE=function(c,u,k,q){if(c=+c,u=u>>>0,!q){const Ue=Math.pow(2,8*k-1);D(this,c,u,k,Ue-1,-Ue)}let V=0,ee=1,we=0;for(this[u]=c&255;++V<k&&(ee*=256);)c<0&&we===0&&this[u+V-1]!==0&&(we=1),this[u+V]=(c/ee>>0)-we&255;return u+k},O.prototype.writeIntBE=function(c,u,k,q){if(c=+c,u=u>>>0,!q){const Ue=Math.pow(2,8*k-1);D(this,c,u,k,Ue-1,-Ue)}let V=k-1,ee=1,we=0;for(this[u+V]=c&255;--V>=0&&(ee*=256);)c<0&&we===0&&this[u+V+1]!==0&&(we=1),this[u+V]=(c/ee>>0)-we&255;return u+k},O.prototype.writeInt8=function(c,u,k){return c=+c,u=u>>>0,k||D(this,c,u,1,127,-128),c<0&&(c=255+c+1),this[u]=c&255,u+1},O.prototype.writeInt16LE=function(c,u,k){return c=+c,u=u>>>0,k||D(this,c,u,2,32767,-32768),this[u]=c&255,this[u+1]=c>>>8,u+2},O.prototype.writeInt16BE=function(c,u,k){return c=+c,u=u>>>0,k||D(this,c,u,2,32767,-32768),this[u]=c>>>8,this[u+1]=c&255,u+2},O.prototype.writeInt32LE=function(c,u,k){return c=+c,u=u>>>0,k||D(this,c,u,4,2147483647,-2147483648),this[u]=c&255,this[u+1]=c>>>8,this[u+2]=c>>>16,this[u+3]=c>>>24,u+4},O.prototype.writeInt32BE=function(c,u,k){return c=+c,u=u>>>0,k||D(this,c,u,4,2147483647,-2147483648),c<0&&(c=4294967295+c+1),this[u]=c>>>24,this[u+1]=c>>>16,this[u+2]=c>>>8,this[u+3]=c&255,u+4},O.prototype.writeBigInt64LE=De(function(c,u=0){return G(this,c,u,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),O.prototype.writeBigInt64BE=De(function(c,u=0){return Q(this,c,u,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function le(E,c,u,k,q,V){if(u+k>E.length)throw new RangeError("Index out of range");if(u<0)throw new RangeError("Index out of range")}function ye(E,c,u,k,q){return c=+c,u=u>>>0,q||le(E,c,u,4),_.write(E,c,u,k,23,4),u+4}O.prototype.writeFloatLE=function(c,u,k){return ye(this,c,u,!0,k)},O.prototype.writeFloatBE=function(c,u,k){return ye(this,c,u,!1,k)};function Te(E,c,u,k,q){return c=+c,u=u>>>0,q||le(E,c,u,8),_.write(E,c,u,k,52,8),u+8}O.prototype.writeDoubleLE=function(c,u,k){return Te(this,c,u,!0,k)},O.prototype.writeDoubleBE=function(c,u,k){return Te(this,c,u,!1,k)},O.prototype.copy=function(c,u,k,q){if(!O.isBuffer(c))throw new TypeError("argument should be a Buffer");if(k||(k=0),!q&&q!==0&&(q=this.length),u>=c.length&&(u=c.length),u||(u=0),q>0&&q<k&&(q=k),q===k||c.length===0||this.length===0)return 0;if(u<0)throw new RangeError("targetStart out of bounds");if(k<0||k>=this.length)throw new RangeError("Index out of range");if(q<0)throw new RangeError("sourceEnd out of bounds");q>this.length&&(q=this.length),c.length-u<q-k&&(q=c.length-u+k);const V=q-k;return this===c&&typeof I.prototype.copyWithin=="function"?this.copyWithin(u,k,q):I.prototype.set.call(c,this.subarray(k,q),u),V},O.prototype.fill=function(c,u,k,q){if(typeof c=="string"){if(typeof u=="string"?(q=u,u=0,k=this.length):typeof k=="string"&&(q=k,k=this.length),q!==void 0&&typeof q!="string")throw new TypeError("encoding must be a string");if(typeof q=="string"&&!O.isEncoding(q))throw new TypeError("Unknown encoding: "+q);if(c.length===1){const ee=c.charCodeAt(0);(q==="utf8"&&ee<128||q==="latin1")&&(c=ee)}}else typeof c=="number"?c=c&255:typeof c=="boolean"&&(c=Number(c));if(u<0||this.length<u||this.length<k)throw new RangeError("Out of range index");if(k<=u)return this;u=u>>>0,k=k===void 0?this.length:k>>>0,c||(c=0);let V;if(typeof c=="number")for(V=u;V<k;++V)this[V]=c;else{const ee=O.isBuffer(c)?c:O.from(c,q),we=ee.length;if(we===0)throw new TypeError('The value "'+c+'" is invalid for argument "value"');for(V=0;V<k-u;++V)this[V+u]=ee[V%we]}return this};const me={};function _e(E,c,u){me[E]=class extends u{constructor(){super(),Object.defineProperty(this,"message",{value:c.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${E}]`,this.stack,delete this.name}get code(){return E}set code(q){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:q,writable:!0})}toString(){return`${this.name} [${E}]: ${this.message}`}}}_e("ERR_BUFFER_OUT_OF_BOUNDS",function(E){return E?`${E} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),_e("ERR_INVALID_ARG_TYPE",function(E,c){return`The "${E}" argument must be of type number. Received type ${typeof c}`},TypeError),_e("ERR_OUT_OF_RANGE",function(E,c,u){let k=`The value of "${E}" is out of range.`,q=u;return Number.isInteger(u)&&Math.abs(u)>2**32?q=je(String(u)):typeof u=="bigint"&&(q=String(u),(u>BigInt(2)**BigInt(32)||u<-(BigInt(2)**BigInt(32)))&&(q=je(q)),q+="n"),k+=` It must be ${c}. Received ${q}`,k},RangeError);function je(E){let c="",u=E.length;const k=E[0]==="-"?1:0;for(;u>=k+4;u-=3)c=`_${E.slice(u-3,u)}${c}`;return`${E.slice(0,u)}${c}`}function ut(E,c,u){Je(c,"offset"),(E[c]===void 0||E[c+u]===void 0)&&He(c,E.length-(u+1))}function at(E,c,u,k,q,V){if(E>u||E<c){const ee=typeof c=="bigint"?"n":"";let we;throw c===0||c===BigInt(0)?we=`>= 0${ee} and < 2${ee} ** ${(V+1)*8}${ee}`:we=`>= -(2${ee} ** ${(V+1)*8-1}${ee}) and < 2 ** ${(V+1)*8-1}${ee}`,new me.ERR_OUT_OF_RANGE("value",we,E)}ut(k,q,V)}function Je(E,c){if(typeof E!="number")throw new me.ERR_INVALID_ARG_TYPE(c,"number",E)}function He(E,c,u){throw Math.floor(E)!==E?(Je(E,u),new me.ERR_OUT_OF_RANGE("offset","an integer",E)):c<0?new me.ERR_BUFFER_OUT_OF_BOUNDS:new me.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${c}`,E)}const nt=/[^+/0-9A-Za-z-_]/g;function nn(E){if(E=E.split("=")[0],E=E.trim().replace(nt,""),E.length<2)return"";for(;E.length%4!==0;)E=E+"=";return E}function Nt(E,c){c=c||1/0;let u;const k=E.length;let q=null;const V=[];for(let ee=0;ee<k;++ee){if(u=E.charCodeAt(ee),u>55295&&u<57344){if(!q){if(u>56319){(c-=3)>-1&&V.push(239,191,189);continue}else if(ee+1===k){(c-=3)>-1&&V.push(239,191,189);continue}q=u;continue}if(u<56320){(c-=3)>-1&&V.push(239,191,189),q=u;continue}u=(q-55296<<10|u-56320)+65536}else q&&(c-=3)>-1&&V.push(239,191,189);if(q=null,u<128){if((c-=1)<0)break;V.push(u)}else if(u<2048){if((c-=2)<0)break;V.push(u>>6|192,u&63|128)}else if(u<65536){if((c-=3)<0)break;V.push(u>>12|224,u>>6&63|128,u&63|128)}else if(u<1114112){if((c-=4)<0)break;V.push(u>>18|240,u>>12&63|128,u>>6&63|128,u&63|128)}else throw new Error("Invalid code point")}return V}function ir(E){const c=[];for(let u=0;u<E.length;++u)c.push(E.charCodeAt(u)&255);return c}function jt(E,c){let u,k,q;const V=[];for(let ee=0;ee<E.length&&!((c-=2)<0);++ee)u=E.charCodeAt(ee),k=u>>8,q=u%256,V.push(q),V.push(k);return V}function Ot(E){return g.toByteArray(nn(E))}function $t(E,c,u,k){let q;for(q=0;q<k&&!(q+u>=c.length||q>=E.length);++q)c[q+u]=E[q];return q}function et(E,c){return E instanceof c||E!=null&&E.constructor!=null&&E.constructor.name!=null&&E.constructor.name===c.name}function rn(E){return E!==E}const sr=function(){const E="0123456789abcdef",c=new Array(256);for(let u=0;u<16;++u){const k=u*16;for(let q=0;q<16;++q)c[k+q]=E[u]+E[q]}return c}();function De(E){return typeof BigInt>"u"?Pt:E}function Pt(){throw new Error("BigInt not supported")}})(e);const S=e.Buffer;r.Blob=e.Blob,r.BlobOptions=e.BlobOptions,r.Buffer=e.Buffer,r.File=e.File,r.FileOptions=e.FileOptions,r.INSPECT_MAX_BYTES=e.INSPECT_MAX_BYTES,r.SlowBuffer=e.SlowBuffer,r.TranscodeEncoding=e.TranscodeEncoding,r.atob=e.atob,r.btoa=e.btoa,r.constants=e.constants,r.default=S,r.isAscii=e.isAscii,r.isUtf8=e.isUtf8,r.kMaxLength=e.kMaxLength,r.kStringMaxLength=e.kStringMaxLength,r.resolveObjectURL=e.resolveObjectURL,r.transcode=e.transcode})(Jt);/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */(function(r,e){var t=Jt,n=t.Buffer;function i(a,l){for(var f in a)l[f]=a[f]}n.from&&n.alloc&&n.allocUnsafe&&n.allocUnsafeSlow?r.exports=t:(i(t,e),e.Buffer=o);function o(a,l,f){return n(a,l,f)}o.prototype=Object.create(n.prototype),i(n,o),o.from=function(a,l,f){if(typeof a=="number")throw new TypeError("Argument must not be a number");return n(a,l,f)},o.alloc=function(a,l,f){if(typeof a!="number")throw new TypeError("Argument must be a number");var p=n(a);return l!==void 0?typeof f=="string"?p.fill(l,f):p.fill(l):p.fill(0),p},o.allocUnsafe=function(a){if(typeof a!="number")throw new TypeError("Argument must be a number");return n(a)},o.allocUnsafeSlow=function(a){if(typeof a!="number")throw new TypeError("Argument must be a number");return t.SlowBuffer(a)}})($r,$r.exports);var qs=$r.exports,ur=65536,da=4294967295;function pa(){throw new Error(`Secure random number generation is not supported by this browser.
Use Chrome, Firefox or Internet Explorer 11`)}var ga=qs.Buffer,$n=Ke.crypto||Ke.msCrypto;$n&&$n.getRandomValues?jr.exports=ya:jr.exports=pa;function ya(r,e){if(r>da)throw new RangeError("requested too many random bytes");var t=ga.allocUnsafe(r);if(r>0)if(r>ur)for(var n=0;n<r;n+=ur)$n.getRandomValues(t.slice(n,n+ur));else $n.getRandomValues(t);return typeof e=="function"?Ee.nextTick(function(){e(null,t)}):t}var ma=jr.exports,Hr={exports:{}},oi={exports:{}},Yt=typeof Reflect=="object"?Reflect:null,Di=Yt&&typeof Yt.apply=="function"?Yt.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)},Mn;Yt&&typeof Yt.ownKeys=="function"?Mn=Yt.ownKeys:Object.getOwnPropertySymbols?Mn=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Mn=function(e){return Object.getOwnPropertyNames(e)};function wa(r){console&&console.warn&&console.warn(r)}var Ws=Number.isNaN||function(e){return e!==e};function xe(){xe.init.call(this)}oi.exports=xe;oi.exports.once=va;xe.EventEmitter=xe;xe.prototype._events=void 0;xe.prototype._eventsCount=0;xe.prototype._maxListeners=void 0;var Fi=10;function Vn(r){if(typeof r!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof r)}Object.defineProperty(xe,"defaultMaxListeners",{enumerable:!0,get:function(){return Fi},set:function(r){if(typeof r!="number"||r<0||Ws(r))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+r+".");Fi=r}});xe.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};xe.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||Ws(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function Ks(r){return r._maxListeners===void 0?xe.defaultMaxListeners:r._maxListeners}xe.prototype.getMaxListeners=function(){return Ks(this)};xe.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var i=e==="error",o=this._events;if(o!==void 0)i=i&&o.error===void 0;else if(!i)return!1;if(i){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var l=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw l.context=a,l}var f=o[e];if(f===void 0)return!1;if(typeof f=="function")Di(f,this,t);else for(var p=f.length,b=Qs(f,p),n=0;n<p;++n)Di(b[n],this,t);return!0};function zs(r,e,t,n){var i,o,a;if(Vn(t),o=r._events,o===void 0?(o=r._events=Object.create(null),r._eventsCount=0):(o.newListener!==void 0&&(r.emit("newListener",e,t.listener?t.listener:t),o=r._events),a=o[e]),a===void 0)a=o[e]=t,++r._eventsCount;else if(typeof a=="function"?a=o[e]=n?[t,a]:[a,t]:n?a.unshift(t):a.push(t),i=Ks(r),i>0&&a.length>i&&!a.warned){a.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=r,l.type=e,l.count=a.length,wa(l)}return r}xe.prototype.addListener=function(e,t){return zs(this,e,t,!1)};xe.prototype.on=xe.prototype.addListener;xe.prototype.prependListener=function(e,t){return zs(this,e,t,!0)};function _a(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Gs(r,e,t){var n={fired:!1,wrapFn:void 0,target:r,type:e,listener:t},i=_a.bind(n);return i.listener=t,n.wrapFn=i,i}xe.prototype.once=function(e,t){return Vn(t),this.on(e,Gs(this,e,t)),this};xe.prototype.prependOnceListener=function(e,t){return Vn(t),this.prependListener(e,Gs(this,e,t)),this};xe.prototype.removeListener=function(e,t){var n,i,o,a,l;if(Vn(t),i=this._events,i===void 0)return this;if(n=i[e],n===void 0)return this;if(n===t||n.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if(typeof n!="function"){for(o=-1,a=n.length-1;a>=0;a--)if(n[a]===t||n[a].listener===t){l=n[a].listener,o=a;break}if(o<0)return this;o===0?n.shift():ba(n,o),n.length===1&&(i[e]=n[0]),i.removeListener!==void 0&&this.emit("removeListener",e,l||t)}return this};xe.prototype.off=xe.prototype.removeListener;xe.prototype.removeAllListeners=function(e){var t,n,i;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete n[e]),this;if(arguments.length===0){var o=Object.keys(n),a;for(i=0;i<o.length;++i)a=o[i],a!=="removeListener"&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=n[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this};function Ys(r,e,t){var n=r._events;if(n===void 0)return[];var i=n[e];return i===void 0?[]:typeof i=="function"?t?[i.listener||i]:[i]:t?Ea(i):Qs(i,i.length)}xe.prototype.listeners=function(e){return Ys(this,e,!0)};xe.prototype.rawListeners=function(e){return Ys(this,e,!1)};xe.listenerCount=function(r,e){return typeof r.listenerCount=="function"?r.listenerCount(e):Vs.call(r,e)};xe.prototype.listenerCount=Vs;function Vs(r){var e=this._events;if(e!==void 0){var t=e[r];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}xe.prototype.eventNames=function(){return this._eventsCount>0?Mn(this._events):[]};function Qs(r,e){for(var t=new Array(e),n=0;n<e;++n)t[n]=r[n];return t}function ba(r,e){for(;e+1<r.length;e++)r[e]=r[e+1];r.pop()}function Ea(r){for(var e=new Array(r.length),t=0;t<e.length;++t)e[t]=r[t].listener||r[t];return e}function va(r,e){return new Promise(function(t,n){function i(a){r.removeListener(e,o),n(a)}function o(){typeof r.removeListener=="function"&&r.removeListener("error",i),t([].slice.call(arguments))}Xs(r,e,o,{once:!0}),e!=="error"&&Ta(r,i,{once:!0})})}function Ta(r,e,t){typeof r.on=="function"&&Xs(r,"error",e,t)}function Xs(r,e,t,n){if(typeof r.on=="function")n.once?r.once(e,t):r.on(e,t);else if(typeof r.addEventListener=="function")r.addEventListener(e,function i(o){n.once&&r.removeEventListener(e,i),t(o)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof r)}var Js=oi.exports,Zs=Js.EventEmitter,ai={},eo={},to=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var e={},t=Symbol("test"),n=Object(t);if(typeof t=="string"||Object.prototype.toString.call(t)!=="[object Symbol]"||Object.prototype.toString.call(n)!=="[object Symbol]")return!1;var i=42;e[t]=i;for(var o in e)return!1;if(typeof Object.keys=="function"&&Object.keys(e).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(e).length!==0)return!1;var a=Object.getOwnPropertySymbols(e);if(a.length!==1||a[0]!==t||!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var l=Object.getOwnPropertyDescriptor(e,t);if(l.value!==i||l.enumerable!==!0)return!1}return!0},Ra=to,Qn=function(){return Ra()&&!!Symbol.toStringTag},no=Object,Sa=Error,Ca=EvalError,Aa=RangeError,Ia=ReferenceError,ro=SyntaxError,wn=TypeError,Pa=URIError,ka=Math.abs,Na=Math.floor,Oa=Math.max,Ma=Math.min,xa=Math.pow,La=Math.round,Da=Number.isNaN||function(e){return e!==e},Fa=Da,Ba=function(e){return Fa(e)||e===0?e:e<0?-1:1},Ua=Object.getOwnPropertyDescriptor,xn=Ua;if(xn)try{xn([],"length")}catch{xn=null}var Zt=xn,Ln=Object.defineProperty||!1;if(Ln)try{Ln({},"a",{value:1})}catch{Ln=!1}var Xn=Ln,fr,Bi;function ja(){if(Bi)return fr;Bi=1;var r=typeof Symbol<"u"&&Symbol,e=to;return fr=function(){return typeof r!="function"||typeof Symbol!="function"||typeof r("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:e()},fr}var io=typeof Reflect<"u"&&Reflect.getPrototypeOf||null,$a=no,so=$a.getPrototypeOf||null,Ha="Function.prototype.bind called on incompatible ",qa=Object.prototype.toString,Wa=Math.max,Ka="[object Function]",Ui=function(e,t){for(var n=[],i=0;i<e.length;i+=1)n[i]=e[i];for(var o=0;o<t.length;o+=1)n[o+e.length]=t[o];return n},za=function(e,t){for(var n=[],i=t,o=0;i<e.length;i+=1,o+=1)n[o]=e[i];return n},Ga=function(r,e){for(var t="",n=0;n<r.length;n+=1)t+=r[n],n+1<r.length&&(t+=e);return t},Ya=function(e){var t=this;if(typeof t!="function"||qa.apply(t)!==Ka)throw new TypeError(Ha+t);for(var n=za(arguments,1),i,o=function(){if(this instanceof i){var b=t.apply(this,Ui(n,arguments));return Object(b)===b?b:this}return t.apply(e,Ui(n,arguments))},a=Wa(0,t.length-n.length),l=[],f=0;f<a;f++)l[f]="$"+f;if(i=Function("binder","return function ("+Ga(l,",")+"){ return binder.apply(this,arguments); }")(o),t.prototype){var p=function(){};p.prototype=t.prototype,i.prototype=new p,p.prototype=null}return i},Va=Ya,_n=Function.prototype.bind||Va,ci=Function.prototype.call,li=Function.prototype.apply,Qa=typeof Reflect<"u"&&Reflect&&Reflect.apply,Xa=_n,Ja=li,Za=ci,ec=Qa,oo=ec||Xa.call(Za,Ja),tc=_n,nc=wn,rc=ci,ic=oo,ui=function(e){if(e.length<1||typeof e[0]!="function")throw new nc("a function is required");return ic(tc,rc,e)},sc=ui,ji=Zt,ao;try{ao=[].__proto__===Array.prototype}catch(r){if(!r||typeof r!="object"||!("code"in r)||r.code!=="ERR_PROTO_ACCESS")throw r}var hr=!!ao&&ji&&ji(Object.prototype,"__proto__"),co=Object,$i=co.getPrototypeOf,oc=hr&&typeof hr.get=="function"?sc([hr.get]):typeof $i=="function"?function(e){return $i(e==null?e:co(e))}:!1,Hi=io,qi=so,Wi=oc,fi=Hi?function(e){return Hi(e)}:qi?function(e){if(!e||typeof e!="object"&&typeof e!="function")throw new TypeError("getProto: not an object");return qi(e)}:Wi?function(e){return Wi(e)}:null,ac=Function.prototype.call,cc=Object.prototype.hasOwnProperty,lc=_n,lo=lc.call(ac,cc),Se,uc=no,fc=Sa,hc=Ca,dc=Aa,pc=Ia,Qt=ro,Vt=wn,gc=Pa,yc=ka,mc=Na,wc=Oa,_c=Ma,bc=xa,Ec=La,vc=Ba,uo=Function,dr=function(r){try{return uo('"use strict"; return ('+r+").constructor;")()}catch{}},yn=Zt,Tc=Xn,pr=function(){throw new Vt},Rc=yn?function(){try{return arguments.callee,pr}catch{try{return yn(arguments,"callee").get}catch{return pr}}}():pr,qt=ja()(),Xe=fi,Sc=so,Cc=io,fo=li,bn=ci,Kt={},Ac=typeof Uint8Array>"u"||!Xe?Se:Xe(Uint8Array),Lt={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?Se:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?Se:ArrayBuffer,"%ArrayIteratorPrototype%":qt&&Xe?Xe([][Symbol.iterator]()):Se,"%AsyncFromSyncIteratorPrototype%":Se,"%AsyncFunction%":Kt,"%AsyncGenerator%":Kt,"%AsyncGeneratorFunction%":Kt,"%AsyncIteratorPrototype%":Kt,"%Atomics%":typeof Atomics>"u"?Se:Atomics,"%BigInt%":typeof BigInt>"u"?Se:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?Se:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?Se:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?Se:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":fc,"%eval%":eval,"%EvalError%":hc,"%Float16Array%":typeof Float16Array>"u"?Se:Float16Array,"%Float32Array%":typeof Float32Array>"u"?Se:Float32Array,"%Float64Array%":typeof Float64Array>"u"?Se:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?Se:FinalizationRegistry,"%Function%":uo,"%GeneratorFunction%":Kt,"%Int8Array%":typeof Int8Array>"u"?Se:Int8Array,"%Int16Array%":typeof Int16Array>"u"?Se:Int16Array,"%Int32Array%":typeof Int32Array>"u"?Se:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":qt&&Xe?Xe(Xe([][Symbol.iterator]())):Se,"%JSON%":typeof JSON=="object"?JSON:Se,"%Map%":typeof Map>"u"?Se:Map,"%MapIteratorPrototype%":typeof Map>"u"||!qt||!Xe?Se:Xe(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":uc,"%Object.getOwnPropertyDescriptor%":yn,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?Se:Promise,"%Proxy%":typeof Proxy>"u"?Se:Proxy,"%RangeError%":dc,"%ReferenceError%":pc,"%Reflect%":typeof Reflect>"u"?Se:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?Se:Set,"%SetIteratorPrototype%":typeof Set>"u"||!qt||!Xe?Se:Xe(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?Se:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":qt&&Xe?Xe(""[Symbol.iterator]()):Se,"%Symbol%":qt?Symbol:Se,"%SyntaxError%":Qt,"%ThrowTypeError%":Rc,"%TypedArray%":Ac,"%TypeError%":Vt,"%Uint8Array%":typeof Uint8Array>"u"?Se:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?Se:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?Se:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?Se:Uint32Array,"%URIError%":gc,"%WeakMap%":typeof WeakMap>"u"?Se:WeakMap,"%WeakRef%":typeof WeakRef>"u"?Se:WeakRef,"%WeakSet%":typeof WeakSet>"u"?Se:WeakSet,"%Function.prototype.call%":bn,"%Function.prototype.apply%":fo,"%Object.defineProperty%":Tc,"%Object.getPrototypeOf%":Sc,"%Math.abs%":yc,"%Math.floor%":mc,"%Math.max%":wc,"%Math.min%":_c,"%Math.pow%":bc,"%Math.round%":Ec,"%Math.sign%":vc,"%Reflect.getPrototypeOf%":Cc};if(Xe)try{null.error}catch(r){var Ic=Xe(Xe(r));Lt["%Error.prototype%"]=Ic}var Pc=function r(e){var t;if(e==="%AsyncFunction%")t=dr("async function () {}");else if(e==="%GeneratorFunction%")t=dr("function* () {}");else if(e==="%AsyncGeneratorFunction%")t=dr("async function* () {}");else if(e==="%AsyncGenerator%"){var n=r("%AsyncGeneratorFunction%");n&&(t=n.prototype)}else if(e==="%AsyncIteratorPrototype%"){var i=r("%AsyncGenerator%");i&&Xe&&(t=Xe(i.prototype))}return Lt[e]=t,t},Ki={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},En=_n,Hn=lo,kc=En.call(bn,Array.prototype.concat),Nc=En.call(fo,Array.prototype.splice),zi=En.call(bn,String.prototype.replace),qn=En.call(bn,String.prototype.slice),Oc=En.call(bn,RegExp.prototype.exec),Mc=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,xc=/\\(\\)?/g,Lc=function(e){var t=qn(e,0,1),n=qn(e,-1);if(t==="%"&&n!=="%")throw new Qt("invalid intrinsic syntax, expected closing `%`");if(n==="%"&&t!=="%")throw new Qt("invalid intrinsic syntax, expected opening `%`");var i=[];return zi(e,Mc,function(o,a,l,f){i[i.length]=l?zi(f,xc,"$1"):a||o}),i},Dc=function(e,t){var n=e,i;if(Hn(Ki,n)&&(i=Ki[n],n="%"+i[0]+"%"),Hn(Lt,n)){var o=Lt[n];if(o===Kt&&(o=Pc(n)),typeof o>"u"&&!t)throw new Vt("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:i,name:n,value:o}}throw new Qt("intrinsic "+e+" does not exist!")},ho=function(e,t){if(typeof e!="string"||e.length===0)throw new Vt("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof t!="boolean")throw new Vt('"allowMissing" argument must be a boolean');if(Oc(/^%?[^%]*%?$/,e)===null)throw new Qt("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var n=Lc(e),i=n.length>0?n[0]:"",o=Dc("%"+i+"%",t),a=o.name,l=o.value,f=!1,p=o.alias;p&&(i=p[0],Nc(n,kc([0,1],p)));for(var b=1,d=!0;b<n.length;b+=1){var w=n[b],T=qn(w,0,1),v=qn(w,-1);if((T==='"'||T==="'"||T==="`"||v==='"'||v==="'"||v==="`")&&T!==v)throw new Qt("property names with quotes must have matching quotes");if((w==="constructor"||!d)&&(f=!0),i+="."+w,a="%"+i+"%",Hn(Lt,a))l=Lt[a];else if(l!=null){if(!(w in l)){if(!t)throw new Vt("base intrinsic for "+e+" exists, but the property is not available.");return}if(yn&&b+1>=n.length){var C=yn(l,w);d=!!C,d&&"get"in C&&!("originalValue"in C.get)?l=C.get:l=l[w]}else d=Hn(l,w),l=l[w];d&&!f&&(Lt[a]=l)}}return l},po=ho,go=ui,Fc=go([po("%String.prototype.indexOf%")]),vn=function(e,t){var n=po(e,!!t);return typeof n=="function"&&Fc(e,".prototype.")>-1?go([n]):n},Bc=Qn(),Uc=vn,qr=Uc("Object.prototype.toString"),Jn=function(e){return Bc&&e&&typeof e=="object"&&Symbol.toStringTag in e?!1:qr(e)==="[object Arguments]"},yo=function(e){return Jn(e)?!0:e!==null&&typeof e=="object"&&"length"in e&&typeof e.length=="number"&&e.length>=0&&qr(e)!=="[object Array]"&&"callee"in e&&qr(e.callee)==="[object Function]"},jc=function(){return Jn(arguments)}();Jn.isLegacyArguments=yo;var $c=jc?Jn:yo,Gi=vn,Hc=Qn(),qc=lo,Wc=Zt,Wr;if(Hc){var Kc=Gi("RegExp.prototype.exec"),Yi={},gr=function(){throw Yi},Vi={toString:gr,valueOf:gr};typeof Symbol.toPrimitive=="symbol"&&(Vi[Symbol.toPrimitive]=gr),Wr=function(e){if(!e||typeof e!="object")return!1;var t=Wc(e,"lastIndex"),n=t&&qc(t,"value");if(!n)return!1;try{Kc(e,Vi)}catch(i){return i===Yi}}}else{var zc=Gi("Object.prototype.toString"),Gc="[object RegExp]";Wr=function(e){return!e||typeof e!="object"&&typeof e!="function"?!1:zc(e)===Gc}}var Yc=Wr,Vc=vn,Qc=Yc,Xc=Vc("RegExp.prototype.exec"),Jc=wn,Zc=function(e){if(!Qc(e))throw new Jc("`regex` must be a RegExp");return function(n){return Xc(e,n)!==null}},yr,Qi;function el(){if(Qi)return yr;Qi=1;const r=(function*(){}).constructor;return yr=()=>r,yr}var mo=vn,tl=Zc,nl=tl(/^\s*(?:function)?\*/),rl=Qn(),Xi=fi,il=mo("Object.prototype.toString"),sl=mo("Function.prototype.toString"),ol=el(),al=function(e){if(typeof e!="function")return!1;if(nl(sl(e)))return!0;if(!rl){var t=il(e);return t==="[object GeneratorFunction]"}if(!Xi)return!1;var n=ol();return n&&Xi(e)===n.prototype},wo=Function.prototype.toString,zt=typeof Reflect=="object"&&Reflect!==null&&Reflect.apply,Kr,Dn;if(typeof zt=="function"&&typeof Object.defineProperty=="function")try{Kr=Object.defineProperty({},"length",{get:function(){throw Dn}}),Dn={},zt(function(){throw 42},null,Kr)}catch(r){r!==Dn&&(zt=null)}else zt=null;var cl=/^\s*class\b/,zr=function(e){try{var t=wo.call(e);return cl.test(t)}catch{return!1}},mr=function(e){try{return zr(e)?!1:(wo.call(e),!0)}catch{return!1}},Fn=Object.prototype.toString,ll="[object Object]",ul="[object Function]",fl="[object GeneratorFunction]",hl="[object HTMLAllCollection]",dl="[object HTML document.all class]",pl="[object HTMLCollection]",gl=typeof Symbol=="function"&&!!Symbol.toStringTag,yl=!(0 in[,]),Gr=function(){return!1};if(typeof document=="object"){var ml=document.all;Fn.call(ml)===Fn.call(document.all)&&(Gr=function(e){if((yl||!e)&&(typeof e>"u"||typeof e=="object"))try{var t=Fn.call(e);return(t===hl||t===dl||t===pl||t===ll)&&e("")==null}catch{}return!1})}var wl=zt?function(e){if(Gr(e))return!0;if(!e||typeof e!="function"&&typeof e!="object")return!1;try{zt(e,null,Kr)}catch(t){if(t!==Dn)return!1}return!zr(e)&&mr(e)}:function(e){if(Gr(e))return!0;if(!e||typeof e!="function"&&typeof e!="object")return!1;if(gl)return mr(e);if(zr(e))return!1;var t=Fn.call(e);return t!==ul&&t!==fl&&!/^\[object HTML/.test(t)?!1:mr(e)},_l=wl,bl=Object.prototype.toString,_o=Object.prototype.hasOwnProperty,El=function(e,t,n){for(var i=0,o=e.length;i<o;i++)_o.call(e,i)&&(n==null?t(e[i],i,e):t.call(n,e[i],i,e))},vl=function(e,t,n){for(var i=0,o=e.length;i<o;i++)n==null?t(e.charAt(i),i,e):t.call(n,e.charAt(i),i,e)},Tl=function(e,t,n){for(var i in e)_o.call(e,i)&&(n==null?t(e[i],i,e):t.call(n,e[i],i,e))};function Rl(r){return bl.call(r)==="[object Array]"}var Sl=function(e,t,n){if(!_l(t))throw new TypeError("iterator must be a function");var i;arguments.length>=3&&(i=n),Rl(e)?El(e,t,i):typeof e=="string"?vl(e,t,i):Tl(e,t,i)},Cl=["Float16Array","Float32Array","Float64Array","Int8Array","Int16Array","Int32Array","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","BigInt64Array","BigUint64Array"],wr=Cl,Al=typeof globalThis>"u"?Ke:globalThis,Il=function(){for(var e=[],t=0;t<wr.length;t++)typeof Al[wr[t]]=="function"&&(e[e.length]=wr[t]);return e},bo={exports:{}},Ji=Xn,Pl=ro,Wt=wn,Zi=Zt,kl=function(e,t,n){if(!e||typeof e!="object"&&typeof e!="function")throw new Wt("`obj` must be an object or a function`");if(typeof t!="string"&&typeof t!="symbol")throw new Wt("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new Wt("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new Wt("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new Wt("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new Wt("`loose`, if provided, must be a boolean");var i=arguments.length>3?arguments[3]:null,o=arguments.length>4?arguments[4]:null,a=arguments.length>5?arguments[5]:null,l=arguments.length>6?arguments[6]:!1,f=!!Zi&&Zi(e,t);if(Ji)Ji(e,t,{configurable:a===null&&f?f.configurable:!a,enumerable:i===null&&f?f.enumerable:!i,value:n,writable:o===null&&f?f.writable:!o});else if(l||!i&&!o&&!a)e[t]=n;else throw new Pl("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},Yr=Xn,Eo=function(){return!!Yr};Eo.hasArrayLengthDefineBug=function(){if(!Yr)return null;try{return Yr([],"length",{value:1}).length!==1}catch{return!0}};var Nl=Eo,Ol=ho,es=kl,Ml=Nl(),ts=Zt,ns=wn,xl=Ol("%Math.floor%"),Ll=function(e,t){if(typeof e!="function")throw new ns("`fn` is not a function");if(typeof t!="number"||t<0||t>4294967295||xl(t)!==t)throw new ns("`length` must be a positive 32-bit integer");var n=arguments.length>2&&!!arguments[2],i=!0,o=!0;if("length"in e&&ts){var a=ts(e,"length");a&&!a.configurable&&(i=!1),a&&!a.writable&&(o=!1)}return(i||o||!n)&&(Ml?es(e,"length",t,!0,!0):es(e,"length",t)),e},Dl=_n,Fl=li,Bl=oo,Ul=function(){return Bl(Dl,Fl,arguments)};(function(r){var e=Ll,t=Xn,n=ui,i=Ul;r.exports=function(a){var l=n(arguments),f=a.length-(arguments.length-1);return e(l,1+(f>0?f:0),!0)},t?t(r.exports,"apply",{value:i}):r.exports.apply=i})(bo);var jl=bo.exports,Wn=Sl,$l=Il,rs=jl,hi=vn,Bn=Zt,Rn=fi,Hl=hi("Object.prototype.toString"),vo=Qn(),is=typeof globalThis>"u"?Ke:globalThis,Vr=$l(),di=hi("String.prototype.slice"),ql=hi("Array.prototype.indexOf",!0)||function(e,t){for(var n=0;n<e.length;n+=1)if(e[n]===t)return n;return-1},Kn={__proto__:null};vo&&Bn&&Rn?Wn(Vr,function(r){var e=new is[r];if(Symbol.toStringTag in e&&Rn){var t=Rn(e),n=Bn(t,Symbol.toStringTag);if(!n&&t){var i=Rn(t);n=Bn(i,Symbol.toStringTag)}Kn["$"+r]=rs(n.get)}}):Wn(Vr,function(r){var e=new is[r],t=e.slice||e.set;t&&(Kn["$"+r]=rs(t))});var Wl=function(e){var t=!1;return Wn(Kn,function(n,i){if(!t)try{"$"+n(e)===i&&(t=di(i,1))}catch{}}),t},Kl=function(e){var t=!1;return Wn(Kn,function(n,i){if(!t)try{n(e),t=di(i,1)}catch{}}),t},To=function(e){if(!e||typeof e!="object")return!1;if(!vo){var t=di(Hl(e),8,-1);return ql(Vr,t)>-1?t:t!=="Object"?!1:Kl(e)}return Bn?Wl(e):null},zl=To,Gl=function(e){return!!zl(e)};(function(r){var e=$c,t=al,n=To,i=Gl;function o(m){return m.call.bind(m)}var a=typeof BigInt<"u",l=typeof Symbol<"u",f=o(Object.prototype.toString),p=o(Number.prototype.valueOf),b=o(String.prototype.valueOf),d=o(Boolean.prototype.valueOf);if(a)var w=o(BigInt.prototype.valueOf);if(l)var T=o(Symbol.prototype.valueOf);function v(m,s){if(typeof m!="object")return!1;try{return s(m),!0}catch{return!1}}r.isArgumentsObject=e,r.isGeneratorFunction=t,r.isTypedArray=i;function C(m){return typeof Promise<"u"&&m instanceof Promise||m!==null&&typeof m=="object"&&typeof m.then=="function"&&typeof m.catch=="function"}r.isPromise=C;function F(m){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(m):i(m)||W(m)}r.isArrayBufferView=F;function S(m){return n(m)==="Uint8Array"}r.isUint8Array=S;function N(m){return n(m)==="Uint8ClampedArray"}r.isUint8ClampedArray=N;function g(m){return n(m)==="Uint16Array"}r.isUint16Array=g;function _(m){return n(m)==="Uint32Array"}r.isUint32Array=_;function R(m){return n(m)==="Int8Array"}r.isInt8Array=R;function M(m){return n(m)==="Int16Array"}r.isInt16Array=M;function I(m){return n(m)==="Int32Array"}r.isInt32Array=I;function x(m){return n(m)==="Float32Array"}r.isFloat32Array=x;function K(m){return n(m)==="Float64Array"}r.isFloat64Array=K;function L(m){return n(m)==="BigInt64Array"}r.isBigInt64Array=L;function B(m){return n(m)==="BigUint64Array"}r.isBigUint64Array=B;function O(m){return f(m)==="[object Map]"}O.working=typeof Map<"u"&&O(new Map);function ne(m){return typeof Map>"u"?!1:O.working?O(m):m instanceof Map}r.isMap=ne;function ue(m){return f(m)==="[object Set]"}ue.working=typeof Set<"u"&&ue(new Set);function fe(m){return typeof Set>"u"?!1:ue.working?ue(m):m instanceof Set}r.isSet=fe;function pe(m){return f(m)==="[object WeakMap]"}pe.working=typeof WeakMap<"u"&&pe(new WeakMap);function ve(m){return typeof WeakMap>"u"?!1:pe.working?pe(m):m instanceof WeakMap}r.isWeakMap=ve;function Ie(m){return f(m)==="[object WeakSet]"}Ie.working=typeof WeakSet<"u"&&Ie(new WeakSet);function he(m){return Ie(m)}r.isWeakSet=he;function ke(m){return f(m)==="[object ArrayBuffer]"}ke.working=typeof ArrayBuffer<"u"&&ke(new ArrayBuffer);function be(m){return typeof ArrayBuffer>"u"?!1:ke.working?ke(m):m instanceof ArrayBuffer}r.isArrayBuffer=be;function Le(m){return f(m)==="[object DataView]"}Le.working=typeof ArrayBuffer<"u"&&typeof DataView<"u"&&Le(new DataView(new ArrayBuffer(1),0,1));function W(m){return typeof DataView>"u"?!1:Le.working?Le(m):m instanceof DataView}r.isDataView=W;var Y=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:void 0;function J(m){return f(m)==="[object SharedArrayBuffer]"}function U(m){return typeof Y>"u"?!1:(typeof J.working>"u"&&(J.working=J(new Y)),J.working?J(m):m instanceof Y)}r.isSharedArrayBuffer=U;function H(m){return f(m)==="[object AsyncFunction]"}r.isAsyncFunction=H;function X(m){return f(m)==="[object Map Iterator]"}r.isMapIterator=X;function re(m){return f(m)==="[object Set Iterator]"}r.isSetIterator=re;function ae(m){return f(m)==="[object Generator]"}r.isGeneratorObject=ae;function A(m){return f(m)==="[object WebAssembly.Module]"}r.isWebAssemblyCompiledModule=A;function P(m){return v(m,p)}r.isNumberObject=P;function Z(m){return v(m,b)}r.isStringObject=Z;function oe(m){return v(m,d)}r.isBooleanObject=oe;function $(m){return a&&v(m,w)}r.isBigIntObject=$;function z(m){return l&&v(m,T)}r.isSymbolObject=z;function te(m){return P(m)||Z(m)||oe(m)||$(m)||z(m)}r.isBoxedPrimitive=te;function ce(m){return typeof Uint8Array<"u"&&(be(m)||U(m))}r.isAnyArrayBuffer=ce,["isProxy","isExternal","isModuleNamespaceObject"].forEach(function(m){Object.defineProperty(r,m,{enumerable:!1,value:function(){throw new Error(m+" is not supported in userland")}})})})(eo);var Yl=function(e){return e&&typeof e=="object"&&typeof e.copy=="function"&&typeof e.fill=="function"&&typeof e.readUInt8=="function"},Qr={exports:{}};typeof Object.create=="function"?Qr.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:Qr.exports=function(e,t){if(t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}};var en=Qr.exports;(function(r){var e={},t=Object.getOwnPropertyDescriptors||function(Y){for(var J=Object.keys(Y),U={},H=0;H<J.length;H++)U[J[H]]=Object.getOwnPropertyDescriptor(Y,J[H]);return U},n=/%[sdj%]/g;r.format=function(W){if(!M(W)){for(var Y=[],J=0;J<arguments.length;J++)Y.push(l(arguments[J]));return Y.join(" ")}for(var J=1,U=arguments,H=U.length,X=String(W).replace(n,function(ae){if(ae==="%%")return"%";if(J>=H)return ae;switch(ae){case"%s":return String(U[J++]);case"%d":return Number(U[J++]);case"%j":try{return JSON.stringify(U[J++])}catch{return"[Circular]"}default:return ae}}),re=U[J];J<H;re=U[++J])g(re)||!L(re)?X+=" "+re:X+=" "+l(re);return X},r.deprecate=function(W,Y){if(typeof Ee<"u"&&Ee.noDeprecation===!0)return W;if(typeof Ee>"u")return function(){return r.deprecate(W,Y).apply(this,arguments)};var J=!1;function U(){if(!J){if(Ee.throwDeprecation)throw new Error(Y);Ee.traceDeprecation?console.trace(Y):console.error(Y),J=!0}return W.apply(this,arguments)}return U};var i={},o=/^$/;if(e.NODE_DEBUG){var a=e.NODE_DEBUG;a=a.replace(/[|\\{}()[\]^$+?.]/g,"\\$&").replace(/\*/g,".*").replace(/,/g,"$|^").toUpperCase(),o=new RegExp("^"+a+"$","i")}r.debuglog=function(W){if(W=W.toUpperCase(),!i[W])if(o.test(W)){var Y=Ee.pid;i[W]=function(){var J=r.format.apply(r,arguments);console.error("%s %d: %s",W,Y,J)}}else i[W]=function(){};return i[W]};function l(W,Y){var J={seen:[],stylize:p};return arguments.length>=3&&(J.depth=arguments[2]),arguments.length>=4&&(J.colors=arguments[3]),N(Y)?J.showHidden=Y:Y&&r._extend(J,Y),x(J.showHidden)&&(J.showHidden=!1),x(J.depth)&&(J.depth=2),x(J.colors)&&(J.colors=!1),x(J.customInspect)&&(J.customInspect=!0),J.colors&&(J.stylize=f),d(J,W,J.depth)}r.inspect=l,l.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},l.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};function f(W,Y){var J=l.styles[Y];return J?"\x1B["+l.colors[J][0]+"m"+W+"\x1B["+l.colors[J][1]+"m":W}function p(W,Y){return W}function b(W){var Y={};return W.forEach(function(J,U){Y[J]=!0}),Y}function d(W,Y,J){if(W.customInspect&&Y&&ne(Y.inspect)&&Y.inspect!==r.inspect&&!(Y.constructor&&Y.constructor.prototype===Y)){var U=Y.inspect(J,W);return M(U)||(U=d(W,U,J)),U}var H=w(W,Y);if(H)return H;var X=Object.keys(Y),re=b(X);if(W.showHidden&&(X=Object.getOwnPropertyNames(Y)),O(Y)&&(X.indexOf("message")>=0||X.indexOf("description")>=0))return T(Y);if(X.length===0){if(ne(Y)){var ae=Y.name?": "+Y.name:"";return W.stylize("[Function"+ae+"]","special")}if(K(Y))return W.stylize(RegExp.prototype.toString.call(Y),"regexp");if(B(Y))return W.stylize(Date.prototype.toString.call(Y),"date");if(O(Y))return T(Y)}var A="",P=!1,Z=["{","}"];if(S(Y)&&(P=!0,Z=["[","]"]),ne(Y)){var oe=Y.name?": "+Y.name:"";A=" [Function"+oe+"]"}if(K(Y)&&(A=" "+RegExp.prototype.toString.call(Y)),B(Y)&&(A=" "+Date.prototype.toUTCString.call(Y)),O(Y)&&(A=" "+T(Y)),X.length===0&&(!P||Y.length==0))return Z[0]+A+Z[1];if(J<0)return K(Y)?W.stylize(RegExp.prototype.toString.call(Y),"regexp"):W.stylize("[Object]","special");W.seen.push(Y);var $;return P?$=v(W,Y,J,re,X):$=X.map(function(z){return C(W,Y,J,re,z,P)}),W.seen.pop(),F($,A,Z)}function w(W,Y){if(x(Y))return W.stylize("undefined","undefined");if(M(Y)){var J="'"+JSON.stringify(Y).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return W.stylize(J,"string")}if(R(Y))return W.stylize(""+Y,"number");if(N(Y))return W.stylize(""+Y,"boolean");if(g(Y))return W.stylize("null","null")}function T(W){return"["+Error.prototype.toString.call(W)+"]"}function v(W,Y,J,U,H){for(var X=[],re=0,ae=Y.length;re<ae;++re)he(Y,String(re))?X.push(C(W,Y,J,U,String(re),!0)):X.push("");return H.forEach(function(A){A.match(/^\d+$/)||X.push(C(W,Y,J,U,A,!0))}),X}function C(W,Y,J,U,H,X){var re,ae,A;if(A=Object.getOwnPropertyDescriptor(Y,H)||{value:Y[H]},A.get?A.set?ae=W.stylize("[Getter/Setter]","special"):ae=W.stylize("[Getter]","special"):A.set&&(ae=W.stylize("[Setter]","special")),he(U,H)||(re="["+H+"]"),ae||(W.seen.indexOf(A.value)<0?(g(J)?ae=d(W,A.value,null):ae=d(W,A.value,J-1),ae.indexOf(`
`)>-1&&(X?ae=ae.split(`
`).map(function(P){return"  "+P}).join(`
`).slice(2):ae=`
`+ae.split(`
`).map(function(P){return"   "+P}).join(`
`))):ae=W.stylize("[Circular]","special")),x(re)){if(X&&H.match(/^\d+$/))return ae;re=JSON.stringify(""+H),re.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(re=re.slice(1,-1),re=W.stylize(re,"name")):(re=re.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),re=W.stylize(re,"string"))}return re+": "+ae}function F(W,Y,J){var U=W.reduce(function(H,X){return X.indexOf(`
`)>=0,H+X.replace(/\u001b\[\d\d?m/g,"").length+1},0);return U>60?J[0]+(Y===""?"":Y+`
 `)+" "+W.join(`,
  `)+" "+J[1]:J[0]+Y+" "+W.join(", ")+" "+J[1]}r.types=eo;function S(W){return Array.isArray(W)}r.isArray=S;function N(W){return typeof W=="boolean"}r.isBoolean=N;function g(W){return W===null}r.isNull=g;function _(W){return W==null}r.isNullOrUndefined=_;function R(W){return typeof W=="number"}r.isNumber=R;function M(W){return typeof W=="string"}r.isString=M;function I(W){return typeof W=="symbol"}r.isSymbol=I;function x(W){return W===void 0}r.isUndefined=x;function K(W){return L(W)&&fe(W)==="[object RegExp]"}r.isRegExp=K,r.types.isRegExp=K;function L(W){return typeof W=="object"&&W!==null}r.isObject=L;function B(W){return L(W)&&fe(W)==="[object Date]"}r.isDate=B,r.types.isDate=B;function O(W){return L(W)&&(fe(W)==="[object Error]"||W instanceof Error)}r.isError=O,r.types.isNativeError=O;function ne(W){return typeof W=="function"}r.isFunction=ne;function ue(W){return W===null||typeof W=="boolean"||typeof W=="number"||typeof W=="string"||typeof W=="symbol"||typeof W>"u"}r.isPrimitive=ue,r.isBuffer=Yl;function fe(W){return Object.prototype.toString.call(W)}function pe(W){return W<10?"0"+W.toString(10):W.toString(10)}var ve=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function Ie(){var W=new Date,Y=[pe(W.getHours()),pe(W.getMinutes()),pe(W.getSeconds())].join(":");return[W.getDate(),ve[W.getMonth()],Y].join(" ")}r.log=function(){console.log("%s - %s",Ie(),r.format.apply(r,arguments))},r.inherits=en,r._extend=function(W,Y){if(!Y||!L(Y))return W;for(var J=Object.keys(Y),U=J.length;U--;)W[J[U]]=Y[J[U]];return W};function he(W,Y){return Object.prototype.hasOwnProperty.call(W,Y)}var ke=typeof Symbol<"u"?Symbol("util.promisify.custom"):void 0;r.promisify=function(Y){if(typeof Y!="function")throw new TypeError('The "original" argument must be of type Function');if(ke&&Y[ke]){var J=Y[ke];if(typeof J!="function")throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(J,ke,{value:J,enumerable:!1,writable:!1,configurable:!0}),J}function J(){for(var U,H,X=new Promise(function(A,P){U=A,H=P}),re=[],ae=0;ae<arguments.length;ae++)re.push(arguments[ae]);re.push(function(A,P){A?H(A):U(P)});try{Y.apply(this,re)}catch(A){H(A)}return X}return Object.setPrototypeOf(J,Object.getPrototypeOf(Y)),ke&&Object.defineProperty(J,ke,{value:J,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(J,t(Y))},r.promisify.custom=ke;function be(W,Y){if(!W){var J=new Error("Promise was rejected with a falsy value");J.reason=W,W=J}return Y(W)}function Le(W){if(typeof W!="function")throw new TypeError('The "original" argument must be of type Function');function Y(){for(var J=[],U=0;U<arguments.length;U++)J.push(arguments[U]);var H=J.pop();if(typeof H!="function")throw new TypeError("The last argument must be of type Function");var X=this,re=function(){return H.apply(X,arguments)};W.apply(this,J).then(function(ae){Ee.nextTick(re.bind(null,null,ae))},function(ae){Ee.nextTick(be.bind(null,ae,re))})}return Object.setPrototypeOf(Y,Object.getPrototypeOf(W)),Object.defineProperties(Y,t(W)),Y}r.callbackify=Le})(ai);var _r,ss;function Vl(){if(ss)return _r;ss=1;function r(v,C){var F=Object.keys(v);if(Object.getOwnPropertySymbols){var S=Object.getOwnPropertySymbols(v);C&&(S=S.filter(function(N){return Object.getOwnPropertyDescriptor(v,N).enumerable})),F.push.apply(F,S)}return F}function e(v){for(var C=1;C<arguments.length;C++){var F=arguments[C]!=null?arguments[C]:{};C%2?r(Object(F),!0).forEach(function(S){t(v,S,F[S])}):Object.getOwnPropertyDescriptors?Object.defineProperties(v,Object.getOwnPropertyDescriptors(F)):r(Object(F)).forEach(function(S){Object.defineProperty(v,S,Object.getOwnPropertyDescriptor(F,S))})}return v}function t(v,C,F){return C=a(C),C in v?Object.defineProperty(v,C,{value:F,enumerable:!0,configurable:!0,writable:!0}):v[C]=F,v}function n(v,C){if(!(v instanceof C))throw new TypeError("Cannot call a class as a function")}function i(v,C){for(var F=0;F<C.length;F++){var S=C[F];S.enumerable=S.enumerable||!1,S.configurable=!0,"value"in S&&(S.writable=!0),Object.defineProperty(v,a(S.key),S)}}function o(v,C,F){return C&&i(v.prototype,C),Object.defineProperty(v,"prototype",{writable:!1}),v}function a(v){var C=l(v,"string");return typeof C=="symbol"?C:String(C)}function l(v,C){if(typeof v!="object"||v===null)return v;var F=v[Symbol.toPrimitive];if(F!==void 0){var S=F.call(v,C);if(typeof S!="object")return S;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(v)}var f=Jt,p=f.Buffer,b=ai,d=b.inspect,w=d&&d.custom||"inspect";function T(v,C,F){p.prototype.copy.call(v,C,F)}return _r=function(){function v(){n(this,v),this.head=null,this.tail=null,this.length=0}return o(v,[{key:"push",value:function(F){var S={data:F,next:null};this.length>0?this.tail.next=S:this.head=S,this.tail=S,++this.length}},{key:"unshift",value:function(F){var S={data:F,next:this.head};this.length===0&&(this.tail=S),this.head=S,++this.length}},{key:"shift",value:function(){if(this.length!==0){var F=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,F}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(F){if(this.length===0)return"";for(var S=this.head,N=""+S.data;S=S.next;)N+=F+S.data;return N}},{key:"concat",value:function(F){if(this.length===0)return p.alloc(0);for(var S=p.allocUnsafe(F>>>0),N=this.head,g=0;N;)T(N.data,S,g),g+=N.data.length,N=N.next;return S}},{key:"consume",value:function(F,S){var N;return F<this.head.data.length?(N=this.head.data.slice(0,F),this.head.data=this.head.data.slice(F)):F===this.head.data.length?N=this.shift():N=S?this._getString(F):this._getBuffer(F),N}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(F){var S=this.head,N=1,g=S.data;for(F-=g.length;S=S.next;){var _=S.data,R=F>_.length?_.length:F;if(R===_.length?g+=_:g+=_.slice(0,F),F-=R,F===0){R===_.length?(++N,S.next?this.head=S.next:this.head=this.tail=null):(this.head=S,S.data=_.slice(R));break}++N}return this.length-=N,g}},{key:"_getBuffer",value:function(F){var S=p.allocUnsafe(F),N=this.head,g=1;for(N.data.copy(S),F-=N.data.length;N=N.next;){var _=N.data,R=F>_.length?_.length:F;if(_.copy(S,S.length-F,0,R),F-=R,F===0){R===_.length?(++g,N.next?this.head=N.next:this.head=this.tail=null):(this.head=N,N.data=_.slice(R));break}++g}return this.length-=g,S}},{key:w,value:function(F,S){return d(this,e(e({},S),{},{depth:0,customInspect:!1}))}}]),v}(),_r}function Ql(r,e){var t=this,n=this._readableState&&this._readableState.destroyed,i=this._writableState&&this._writableState.destroyed;return n||i?(e?e(r):r&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,Ee.nextTick(Xr,this,r)):Ee.nextTick(Xr,this,r)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(r||null,function(o){!e&&o?t._writableState?t._writableState.errorEmitted?Ee.nextTick(Un,t):(t._writableState.errorEmitted=!0,Ee.nextTick(os,t,o)):Ee.nextTick(os,t,o):e?(Ee.nextTick(Un,t),e(o)):Ee.nextTick(Un,t)}),this)}function os(r,e){Xr(r,e),Un(r)}function Un(r){r._writableState&&!r._writableState.emitClose||r._readableState&&!r._readableState.emitClose||r.emit("close")}function Xl(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function Xr(r,e){r.emit("error",e)}function Jl(r,e){var t=r._readableState,n=r._writableState;t&&t.autoDestroy||n&&n.autoDestroy?r.destroy(e):r.emit("error",e)}var Ro={destroy:Ql,undestroy:Xl,errorOrDestroy:Jl},Bt={};function Zl(r,e){r.prototype=Object.create(e.prototype),r.prototype.constructor=r,r.__proto__=e}var So={};function pt(r,e,t){t||(t=Error);function n(o,a,l){return typeof e=="string"?e:e(o,a,l)}var i=function(o){Zl(a,o);function a(l,f,p){return o.call(this,n(l,f,p))||this}return a}(t);i.prototype.name=t.name,i.prototype.code=r,So[r]=i}function as(r,e){if(Array.isArray(r)){var t=r.length;return r=r.map(function(n){return String(n)}),t>2?"one of ".concat(e," ").concat(r.slice(0,t-1).join(", "),", or ")+r[t-1]:t===2?"one of ".concat(e," ").concat(r[0]," or ").concat(r[1]):"of ".concat(e," ").concat(r[0])}else return"of ".concat(e," ").concat(String(r))}function eu(r,e,t){return r.substr(0,e.length)===e}function tu(r,e,t){return(t===void 0||t>r.length)&&(t=r.length),r.substring(t-e.length,t)===e}function nu(r,e,t){return typeof t!="number"&&(t=0),t+e.length>r.length?!1:r.indexOf(e,t)!==-1}pt("ERR_INVALID_OPT_VALUE",function(r,e){return'The value "'+e+'" is invalid for option "'+r+'"'},TypeError);pt("ERR_INVALID_ARG_TYPE",function(r,e,t){var n;typeof e=="string"&&eu(e,"not ")?(n="must not be",e=e.replace(/^not /,"")):n="must be";var i;if(tu(r," argument"))i="The ".concat(r," ").concat(n," ").concat(as(e,"type"));else{var o=nu(r,".")?"property":"argument";i='The "'.concat(r,'" ').concat(o," ").concat(n," ").concat(as(e,"type"))}return i+=". Received type ".concat(typeof t),i},TypeError);pt("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF");pt("ERR_METHOD_NOT_IMPLEMENTED",function(r){return"The "+r+" method is not implemented"});pt("ERR_STREAM_PREMATURE_CLOSE","Premature close");pt("ERR_STREAM_DESTROYED",function(r){return"Cannot call "+r+" after a stream was destroyed"});pt("ERR_MULTIPLE_CALLBACK","Callback called multiple times");pt("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable");pt("ERR_STREAM_WRITE_AFTER_END","write after end");pt("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError);pt("ERR_UNKNOWN_ENCODING",function(r){return"Unknown encoding: "+r},TypeError);pt("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event");Bt.codes=So;var ru=Bt.codes.ERR_INVALID_OPT_VALUE;function iu(r,e,t){return r.highWaterMark!=null?r.highWaterMark:e?r[t]:null}function su(r,e,t,n){var i=iu(e,n,t);if(i!=null){if(!(isFinite(i)&&Math.floor(i)===i)||i<0){var o=n?t:"highWaterMark";throw new ru(o,i)}return Math.floor(i)}return r.objectMode?16:16*1024}var Co={getHighWaterMark:su},ou=au;function au(r,e){if(br("noDeprecation"))return r;var t=!1;function n(){if(!t){if(br("throwDeprecation"))throw new Error(e);br("traceDeprecation")?console.trace(e):console.warn(e),t=!0}return r.apply(this,arguments)}return n}function br(r){try{if(!Ke.localStorage)return!1}catch{return!1}var e=Ke.localStorage[r];return e==null?!1:String(e).toLowerCase()==="true"}var Er,cs;function Ao(){if(cs)return Er;cs=1,Er=x;function r(U){var H=this;this.next=null,this.entry=null,this.finish=function(){J(H,U)}}var e;x.WritableState=M;var t={deprecate:ou},n=Zs,i=Jt.Buffer,o=(typeof Ke<"u"?Ke:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function a(U){return i.from(U)}function l(U){return i.isBuffer(U)||U instanceof o}var f=Ro,p=Co,b=p.getHighWaterMark,d=Bt.codes,w=d.ERR_INVALID_ARG_TYPE,T=d.ERR_METHOD_NOT_IMPLEMENTED,v=d.ERR_MULTIPLE_CALLBACK,C=d.ERR_STREAM_CANNOT_PIPE,F=d.ERR_STREAM_DESTROYED,S=d.ERR_STREAM_NULL_VALUES,N=d.ERR_STREAM_WRITE_AFTER_END,g=d.ERR_UNKNOWN_ENCODING,_=f.errorOrDestroy;en(x,n);function R(){}function M(U,H,X){e=e||Xt(),U=U||{},typeof X!="boolean"&&(X=H instanceof e),this.objectMode=!!U.objectMode,X&&(this.objectMode=this.objectMode||!!U.writableObjectMode),this.highWaterMark=b(this,U,"writableHighWaterMark",X),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var re=U.decodeStrings===!1;this.decodeStrings=!re,this.defaultEncoding=U.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(ae){pe(H,ae)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=U.emitClose!==!1,this.autoDestroy=!!U.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new r(this)}M.prototype.getBuffer=function(){for(var H=this.bufferedRequest,X=[];H;)X.push(H),H=H.next;return X},function(){try{Object.defineProperty(M.prototype,"buffer",{get:t.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}}();var I;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(I=Function.prototype[Symbol.hasInstance],Object.defineProperty(x,Symbol.hasInstance,{value:function(H){return I.call(this,H)?!0:this!==x?!1:H&&H._writableState instanceof M}})):I=function(H){return H instanceof this};function x(U){e=e||Xt();var H=this instanceof e;if(!H&&!I.call(x,this))return new x(U);this._writableState=new M(U,this,H),this.writable=!0,U&&(typeof U.write=="function"&&(this._write=U.write),typeof U.writev=="function"&&(this._writev=U.writev),typeof U.destroy=="function"&&(this._destroy=U.destroy),typeof U.final=="function"&&(this._final=U.final)),n.call(this)}x.prototype.pipe=function(){_(this,new C)};function K(U,H){var X=new N;_(U,X),Ee.nextTick(H,X)}function L(U,H,X,re){var ae;return X===null?ae=new S:typeof X!="string"&&!H.objectMode&&(ae=new w("chunk",["string","Buffer"],X)),ae?(_(U,ae),Ee.nextTick(re,ae),!1):!0}x.prototype.write=function(U,H,X){var re=this._writableState,ae=!1,A=!re.objectMode&&l(U);return A&&!i.isBuffer(U)&&(U=a(U)),typeof H=="function"&&(X=H,H=null),A?H="buffer":H||(H=re.defaultEncoding),typeof X!="function"&&(X=R),re.ending?K(this,X):(A||L(this,re,U,X))&&(re.pendingcb++,ae=O(this,re,A,U,H,X)),ae},x.prototype.cork=function(){this._writableState.corked++},x.prototype.uncork=function(){var U=this._writableState;U.corked&&(U.corked--,!U.writing&&!U.corked&&!U.bufferProcessing&&U.bufferedRequest&&he(this,U))},x.prototype.setDefaultEncoding=function(H){if(typeof H=="string"&&(H=H.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((H+"").toLowerCase())>-1))throw new g(H);return this._writableState.defaultEncoding=H,this},Object.defineProperty(x.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}});function B(U,H,X){return!U.objectMode&&U.decodeStrings!==!1&&typeof H=="string"&&(H=i.from(H,X)),H}Object.defineProperty(x.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function O(U,H,X,re,ae,A){if(!X){var P=B(H,re,ae);re!==P&&(X=!0,ae="buffer",re=P)}var Z=H.objectMode?1:re.length;H.length+=Z;var oe=H.length<H.highWaterMark;if(oe||(H.needDrain=!0),H.writing||H.corked){var $=H.lastBufferedRequest;H.lastBufferedRequest={chunk:re,encoding:ae,isBuf:X,callback:A,next:null},$?$.next=H.lastBufferedRequest:H.bufferedRequest=H.lastBufferedRequest,H.bufferedRequestCount+=1}else ne(U,H,!1,Z,re,ae,A);return oe}function ne(U,H,X,re,ae,A,P){H.writelen=re,H.writecb=P,H.writing=!0,H.sync=!0,H.destroyed?H.onwrite(new F("write")):X?U._writev(ae,H.onwrite):U._write(ae,A,H.onwrite),H.sync=!1}function ue(U,H,X,re,ae){--H.pendingcb,X?(Ee.nextTick(ae,re),Ee.nextTick(W,U,H),U._writableState.errorEmitted=!0,_(U,re)):(ae(re),U._writableState.errorEmitted=!0,_(U,re),W(U,H))}function fe(U){U.writing=!1,U.writecb=null,U.length-=U.writelen,U.writelen=0}function pe(U,H){var X=U._writableState,re=X.sync,ae=X.writecb;if(typeof ae!="function")throw new v;if(fe(X),H)ue(U,X,re,H,ae);else{var A=ke(X)||U.destroyed;!A&&!X.corked&&!X.bufferProcessing&&X.bufferedRequest&&he(U,X),re?Ee.nextTick(ve,U,X,A,ae):ve(U,X,A,ae)}}function ve(U,H,X,re){X||Ie(U,H),H.pendingcb--,re(),W(U,H)}function Ie(U,H){H.length===0&&H.needDrain&&(H.needDrain=!1,U.emit("drain"))}function he(U,H){H.bufferProcessing=!0;var X=H.bufferedRequest;if(U._writev&&X&&X.next){var re=H.bufferedRequestCount,ae=new Array(re),A=H.corkedRequestsFree;A.entry=X;for(var P=0,Z=!0;X;)ae[P]=X,X.isBuf||(Z=!1),X=X.next,P+=1;ae.allBuffers=Z,ne(U,H,!0,H.length,ae,"",A.finish),H.pendingcb++,H.lastBufferedRequest=null,A.next?(H.corkedRequestsFree=A.next,A.next=null):H.corkedRequestsFree=new r(H),H.bufferedRequestCount=0}else{for(;X;){var oe=X.chunk,$=X.encoding,z=X.callback,te=H.objectMode?1:oe.length;if(ne(U,H,!1,te,oe,$,z),X=X.next,H.bufferedRequestCount--,H.writing)break}X===null&&(H.lastBufferedRequest=null)}H.bufferedRequest=X,H.bufferProcessing=!1}x.prototype._write=function(U,H,X){X(new T("_write()"))},x.prototype._writev=null,x.prototype.end=function(U,H,X){var re=this._writableState;return typeof U=="function"?(X=U,U=null,H=null):typeof H=="function"&&(X=H,H=null),U!=null&&this.write(U,H),re.corked&&(re.corked=1,this.uncork()),re.ending||Y(this,re,X),this},Object.defineProperty(x.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function ke(U){return U.ending&&U.length===0&&U.bufferedRequest===null&&!U.finished&&!U.writing}function be(U,H){U._final(function(X){H.pendingcb--,X&&_(U,X),H.prefinished=!0,U.emit("prefinish"),W(U,H)})}function Le(U,H){!H.prefinished&&!H.finalCalled&&(typeof U._final=="function"&&!H.destroyed?(H.pendingcb++,H.finalCalled=!0,Ee.nextTick(be,U,H)):(H.prefinished=!0,U.emit("prefinish")))}function W(U,H){var X=ke(H);if(X&&(Le(U,H),H.pendingcb===0&&(H.finished=!0,U.emit("finish"),H.autoDestroy))){var re=U._readableState;(!re||re.autoDestroy&&re.endEmitted)&&U.destroy()}return X}function Y(U,H,X){H.ending=!0,W(U,H),X&&(H.finished?Ee.nextTick(X):U.once("finish",X)),H.ended=!0,U.writable=!1}function J(U,H,X){var re=U.entry;for(U.entry=null;re;){var ae=re.callback;H.pendingcb--,ae(X),re=re.next}H.corkedRequestsFree.next=U}return Object.defineProperty(x.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState===void 0?!1:this._writableState.destroyed},set:function(H){this._writableState&&(this._writableState.destroyed=H)}}),x.prototype.destroy=f.destroy,x.prototype._undestroy=f.undestroy,x.prototype._destroy=function(U,H){H(U)},Er}var vr,ls;function Xt(){if(ls)return vr;ls=1;var r=Object.keys||function(p){var b=[];for(var d in p)b.push(d);return b};vr=a;var e=Po(),t=Ao();en(a,e);for(var n=r(t.prototype),i=0;i<n.length;i++){var o=n[i];a.prototype[o]||(a.prototype[o]=t.prototype[o])}function a(p){if(!(this instanceof a))return new a(p);e.call(this,p),t.call(this,p),this.allowHalfOpen=!0,p&&(p.readable===!1&&(this.readable=!1),p.writable===!1&&(this.writable=!1),p.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",l)))}Object.defineProperty(a.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(a.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(a.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function l(){this._writableState.ended||Ee.nextTick(f,this)}function f(p){p.end()}return Object.defineProperty(a.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set:function(b){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=b,this._writableState.destroyed=b)}}),vr}var Tr={},us;function fs(){if(us)return Tr;us=1;var r=qs.Buffer,e=r.isEncoding||function(S){switch(S=""+S,S&&S.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function t(S){if(!S)return"utf8";for(var N;;)switch(S){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return S;default:if(N)return;S=(""+S).toLowerCase(),N=!0}}function n(S){var N=t(S);if(typeof N!="string"&&(r.isEncoding===e||!e(S)))throw new Error("Unknown encoding: "+S);return N||S}Tr.StringDecoder=i;function i(S){this.encoding=n(S);var N;switch(this.encoding){case"utf16le":this.text=d,this.end=w,N=4;break;case"utf8":this.fillLast=f,N=4;break;case"base64":this.text=T,this.end=v,N=3;break;default:this.write=C,this.end=F;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=r.allocUnsafe(N)}i.prototype.write=function(S){if(S.length===0)return"";var N,g;if(this.lastNeed){if(N=this.fillLast(S),N===void 0)return"";g=this.lastNeed,this.lastNeed=0}else g=0;return g<S.length?N?N+this.text(S,g):this.text(S,g):N||""},i.prototype.end=b,i.prototype.text=p,i.prototype.fillLast=function(S){if(this.lastNeed<=S.length)return S.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);S.copy(this.lastChar,this.lastTotal-this.lastNeed,0,S.length),this.lastNeed-=S.length};function o(S){return S<=127?0:S>>5===6?2:S>>4===14?3:S>>3===30?4:S>>6===2?-1:-2}function a(S,N,g){var _=N.length-1;if(_<g)return 0;var R=o(N[_]);return R>=0?(R>0&&(S.lastNeed=R-1),R):--_<g||R===-2?0:(R=o(N[_]),R>=0?(R>0&&(S.lastNeed=R-2),R):--_<g||R===-2?0:(R=o(N[_]),R>=0?(R>0&&(R===2?R=0:S.lastNeed=R-3),R):0))}function l(S,N,g){if((N[0]&192)!==128)return S.lastNeed=0,"";if(S.lastNeed>1&&N.length>1){if((N[1]&192)!==128)return S.lastNeed=1,"";if(S.lastNeed>2&&N.length>2&&(N[2]&192)!==128)return S.lastNeed=2,""}}function f(S){var N=this.lastTotal-this.lastNeed,g=l(this,S);if(g!==void 0)return g;if(this.lastNeed<=S.length)return S.copy(this.lastChar,N,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);S.copy(this.lastChar,N,0,S.length),this.lastNeed-=S.length}function p(S,N){var g=a(this,S,N);if(!this.lastNeed)return S.toString("utf8",N);this.lastTotal=g;var _=S.length-(g-this.lastNeed);return S.copy(this.lastChar,0,_),S.toString("utf8",N,_)}function b(S){var N=S&&S.length?this.write(S):"";return this.lastNeed?N+"":N}function d(S,N){if((S.length-N)%2===0){var g=S.toString("utf16le",N);if(g){var _=g.charCodeAt(g.length-1);if(_>=55296&&_<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=S[S.length-2],this.lastChar[1]=S[S.length-1],g.slice(0,-1)}return g}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=S[S.length-1],S.toString("utf16le",N,S.length-1)}function w(S){var N=S&&S.length?this.write(S):"";if(this.lastNeed){var g=this.lastTotal-this.lastNeed;return N+this.lastChar.toString("utf16le",0,g)}return N}function T(S,N){var g=(S.length-N)%3;return g===0?S.toString("base64",N):(this.lastNeed=3-g,this.lastTotal=3,g===1?this.lastChar[0]=S[S.length-1]:(this.lastChar[0]=S[S.length-2],this.lastChar[1]=S[S.length-1]),S.toString("base64",N,S.length-g))}function v(S){var N=S&&S.length?this.write(S):"";return this.lastNeed?N+this.lastChar.toString("base64",0,3-this.lastNeed):N}function C(S){return S.toString(this.encoding)}function F(S){return S&&S.length?this.write(S):""}return Tr}var hs=Bt.codes.ERR_STREAM_PREMATURE_CLOSE;function cu(r){var e=!1;return function(){if(!e){e=!0;for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];r.apply(this,n)}}}function lu(){}function uu(r){return r.setHeader&&typeof r.abort=="function"}function Io(r,e,t){if(typeof e=="function")return Io(r,null,e);e||(e={}),t=cu(t||lu);var n=e.readable||e.readable!==!1&&r.readable,i=e.writable||e.writable!==!1&&r.writable,o=function(){r.writable||l()},a=r._writableState&&r._writableState.finished,l=function(){i=!1,a=!0,n||t.call(r)},f=r._readableState&&r._readableState.endEmitted,p=function(){n=!1,f=!0,i||t.call(r)},b=function(v){t.call(r,v)},d=function(){var v;if(n&&!f)return(!r._readableState||!r._readableState.ended)&&(v=new hs),t.call(r,v);if(i&&!a)return(!r._writableState||!r._writableState.ended)&&(v=new hs),t.call(r,v)},w=function(){r.req.on("finish",l)};return uu(r)?(r.on("complete",l),r.on("abort",d),r.req?w():r.on("request",w)):i&&!r._writableState&&(r.on("end",o),r.on("close",o)),r.on("end",p),r.on("finish",l),e.error!==!1&&r.on("error",b),r.on("close",d),function(){r.removeListener("complete",l),r.removeListener("abort",d),r.removeListener("request",w),r.req&&r.req.removeListener("finish",l),r.removeListener("end",o),r.removeListener("close",o),r.removeListener("finish",l),r.removeListener("end",p),r.removeListener("error",b),r.removeListener("close",d)}}var pi=Io,Rr,ds;function fu(){if(ds)return Rr;ds=1;var r;function e(g,_,R){return _=t(_),_ in g?Object.defineProperty(g,_,{value:R,enumerable:!0,configurable:!0,writable:!0}):g[_]=R,g}function t(g){var _=n(g,"string");return typeof _=="symbol"?_:String(_)}function n(g,_){if(typeof g!="object"||g===null)return g;var R=g[Symbol.toPrimitive];if(R!==void 0){var M=R.call(g,_);if(typeof M!="object")return M;throw new TypeError("@@toPrimitive must return a primitive value.")}return(_==="string"?String:Number)(g)}var i=pi,o=Symbol("lastResolve"),a=Symbol("lastReject"),l=Symbol("error"),f=Symbol("ended"),p=Symbol("lastPromise"),b=Symbol("handlePromise"),d=Symbol("stream");function w(g,_){return{value:g,done:_}}function T(g){var _=g[o];if(_!==null){var R=g[d].read();R!==null&&(g[p]=null,g[o]=null,g[a]=null,_(w(R,!1)))}}function v(g){Ee.nextTick(T,g)}function C(g,_){return function(R,M){g.then(function(){if(_[f]){R(w(void 0,!0));return}_[b](R,M)},M)}}var F=Object.getPrototypeOf(function(){}),S=Object.setPrototypeOf((r={get stream(){return this[d]},next:function(){var _=this,R=this[l];if(R!==null)return Promise.reject(R);if(this[f])return Promise.resolve(w(void 0,!0));if(this[d].destroyed)return new Promise(function(K,L){Ee.nextTick(function(){_[l]?L(_[l]):K(w(void 0,!0))})});var M=this[p],I;if(M)I=new Promise(C(M,this));else{var x=this[d].read();if(x!==null)return Promise.resolve(w(x,!1));I=new Promise(this[b])}return this[p]=I,I}},e(r,Symbol.asyncIterator,function(){return this}),e(r,"return",function(){var _=this;return new Promise(function(R,M){_[d].destroy(null,function(I){if(I){M(I);return}R(w(void 0,!0))})})}),r),F),N=function(_){var R,M=Object.create(S,(R={},e(R,d,{value:_,writable:!0}),e(R,o,{value:null,writable:!0}),e(R,a,{value:null,writable:!0}),e(R,l,{value:null,writable:!0}),e(R,f,{value:_._readableState.endEmitted,writable:!0}),e(R,b,{value:function(x,K){var L=M[d].read();L?(M[p]=null,M[o]=null,M[a]=null,x(w(L,!1))):(M[o]=x,M[a]=K)},writable:!0}),R));return M[p]=null,i(_,function(I){if(I&&I.code!=="ERR_STREAM_PREMATURE_CLOSE"){var x=M[a];x!==null&&(M[p]=null,M[o]=null,M[a]=null,x(I)),M[l]=I;return}var K=M[o];K!==null&&(M[p]=null,M[o]=null,M[a]=null,K(w(void 0,!0))),M[f]=!0}),_.on("readable",v.bind(null,M)),M};return Rr=N,Rr}var Sr,ps;function hu(){return ps||(ps=1,Sr=function(){throw new Error("Readable.from is not available in the browser")}),Sr}var Cr,gs;function Po(){if(gs)return Cr;gs=1,Cr=K;var r;K.ReadableState=x,Js.EventEmitter;var e=function(P,Z){return P.listeners(Z).length},t=Zs,n=Jt.Buffer,i=(typeof Ke<"u"?Ke:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function o(A){return n.from(A)}function a(A){return n.isBuffer(A)||A instanceof i}var l=ai,f;l&&l.debuglog?f=l.debuglog("stream"):f=function(){};var p=Vl(),b=Ro,d=Co,w=d.getHighWaterMark,T=Bt.codes,v=T.ERR_INVALID_ARG_TYPE,C=T.ERR_STREAM_PUSH_AFTER_EOF,F=T.ERR_METHOD_NOT_IMPLEMENTED,S=T.ERR_STREAM_UNSHIFT_AFTER_END_EVENT,N,g,_;en(K,t);var R=b.errorOrDestroy,M=["error","close","destroy","pause","resume"];function I(A,P,Z){if(typeof A.prependListener=="function")return A.prependListener(P,Z);!A._events||!A._events[P]?A.on(P,Z):Array.isArray(A._events[P])?A._events[P].unshift(Z):A._events[P]=[Z,A._events[P]]}function x(A,P,Z){r=r||Xt(),A=A||{},typeof Z!="boolean"&&(Z=P instanceof r),this.objectMode=!!A.objectMode,Z&&(this.objectMode=this.objectMode||!!A.readableObjectMode),this.highWaterMark=w(this,A,"readableHighWaterMark",Z),this.buffer=new p,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=A.emitClose!==!1,this.autoDestroy=!!A.autoDestroy,this.destroyed=!1,this.defaultEncoding=A.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,A.encoding&&(N||(N=fs().StringDecoder),this.decoder=new N(A.encoding),this.encoding=A.encoding)}function K(A){if(r=r||Xt(),!(this instanceof K))return new K(A);var P=this instanceof r;this._readableState=new x(A,this,P),this.readable=!0,A&&(typeof A.read=="function"&&(this._read=A.read),typeof A.destroy=="function"&&(this._destroy=A.destroy)),t.call(this)}Object.defineProperty(K.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0?!1:this._readableState.destroyed},set:function(P){this._readableState&&(this._readableState.destroyed=P)}}),K.prototype.destroy=b.destroy,K.prototype._undestroy=b.undestroy,K.prototype._destroy=function(A,P){P(A)},K.prototype.push=function(A,P){var Z=this._readableState,oe;return Z.objectMode?oe=!0:typeof A=="string"&&(P=P||Z.defaultEncoding,P!==Z.encoding&&(A=n.from(A,P),P=""),oe=!0),L(this,A,P,!1,oe)},K.prototype.unshift=function(A){return L(this,A,null,!0,!1)};function L(A,P,Z,oe,$){f("readableAddChunk",P);var z=A._readableState;if(P===null)z.reading=!1,pe(A,z);else{var te;if($||(te=O(z,P)),te)R(A,te);else if(z.objectMode||P&&P.length>0)if(typeof P!="string"&&!z.objectMode&&Object.getPrototypeOf(P)!==n.prototype&&(P=o(P)),oe)z.endEmitted?R(A,new S):B(A,z,P,!0);else if(z.ended)R(A,new C);else{if(z.destroyed)return!1;z.reading=!1,z.decoder&&!Z?(P=z.decoder.write(P),z.objectMode||P.length!==0?B(A,z,P,!1):he(A,z)):B(A,z,P,!1)}else oe||(z.reading=!1,he(A,z))}return!z.ended&&(z.length<z.highWaterMark||z.length===0)}function B(A,P,Z,oe){P.flowing&&P.length===0&&!P.sync?(P.awaitDrain=0,A.emit("data",Z)):(P.length+=P.objectMode?1:Z.length,oe?P.buffer.unshift(Z):P.buffer.push(Z),P.needReadable&&ve(A)),he(A,P)}function O(A,P){var Z;return!a(P)&&typeof P!="string"&&P!==void 0&&!A.objectMode&&(Z=new v("chunk",["string","Buffer","Uint8Array"],P)),Z}K.prototype.isPaused=function(){return this._readableState.flowing===!1},K.prototype.setEncoding=function(A){N||(N=fs().StringDecoder);var P=new N(A);this._readableState.decoder=P,this._readableState.encoding=this._readableState.decoder.encoding;for(var Z=this._readableState.buffer.head,oe="";Z!==null;)oe+=P.write(Z.data),Z=Z.next;return this._readableState.buffer.clear(),oe!==""&&this._readableState.buffer.push(oe),this._readableState.length=oe.length,this};var ne=1073741824;function ue(A){return A>=ne?A=ne:(A--,A|=A>>>1,A|=A>>>2,A|=A>>>4,A|=A>>>8,A|=A>>>16,A++),A}function fe(A,P){return A<=0||P.length===0&&P.ended?0:P.objectMode?1:A!==A?P.flowing&&P.length?P.buffer.head.data.length:P.length:(A>P.highWaterMark&&(P.highWaterMark=ue(A)),A<=P.length?A:P.ended?P.length:(P.needReadable=!0,0))}K.prototype.read=function(A){f("read",A),A=parseInt(A,10);var P=this._readableState,Z=A;if(A!==0&&(P.emittedReadable=!1),A===0&&P.needReadable&&((P.highWaterMark!==0?P.length>=P.highWaterMark:P.length>0)||P.ended))return f("read: emitReadable",P.length,P.ended),P.length===0&&P.ended?X(this):ve(this),null;if(A=fe(A,P),A===0&&P.ended)return P.length===0&&X(this),null;var oe=P.needReadable;f("need readable",oe),(P.length===0||P.length-A<P.highWaterMark)&&(oe=!0,f("length less than watermark",oe)),P.ended||P.reading?(oe=!1,f("reading or ended",oe)):oe&&(f("do read"),P.reading=!0,P.sync=!0,P.length===0&&(P.needReadable=!0),this._read(P.highWaterMark),P.sync=!1,P.reading||(A=fe(Z,P)));var $;return A>0?$=H(A,P):$=null,$===null?(P.needReadable=P.length<=P.highWaterMark,A=0):(P.length-=A,P.awaitDrain=0),P.length===0&&(P.ended||(P.needReadable=!0),Z!==A&&P.ended&&X(this)),$!==null&&this.emit("data",$),$};function pe(A,P){if(f("onEofChunk"),!P.ended){if(P.decoder){var Z=P.decoder.end();Z&&Z.length&&(P.buffer.push(Z),P.length+=P.objectMode?1:Z.length)}P.ended=!0,P.sync?ve(A):(P.needReadable=!1,P.emittedReadable||(P.emittedReadable=!0,Ie(A)))}}function ve(A){var P=A._readableState;f("emitReadable",P.needReadable,P.emittedReadable),P.needReadable=!1,P.emittedReadable||(f("emitReadable",P.flowing),P.emittedReadable=!0,Ee.nextTick(Ie,A))}function Ie(A){var P=A._readableState;f("emitReadable_",P.destroyed,P.length,P.ended),!P.destroyed&&(P.length||P.ended)&&(A.emit("readable"),P.emittedReadable=!1),P.needReadable=!P.flowing&&!P.ended&&P.length<=P.highWaterMark,U(A)}function he(A,P){P.readingMore||(P.readingMore=!0,Ee.nextTick(ke,A,P))}function ke(A,P){for(;!P.reading&&!P.ended&&(P.length<P.highWaterMark||P.flowing&&P.length===0);){var Z=P.length;if(f("maybeReadMore read 0"),A.read(0),Z===P.length)break}P.readingMore=!1}K.prototype._read=function(A){R(this,new F("_read()"))},K.prototype.pipe=function(A,P){var Z=this,oe=this._readableState;switch(oe.pipesCount){case 0:oe.pipes=A;break;case 1:oe.pipes=[oe.pipes,A];break;default:oe.pipes.push(A);break}oe.pipesCount+=1,f("pipe count=%d opts=%j",oe.pipesCount,P);var $=(!P||P.end!==!1)&&A!==Ee.stdout&&A!==Ee.stderr,z=$?ce:le;oe.endEmitted?Ee.nextTick(z):Z.once("end",z),A.on("unpipe",te);function te(ye,Te){f("onunpipe"),ye===Z&&Te&&Te.hasUnpiped===!1&&(Te.hasUnpiped=!0,h())}function ce(){f("onend"),A.end()}var m=be(Z);A.on("drain",m);var s=!1;function h(){f("cleanup"),A.removeListener("close",G),A.removeListener("finish",Q),A.removeListener("drain",m),A.removeListener("error",D),A.removeListener("unpipe",te),Z.removeListener("end",ce),Z.removeListener("end",le),Z.removeListener("data",y),s=!0,oe.awaitDrain&&(!A._writableState||A._writableState.needDrain)&&m()}Z.on("data",y);function y(ye){f("ondata");var Te=A.write(ye);f("dest.write",Te),Te===!1&&((oe.pipesCount===1&&oe.pipes===A||oe.pipesCount>1&&ae(oe.pipes,A)!==-1)&&!s&&(f("false write response, pause",oe.awaitDrain),oe.awaitDrain++),Z.pause())}function D(ye){f("onerror",ye),le(),A.removeListener("error",D),e(A,"error")===0&&R(A,ye)}I(A,"error",D);function G(){A.removeListener("finish",Q),le()}A.once("close",G);function Q(){f("onfinish"),A.removeListener("close",G),le()}A.once("finish",Q);function le(){f("unpipe"),Z.unpipe(A)}return A.emit("pipe",Z),oe.flowing||(f("pipe resume"),Z.resume()),A};function be(A){return function(){var Z=A._readableState;f("pipeOnDrain",Z.awaitDrain),Z.awaitDrain&&Z.awaitDrain--,Z.awaitDrain===0&&e(A,"data")&&(Z.flowing=!0,U(A))}}K.prototype.unpipe=function(A){var P=this._readableState,Z={hasUnpiped:!1};if(P.pipesCount===0)return this;if(P.pipesCount===1)return A&&A!==P.pipes?this:(A||(A=P.pipes),P.pipes=null,P.pipesCount=0,P.flowing=!1,A&&A.emit("unpipe",this,Z),this);if(!A){var oe=P.pipes,$=P.pipesCount;P.pipes=null,P.pipesCount=0,P.flowing=!1;for(var z=0;z<$;z++)oe[z].emit("unpipe",this,{hasUnpiped:!1});return this}var te=ae(P.pipes,A);return te===-1?this:(P.pipes.splice(te,1),P.pipesCount-=1,P.pipesCount===1&&(P.pipes=P.pipes[0]),A.emit("unpipe",this,Z),this)},K.prototype.on=function(A,P){var Z=t.prototype.on.call(this,A,P),oe=this._readableState;return A==="data"?(oe.readableListening=this.listenerCount("readable")>0,oe.flowing!==!1&&this.resume()):A==="readable"&&!oe.endEmitted&&!oe.readableListening&&(oe.readableListening=oe.needReadable=!0,oe.flowing=!1,oe.emittedReadable=!1,f("on readable",oe.length,oe.reading),oe.length?ve(this):oe.reading||Ee.nextTick(W,this)),Z},K.prototype.addListener=K.prototype.on,K.prototype.removeListener=function(A,P){var Z=t.prototype.removeListener.call(this,A,P);return A==="readable"&&Ee.nextTick(Le,this),Z},K.prototype.removeAllListeners=function(A){var P=t.prototype.removeAllListeners.apply(this,arguments);return(A==="readable"||A===void 0)&&Ee.nextTick(Le,this),P};function Le(A){var P=A._readableState;P.readableListening=A.listenerCount("readable")>0,P.resumeScheduled&&!P.paused?P.flowing=!0:A.listenerCount("data")>0&&A.resume()}function W(A){f("readable nexttick read 0"),A.read(0)}K.prototype.resume=function(){var A=this._readableState;return A.flowing||(f("resume"),A.flowing=!A.readableListening,Y(this,A)),A.paused=!1,this};function Y(A,P){P.resumeScheduled||(P.resumeScheduled=!0,Ee.nextTick(J,A,P))}function J(A,P){f("resume",P.reading),P.reading||A.read(0),P.resumeScheduled=!1,A.emit("resume"),U(A),P.flowing&&!P.reading&&A.read(0)}K.prototype.pause=function(){return f("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(f("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this};function U(A){var P=A._readableState;for(f("flow",P.flowing);P.flowing&&A.read()!==null;);}K.prototype.wrap=function(A){var P=this,Z=this._readableState,oe=!1;A.on("end",function(){if(f("wrapped end"),Z.decoder&&!Z.ended){var te=Z.decoder.end();te&&te.length&&P.push(te)}P.push(null)}),A.on("data",function(te){if(f("wrapped data"),Z.decoder&&(te=Z.decoder.write(te)),!(Z.objectMode&&te==null)&&!(!Z.objectMode&&(!te||!te.length))){var ce=P.push(te);ce||(oe=!0,A.pause())}});for(var $ in A)this[$]===void 0&&typeof A[$]=="function"&&(this[$]=function(ce){return function(){return A[ce].apply(A,arguments)}}($));for(var z=0;z<M.length;z++)A.on(M[z],this.emit.bind(this,M[z]));return this._read=function(te){f("wrapped _read",te),oe&&(oe=!1,A.resume())},this},typeof Symbol=="function"&&(K.prototype[Symbol.asyncIterator]=function(){return g===void 0&&(g=fu()),g(this)}),Object.defineProperty(K.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(K.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(K.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(P){this._readableState&&(this._readableState.flowing=P)}}),K._fromList=H,Object.defineProperty(K.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}});function H(A,P){if(P.length===0)return null;var Z;return P.objectMode?Z=P.buffer.shift():!A||A>=P.length?(P.decoder?Z=P.buffer.join(""):P.buffer.length===1?Z=P.buffer.first():Z=P.buffer.concat(P.length),P.buffer.clear()):Z=P.buffer.consume(A,P.decoder),Z}function X(A){var P=A._readableState;f("endReadable",P.endEmitted),P.endEmitted||(P.ended=!0,Ee.nextTick(re,P,A))}function re(A,P){if(f("endReadableNT",A.endEmitted,A.length),!A.endEmitted&&A.length===0&&(A.endEmitted=!0,P.readable=!1,P.emit("end"),A.autoDestroy)){var Z=P._writableState;(!Z||Z.autoDestroy&&Z.finished)&&P.destroy()}}typeof Symbol=="function"&&(K.from=function(A,P){return _===void 0&&(_=hu()),_(K,A,P)});function ae(A,P){for(var Z=0,oe=A.length;Z<oe;Z++)if(A[Z]===P)return Z;return-1}return Cr}var ko=At,Zn=Bt.codes,du=Zn.ERR_METHOD_NOT_IMPLEMENTED,pu=Zn.ERR_MULTIPLE_CALLBACK,gu=Zn.ERR_TRANSFORM_ALREADY_TRANSFORMING,yu=Zn.ERR_TRANSFORM_WITH_LENGTH_0,er=Xt();en(At,er);function mu(r,e){var t=this._transformState;t.transforming=!1;var n=t.writecb;if(n===null)return this.emit("error",new pu);t.writechunk=null,t.writecb=null,e!=null&&this.push(e),n(r);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}function At(r){if(!(this instanceof At))return new At(r);er.call(this,r),this._transformState={afterTransform:mu.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,r&&(typeof r.transform=="function"&&(this._transform=r.transform),typeof r.flush=="function"&&(this._flush=r.flush)),this.on("prefinish",wu)}function wu(){var r=this;typeof this._flush=="function"&&!this._readableState.destroyed?this._flush(function(e,t){ys(r,e,t)}):ys(this,null,null)}At.prototype.push=function(r,e){return this._transformState.needTransform=!1,er.prototype.push.call(this,r,e)};At.prototype._transform=function(r,e,t){t(new du("_transform()"))};At.prototype._write=function(r,e,t){var n=this._transformState;if(n.writecb=t,n.writechunk=r,n.writeencoding=e,!n.transforming){var i=this._readableState;(n.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}};At.prototype._read=function(r){var e=this._transformState;e.writechunk!==null&&!e.transforming?(e.transforming=!0,this._transform(e.writechunk,e.writeencoding,e.afterTransform)):e.needTransform=!0};At.prototype._destroy=function(r,e){er.prototype._destroy.call(this,r,function(t){e(t)})};function ys(r,e,t){if(e)return r.emit("error",e);if(t!=null&&r.push(t),r._writableState.length)throw new yu;if(r._transformState.transforming)throw new gu;return r.push(null)}var _u=mn,No=ko;en(mn,No);function mn(r){if(!(this instanceof mn))return new mn(r);No.call(this,r)}mn.prototype._transform=function(r,e,t){t(null,r)};var Ar;function bu(r){var e=!1;return function(){e||(e=!0,r.apply(void 0,arguments))}}var Oo=Bt.codes,Eu=Oo.ERR_MISSING_ARGS,vu=Oo.ERR_STREAM_DESTROYED;function ms(r){if(r)throw r}function Tu(r){return r.setHeader&&typeof r.abort=="function"}function Ru(r,e,t,n){n=bu(n);var i=!1;r.on("close",function(){i=!0}),Ar===void 0&&(Ar=pi),Ar(r,{readable:e,writable:t},function(a){if(a)return n(a);i=!0,n()});var o=!1;return function(a){if(!i&&!o){if(o=!0,Tu(r))return r.abort();if(typeof r.destroy=="function")return r.destroy();n(a||new vu("pipe"))}}}function ws(r){r()}function Su(r,e){return r.pipe(e)}function Cu(r){return!r.length||typeof r[r.length-1]!="function"?ms:r.pop()}function Au(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];var n=Cu(e);if(Array.isArray(e[0])&&(e=e[0]),e.length<2)throw new Eu("streams");var i,o=e.map(function(a,l){var f=l<e.length-1,p=l>0;return Ru(a,f,p,function(b){i||(i=b),b&&o.forEach(ws),!f&&(o.forEach(ws),n(i))})});return e.reduce(Su)}var Iu=Au;(function(r,e){e=r.exports=Po(),e.Stream=e,e.Readable=e,e.Writable=Ao(),e.Duplex=Xt(),e.Transform=ko,e.PassThrough=_u,e.finished=pi,e.pipeline=Iu})(Hr,Hr.exports);var Pu=Hr.exports;/*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */let _s;var ku=typeof queueMicrotask=="function"?queueMicrotask.bind(typeof window<"u"?window:Ke):r=>(_s||(_s=Promise.resolve())).then(r).catch(e=>setTimeout(()=>{throw e},0));function bs(r,e){for(const t in e)Object.defineProperty(r,t,{value:e[t],enumerable:!0,configurable:!0});return r}function Nu(r,e,t){if(!r||typeof r=="string")throw new TypeError("Please pass an Error to err-code");t||(t={}),typeof e=="object"&&(t=e,e=""),e&&(t.code=e);try{return bs(r,t)}catch{t.message=r.message,t.stack=r.stack;const i=function(){};return i.prototype=Object.create(Object.getPrototypeOf(r)),bs(new i,t)}}var Ou=Nu;/*! simple-peer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */const Mu=fa("simple-peer"),Mo=ha,Es=ma,xu=Pu,Ir=ku,Ce=Ou,{Buffer:Lu}=Jt,Pr=64*1024,Du=5*1e3,Fu=5*1e3;function vs(r){return r.replace(/a=ice-options:trickle\s\n/g,"")}function Bu(r){console.warn(r)}class Dt extends xu.Duplex{constructor(e){if(e=Object.assign({allowHalfOpen:!1},e),super(e),this._id=Es(4).toString("hex").slice(0,7),this._debug("new peer %o",e),this.channelName=e.initiator?e.channelName||Es(20).toString("hex"):null,this.initiator=e.initiator||!1,this.channelConfig=e.channelConfig||Dt.channelConfig,this.channelNegotiated=this.channelConfig.negotiated,this.config=Object.assign({},Dt.config,e.config),this.offerOptions=e.offerOptions||{},this.answerOptions=e.answerOptions||{},this.sdpTransform=e.sdpTransform||(t=>t),this.streams=e.streams||(e.stream?[e.stream]:[]),this.trickle=e.trickle!==void 0?e.trickle:!0,this.allowHalfTrickle=e.allowHalfTrickle!==void 0?e.allowHalfTrickle:!1,this.iceCompleteTimeout=e.iceCompleteTimeout||Du,this.destroyed=!1,this.destroying=!1,this._connected=!1,this.remoteAddress=void 0,this.remoteFamily=void 0,this.remotePort=void 0,this.localAddress=void 0,this.localFamily=void 0,this.localPort=void 0,this._wrtc=e.wrtc&&typeof e.wrtc=="object"?e.wrtc:Mo(),!this._wrtc)throw Ce(typeof window>"u"?new Error("No WebRTC support: Specify `opts.wrtc` option in this environment"):new Error("No WebRTC support: Not a supported browser"),"ERR_WEBRTC_SUPPORT");this._pcReady=!1,this._channelReady=!1,this._iceComplete=!1,this._iceCompleteTimer=null,this._channel=null,this._pendingCandidates=[],this._isNegotiating=!1,this._firstNegotiation=!0,this._batchedNegotiation=!1,this._queuedNegotiation=!1,this._sendersAwaitingStable=[],this._senderMap=new Map,this._closingInterval=null,this._remoteTracks=[],this._remoteStreams=[],this._chunk=null,this._cb=null,this._interval=null;try{this._pc=new this._wrtc.RTCPeerConnection(this.config)}catch(t){this.destroy(Ce(t,"ERR_PC_CONSTRUCTOR"));return}this._isReactNativeWebrtc=typeof this._pc._peerConnectionId=="number",this._pc.oniceconnectionstatechange=()=>{this._onIceStateChange()},this._pc.onicegatheringstatechange=()=>{this._onIceStateChange()},this._pc.onconnectionstatechange=()=>{this._onConnectionStateChange()},this._pc.onsignalingstatechange=()=>{this._onSignalingStateChange()},this._pc.onicecandidate=t=>{this._onIceCandidate(t)},typeof this._pc.peerIdentity=="object"&&this._pc.peerIdentity.catch(t=>{this.destroy(Ce(t,"ERR_PC_PEER_IDENTITY"))}),this.initiator||this.channelNegotiated?this._setupData({channel:this._pc.createDataChannel(this.channelName,this.channelConfig)}):this._pc.ondatachannel=t=>{this._setupData(t)},this.streams&&this.streams.forEach(t=>{this.addStream(t)}),this._pc.ontrack=t=>{this._onTrack(t)},this._debug("initial negotiation"),this._needsNegotiation(),this._onFinishBound=()=>{this._onFinish()},this.once("finish",this._onFinishBound)}get bufferSize(){return this._channel&&this._channel.bufferedAmount||0}get connected(){return this._connected&&this._channel.readyState==="open"}address(){return{port:this.localPort,family:this.localFamily,address:this.localAddress}}signal(e){if(!this.destroying){if(this.destroyed)throw Ce(new Error("cannot signal after peer is destroyed"),"ERR_DESTROYED");if(typeof e=="string")try{e=JSON.parse(e)}catch{e={}}this._debug("signal()"),e.renegotiate&&this.initiator&&(this._debug("got request to renegotiate"),this._needsNegotiation()),e.transceiverRequest&&this.initiator&&(this._debug("got request for transceiver"),this.addTransceiver(e.transceiverRequest.kind,e.transceiverRequest.init)),e.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(e.candidate):this._pendingCandidates.push(e.candidate)),e.sdp&&this._pc.setRemoteDescription(new this._wrtc.RTCSessionDescription(e)).then(()=>{this.destroyed||(this._pendingCandidates.forEach(t=>{this._addIceCandidate(t)}),this._pendingCandidates=[],this._pc.remoteDescription.type==="offer"&&this._createAnswer())}).catch(t=>{this.destroy(Ce(t,"ERR_SET_REMOTE_DESCRIPTION"))}),!e.sdp&&!e.candidate&&!e.renegotiate&&!e.transceiverRequest&&this.destroy(Ce(new Error("signal() called with invalid signal data"),"ERR_SIGNALING"))}}_addIceCandidate(e){const t=new this._wrtc.RTCIceCandidate(e);this._pc.addIceCandidate(t).catch(n=>{!t.address||t.address.endsWith(".local")?Bu("Ignoring unsupported ICE candidate."):this.destroy(Ce(n,"ERR_ADD_ICE_CANDIDATE"))})}send(e){if(!this.destroying){if(this.destroyed)throw Ce(new Error("cannot send after peer is destroyed"),"ERR_DESTROYED");this._channel.send(e)}}addTransceiver(e,t){if(!this.destroying){if(this.destroyed)throw Ce(new Error("cannot addTransceiver after peer is destroyed"),"ERR_DESTROYED");if(this._debug("addTransceiver()"),this.initiator)try{this._pc.addTransceiver(e,t),this._needsNegotiation()}catch(n){this.destroy(Ce(n,"ERR_ADD_TRANSCEIVER"))}else this.emit("signal",{type:"transceiverRequest",transceiverRequest:{kind:e,init:t}})}}addStream(e){if(!this.destroying){if(this.destroyed)throw Ce(new Error("cannot addStream after peer is destroyed"),"ERR_DESTROYED");this._debug("addStream()"),e.getTracks().forEach(t=>{this.addTrack(t,e)})}}addTrack(e,t){if(this.destroying)return;if(this.destroyed)throw Ce(new Error("cannot addTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("addTrack()");const n=this._senderMap.get(e)||new Map;let i=n.get(t);if(!i)i=this._pc.addTrack(e,t),n.set(t,i),this._senderMap.set(e,n),this._needsNegotiation();else throw i.removed?Ce(new Error("Track has been removed. You should enable/disable tracks that you want to re-add."),"ERR_SENDER_REMOVED"):Ce(new Error("Track has already been added to that stream."),"ERR_SENDER_ALREADY_ADDED")}replaceTrack(e,t,n){if(this.destroying)return;if(this.destroyed)throw Ce(new Error("cannot replaceTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("replaceTrack()");const i=this._senderMap.get(e),o=i?i.get(n):null;if(!o)throw Ce(new Error("Cannot replace track that was never added."),"ERR_TRACK_NOT_ADDED");t&&this._senderMap.set(t,i),o.replaceTrack!=null?o.replaceTrack(t):this.destroy(Ce(new Error("replaceTrack is not supported in this browser"),"ERR_UNSUPPORTED_REPLACETRACK"))}removeTrack(e,t){if(this.destroying)return;if(this.destroyed)throw Ce(new Error("cannot removeTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSender()");const n=this._senderMap.get(e),i=n?n.get(t):null;if(!i)throw Ce(new Error("Cannot remove track that was never added."),"ERR_TRACK_NOT_ADDED");try{i.removed=!0,this._pc.removeTrack(i)}catch(o){o.name==="NS_ERROR_UNEXPECTED"?this._sendersAwaitingStable.push(i):this.destroy(Ce(o,"ERR_REMOVE_TRACK"))}this._needsNegotiation()}removeStream(e){if(!this.destroying){if(this.destroyed)throw Ce(new Error("cannot removeStream after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSenders()"),e.getTracks().forEach(t=>{this.removeTrack(t,e)})}}_needsNegotiation(){this._debug("_needsNegotiation"),!this._batchedNegotiation&&(this._batchedNegotiation=!0,Ir(()=>{this._batchedNegotiation=!1,this.initiator||!this._firstNegotiation?(this._debug("starting batched negotiation"),this.negotiate()):this._debug("non-initiator initial negotiation request discarded"),this._firstNegotiation=!1}))}negotiate(){if(!this.destroying){if(this.destroyed)throw Ce(new Error("cannot negotiate after peer is destroyed"),"ERR_DESTROYED");this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),setTimeout(()=>{this._createOffer()},0)):this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("requesting negotiation from initiator"),this.emit("signal",{type:"renegotiate",renegotiate:!0})),this._isNegotiating=!0}}destroy(e){this._destroy(e,()=>{})}_destroy(e,t){this.destroyed||this.destroying||(this.destroying=!0,this._debug("destroying (error: %s)",e&&(e.message||e)),Ir(()=>{if(this.destroyed=!0,this.destroying=!1,this._debug("destroy (error: %s)",e&&(e.message||e)),this.readable=this.writable=!1,this._readableState.ended||this.push(null),this._writableState.finished||this.end(),this._connected=!1,this._pcReady=!1,this._channelReady=!1,this._remoteTracks=null,this._remoteStreams=null,this._senderMap=null,clearInterval(this._closingInterval),this._closingInterval=null,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._onFinishBound&&this.removeListener("finish",this._onFinishBound),this._onFinishBound=null,this._channel){try{this._channel.close()}catch{}this._channel.onmessage=null,this._channel.onopen=null,this._channel.onclose=null,this._channel.onerror=null}if(this._pc){try{this._pc.close()}catch{}this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ontrack=null,this._pc.ondatachannel=null}this._pc=null,this._channel=null,e&&this.emit("error",e),this.emit("close"),t()}))}_setupData(e){if(!e.channel)return this.destroy(Ce(new Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL"));this._channel=e.channel,this._channel.binaryType="arraybuffer",typeof this._channel.bufferedAmountLowThreshold=="number"&&(this._channel.bufferedAmountLowThreshold=Pr),this.channelName=this._channel.label,this._channel.onmessage=n=>{this._onChannelMessage(n)},this._channel.onbufferedamountlow=()=>{this._onChannelBufferedAmountLow()},this._channel.onopen=()=>{this._onChannelOpen()},this._channel.onclose=()=>{this._onChannelClose()},this._channel.onerror=n=>{const i=n.error instanceof Error?n.error:new Error(`Datachannel error: ${n.message} ${n.filename}:${n.lineno}:${n.colno}`);this.destroy(Ce(i,"ERR_DATA_CHANNEL"))};let t=!1;this._closingInterval=setInterval(()=>{this._channel&&this._channel.readyState==="closing"?(t&&this._onChannelClose(),t=!0):t=!1},Fu)}_read(){}_write(e,t,n){if(this.destroyed)return n(Ce(new Error("cannot write after peer is destroyed"),"ERR_DATA_CHANNEL"));if(this._connected){try{this.send(e)}catch(i){return this.destroy(Ce(i,"ERR_DATA_CHANNEL"))}this._channel.bufferedAmount>Pr?(this._debug("start backpressure: bufferedAmount %d",this._channel.bufferedAmount),this._cb=n):n(null)}else this._debug("write before connect"),this._chunk=e,this._cb=n}_onFinish(){if(this.destroyed)return;const e=()=>{setTimeout(()=>this.destroy(),1e3)};this._connected?e():this.once("connect",e)}_startIceCompleteTimeout(){this.destroyed||this._iceCompleteTimer||(this._debug("started iceComplete timeout"),this._iceCompleteTimer=setTimeout(()=>{this._iceComplete||(this._iceComplete=!0,this._debug("iceComplete timeout completed"),this.emit("iceTimeout"),this.emit("_iceComplete"))},this.iceCompleteTimeout))}_createOffer(){this.destroyed||this._pc.createOffer(this.offerOptions).then(e=>{if(this.destroyed)return;!this.trickle&&!this.allowHalfTrickle&&(e.sdp=vs(e.sdp)),e.sdp=this.sdpTransform(e.sdp);const t=()=>{if(this.destroyed)return;const o=this._pc.localDescription||e;this._debug("signal"),this.emit("signal",{type:o.type,sdp:o.sdp})},n=()=>{this._debug("createOffer success"),!this.destroyed&&(this.trickle||this._iceComplete?t():this.once("_iceComplete",t))},i=o=>{this.destroy(Ce(o,"ERR_SET_LOCAL_DESCRIPTION"))};this._pc.setLocalDescription(e).then(n).catch(i)}).catch(e=>{this.destroy(Ce(e,"ERR_CREATE_OFFER"))})}_requestMissingTransceivers(){this._pc.getTransceivers&&this._pc.getTransceivers().forEach(e=>{!e.mid&&e.sender.track&&!e.requested&&(e.requested=!0,this.addTransceiver(e.sender.track.kind))})}_createAnswer(){this.destroyed||this._pc.createAnswer(this.answerOptions).then(e=>{if(this.destroyed)return;!this.trickle&&!this.allowHalfTrickle&&(e.sdp=vs(e.sdp)),e.sdp=this.sdpTransform(e.sdp);const t=()=>{if(this.destroyed)return;const o=this._pc.localDescription||e;this._debug("signal"),this.emit("signal",{type:o.type,sdp:o.sdp}),this.initiator||this._requestMissingTransceivers()},n=()=>{this.destroyed||(this.trickle||this._iceComplete?t():this.once("_iceComplete",t))},i=o=>{this.destroy(Ce(o,"ERR_SET_LOCAL_DESCRIPTION"))};this._pc.setLocalDescription(e).then(n).catch(i)}).catch(e=>{this.destroy(Ce(e,"ERR_CREATE_ANSWER"))})}_onConnectionStateChange(){this.destroyed||this._pc.connectionState==="failed"&&this.destroy(Ce(new Error("Connection failed."),"ERR_CONNECTION_FAILURE"))}_onIceStateChange(){if(this.destroyed)return;const e=this._pc.iceConnectionState,t=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",e,t),this.emit("iceStateChange",e,t),(e==="connected"||e==="completed")&&(this._pcReady=!0,this._maybeReady()),e==="failed"&&this.destroy(Ce(new Error("Ice connection failed."),"ERR_ICE_CONNECTION_FAILURE")),e==="closed"&&this.destroy(Ce(new Error("Ice connection closed."),"ERR_ICE_CONNECTION_CLOSED"))}getStats(e){const t=n=>(Object.prototype.toString.call(n.values)==="[object Array]"&&n.values.forEach(i=>{Object.assign(n,i)}),n);this._pc.getStats.length===0||this._isReactNativeWebrtc?this._pc.getStats().then(n=>{const i=[];n.forEach(o=>{i.push(t(o))}),e(null,i)},n=>e(n)):this._pc.getStats.length>0?this._pc.getStats(n=>{if(this.destroyed)return;const i=[];n.result().forEach(o=>{const a={};o.names().forEach(l=>{a[l]=o.stat(l)}),a.id=o.id,a.type=o.type,a.timestamp=o.timestamp,i.push(t(a))}),e(null,i)},n=>e(n)):e(null,[])}_maybeReady(){if(this._debug("maybeReady pc %s channel %s",this._pcReady,this._channelReady),this._connected||this._connecting||!this._pcReady||!this._channelReady)return;this._connecting=!0;const e=()=>{this.destroyed||this.getStats((t,n)=>{if(this.destroyed)return;t&&(n=[]);const i={},o={},a={};let l=!1;n.forEach(p=>{(p.type==="remotecandidate"||p.type==="remote-candidate")&&(i[p.id]=p),(p.type==="localcandidate"||p.type==="local-candidate")&&(o[p.id]=p),(p.type==="candidatepair"||p.type==="candidate-pair")&&(a[p.id]=p)});const f=p=>{l=!0;let b=o[p.localCandidateId];b&&(b.ip||b.address)?(this.localAddress=b.ip||b.address,this.localPort=Number(b.port)):b&&b.ipAddress?(this.localAddress=b.ipAddress,this.localPort=Number(b.portNumber)):typeof p.googLocalAddress=="string"&&(b=p.googLocalAddress.split(":"),this.localAddress=b[0],this.localPort=Number(b[1])),this.localAddress&&(this.localFamily=this.localAddress.includes(":")?"IPv6":"IPv4");let d=i[p.remoteCandidateId];d&&(d.ip||d.address)?(this.remoteAddress=d.ip||d.address,this.remotePort=Number(d.port)):d&&d.ipAddress?(this.remoteAddress=d.ipAddress,this.remotePort=Number(d.portNumber)):typeof p.googRemoteAddress=="string"&&(d=p.googRemoteAddress.split(":"),this.remoteAddress=d[0],this.remotePort=Number(d[1])),this.remoteAddress&&(this.remoteFamily=this.remoteAddress.includes(":")?"IPv6":"IPv4"),this._debug("connect local: %s:%s remote: %s:%s",this.localAddress,this.localPort,this.remoteAddress,this.remotePort)};if(n.forEach(p=>{p.type==="transport"&&p.selectedCandidatePairId&&f(a[p.selectedCandidatePairId]),(p.type==="googCandidatePair"&&p.googActiveConnection==="true"||(p.type==="candidatepair"||p.type==="candidate-pair")&&p.selected)&&f(p)}),!l&&(!Object.keys(a).length||Object.keys(o).length)){setTimeout(e,100);return}else this._connecting=!1,this._connected=!0;if(this._chunk){try{this.send(this._chunk)}catch(b){return this.destroy(Ce(b,"ERR_DATA_CHANNEL"))}this._chunk=null,this._debug('sent chunk from "write before connect"');const p=this._cb;this._cb=null,p(null)}typeof this._channel.bufferedAmountLowThreshold!="number"&&(this._interval=setInterval(()=>this._onInterval(),150),this._interval.unref&&this._interval.unref()),this._debug("connect"),this.emit("connect")})};e()}_onInterval(){!this._cb||!this._channel||this._channel.bufferedAmount>Pr||this._onChannelBufferedAmountLow()}_onSignalingStateChange(){this.destroyed||(this._pc.signalingState==="stable"&&(this._isNegotiating=!1,this._debug("flushing sender queue",this._sendersAwaitingStable),this._sendersAwaitingStable.forEach(e=>{this._pc.removeTrack(e),this._queuedNegotiation=!0}),this._sendersAwaitingStable=[],this._queuedNegotiation?(this._debug("flushing negotiation queue"),this._queuedNegotiation=!1,this._needsNegotiation()):(this._debug("negotiated"),this.emit("negotiated"))),this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState))}_onIceCandidate(e){this.destroyed||(e.candidate&&this.trickle?this.emit("signal",{type:"candidate",candidate:{candidate:e.candidate.candidate,sdpMLineIndex:e.candidate.sdpMLineIndex,sdpMid:e.candidate.sdpMid}}):!e.candidate&&!this._iceComplete&&(this._iceComplete=!0,this.emit("_iceComplete")),e.candidate&&this._startIceCompleteTimeout())}_onChannelMessage(e){if(this.destroyed)return;let t=e.data;t instanceof ArrayBuffer&&(t=Lu.from(t)),this.push(t)}_onChannelBufferedAmountLow(){if(this.destroyed||!this._cb)return;this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);const e=this._cb;this._cb=null,e(null)}_onChannelOpen(){this._connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())}_onChannelClose(){this.destroyed||(this._debug("on channel close"),this.destroy())}_onTrack(e){this.destroyed||e.streams.forEach(t=>{this._debug("on track"),this.emit("track",e.track,t),this._remoteTracks.push({track:e.track,stream:t}),!this._remoteStreams.some(n=>n.id===t.id)&&(this._remoteStreams.push(t),Ir(()=>{this._debug("on stream"),this.emit("stream",t)}))})}_debug(){const e=[].slice.call(arguments);e[0]="["+this._id+"] "+e[0],Mu.apply(null,e)}}Dt.WEBRTC_SUPPORT=!!Mo();Dt.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"};Dt.channelConfig={};var Uu=Dt;const kt=Bs(Uu);class ju{constructor(e,t={}){this.identity=e,this.peerManager=null,this.config={defaultTTL:t.defaultTTL||7,maxHops:t.maxHops||10,seenMessageExpiry:t.seenMessageExpiry||6e4,cleanupInterval:t.cleanupInterval||3e4,maxSeenMessages:t.maxSeenMessages||1e4},this.seenMessages=new Map,this.messageHandlers=new Map,this.stats={messagesReceived:0,messagesForwarded:0,messagesDuplicate:0,messagesExpired:0,messagesDelivered:0},this.startCleanup()}setPeerManager(e){this.peerManager=e}on(e,t){this.messageHandlers.set(e,t)}generateId(){return`${this.identity.uuid}-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}createMessage(e,t,n={}){return{msgId:this.generateId(),msgType:e,senderId:this.identity.uuid,senderName:this.identity.displayName,timestamp:Date.now(),ttl:n.ttl||this.config.defaultTTL,hopCount:0,path:[this.identity.uuid],targetPeerId:n.targetPeerId||null,routingHint:n.routingHint||"broadcast",payload:t}}async routeMessage(e,t=null){if(this.stats.messagesReceived++,!this.validateMessage(e))return!1;if(this.isDuplicate(e.msgId,t))return this.stats.messagesDuplicate++,!1;if(this.recordSeen(e.msgId,t,e.hopCount),e.ttl<=0)return this.stats.messagesExpired++,!1;if(e.hopCount>=this.config.maxHops)return this.stats.messagesExpired++,!1;if(this.hasLoop(e.path))return!1;const n=this.isMessageForUs(e);return n&&e.senderId!==this.identity.uuid&&(this.stats.messagesDelivered++,await this.deliverMessage(e)),this.shouldForward(e,n,t)&&await this.forwardMessage(e,t),!0}validateMessage(e){return!(!e||typeof e!="object"||!e.msgId||!e.msgType||!e.senderId||typeof e.ttl!="number"||e.ttl<0||typeof e.hopCount!="number"||e.hopCount<0||!Array.isArray(e.path)||e.path.length===0)}isDuplicate(e,t){if(!this.seenMessages.has(e))return!1;const n=this.seenMessages.get(e);return n.from===t&&Date.now()-n.timestamp<5e3||Date.now()-n.timestamp<1e3}recordSeen(e,t,n){this.seenMessages.set(e,{timestamp:Date.now(),from:t,hops:n}),this.seenMessages.size>this.config.maxSeenMessages&&this.pruneOldestSeenMessages(1e3)}hasLoop(e){return new Set(e).size!==e.length}isMessageForUs(e){return e.targetPeerId===this.identity.uuid||!e.targetPeerId&&e.routingHint==="broadcast"||e.msgType==="chat"}shouldForward(e,t,n){return e.ttl<=1?!1:e.targetPeerId?e.targetPeerId!==this.identity.uuid:!0}async forwardMessage(e,t){if(!this.peerManager)return 0;this.stats.messagesForwarded++;const n={...e,ttl:e.ttl-1,hopCount:e.hopCount+1,path:e.senderId===this.identity.uuid?e.path:[...e.path,this.identity.uuid]},i=Array.from(this.peerManager.peers.entries());let o=0;for(const[a,l]of i)if(l.status==="connected"&&a!==t&&!e.path.includes(a)&&a!==e.senderId&&a!=="_temp")try{l.peer.send(JSON.stringify(n)),o++}catch(f){console.error(`[Router] Failed to forward to ${a}:`,f)}return o}async deliverMessage(e){const t=this.messageHandlers.get(e.msgType);if(t)try{await t(e)}catch(n){console.error(`[Router] Handler error for ${e.msgType}:`,n)}}startCleanup(){this.cleanupTimer=setInterval(()=>{this.cleanupSeenMessages()},this.config.cleanupInterval)}cleanupSeenMessages(){const e=Date.now(),t=this.config.seenMessageExpiry;for(const[n,i]of this.seenMessages.entries())e-i.timestamp>t&&this.seenMessages.delete(n)}pruneOldestSeenMessages(e){const t=Array.from(this.seenMessages.entries()).sort((n,i)=>n[1].timestamp-i[1].timestamp);for(let n=0;n<e&&n<t.length;n++)this.seenMessages.delete(t[n][0])}getStats(){return{...this.stats,seenMessagesCount:this.seenMessages.size}}stop(){this.cleanupTimer&&clearInterval(this.cleanupTimer)}}class $u{constructor(e,t=6){this.identity=e,this.maxConnections=t,this.peerManager=null,this.router=null,this.introductionsSent=new Map,this.introductionsReceived=new Set,this.pendingConnections=new Map,this.introductionTimeout=3e4,this.cooldownPeriod=6e4,this.autoIntroduceInterval=3e4,this.startAutoIntroduce()}setPeerManager(e){this.peerManager=e}setRouter(e){this.router=e}introducePeers(e,t){if(!this.shouldIntroduce(e,t))return!1;const n=`${e}-${t}-${Date.now()}`,i=this.peerManager.peers.get(e),o=this.peerManager.peers.get(t);if(!i||!o)return!1;const a=this.router.createMessage("peer_introduction",{introducedPeerId:e,introducedName:i.displayName,introductionId:n,connectionQuality:{latency:i.latency||null,uptime:this.getUptime(e)}},{targetPeerId:t,ttl:3});this.router.routeMessage(a);const l=this.router.createMessage("peer_introduction",{introducedPeerId:t,introducedName:o.displayName,introductionId:n,connectionQuality:{latency:o.latency||null,uptime:this.getUptime(t)}},{targetPeerId:e,ttl:3});return this.router.routeMessage(l),this.introductionsSent.set(n,{peerA:e,peerB:t,timestamp:Date.now()}),setTimeout(()=>{this.introductionsSent.delete(n)},this.introductionTimeout),!0}shouldIntroduce(e,t){const n=this.peerManager.peers.get(e),i=this.peerManager.peers.get(t);if(!n||!i||n.status!=="connected"||i.status!=="connected")return!1;const o=this.findRecentIntroduction(e,t);return!(o&&Date.now()-o.timestamp<this.cooldownPeriod)}findRecentIntroduction(e,t){for(const[n,i]of this.introductionsSent.entries())if(i.peerA===e&&i.peerB===t||i.peerA===t&&i.peerB===e)return i;return null}async handleIntroduction(e){const{introducedPeerId:t,introducedName:n,introductionId:i,connectionQuality:o}=e.payload;if(!this.introductionsReceived.has(i)){if(this.introductionsReceived.add(i),this.introductionsReceived.size>100){const a=Array.from(this.introductionsReceived);this.introductionsReceived=new Set(a.slice(-50))}this.shouldAcceptIntroduction(t,o)&&(this.peerManager.peers.has(t)||(this.identity.uuid<t?setTimeout(()=>{this.initiateConnection(t,n,i)},1e3):(this.pendingConnections.set(t,{name:n,timestamp:Date.now(),introductionId:i}),setTimeout(()=>{this.pendingConnections.delete(t)},this.introductionTimeout))))}}shouldAcceptIntroduction(e,t){return!(e===this.identity.uuid||this.peerManager.peers.has(e)||this.peerManager.getConnectedPeerCount()>=this.maxConnections||t&&t.latency>2e3)}async initiateConnection(e,t,n){this.peerManager.peers.has(e)||await this.peerManager.createIntroducedConnection(e,t,n)}async handleRelaySignal(e){const{signalType:t,signal:n,fromPeerId:i,fromName:o,introductionId:a}=e.payload;this.pendingConnections.get(i),await this.peerManager.handleRelayedSignal(i,o,n,t,a),this.pendingConnections.delete(i)}startAutoIntroduce(){this.autoIntroduceTimer=setInterval(()=>{this.autoIntroducePeers()},this.autoIntroduceInterval)}autoIntroducePeers(){const e=Array.from(this.peerManager.peers.entries()).filter(([t,n])=>n.status==="connected"&&t!=="_temp").map(([t])=>t);if(!(e.length<2))for(let t=0;t<e.length-1;t++)for(let n=t+1;n<e.length;n++)this.introducePeers(e[t],e[n])}getUptime(e){const t=this.peerManager.peers.get(e);return!t||!t.connectedAt?0:Math.floor((Date.now()-t.connectedAt)/1e3)}stop(){this.autoIntroduceTimer&&clearInterval(this.autoIntroduceTimer)}}class Hu{constructor(e){this.identity=e,this.peerManager=null,this.router=null,this.directLatencies=new Map,this.pendingPings=new Map,this.pingInterval=15e3,this.maxPendingPings=100,this.pingTimeout=5e3,this.startPeriodicPing()}setPeerManager(e){this.peerManager=e}setRouter(e){this.router=e}startPeriodicPing(){this.pingTimer=setInterval(()=>{this.pingAllPeers()},this.pingInterval)}pingAllPeers(){if(!this.peerManager)return;const e=Array.from(this.peerManager.peers.entries()).filter(([t,n])=>n.status==="connected"&&t!=="_temp");for(const[t]of e)this.pingPeer(t)}pingPeer(e){if(!this.router)return;const t=this.generatePingId();this.pendingPings.set(t,{timestamp:Date.now(),targetPeerId:e});const n=this.router.createMessage("ping",{pingId:t},{targetPeerId:e,ttl:5});this.router.routeMessage(n),setTimeout(()=>{this.pendingPings.has(t)&&this.pendingPings.delete(t)},this.pingTimeout),this.pendingPings.size>this.maxPendingPings&&this.pruneOldestPings(20)}async handlePing(e){if(!this.router)return;const{pingId:t}=e.payload,n=this.router.createMessage("pong",{pingId:t},{targetPeerId:e.senderId,ttl:5});this.router.routeMessage(n)}async handlePong(e){const{pingId:t}=e.payload,n=this.pendingPings.get(t);if(!n)return;const i=Date.now()-n.timestamp,o=e.senderId;this.updateLatency(o,i,e.hopCount),this.pendingPings.delete(t)}updateLatency(e,t,n){if(this.directLatencies.set(e,t),this.peerManager&&this.peerManager.peers.has(e)){const i=this.peerManager.peers.get(e);n<=1?i.latency=t:i.latency=Math.floor(t/n)}}getLatency(e){return this.directLatencies.get(e)||null}getBestPeer(e){if(!e||e.length===0)return null;let t=null,n=1/0;for(const i of e){const o=this.directLatencies.get(i);o&&o<n&&(n=o,t=i)}return!t&&e.length>0&&(t=e[Math.floor(Math.random()*e.length)]),t}generatePingId(){return`ping-${Date.now()}-${Math.random().toString(36).substr(2,6)}`}pruneOldestPings(e){const t=Array.from(this.pendingPings.entries()).sort((n,i)=>n[1].timestamp-i[1].timestamp);for(let n=0;n<e&&n<t.length;n++)this.pendingPings.delete(t[n][0])}getStats(){const e=[];for(const[t,n]of this.directLatencies.entries())e.push({peerId:t.substring(0,8),latency:n});return{measuredPeers:e.length,pendingPings:this.pendingPings.size,latencies:e.sort((t,n)=>t.latency-n.latency)}}stop(){this.pingTimer&&clearInterval(this.pingTimer)}}class qu{constructor(e,t={}){this.identity=e,this.peerManager=null,this.config={maxConnections:t.maxConnections||6,minConnections:t.minConnections||2,targetConnections:t.targetConnections||4,qualityThreshold:t.qualityThreshold||40,rebalanceInterval:t.rebalanceInterval||6e4},this.connectionScores=new Map,this.startRebalancing()}setPeerManager(e){this.peerManager=e}calculateQualityScore(e){if(!this.peerManager)return 0;const t=this.peerManager.peers.get(e);if(!t)return 0;let n=0;t.latency!==null&&t.latency!==void 0?t.latency<100?n+=40:t.latency<200?n+=30:t.latency<500?n+=20:t.latency<1e3&&(n+=10):n+=20,t.connectionType?t.connectionType.includes("host")?n+=30:t.connectionType.includes("srflx")?n+=20:t.connectionType.includes("relay")&&(n+=10):n+=15;const i=this.getConnectionUptime(e);return i>600?n+=30:i>300?n+=20:i>60&&(n+=10),this.connectionScores.set(e,n),n}getConnectionUptime(e){if(!this.peerManager)return 0;const t=this.peerManager.peers.get(e);return!t||!t.connectedAt?0:Math.floor((Date.now()-t.connectedAt)/1e3)}shouldAcceptConnection(e){if(!this.peerManager)return{accept:!1,reason:"no_peer_manager"};const t=this.peerManager.getConnectedPeerCount();if(t<this.config.targetConnections)return{accept:!0,reason:"below_target"};if(t>=this.config.maxConnections){const n=this.getWorstConnection();return n&&e.score>n.score+20?{accept:!0,reason:"replacement",replacePeerId:n.peerId}:{accept:!1,reason:"at_max_capacity"}}return e.score>=this.config.qualityThreshold?{accept:!0,reason:"good_quality"}:{accept:!1,reason:"low_quality"}}getWorstConnection(){if(!this.peerManager)return null;let e=null,t=1/0;for(const[n,i]of this.peerManager.peers.entries()){if(i.status!=="connected"||n==="_temp")continue;const o=this.calculateQualityScore(n);o<t&&(t=o,e={peerId:n,score:o})}return e}getBestConnection(){if(!this.peerManager)return null;let e=null,t=-1/0;for(const[n,i]of this.peerManager.peers.entries()){if(i.status!=="connected"||n==="_temp")continue;const o=this.calculateQualityScore(n);o>t&&(t=o,e={peerId:n,score:o})}return e}startRebalancing(){this.rebalanceTimer=setInterval(()=>{this.rebalanceConnections()},this.config.rebalanceInterval)}rebalanceConnections(){if(!this.peerManager)return;const e=this.peerManager.getConnectedPeerCount();if(e<this.config.minConnections)return;if(e>this.config.maxConnections){this.pruneWorstConnection();return}this.findLowQualityConnections().length>0}findLowQualityConnections(){if(!this.peerManager)return[];const e=[];for(const[t,n]of this.peerManager.peers.entries()){if(n.status!=="connected"||t==="_temp")continue;const i=this.calculateQualityScore(t);i<this.config.qualityThreshold&&e.push({peerId:t,score:i})}return e}pruneWorstConnection(){const e=this.getWorstConnection();if(e&&this.peerManager){const t=this.peerManager.peers.get(e.peerId);t&&t.peer&&t.peer.destroy(),this.peerManager.peers.delete(e.peerId)}}getConnectionStats(){if(!this.peerManager)return null;const e=[];for(const[t,n]of this.peerManager.peers.entries())n.status!=="connected"||t==="_temp"||e.push({peerId:t.substring(0,8),score:this.calculateQualityScore(t),latency:n.latency,uptime:this.getConnectionUptime(t)});return{count:this.peerManager.getConnectedPeerCount(),target:this.config.targetConnections,max:this.config.maxConnections,scores:e.sort((t,n)=>n.score-t.score)}}stop(){this.rebalanceTimer&&clearInterval(this.rebalanceTimer)}}class Wu{constructor(){this.peerViolations=new Map,this.messageRateLimits=new Map,this.MAX_VIOLATIONS=3,this.RATE_LIMIT_WINDOW=1e3,this.RATE_LIMIT_MAX=50,this.MAX_MESSAGE_SIZE=1e5,this.MAX_PATH_LENGTH=20,this.loadBanList()}checkRateLimit(e){const t=Date.now(),n=this.messageRateLimits.get(e);return!n||t-n.windowStart>this.RATE_LIMIT_WINDOW?(this.messageRateLimits.set(e,{count:1,windowStart:t}),!0):(n.count++,n.count>this.RATE_LIMIT_MAX?(this.recordViolation(e,"rate_limit_exceeded"),!1):!0)}validateMessageStructure(e){try{return JSON.stringify(e).length>this.MAX_MESSAGE_SIZE?(console.warn("[Security] Message exceeds size limit"),!1):e.path&&e.path.length>this.MAX_PATH_LENGTH?(console.warn("[Security] Path exceeds maximum length"),!1):e.ttl>10||e.ttl<0?(console.warn("[Security] Invalid TTL value"),!1):e.hopCount>20||e.hopCount<0?(console.warn("[Security] Invalid hop count"),!1):!0}catch(t){return console.error("[Security] Error validating message:",t),!1}}validateTTLConsistency(e,t){return t&&e.ttl>=t?(console.warn("[Security] TTL increased in transit - possible attack"),!1):!0}validatePath(e,t){if(!e.path||e.path.length===0)return console.warn("[Security] Empty path"),!1;const n=e.path[e.path.length-1];return n!==t&&n!==e.senderId&&console.log("[Security] Path mismatch (might be multi-hop)"),!0}sanitizeMessage(e,t="plain"){if(typeof e!="string")return"";const n=e.trim().substring(0,5e3);if(t==="markdown"){if(/<script|javascript:|data:|vbscript:/i.test(n))throw new Error("Invalid content detected");return n}else return n.replace(/</g,"&lt;").replace(/>/g,"&gt;")}recordViolation(e,t){const n=this.peerViolations.get(e)||0;this.peerViolations.set(e,n+1),console.warn(`[Security] Violation recorded for ${e.substring(0,8)}: ${t} (total: ${n+1})`),n+1>=this.MAX_VIOLATIONS&&this.banPeer(e)}banPeer(e){console.error(`[Security] Banning peer ${e.substring(0,8)} for excessive violations`);const t=this.getBanList();t.includes(e)||(t.push(e),localStorage.setItem("meshBanList",JSON.stringify(t)))}isBanned(e){return this.getBanList().includes(e)}getBanList(){try{return JSON.parse(localStorage.getItem("meshBanList")||"[]")}catch{return[]}}loadBanList(){const e=this.getBanList();console.log(`[Security] Loaded ${e.length} banned peers`)}unbanPeer(e){const n=this.getBanList().filter(i=>i!==e);localStorage.setItem("meshBanList",JSON.stringify(n)),console.log(`[Security] Unbanned peer ${e.substring(0,8)}`)}clearBanList(){localStorage.setItem("meshBanList",JSON.stringify([])),console.log("[Security] Cleared ban list")}getStats(){return{violations:Array.from(this.peerViolations.entries()).map(([e,t])=>({peerId:e.substring(0,8),violations:t})),bannedPeers:this.getBanList().length,rateLimitEntries:this.messageRateLimits.size}}}const ht={DIRECT_UDP:{name:"Direct UDP",priority:1,category:"host",description:"True peer-to-peer UDP connection (fastest)"},DIRECT_TCP:{name:"Direct TCP",priority:2,category:"host",description:"True peer-to-peer TCP connection"},STUN_UDP:{name:"STUN UDP",priority:3,category:"srflx",description:"NAT-traversed UDP via STUN server"},STUN_TCP:{name:"STUN TCP",priority:4,category:"srflx",description:"NAT-traversed TCP via STUN server"},TURN_UDP_80:{name:"TURN UDP :80",priority:5,category:"relay",port:80,transport:"udp",description:"Relayed via TURN UDP on port 80 (HTTP port)"},TURN_UDP_443:{name:"TURN UDP :443",priority:6,category:"relay",port:443,transport:"udp",description:"Relayed via TURN UDP on port 443 (HTTPS port)"},TURN_TCP_443:{name:"TURN TCP :443",priority:7,category:"relay",port:443,transport:"tcp",description:"Relayed via TURN TCP on port 443 (looks like HTTPS)"},TURNS_TLS_443:{name:"TURN TLS :443",priority:8,category:"relay",port:443,transport:"tls",description:"Relayed via TURN TLS on port 443 (encrypted, indistinguishable from HTTPS)"},UNKNOWN:{name:"Unknown",priority:99,category:"unknown",description:"Connection type could not be determined"}},Sn="openrelayproject",Cn="openrelayproject",sn="openrelay.metered.ca",yt={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"},{urls:"stun:stun3.l.google.com:19302"},{urls:`stun:${sn}:80`},{urls:`turn:${sn}:80`,username:Sn,credential:Cn},{urls:`turn:${sn}:443`,username:Sn,credential:Cn},{urls:`turn:${sn}:443?transport=tcp`,username:Sn,credential:Cn},{urls:`turns:${sn}:443?transport=tcp`,username:Sn,credential:Cn}],iceTransportPolicy:"all",iceCandidatePoolSize:0,bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"};function Ku(r,e){if(!r)return ht.UNKNOWN;const t=r.candidateType||r.type,n=(r.protocol||"").toLowerCase(),i=r.port;if(t==="host"){if(n==="udp")return ht.DIRECT_UDP;if(n==="tcp")return ht.DIRECT_TCP}if(t==="srflx"){if(n==="udp")return ht.STUN_UDP;if(n==="tcp")return ht.STUN_TCP}if(t==="relay"){if(n==="udp")return i===80?ht.TURN_UDP_80:ht.TURN_UDP_443;if(n==="tcp")return(r.url||"").startsWith("turns:")?ht.TURNS_TLS_443:ht.TURN_TCP_443}return ht.UNKNOWN}function zu(r){let e=null,t=null,n=null;return r.forEach(i=>{i.type==="candidate-pair"&&i.state==="succeeded"&&(e=i)}),e?(r.forEach(i=>{i.id===e.localCandidateId&&(t=i),i.id===e.remoteCandidateId&&(n=i)}),{connectionType:Ku(t),localCandidate:t,remoteCandidate:n,selectedPair:e}):{connectionType:ht.UNKNOWN,localCandidate:null,remoteCandidate:null}}const Mt={CACHE_VALIDITY:{HOST:6e5,SRFLX:3e5,RELAY:12e4,DEFAULT:3e5},DEFAULT_TIMEOUT:8e3,SIGNALING_REUSE_TIMEOUT:5e3,ICE_GATHER_DELAY:2e3,STATS_SAMPLE_DELAY:1e3};class Gu{constructor(e,t,n){this.identity=e,this.peerManager=t,this.peerPersistence=n,this.monitoredPeers=new Map}async attemptDirectReconnection(e,t=Mt.DEFAULT_TIMEOUT){const n=Date.now();try{const i=await this.peerPersistence.getPeer(e);if(!i)return{success:!1,reason:"no_cached_data",duration:Date.now()-n};if(!this.isCacheValid(i))return{success:!1,reason:"cache_expired",cacheAge:Date.now()-i.lastSeen,duration:Date.now()-n};const o=this.getReconnectionProbability(i);return i.lastOffer&&i.lastAnswer&&(await this.tryReuseSignaling(i,t)).success?(await this.peerPersistence.updateConnectionQuality(e,{lastMeasured:Date.now()}),{success:!0,method:"signaling_reuse",duration:Date.now()-n}):i.reconnectionCredentials&&(await this.tryReconnectionCredentials(i,t)).success?(await this.peerPersistence.updateConnectionQuality(e,{lastMeasured:Date.now()}),{success:!0,method:"pre_exchanged_credentials",duration:Date.now()-n}):(await this.peerPersistence.incrementReconnectionAttempts(e),{success:!1,reason:"all_methods_failed",probability:o,duration:Date.now()-n})}catch(i){return console.error("[DirectReconnection] Error during reconnection:",i),{success:!1,reason:"error",error:i.message,duration:Date.now()-n}}}isCacheValid(e){var o;if(!e||!e.lastSeen)return!1;const t=Date.now()-e.lastSeen,n=(o=e.connectionQuality)==null?void 0:o.connectionType;let i=Mt.CACHE_VALIDITY.DEFAULT;if(n){const a=n.toLowerCase();a.includes("host")||a.includes("direct")?i=Mt.CACHE_VALIDITY.HOST:a.includes("srflx")||a.includes("stun")?i=Mt.CACHE_VALIDITY.SRFLX:(a.includes("relay")||a.includes("turn"))&&(i=Mt.CACHE_VALIDITY.RELAY)}return t<=i}async tryReuseSignaling(e,t){return new Promise(n=>{let i=null,o=null,a=!1;const l=()=>{if(o&&clearTimeout(o),i&&!a)try{i.destroy()}catch{}},f=p=>{a||(a=!0,l(),n(p))};try{const p=e.wasInitiator||!1;if(i=new kt({initiator:p,trickle:!1,config:yt,sdpTransform:b=>b.replace(/a=ice-options:trickle\s?\n/g,"")}),o=setTimeout(()=>{f({success:!1,reason:"timeout"})},t),i.on("connect",()=>{f({success:!0,reason:"connected",peer:i})}),i.on("error",b=>{f({success:!1,reason:"peer_error",error:b.message})}),i.on("close",()=>{f({success:!1,reason:"peer_closed"})}),p&&e.lastAnswer)i.signal(e.lastAnswer);else if(!p&&e.lastOffer)i.signal(e.lastOffer);else{f({success:!1,reason:"missing_signaling_data"});return}}catch(p){f({success:!1,reason:"exception",error:p.message})}})}async tryReconnectionCredentials(e,t){return new Promise(n=>{let i=null,o=null,a=!1;const l=()=>{if(o&&clearTimeout(o),i&&!a)try{i.destroy()}catch{}},f=p=>{a||(a=!0,l(),n(p))};try{const p=e.reconnectionCredentials;let b=!1,d=null;if(p.ourOffer&&p.theirAnswer)b=!0,d=p.theirAnswer;else if(p.theirOffer&&p.ourAnswer)b=!1,d=p.theirOffer;else{f({success:!1,reason:"invalid_credentials_format"});return}i=new kt({initiator:b,trickle:!1,config:yt,sdpTransform:w=>w.replace(/a=ice-options:trickle\s?\n/g,"")}),o=setTimeout(()=>{f({success:!1,reason:"timeout"})},t),i.on("connect",async()=>{this.peerManager.registerReconnectedPeer&&await this.peerManager.registerReconnectedPeer(e.peerId,e.displayName,i),f({success:!0,reason:"connected",peer:i})}),i.on("error",w=>{f({success:!1,reason:"peer_error",error:w.message})}),i.on("close",()=>{f({success:!1,reason:"peer_closed"})}),i.signal(d)}catch(p){f({success:!1,reason:"exception",error:p.message})}})}monitorPeerConnection(e,t,n){if(!n||!n._pc)return;const i={peerId:e,peerName:t,peer:n,startTime:Date.now(),candidates:[],localDescription:null,remoteDescription:null,connectionType:null};this.monitoredPeers.set(e,i),setTimeout(()=>{this.captureConnectionData(e,i)},Mt.ICE_GATHER_DELAY),n.on("close",()=>{this.handlePeerDisconnect(e)}),n.on("error",()=>{})}async captureConnectionData(e,t){try{const{peer:n}=t,i=n._pc;if(!i)return;const o=i.localDescription,a=i.remoteDescription;o&&(t.localDescription={type:o.type,sdp:o.sdp}),a&&(t.remoteDescription={type:a.type,sdp:a.sdp}),setTimeout(async()=>{try{const l=await i.getStats(),f=zu(l);t.connectionType=f.connectionType;const p=[];l.forEach(b=>{(b.type==="local-candidate"||b.type==="remote-candidate")&&p.push({type:b.type,candidateType:b.candidateType,protocol:b.protocol,address:b.address,port:b.port,priority:b.priority,relatedAddress:b.relatedAddress,relatedPort:b.relatedPort})}),t.candidates=p,await this.cacheConnectionInfo(e,t.peerName,{localDescription:t.localDescription,remoteDescription:t.remoteDescription,candidates:t.candidates,connectionType:f.connectionType,wasInitiator:n.initiator})}catch(l){console.error("[DirectReconnection] Error capturing stats:",l)}},Mt.STATS_SAMPLE_DELAY)}catch(n){console.error("[DirectReconnection] Error capturing connection data:",n)}}async handlePeerDisconnect(e){this.monitoredPeers.get(e)&&(await this.peerPersistence.updateLastSeen(e),this.monitoredPeers.delete(e))}async cacheConnectionInfo(e,t,n){var i,o;try{let a=await this.peerPersistence.getPeer(e);a||(a={peerId:e,userId:e,displayName:t,firstSeen:Date.now(),lastSeen:Date.now(),lastConnected:Date.now(),publicKey:null,connectionQuality:{latency:null,successRate:1,connectionType:((i=n.connectionType)==null?void 0:i.name)||null,lastMeasured:Date.now(),totalConnections:1,successfulConnections:1,avgUptime:0},reconnectionAttempts:0,blacklistUntil:null,metadata:{}}),a.lastSeen=Date.now(),a.lastConnected=Date.now(),a.cachedCandidates=n.candidates||[],a.connectionQuality=a.connectionQuality||{},a.connectionQuality.connectionType=((o=n.connectionType)==null?void 0:o.name)||null,a.connectionQuality.lastMeasured=Date.now(),n.localDescription&&(n.wasInitiator?a.lastOffer=n.localDescription:a.lastAnswer=n.localDescription),n.remoteDescription&&(n.wasInitiator?a.lastAnswer=n.remoteDescription:a.lastOffer=n.remoteDescription),a.wasInitiator=n.wasInitiator,await this.peerPersistence.storePeer(a)}catch(a){console.error("[DirectReconnection] Error caching connection info:",a)}}getReconnectionProbability(e){var p;if(!e)return{likelihood:"very_low",score:0,factors:["no_cached_data"]};let t=0;const n=[],i=Date.now()-e.lastSeen,o=Math.floor(i/6e4);i<6e4?(t+=30,n.push("very_recent")):i<3e5?(t+=20,n.push("recent")):i<6e5?(t+=10,n.push(`${o}m_old`)):(t+=5,n.push(`${o}m_old`));const a=(p=e.connectionQuality)==null?void 0:p.connectionType;if(a){const b=a.toLowerCase();b.includes("host")||b.includes("direct")?(t+=40,n.push("direct_connection")):b.includes("srflx")||b.includes("stun")?(t+=25,n.push("stun_connection")):b.includes("relay")||b.includes("turn")?(t+=10,n.push("relay_connection")):(t+=15,n.push("unknown_type"))}else t+=10,n.push("no_type_info");const l=e.connectionQuality;l&&l.successRate!==null&&l.successRate!==void 0&&(t+=Math.floor(l.successRate*20),l.successRate>.8?n.push("reliable"):l.successRate<.5&&n.push("unreliable")),l&&l.latency!==null&&l.latency!==void 0&&(l.latency<50?(t+=10,n.push("low_latency")):l.latency<200?t+=5:n.push("high_latency")),e.reconnectionAttempts>0&&(t-=e.reconnectionAttempts*5,n.push(`${e.reconnectionAttempts}_failed`)),e.blacklistUntil&&e.blacklistUntil>Date.now()&&(t=0,n.push("blacklisted")),t=Math.max(0,Math.min(100,t));let f;return t>=70?f="very_high":t>=50?f="high":t>=30?f="medium":t>=15?f="low":f="very_low",{likelihood:f,score:Math.round(t),factors:n,cacheAge:i,ageMinutes:o}}stopMonitoring(){this.monitoredPeers.clear()}async getStatistics(){var n;const e=await this.peerPersistence.getAllPeerIds(),t={totalCached:e.length,validCache:0,byType:{host:0,srflx:0,relay:0,unknown:0},byAge:{veryRecent:0,recent:0,moderate:0,old:0}};for(const i of e){const o=await this.peerPersistence.getPeer(i);if(!o)continue;this.isCacheValid(o)&&t.validCache++;const a=(n=o.connectionQuality)==null?void 0:n.connectionType;if(a){const f=a.toLowerCase();f.includes("host")?t.byType.host++:f.includes("srflx")?t.byType.srflx++:f.includes("relay")?t.byType.relay++:t.byType.unknown++}else t.byType.unknown++;const l=Date.now()-o.lastSeen;l<6e4?t.byAge.veryRecent++:l<3e5?t.byAge.recent++:l<6e5?t.byAge.moderate++:t.byAge.old++}return t}}function An(r){throw new Error('Could not dynamically require "'+r+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var xo={exports:{}};(function(r,e){(function(t){r.exports=t()})(function(){var t=Math.floor,n=Math.abs,i=Math.pow;return function(){function o(a,l,f){function p(w,T){if(!l[w]){if(!a[w]){var v=typeof An=="function"&&An;if(!T&&v)return v(w,!0);if(b)return b(w,!0);var C=new Error("Cannot find module '"+w+"'");throw C.code="MODULE_NOT_FOUND",C}var F=l[w]={exports:{}};a[w][0].call(F.exports,function(S){var N=a[w][1][S];return p(N||S)},F,F.exports,o,a,l,f)}return l[w].exports}for(var b=typeof An=="function"&&An,d=0;d<f.length;d++)p(f[d]);return p}return o}()({1:[function(o,a,l){function f(_){var R=_.length;if(0<R%4)throw new Error("Invalid string. Length must be a multiple of 4");var M=_.indexOf("=");M===-1&&(M=R);var I=M===R?0:4-M%4;return[M,I]}function p(_,R,M){return 3*(R+M)/4-M}function b(_){var R,M,I=f(_),x=I[0],K=I[1],L=new F(p(_,x,K)),B=0,O=0<K?x-4:x;for(M=0;M<O;M+=4)R=C[_.charCodeAt(M)]<<18|C[_.charCodeAt(M+1)]<<12|C[_.charCodeAt(M+2)]<<6|C[_.charCodeAt(M+3)],L[B++]=255&R>>16,L[B++]=255&R>>8,L[B++]=255&R;return K===2&&(R=C[_.charCodeAt(M)]<<2|C[_.charCodeAt(M+1)]>>4,L[B++]=255&R),K===1&&(R=C[_.charCodeAt(M)]<<10|C[_.charCodeAt(M+1)]<<4|C[_.charCodeAt(M+2)]>>2,L[B++]=255&R>>8,L[B++]=255&R),L}function d(_){return v[63&_>>18]+v[63&_>>12]+v[63&_>>6]+v[63&_]}function w(_,R,M){for(var I,x=[],K=R;K<M;K+=3)I=(16711680&_[K]<<16)+(65280&_[K+1]<<8)+(255&_[K+2]),x.push(d(I));return x.join("")}function T(_){for(var R,M=_.length,I=M%3,x=[],K=16383,L=0,B=M-I;L<B;L+=K)x.push(w(_,L,L+K>B?B:L+K));return I===1?(R=_[M-1],x.push(v[R>>2]+v[63&R<<4]+"==")):I===2&&(R=(_[M-2]<<8)+_[M-1],x.push(v[R>>10]+v[63&R>>4]+v[63&R<<2]+"=")),x.join("")}l.byteLength=function(_){var R=f(_),M=R[0],I=R[1];return 3*(M+I)/4-I},l.toByteArray=b,l.fromByteArray=T;for(var v=[],C=[],F=typeof Uint8Array>"u"?Array:Uint8Array,S="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",N=0,g=S.length;N<g;++N)v[N]=S[N],C[S.charCodeAt(N)]=N;C[45]=62,C[95]=63},{}],2:[function(){},{}],3:[function(o,a,l){(function(){(function(){var f=String.fromCharCode,p=Math.min;function b(s){if(2147483647<s)throw new RangeError('The value "'+s+'" is invalid for option "size"');var h=new Uint8Array(s);return h.__proto__=d.prototype,h}function d(s,h,y){if(typeof s=="number"){if(typeof h=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return C(s)}return w(s,h,y)}function w(s,h,y){if(typeof s=="string")return F(s,h);if(ArrayBuffer.isView(s))return S(s);if(s==null)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof s);if($(s,ArrayBuffer)||s&&$(s.buffer,ArrayBuffer))return N(s,h,y);if(typeof s=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');var D=s.valueOf&&s.valueOf();if(D!=null&&D!==s)return d.from(D,h,y);var G=g(s);if(G)return G;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof s[Symbol.toPrimitive]=="function")return d.from(s[Symbol.toPrimitive]("string"),h,y);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof s)}function T(s){if(typeof s!="number")throw new TypeError('"size" argument must be of type number');if(0>s)throw new RangeError('The value "'+s+'" is invalid for option "size"')}function v(s,h,y){return T(s),0>=s||h===void 0?b(s):typeof y=="string"?b(s).fill(h,y):b(s).fill(h)}function C(s){return T(s),b(0>s?0:0|_(s))}function F(s,h){if((typeof h!="string"||h==="")&&(h="utf8"),!d.isEncoding(h))throw new TypeError("Unknown encoding: "+h);var y=0|R(s,h),D=b(y),G=D.write(s,h);return G!==y&&(D=D.slice(0,G)),D}function S(s){for(var h=0>s.length?0:0|_(s.length),y=b(h),D=0;D<h;D+=1)y[D]=255&s[D];return y}function N(s,h,y){if(0>h||s.byteLength<h)throw new RangeError('"offset" is outside of buffer bounds');if(s.byteLength<h+(y||0))throw new RangeError('"length" is outside of buffer bounds');var D;return D=h===void 0&&y===void 0?new Uint8Array(s):y===void 0?new Uint8Array(s,h):new Uint8Array(s,h,y),D.__proto__=d.prototype,D}function g(s){if(d.isBuffer(s)){var h=0|_(s.length),y=b(h);return y.length===0||s.copy(y,0,0,h),y}return s.length===void 0?s.type==="Buffer"&&Array.isArray(s.data)?S(s.data):void 0:typeof s.length!="number"||z(s.length)?b(0):S(s)}function _(s){if(s>=2147483647)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x7fffffff bytes");return 0|s}function R(s,h){if(d.isBuffer(s))return s.length;if(ArrayBuffer.isView(s)||$(s,ArrayBuffer))return s.byteLength;if(typeof s!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof s);var y=s.length,D=2<arguments.length&&arguments[2]===!0;if(!D&&y===0)return 0;for(var G=!1;;)switch(h){case"ascii":case"latin1":case"binary":return y;case"utf8":case"utf-8":return ae(s).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*y;case"hex":return y>>>1;case"base64":return Z(s).length;default:if(G)return D?-1:ae(s).length;h=(""+h).toLowerCase(),G=!0}}function M(s,h,y){var D=!1;if((h===void 0||0>h)&&(h=0),h>this.length||((y===void 0||y>this.length)&&(y=this.length),0>=y)||(y>>>=0,h>>>=0,y<=h))return"";for(s||(s="utf8");;)switch(s){case"hex":return be(this,h,y);case"utf8":case"utf-8":return ve(this,h,y);case"ascii":return he(this,h,y);case"latin1":case"binary":return ke(this,h,y);case"base64":return pe(this,h,y);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Le(this,h,y);default:if(D)throw new TypeError("Unknown encoding: "+s);s=(s+"").toLowerCase(),D=!0}}function I(s,h,y){var D=s[h];s[h]=s[y],s[y]=D}function x(s,h,y,D,G){if(s.length===0)return-1;if(typeof y=="string"?(D=y,y=0):2147483647<y?y=2147483647:-2147483648>y&&(y=-2147483648),y=+y,z(y)&&(y=G?0:s.length-1),0>y&&(y=s.length+y),y>=s.length){if(G)return-1;y=s.length-1}else if(0>y)if(G)y=0;else return-1;if(typeof h=="string"&&(h=d.from(h,D)),d.isBuffer(h))return h.length===0?-1:K(s,h,y,D,G);if(typeof h=="number")return h&=255,typeof Uint8Array.prototype.indexOf=="function"?G?Uint8Array.prototype.indexOf.call(s,h,y):Uint8Array.prototype.lastIndexOf.call(s,h,y):K(s,[h],y,D,G);throw new TypeError("val must be string, number or Buffer")}function K(s,h,y,D,G){function Q(at,Je){return le===1?at[Je]:at.readUInt16BE(Je*le)}var le=1,ye=s.length,Te=h.length;if(D!==void 0&&(D=(D+"").toLowerCase(),D==="ucs2"||D==="ucs-2"||D==="utf16le"||D==="utf-16le")){if(2>s.length||2>h.length)return-1;le=2,ye/=2,Te/=2,y/=2}var me;if(G){var _e=-1;for(me=y;me<ye;me++)if(Q(s,me)!==Q(h,_e===-1?0:me-_e))_e!==-1&&(me-=me-_e),_e=-1;else if(_e===-1&&(_e=me),me-_e+1===Te)return _e*le}else for(y+Te>ye&&(y=ye-Te),me=y;0<=me;me--){for(var je=!0,ut=0;ut<Te;ut++)if(Q(s,me+ut)!==Q(h,ut)){je=!1;break}if(je)return me}return-1}function L(s,h,y,D){y=+y||0;var G=s.length-y;D?(D=+D,D>G&&(D=G)):D=G;var Q=h.length;D>Q/2&&(D=Q/2);for(var le,ye=0;ye<D;++ye){if(le=parseInt(h.substr(2*ye,2),16),z(le))return ye;s[y+ye]=le}return ye}function B(s,h,y,D){return oe(ae(h,s.length-y),s,y,D)}function O(s,h,y,D){return oe(A(h),s,y,D)}function ne(s,h,y,D){return O(s,h,y,D)}function ue(s,h,y,D){return oe(Z(h),s,y,D)}function fe(s,h,y,D){return oe(P(h,s.length-y),s,y,D)}function pe(s,h,y){return h===0&&y===s.length?te.fromByteArray(s):te.fromByteArray(s.slice(h,y))}function ve(s,h,y){y=p(s.length,y);for(var D=[],G=h;G<y;){var Q=s[G],le=null,ye=239<Q?4:223<Q?3:191<Q?2:1;if(G+ye<=y){var Te,me,_e,je;ye===1?128>Q&&(le=Q):ye===2?(Te=s[G+1],(192&Te)==128&&(je=(31&Q)<<6|63&Te,127<je&&(le=je))):ye===3?(Te=s[G+1],me=s[G+2],(192&Te)==128&&(192&me)==128&&(je=(15&Q)<<12|(63&Te)<<6|63&me,2047<je&&(55296>je||57343<je)&&(le=je))):ye===4&&(Te=s[G+1],me=s[G+2],_e=s[G+3],(192&Te)==128&&(192&me)==128&&(192&_e)==128&&(je=(15&Q)<<18|(63&Te)<<12|(63&me)<<6|63&_e,65535<je&&1114112>je&&(le=je)))}le===null?(le=65533,ye=1):65535<le&&(le-=65536,D.push(55296|1023&le>>>10),le=56320|1023&le),D.push(le),G+=ye}return Ie(D)}function Ie(s){var h=s.length;if(h<=4096)return f.apply(String,s);for(var y="",D=0;D<h;)y+=f.apply(String,s.slice(D,D+=4096));return y}function he(s,h,y){var D="";y=p(s.length,y);for(var G=h;G<y;++G)D+=f(127&s[G]);return D}function ke(s,h,y){var D="";y=p(s.length,y);for(var G=h;G<y;++G)D+=f(s[G]);return D}function be(s,h,y){var D=s.length;(!h||0>h)&&(h=0),(!y||0>y||y>D)&&(y=D);for(var G="",Q=h;Q<y;++Q)G+=re(s[Q]);return G}function Le(s,h,y){for(var D=s.slice(h,y),G="",Q=0;Q<D.length;Q+=2)G+=f(D[Q]+256*D[Q+1]);return G}function W(s,h,y){if(s%1!=0||0>s)throw new RangeError("offset is not uint");if(s+h>y)throw new RangeError("Trying to access beyond buffer length")}function Y(s,h,y,D,G,Q){if(!d.isBuffer(s))throw new TypeError('"buffer" argument must be a Buffer instance');if(h>G||h<Q)throw new RangeError('"value" argument is out of bounds');if(y+D>s.length)throw new RangeError("Index out of range")}function J(s,h,y,D){if(y+D>s.length)throw new RangeError("Index out of range");if(0>y)throw new RangeError("Index out of range")}function U(s,h,y,D,G){return h=+h,y>>>=0,G||J(s,h,y,4),ce.write(s,h,y,D,23,4),y+4}function H(s,h,y,D,G){return h=+h,y>>>=0,G||J(s,h,y,8),ce.write(s,h,y,D,52,8),y+8}function X(s){if(s=s.split("=")[0],s=s.trim().replace(m,""),2>s.length)return"";for(;s.length%4!=0;)s+="=";return s}function re(s){return 16>s?"0"+s.toString(16):s.toString(16)}function ae(s,h){h=h||1/0;for(var y,D=s.length,G=null,Q=[],le=0;le<D;++le){if(y=s.charCodeAt(le),55295<y&&57344>y){if(!G){if(56319<y){-1<(h-=3)&&Q.push(239,191,189);continue}else if(le+1===D){-1<(h-=3)&&Q.push(239,191,189);continue}G=y;continue}if(56320>y){-1<(h-=3)&&Q.push(239,191,189),G=y;continue}y=(G-55296<<10|y-56320)+65536}else G&&-1<(h-=3)&&Q.push(239,191,189);if(G=null,128>y){if(0>(h-=1))break;Q.push(y)}else if(2048>y){if(0>(h-=2))break;Q.push(192|y>>6,128|63&y)}else if(65536>y){if(0>(h-=3))break;Q.push(224|y>>12,128|63&y>>6,128|63&y)}else if(1114112>y){if(0>(h-=4))break;Q.push(240|y>>18,128|63&y>>12,128|63&y>>6,128|63&y)}else throw new Error("Invalid code point")}return Q}function A(s){for(var h=[],y=0;y<s.length;++y)h.push(255&s.charCodeAt(y));return h}function P(s,h){for(var y,D,G,Q=[],le=0;le<s.length&&!(0>(h-=2));++le)y=s.charCodeAt(le),D=y>>8,G=y%256,Q.push(G),Q.push(D);return Q}function Z(s){return te.toByteArray(X(s))}function oe(s,h,y,D){for(var G=0;G<D&&!(G+y>=h.length||G>=s.length);++G)h[G+y]=s[G];return G}function $(s,h){return s instanceof h||s!=null&&s.constructor!=null&&s.constructor.name!=null&&s.constructor.name===h.name}function z(s){return s!==s}var te=o("base64-js"),ce=o("ieee754");l.Buffer=d,l.SlowBuffer=function(s){return+s!=s&&(s=0),d.alloc(+s)},l.INSPECT_MAX_BYTES=50,l.kMaxLength=2147483647,d.TYPED_ARRAY_SUPPORT=function(){try{var s=new Uint8Array(1);return s.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},s.foo()===42}catch{return!1}}(),d.TYPED_ARRAY_SUPPORT||typeof console>"u"||typeof console.error!="function"||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(d.prototype,"parent",{enumerable:!0,get:function(){return d.isBuffer(this)?this.buffer:void 0}}),Object.defineProperty(d.prototype,"offset",{enumerable:!0,get:function(){return d.isBuffer(this)?this.byteOffset:void 0}}),typeof Symbol<"u"&&Symbol.species!=null&&d[Symbol.species]===d&&Object.defineProperty(d,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),d.poolSize=8192,d.from=function(s,h,y){return w(s,h,y)},d.prototype.__proto__=Uint8Array.prototype,d.__proto__=Uint8Array,d.alloc=function(s,h,y){return v(s,h,y)},d.allocUnsafe=function(s){return C(s)},d.allocUnsafeSlow=function(s){return C(s)},d.isBuffer=function(s){return s!=null&&s._isBuffer===!0&&s!==d.prototype},d.compare=function(s,h){if($(s,Uint8Array)&&(s=d.from(s,s.offset,s.byteLength)),$(h,Uint8Array)&&(h=d.from(h,h.offset,h.byteLength)),!d.isBuffer(s)||!d.isBuffer(h))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(s===h)return 0;for(var y=s.length,D=h.length,G=0,Q=p(y,D);G<Q;++G)if(s[G]!==h[G]){y=s[G],D=h[G];break}return y<D?-1:D<y?1:0},d.isEncoding=function(s){switch((s+"").toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},d.concat=function(s,h){if(!Array.isArray(s))throw new TypeError('"list" argument must be an Array of Buffers');if(s.length===0)return d.alloc(0);var y;if(h===void 0)for(h=0,y=0;y<s.length;++y)h+=s[y].length;var D=d.allocUnsafe(h),G=0;for(y=0;y<s.length;++y){var Q=s[y];if($(Q,Uint8Array)&&(Q=d.from(Q)),!d.isBuffer(Q))throw new TypeError('"list" argument must be an Array of Buffers');Q.copy(D,G),G+=Q.length}return D},d.byteLength=R,d.prototype._isBuffer=!0,d.prototype.swap16=function(){var s=this.length;if(s%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var h=0;h<s;h+=2)I(this,h,h+1);return this},d.prototype.swap32=function(){var s=this.length;if(s%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var h=0;h<s;h+=4)I(this,h,h+3),I(this,h+1,h+2);return this},d.prototype.swap64=function(){var s=this.length;if(s%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var h=0;h<s;h+=8)I(this,h,h+7),I(this,h+1,h+6),I(this,h+2,h+5),I(this,h+3,h+4);return this},d.prototype.toString=function(){var s=this.length;return s===0?"":arguments.length===0?ve(this,0,s):M.apply(this,arguments)},d.prototype.toLocaleString=d.prototype.toString,d.prototype.equals=function(s){if(!d.isBuffer(s))throw new TypeError("Argument must be a Buffer");return this===s||d.compare(this,s)===0},d.prototype.inspect=function(){var s="",h=l.INSPECT_MAX_BYTES;return s=this.toString("hex",0,h).replace(/(.{2})/g,"$1 ").trim(),this.length>h&&(s+=" ... "),"<Buffer "+s+">"},d.prototype.compare=function(s,h,y,D,G){if($(s,Uint8Array)&&(s=d.from(s,s.offset,s.byteLength)),!d.isBuffer(s))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof s);if(h===void 0&&(h=0),y===void 0&&(y=s?s.length:0),D===void 0&&(D=0),G===void 0&&(G=this.length),0>h||y>s.length||0>D||G>this.length)throw new RangeError("out of range index");if(D>=G&&h>=y)return 0;if(D>=G)return-1;if(h>=y)return 1;if(h>>>=0,y>>>=0,D>>>=0,G>>>=0,this===s)return 0;for(var Q=G-D,le=y-h,ye=p(Q,le),Te=this.slice(D,G),me=s.slice(h,y),_e=0;_e<ye;++_e)if(Te[_e]!==me[_e]){Q=Te[_e],le=me[_e];break}return Q<le?-1:le<Q?1:0},d.prototype.includes=function(s,h,y){return this.indexOf(s,h,y)!==-1},d.prototype.indexOf=function(s,h,y){return x(this,s,h,y,!0)},d.prototype.lastIndexOf=function(s,h,y){return x(this,s,h,y,!1)},d.prototype.write=function(s,h,y,D){if(h===void 0)D="utf8",y=this.length,h=0;else if(y===void 0&&typeof h=="string")D=h,y=this.length,h=0;else if(isFinite(h))h>>>=0,isFinite(y)?(y>>>=0,D===void 0&&(D="utf8")):(D=y,y=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var G=this.length-h;if((y===void 0||y>G)&&(y=G),0<s.length&&(0>y||0>h)||h>this.length)throw new RangeError("Attempt to write outside buffer bounds");D||(D="utf8");for(var Q=!1;;)switch(D){case"hex":return L(this,s,h,y);case"utf8":case"utf-8":return B(this,s,h,y);case"ascii":return O(this,s,h,y);case"latin1":case"binary":return ne(this,s,h,y);case"base64":return ue(this,s,h,y);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return fe(this,s,h,y);default:if(Q)throw new TypeError("Unknown encoding: "+D);D=(""+D).toLowerCase(),Q=!0}},d.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},d.prototype.slice=function(s,h){var y=this.length;s=~~s,h=h===void 0?y:~~h,0>s?(s+=y,0>s&&(s=0)):s>y&&(s=y),0>h?(h+=y,0>h&&(h=0)):h>y&&(h=y),h<s&&(h=s);var D=this.subarray(s,h);return D.__proto__=d.prototype,D},d.prototype.readUIntLE=function(s,h,y){s>>>=0,h>>>=0,y||W(s,h,this.length);for(var D=this[s],G=1,Q=0;++Q<h&&(G*=256);)D+=this[s+Q]*G;return D},d.prototype.readUIntBE=function(s,h,y){s>>>=0,h>>>=0,y||W(s,h,this.length);for(var D=this[s+--h],G=1;0<h&&(G*=256);)D+=this[s+--h]*G;return D},d.prototype.readUInt8=function(s,h){return s>>>=0,h||W(s,1,this.length),this[s]},d.prototype.readUInt16LE=function(s,h){return s>>>=0,h||W(s,2,this.length),this[s]|this[s+1]<<8},d.prototype.readUInt16BE=function(s,h){return s>>>=0,h||W(s,2,this.length),this[s]<<8|this[s+1]},d.prototype.readUInt32LE=function(s,h){return s>>>=0,h||W(s,4,this.length),(this[s]|this[s+1]<<8|this[s+2]<<16)+16777216*this[s+3]},d.prototype.readUInt32BE=function(s,h){return s>>>=0,h||W(s,4,this.length),16777216*this[s]+(this[s+1]<<16|this[s+2]<<8|this[s+3])},d.prototype.readIntLE=function(s,h,y){s>>>=0,h>>>=0,y||W(s,h,this.length);for(var D=this[s],G=1,Q=0;++Q<h&&(G*=256);)D+=this[s+Q]*G;return G*=128,D>=G&&(D-=i(2,8*h)),D},d.prototype.readIntBE=function(s,h,y){s>>>=0,h>>>=0,y||W(s,h,this.length);for(var D=h,G=1,Q=this[s+--D];0<D&&(G*=256);)Q+=this[s+--D]*G;return G*=128,Q>=G&&(Q-=i(2,8*h)),Q},d.prototype.readInt8=function(s,h){return s>>>=0,h||W(s,1,this.length),128&this[s]?-1*(255-this[s]+1):this[s]},d.prototype.readInt16LE=function(s,h){s>>>=0,h||W(s,2,this.length);var y=this[s]|this[s+1]<<8;return 32768&y?4294901760|y:y},d.prototype.readInt16BE=function(s,h){s>>>=0,h||W(s,2,this.length);var y=this[s+1]|this[s]<<8;return 32768&y?4294901760|y:y},d.prototype.readInt32LE=function(s,h){return s>>>=0,h||W(s,4,this.length),this[s]|this[s+1]<<8|this[s+2]<<16|this[s+3]<<24},d.prototype.readInt32BE=function(s,h){return s>>>=0,h||W(s,4,this.length),this[s]<<24|this[s+1]<<16|this[s+2]<<8|this[s+3]},d.prototype.readFloatLE=function(s,h){return s>>>=0,h||W(s,4,this.length),ce.read(this,s,!0,23,4)},d.prototype.readFloatBE=function(s,h){return s>>>=0,h||W(s,4,this.length),ce.read(this,s,!1,23,4)},d.prototype.readDoubleLE=function(s,h){return s>>>=0,h||W(s,8,this.length),ce.read(this,s,!0,52,8)},d.prototype.readDoubleBE=function(s,h){return s>>>=0,h||W(s,8,this.length),ce.read(this,s,!1,52,8)},d.prototype.writeUIntLE=function(s,h,y,D){if(s=+s,h>>>=0,y>>>=0,!D){var G=i(2,8*y)-1;Y(this,s,h,y,G,0)}var Q=1,le=0;for(this[h]=255&s;++le<y&&(Q*=256);)this[h+le]=255&s/Q;return h+y},d.prototype.writeUIntBE=function(s,h,y,D){if(s=+s,h>>>=0,y>>>=0,!D){var G=i(2,8*y)-1;Y(this,s,h,y,G,0)}var Q=y-1,le=1;for(this[h+Q]=255&s;0<=--Q&&(le*=256);)this[h+Q]=255&s/le;return h+y},d.prototype.writeUInt8=function(s,h,y){return s=+s,h>>>=0,y||Y(this,s,h,1,255,0),this[h]=255&s,h+1},d.prototype.writeUInt16LE=function(s,h,y){return s=+s,h>>>=0,y||Y(this,s,h,2,65535,0),this[h]=255&s,this[h+1]=s>>>8,h+2},d.prototype.writeUInt16BE=function(s,h,y){return s=+s,h>>>=0,y||Y(this,s,h,2,65535,0),this[h]=s>>>8,this[h+1]=255&s,h+2},d.prototype.writeUInt32LE=function(s,h,y){return s=+s,h>>>=0,y||Y(this,s,h,4,4294967295,0),this[h+3]=s>>>24,this[h+2]=s>>>16,this[h+1]=s>>>8,this[h]=255&s,h+4},d.prototype.writeUInt32BE=function(s,h,y){return s=+s,h>>>=0,y||Y(this,s,h,4,4294967295,0),this[h]=s>>>24,this[h+1]=s>>>16,this[h+2]=s>>>8,this[h+3]=255&s,h+4},d.prototype.writeIntLE=function(s,h,y,D){if(s=+s,h>>>=0,!D){var G=i(2,8*y-1);Y(this,s,h,y,G-1,-G)}var Q=0,le=1,ye=0;for(this[h]=255&s;++Q<y&&(le*=256);)0>s&&ye===0&&this[h+Q-1]!==0&&(ye=1),this[h+Q]=255&(s/le>>0)-ye;return h+y},d.prototype.writeIntBE=function(s,h,y,D){if(s=+s,h>>>=0,!D){var G=i(2,8*y-1);Y(this,s,h,y,G-1,-G)}var Q=y-1,le=1,ye=0;for(this[h+Q]=255&s;0<=--Q&&(le*=256);)0>s&&ye===0&&this[h+Q+1]!==0&&(ye=1),this[h+Q]=255&(s/le>>0)-ye;return h+y},d.prototype.writeInt8=function(s,h,y){return s=+s,h>>>=0,y||Y(this,s,h,1,127,-128),0>s&&(s=255+s+1),this[h]=255&s,h+1},d.prototype.writeInt16LE=function(s,h,y){return s=+s,h>>>=0,y||Y(this,s,h,2,32767,-32768),this[h]=255&s,this[h+1]=s>>>8,h+2},d.prototype.writeInt16BE=function(s,h,y){return s=+s,h>>>=0,y||Y(this,s,h,2,32767,-32768),this[h]=s>>>8,this[h+1]=255&s,h+2},d.prototype.writeInt32LE=function(s,h,y){return s=+s,h>>>=0,y||Y(this,s,h,4,2147483647,-2147483648),this[h]=255&s,this[h+1]=s>>>8,this[h+2]=s>>>16,this[h+3]=s>>>24,h+4},d.prototype.writeInt32BE=function(s,h,y){return s=+s,h>>>=0,y||Y(this,s,h,4,2147483647,-2147483648),0>s&&(s=4294967295+s+1),this[h]=s>>>24,this[h+1]=s>>>16,this[h+2]=s>>>8,this[h+3]=255&s,h+4},d.prototype.writeFloatLE=function(s,h,y){return U(this,s,h,!0,y)},d.prototype.writeFloatBE=function(s,h,y){return U(this,s,h,!1,y)},d.prototype.writeDoubleLE=function(s,h,y){return H(this,s,h,!0,y)},d.prototype.writeDoubleBE=function(s,h,y){return H(this,s,h,!1,y)},d.prototype.copy=function(s,h,y,D){if(!d.isBuffer(s))throw new TypeError("argument should be a Buffer");if(y||(y=0),D||D===0||(D=this.length),h>=s.length&&(h=s.length),h||(h=0),0<D&&D<y&&(D=y),D===y||s.length===0||this.length===0)return 0;if(0>h)throw new RangeError("targetStart out of bounds");if(0>y||y>=this.length)throw new RangeError("Index out of range");if(0>D)throw new RangeError("sourceEnd out of bounds");D>this.length&&(D=this.length),s.length-h<D-y&&(D=s.length-h+y);var G=D-y;if(this===s&&typeof Uint8Array.prototype.copyWithin=="function")this.copyWithin(h,y,D);else if(this===s&&y<h&&h<D)for(var Q=G-1;0<=Q;--Q)s[Q+h]=this[Q+y];else Uint8Array.prototype.set.call(s,this.subarray(y,D),h);return G},d.prototype.fill=function(s,h,y,D){if(typeof s=="string"){if(typeof h=="string"?(D=h,h=0,y=this.length):typeof y=="string"&&(D=y,y=this.length),D!==void 0&&typeof D!="string")throw new TypeError("encoding must be a string");if(typeof D=="string"&&!d.isEncoding(D))throw new TypeError("Unknown encoding: "+D);if(s.length===1){var G=s.charCodeAt(0);(D==="utf8"&&128>G||D==="latin1")&&(s=G)}}else typeof s=="number"&&(s&=255);if(0>h||this.length<h||this.length<y)throw new RangeError("Out of range index");if(y<=h)return this;h>>>=0,y=y===void 0?this.length:y>>>0,s||(s=0);var Q;if(typeof s=="number")for(Q=h;Q<y;++Q)this[Q]=s;else{var le=d.isBuffer(s)?s:d.from(s,D),ye=le.length;if(ye===0)throw new TypeError('The value "'+s+'" is invalid for argument "value"');for(Q=0;Q<y-h;++Q)this[Q+h]=le[Q%ye]}return this};var m=/[^+/0-9A-Za-z-_]/g}).call(this)}).call(this,o("buffer").Buffer)},{"base64-js":1,buffer:3,ieee754:9}],4:[function(o,a,l){(function(f){(function(){function p(){let d;try{d=l.storage.getItem("debug")}catch{}return!d&&typeof f<"u"&&"env"in f&&(d=f.env.DEBUG),d}l.formatArgs=function(d){if(d[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+d[0]+(this.useColors?"%c ":" ")+"+"+a.exports.humanize(this.diff),!this.useColors)return;const w="color: "+this.color;d.splice(1,0,w,"color: inherit");let T=0,v=0;d[0].replace(/%[a-zA-Z%]/g,C=>{C==="%%"||(T++,C==="%c"&&(v=T))}),d.splice(v,0,w)},l.save=function(d){try{d?l.storage.setItem("debug",d):l.storage.removeItem("debug")}catch{}},l.load=p,l.useColors=function(){return!!(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))||!(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&(typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},l.storage=function(){try{return localStorage}catch{}}(),l.destroy=(()=>{let d=!1;return()=>{d||(d=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),l.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],l.log=console.debug||console.log||(()=>{}),a.exports=o("./common")(l);const{formatters:b}=a.exports;b.j=function(d){try{return JSON.stringify(d)}catch(w){return"[UnexpectedJSONParseError]: "+w.message}}}).call(this)}).call(this,o("_process"))},{"./common":5,_process:12}],5:[function(o,a){a.exports=function(l){function f(d){function w(...C){if(!w.enabled)return;const F=w,S=+new Date,N=S-(T||S);F.diff=N,F.prev=T,F.curr=S,T=S,C[0]=f.coerce(C[0]),typeof C[0]!="string"&&C.unshift("%O");let g=0;C[0]=C[0].replace(/%([a-zA-Z%])/g,(R,M)=>{if(R==="%%")return"%";g++;const I=f.formatters[M];if(typeof I=="function"){const x=C[g];R=I.call(F,x),C.splice(g,1),g--}return R}),f.formatArgs.call(F,C),(F.log||f.log).apply(F,C)}let T,v=null;return w.namespace=d,w.useColors=f.useColors(),w.color=f.selectColor(d),w.extend=p,w.destroy=f.destroy,Object.defineProperty(w,"enabled",{enumerable:!0,configurable:!1,get:()=>v===null?f.enabled(d):v,set:C=>{v=C}}),typeof f.init=="function"&&f.init(w),w}function p(d,w){const T=f(this.namespace+(typeof w>"u"?":":w)+d);return T.log=this.log,T}function b(d){return d.toString().substring(2,d.toString().length-2).replace(/\.\*\?$/,"*")}return f.debug=f,f.default=f,f.coerce=function(d){return d instanceof Error?d.stack||d.message:d},f.disable=function(){const d=[...f.names.map(b),...f.skips.map(b).map(w=>"-"+w)].join(",");return f.enable(""),d},f.enable=function(d){f.save(d),f.names=[],f.skips=[];let w;const T=(typeof d=="string"?d:"").split(/[\s,]+/),v=T.length;for(w=0;w<v;w++)T[w]&&(d=T[w].replace(/\*/g,".*?"),d[0]==="-"?f.skips.push(new RegExp("^"+d.substr(1)+"$")):f.names.push(new RegExp("^"+d+"$")))},f.enabled=function(d){if(d[d.length-1]==="*")return!0;let w,T;for(w=0,T=f.skips.length;w<T;w++)if(f.skips[w].test(d))return!1;for(w=0,T=f.names.length;w<T;w++)if(f.names[w].test(d))return!0;return!1},f.humanize=o("ms"),f.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(l).forEach(d=>{f[d]=l[d]}),f.names=[],f.skips=[],f.formatters={},f.selectColor=function(d){let w=0;for(let T=0;T<d.length;T++)w=(w<<5)-w+d.charCodeAt(T),w|=0;return f.colors[n(w)%f.colors.length]},f.enable(f.load()),f}},{ms:11}],6:[function(o,a){function l(f,p){for(const b in p)Object.defineProperty(f,b,{value:p[b],enumerable:!0,configurable:!0});return f}a.exports=function(f,p,b){if(!f||typeof f=="string")throw new TypeError("Please pass an Error to err-code");b||(b={}),typeof p=="object"&&(b=p,p=""),p&&(b.code=p);try{return l(f,b)}catch{b.message=f.message,b.stack=f.stack;const w=function(){};return w.prototype=Object.create(Object.getPrototypeOf(f)),l(new w,b)}}},{}],7:[function(o,a){function l(L){console&&console.warn&&console.warn(L)}function f(){f.init.call(this)}function p(L){if(typeof L!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof L)}function b(L){return L._maxListeners===void 0?f.defaultMaxListeners:L._maxListeners}function d(L,B,O,ne){var ue,fe,pe;if(p(O),fe=L._events,fe===void 0?(fe=L._events=Object.create(null),L._eventsCount=0):(fe.newListener!==void 0&&(L.emit("newListener",B,O.listener?O.listener:O),fe=L._events),pe=fe[B]),pe===void 0)pe=fe[B]=O,++L._eventsCount;else if(typeof pe=="function"?pe=fe[B]=ne?[O,pe]:[pe,O]:ne?pe.unshift(O):pe.push(O),ue=b(L),0<ue&&pe.length>ue&&!pe.warned){pe.warned=!0;var ve=new Error("Possible EventEmitter memory leak detected. "+pe.length+" "+(B+" listeners added. Use emitter.setMaxListeners() to increase limit"));ve.name="MaxListenersExceededWarning",ve.emitter=L,ve.type=B,ve.count=pe.length,l(ve)}return L}function w(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function T(L,B,O){var ne={fired:!1,wrapFn:void 0,target:L,type:B,listener:O},ue=w.bind(ne);return ue.listener=O,ne.wrapFn=ue,ue}function v(L,B,O){var ne=L._events;if(ne===void 0)return[];var ue=ne[B];return ue===void 0?[]:typeof ue=="function"?O?[ue.listener||ue]:[ue]:O?N(ue):F(ue,ue.length)}function C(L){var B=this._events;if(B!==void 0){var O=B[L];if(typeof O=="function")return 1;if(O!==void 0)return O.length}return 0}function F(L,B){for(var O=Array(B),ne=0;ne<B;++ne)O[ne]=L[ne];return O}function S(L,B){for(;B+1<L.length;B++)L[B]=L[B+1];L.pop()}function N(L){for(var B=Array(L.length),O=0;O<B.length;++O)B[O]=L[O].listener||L[O];return B}function g(L,B,O){typeof L.on=="function"&&_(L,"error",B,O)}function _(L,B,O,ne){if(typeof L.on=="function")ne.once?L.once(B,O):L.on(B,O);else if(typeof L.addEventListener=="function")L.addEventListener(B,function ue(fe){ne.once&&L.removeEventListener(B,ue),O(fe)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof L)}var R,M=typeof Reflect=="object"?Reflect:null,I=M&&typeof M.apply=="function"?M.apply:function(L,B,O){return Function.prototype.apply.call(L,B,O)};R=M&&typeof M.ownKeys=="function"?M.ownKeys:Object.getOwnPropertySymbols?function(L){return Object.getOwnPropertyNames(L).concat(Object.getOwnPropertySymbols(L))}:function(L){return Object.getOwnPropertyNames(L)};var x=Number.isNaN||function(L){return L!==L};a.exports=f,a.exports.once=function(L,B){return new Promise(function(O,ne){function ue(pe){L.removeListener(B,fe),ne(pe)}function fe(){typeof L.removeListener=="function"&&L.removeListener("error",ue),O([].slice.call(arguments))}_(L,B,fe,{once:!0}),B!=="error"&&g(L,ue,{once:!0})})},f.EventEmitter=f,f.prototype._events=void 0,f.prototype._eventsCount=0,f.prototype._maxListeners=void 0;var K=10;Object.defineProperty(f,"defaultMaxListeners",{enumerable:!0,get:function(){return K},set:function(L){if(typeof L!="number"||0>L||x(L))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+L+".");K=L}}),f.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},f.prototype.setMaxListeners=function(L){if(typeof L!="number"||0>L||x(L))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+L+".");return this._maxListeners=L,this},f.prototype.getMaxListeners=function(){return b(this)},f.prototype.emit=function(L){for(var B=[],O=1;O<arguments.length;O++)B.push(arguments[O]);var ne=L==="error",ue=this._events;if(ue!==void 0)ne=ne&&ue.error===void 0;else if(!ne)return!1;if(ne){var fe;if(0<B.length&&(fe=B[0]),fe instanceof Error)throw fe;var pe=new Error("Unhandled error."+(fe?" ("+fe.message+")":""));throw pe.context=fe,pe}var ve=ue[L];if(ve===void 0)return!1;if(typeof ve=="function")I(ve,this,B);else for(var Ie=ve.length,he=F(ve,Ie),O=0;O<Ie;++O)I(he[O],this,B);return!0},f.prototype.addListener=function(L,B){return d(this,L,B,!1)},f.prototype.on=f.prototype.addListener,f.prototype.prependListener=function(L,B){return d(this,L,B,!0)},f.prototype.once=function(L,B){return p(B),this.on(L,T(this,L,B)),this},f.prototype.prependOnceListener=function(L,B){return p(B),this.prependListener(L,T(this,L,B)),this},f.prototype.removeListener=function(L,B){var O,ne,ue,fe,pe;if(p(B),ne=this._events,ne===void 0)return this;if(O=ne[L],O===void 0)return this;if(O===B||O.listener===B)--this._eventsCount==0?this._events=Object.create(null):(delete ne[L],ne.removeListener&&this.emit("removeListener",L,O.listener||B));else if(typeof O!="function"){for(ue=-1,fe=O.length-1;0<=fe;fe--)if(O[fe]===B||O[fe].listener===B){pe=O[fe].listener,ue=fe;break}if(0>ue)return this;ue===0?O.shift():S(O,ue),O.length===1&&(ne[L]=O[0]),ne.removeListener!==void 0&&this.emit("removeListener",L,pe||B)}return this},f.prototype.off=f.prototype.removeListener,f.prototype.removeAllListeners=function(L){var B,O,ne;if(O=this._events,O===void 0)return this;if(O.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):O[L]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete O[L]),this;if(arguments.length===0){var ue,fe=Object.keys(O);for(ne=0;ne<fe.length;++ne)ue=fe[ne],ue!=="removeListener"&&this.removeAllListeners(ue);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(B=O[L],typeof B=="function")this.removeListener(L,B);else if(B!==void 0)for(ne=B.length-1;0<=ne;ne--)this.removeListener(L,B[ne]);return this},f.prototype.listeners=function(L){return v(this,L,!0)},f.prototype.rawListeners=function(L){return v(this,L,!1)},f.listenerCount=function(L,B){return typeof L.listenerCount=="function"?L.listenerCount(B):C.call(L,B)},f.prototype.listenerCount=C,f.prototype.eventNames=function(){return 0<this._eventsCount?R(this._events):[]}},{}],8:[function(o,a){a.exports=function(){if(typeof globalThis>"u")return null;var l={RTCPeerConnection:globalThis.RTCPeerConnection||globalThis.mozRTCPeerConnection||globalThis.webkitRTCPeerConnection,RTCSessionDescription:globalThis.RTCSessionDescription||globalThis.mozRTCSessionDescription||globalThis.webkitRTCSessionDescription,RTCIceCandidate:globalThis.RTCIceCandidate||globalThis.mozRTCIceCandidate||globalThis.webkitRTCIceCandidate};return l.RTCPeerConnection?l:null}},{}],9:[function(o,a,l){/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */l.read=function(f,p,b,d,w){var T,v,C=8*w-d-1,F=(1<<C)-1,S=F>>1,N=-7,g=b?w-1:0,_=b?-1:1,R=f[p+g];for(g+=_,T=R&(1<<-N)-1,R>>=-N,N+=C;0<N;T=256*T+f[p+g],g+=_,N-=8);for(v=T&(1<<-N)-1,T>>=-N,N+=d;0<N;v=256*v+f[p+g],g+=_,N-=8);if(T===0)T=1-S;else{if(T===F)return v?NaN:(R?-1:1)*(1/0);v+=i(2,d),T-=S}return(R?-1:1)*v*i(2,T-d)},l.write=function(f,p,b,d,w,T){var v,C,F,S=Math.LN2,N=Math.log,g=8*T-w-1,_=(1<<g)-1,R=_>>1,M=w===23?i(2,-24)-i(2,-77):0,I=d?0:T-1,x=d?1:-1,K=0>p||p===0&&0>1/p?1:0;for(p=n(p),isNaN(p)||p===1/0?(C=isNaN(p)?1:0,v=_):(v=t(N(p)/S),1>p*(F=i(2,-v))&&(v--,F*=2),p+=1<=v+R?M/F:M*i(2,1-R),2<=p*F&&(v++,F/=2),v+R>=_?(C=0,v=_):1<=v+R?(C=(p*F-1)*i(2,w),v+=R):(C=p*i(2,R-1)*i(2,w),v=0));8<=w;f[b+I]=255&C,I+=x,C/=256,w-=8);for(v=v<<w|C,g+=w;0<g;f[b+I]=255&v,I+=x,v/=256,g-=8);f[b+I-x]|=128*K}},{}],10:[function(o,a){a.exports=typeof Object.create=="function"?function(l,f){f&&(l.super_=f,l.prototype=Object.create(f.prototype,{constructor:{value:l,enumerable:!1,writable:!0,configurable:!0}}))}:function(l,f){if(f){l.super_=f;var p=function(){};p.prototype=f.prototype,l.prototype=new p,l.prototype.constructor=l}}},{}],11:[function(o,a){var l=Math.round;function f(w){if(w+="",!(100<w.length)){var T=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(w);if(T){var v=parseFloat(T[1]),C=(T[2]||"ms").toLowerCase();return C==="years"||C==="year"||C==="yrs"||C==="yr"||C==="y"?315576e5*v:C==="weeks"||C==="week"||C==="w"?6048e5*v:C==="days"||C==="day"||C==="d"?864e5*v:C==="hours"||C==="hour"||C==="hrs"||C==="hr"||C==="h"?36e5*v:C==="minutes"||C==="minute"||C==="mins"||C==="min"||C==="m"?6e4*v:C==="seconds"||C==="second"||C==="secs"||C==="sec"||C==="s"?1e3*v:C==="milliseconds"||C==="millisecond"||C==="msecs"||C==="msec"||C==="ms"?v:void 0}}}function p(w){var T=n(w);return 864e5<=T?l(w/864e5)+"d":36e5<=T?l(w/36e5)+"h":6e4<=T?l(w/6e4)+"m":1e3<=T?l(w/1e3)+"s":w+"ms"}function b(w){var T=n(w);return 864e5<=T?d(w,T,864e5,"day"):36e5<=T?d(w,T,36e5,"hour"):6e4<=T?d(w,T,6e4,"minute"):1e3<=T?d(w,T,1e3,"second"):w+" ms"}function d(w,T,v,C){return l(w/v)+" "+C+(T>=1.5*v?"s":"")}a.exports=function(w,T){T=T||{};var v=typeof w;if(v=="string"&&0<w.length)return f(w);if(v==="number"&&isFinite(w))return T.long?b(w):p(w);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(w))}},{}],12:[function(o,a){function l(){throw new Error("setTimeout has not been defined")}function f(){throw new Error("clearTimeout has not been defined")}function p(M){if(C===setTimeout)return setTimeout(M,0);if((C===l||!C)&&setTimeout)return C=setTimeout,setTimeout(M,0);try{return C(M,0)}catch{try{return C.call(null,M,0)}catch{return C.call(this,M,0)}}}function b(M){if(F===clearTimeout)return clearTimeout(M);if((F===f||!F)&&clearTimeout)return F=clearTimeout,clearTimeout(M);try{return F(M)}catch{try{return F.call(null,M)}catch{return F.call(this,M)}}}function d(){_&&N&&(_=!1,N.length?g=N.concat(g):R=-1,g.length&&w())}function w(){if(!_){var M=p(d);_=!0;for(var I=g.length;I;){for(N=g,g=[];++R<I;)N&&N[R].run();R=-1,I=g.length}N=null,_=!1,b(M)}}function T(M,I){this.fun=M,this.array=I}function v(){}var C,F,S=a.exports={};(function(){try{C=typeof setTimeout=="function"?setTimeout:l}catch{C=l}try{F=typeof clearTimeout=="function"?clearTimeout:f}catch{F=f}})();var N,g=[],_=!1,R=-1;S.nextTick=function(M){var I=Array(arguments.length-1);if(1<arguments.length)for(var x=1;x<arguments.length;x++)I[x-1]=arguments[x];g.push(new T(M,I)),g.length!==1||_||p(w)},T.prototype.run=function(){this.fun.apply(null,this.array)},S.title="browser",S.browser=!0,S.env={},S.argv=[],S.version="",S.versions={},S.on=v,S.addListener=v,S.once=v,S.off=v,S.removeListener=v,S.removeAllListeners=v,S.emit=v,S.prependListener=v,S.prependOnceListener=v,S.listeners=function(){return[]},S.binding=function(){throw new Error("process.binding is not supported")},S.cwd=function(){return"/"},S.chdir=function(){throw new Error("process.chdir is not supported")},S.umask=function(){return 0}},{}],13:[function(o,a){(function(l){(function(){/*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */let f;a.exports=typeof queueMicrotask=="function"?queueMicrotask.bind(typeof window>"u"?l:window):p=>(f||(f=Promise.resolve())).then(p).catch(b=>setTimeout(()=>{throw b},0))}).call(this)}).call(this,typeof Ke>"u"?typeof self>"u"?typeof window>"u"?{}:window:self:Ke)},{}],14:[function(o,a){(function(l,f){(function(){var p=o("safe-buffer").Buffer,b=f.crypto||f.msCrypto;a.exports=b&&b.getRandomValues?function(d,w){if(d>4294967295)throw new RangeError("requested too many random bytes");var T=p.allocUnsafe(d);if(0<d)if(65536<d)for(var v=0;v<d;v+=65536)b.getRandomValues(T.slice(v,v+65536));else b.getRandomValues(T);return typeof w=="function"?l.nextTick(function(){w(null,T)}):T}:function(){throw new Error(`Secure random number generation is not supported by this browser.
Use Chrome, Firefox or Internet Explorer 11`)}}).call(this)}).call(this,o("_process"),typeof Ke>"u"?typeof self>"u"?typeof window>"u"?{}:window:self:Ke)},{_process:12,"safe-buffer":30}],15:[function(o,a){function l(v,C){v.prototype=Object.create(C.prototype),v.prototype.constructor=v,v.__proto__=C}function f(v,C,F){function S(g,_,R){return typeof C=="string"?C:C(g,_,R)}F||(F=Error);var N=function(g){function _(R,M,I){return g.call(this,S(R,M,I))||this}return l(_,g),_}(F);N.prototype.name=F.name,N.prototype.code=v,T[v]=N}function p(v,C){if(Array.isArray(v)){var F=v.length;return v=v.map(function(S){return S+""}),2<F?"one of ".concat(C," ").concat(v.slice(0,F-1).join(", "),", or ")+v[F-1]:F===2?"one of ".concat(C," ").concat(v[0]," or ").concat(v[1]):"of ".concat(C," ").concat(v[0])}return"of ".concat(C," ").concat(v+"")}function b(v,C,F){return v.substr(0,C.length)===C}function d(v,C,F){return(F===void 0||F>v.length)&&(F=v.length),v.substring(F-C.length,F)===C}function w(v,C,F){return typeof F!="number"&&(F=0),!(F+C.length>v.length)&&v.indexOf(C,F)!==-1}var T={};f("ERR_INVALID_OPT_VALUE",function(v,C){return'The value "'+C+'" is invalid for option "'+v+'"'},TypeError),f("ERR_INVALID_ARG_TYPE",function(v,C,F){var S;typeof C=="string"&&b(C,"not ")?(S="must not be",C=C.replace(/^not /,"")):S="must be";var N;if(d(v," argument"))N="The ".concat(v," ").concat(S," ").concat(p(C,"type"));else{var g=w(v,".")?"property":"argument";N='The "'.concat(v,'" ').concat(g," ").concat(S," ").concat(p(C,"type"))}return N+=". Received type ".concat(typeof F),N},TypeError),f("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),f("ERR_METHOD_NOT_IMPLEMENTED",function(v){return"The "+v+" method is not implemented"}),f("ERR_STREAM_PREMATURE_CLOSE","Premature close"),f("ERR_STREAM_DESTROYED",function(v){return"Cannot call "+v+" after a stream was destroyed"}),f("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),f("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),f("ERR_STREAM_WRITE_AFTER_END","write after end"),f("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),f("ERR_UNKNOWN_ENCODING",function(v){return"Unknown encoding: "+v},TypeError),f("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),a.exports.codes=T},{}],16:[function(o,a){(function(l){(function(){function f(S){return this instanceof f?(w.call(this,S),T.call(this,S),this.allowHalfOpen=!0,void(S&&(S.readable===!1&&(this.readable=!1),S.writable===!1&&(this.writable=!1),S.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",p))))):new f(S)}function p(){this._writableState.ended||l.nextTick(b,this)}function b(S){S.end()}var d=Object.keys||function(S){var N=[];for(var g in S)N.push(g);return N};a.exports=f;var w=o("./_stream_readable"),T=o("./_stream_writable");o("inherits")(f,w);for(var v,C=d(T.prototype),F=0;F<C.length;F++)v=C[F],f.prototype[v]||(f.prototype[v]=T.prototype[v]);Object.defineProperty(f.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(f.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(f.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(f.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState!==void 0&&this._writableState!==void 0&&this._readableState.destroyed&&this._writableState.destroyed},set:function(S){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=S,this._writableState.destroyed=S)}})}).call(this)}).call(this,o("_process"))},{"./_stream_readable":18,"./_stream_writable":20,_process:12,inherits:10}],17:[function(o,a){function l(p){return this instanceof l?void f.call(this,p):new l(p)}a.exports=l;var f=o("./_stream_transform");o("inherits")(l,f),l.prototype._transform=function(p,b,d){d(null,p)}},{"./_stream_transform":19,inherits:10}],18:[function(o,a){(function(l,f){(function(){function p(m){return Le.from(m)}function b(m){return Le.isBuffer(m)||m instanceof W}function d(m,s,h){return typeof m.prependListener=="function"?m.prependListener(s,h):void(m._events&&m._events[s]?Array.isArray(m._events[s])?m._events[s].unshift(h):m._events[s]=[h,m._events[s]]:m.on(s,h))}function w(m,s,h){Ie=Ie||o("./_stream_duplex"),m=m||{},typeof h!="boolean"&&(h=s instanceof Ie),this.objectMode=!!m.objectMode,h&&(this.objectMode=this.objectMode||!!m.readableObjectMode),this.highWaterMark=A(this,m,"readableHighWaterMark",h),this.buffer=new X,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=m.emitClose!==!1,this.autoDestroy=!!m.autoDestroy,this.destroyed=!1,this.defaultEncoding=m.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,m.encoding&&(!J&&(J=o("string_decoder/").StringDecoder),this.decoder=new J(m.encoding),this.encoding=m.encoding)}function T(m){if(Ie=Ie||o("./_stream_duplex"),!(this instanceof T))return new T(m);var s=this instanceof Ie;this._readableState=new w(m,this,s),this.readable=!0,m&&(typeof m.read=="function"&&(this._read=m.read),typeof m.destroy=="function"&&(this._destroy=m.destroy)),be.call(this)}function v(m,s,h,y,D){he("readableAddChunk",s);var G=m._readableState;if(s===null)G.reading=!1,g(m,G);else{var Q;if(D||(Q=F(G,s)),Q)te(m,Q);else if(!(G.objectMode||s&&0<s.length))y||(G.reading=!1,M(m,G));else if(typeof s=="string"||G.objectMode||Object.getPrototypeOf(s)===Le.prototype||(s=p(s)),y)G.endEmitted?te(m,new z):C(m,G,s,!0);else if(G.ended)te(m,new oe);else{if(G.destroyed)return!1;G.reading=!1,G.decoder&&!h?(s=G.decoder.write(s),G.objectMode||s.length!==0?C(m,G,s,!1):M(m,G)):C(m,G,s,!1)}}return!G.ended&&(G.length<G.highWaterMark||G.length===0)}function C(m,s,h,y){s.flowing&&s.length===0&&!s.sync?(s.awaitDrain=0,m.emit("data",h)):(s.length+=s.objectMode?1:h.length,y?s.buffer.unshift(h):s.buffer.push(h),s.needReadable&&_(m)),M(m,s)}function F(m,s){var h;return b(s)||typeof s=="string"||s===void 0||m.objectMode||(h=new Z("chunk",["string","Buffer","Uint8Array"],s)),h}function S(m){return 1073741824<=m?m=1073741824:(m--,m|=m>>>1,m|=m>>>2,m|=m>>>4,m|=m>>>8,m|=m>>>16,m++),m}function N(m,s){return 0>=m||s.length===0&&s.ended?0:s.objectMode?1:m===m?(m>s.highWaterMark&&(s.highWaterMark=S(m)),m<=s.length?m:s.ended?s.length:(s.needReadable=!0,0)):s.flowing&&s.length?s.buffer.head.data.length:s.length}function g(m,s){if(he("onEofChunk"),!s.ended){if(s.decoder){var h=s.decoder.end();h&&h.length&&(s.buffer.push(h),s.length+=s.objectMode?1:h.length)}s.ended=!0,s.sync?_(m):(s.needReadable=!1,!s.emittedReadable&&(s.emittedReadable=!0,R(m)))}}function _(m){var s=m._readableState;he("emitReadable",s.needReadable,s.emittedReadable),s.needReadable=!1,s.emittedReadable||(he("emitReadable",s.flowing),s.emittedReadable=!0,l.nextTick(R,m))}function R(m){var s=m._readableState;he("emitReadable_",s.destroyed,s.length,s.ended),!s.destroyed&&(s.length||s.ended)&&(m.emit("readable"),s.emittedReadable=!1),s.needReadable=!s.flowing&&!s.ended&&s.length<=s.highWaterMark,ne(m)}function M(m,s){s.readingMore||(s.readingMore=!0,l.nextTick(I,m,s))}function I(m,s){for(;!s.reading&&!s.ended&&(s.length<s.highWaterMark||s.flowing&&s.length===0);){var h=s.length;if(he("maybeReadMore read 0"),m.read(0),h===s.length)break}s.readingMore=!1}function x(m){return function(){var s=m._readableState;he("pipeOnDrain",s.awaitDrain),s.awaitDrain&&s.awaitDrain--,s.awaitDrain===0&&ke(m,"data")&&(s.flowing=!0,ne(m))}}function K(m){var s=m._readableState;s.readableListening=0<m.listenerCount("readable"),s.resumeScheduled&&!s.paused?s.flowing=!0:0<m.listenerCount("data")&&m.resume()}function L(m){he("readable nexttick read 0"),m.read(0)}function B(m,s){s.resumeScheduled||(s.resumeScheduled=!0,l.nextTick(O,m,s))}function O(m,s){he("resume",s.reading),s.reading||m.read(0),s.resumeScheduled=!1,m.emit("resume"),ne(m),s.flowing&&!s.reading&&m.read(0)}function ne(m){var s=m._readableState;for(he("flow",s.flowing);s.flowing&&m.read()!==null;);}function ue(m,s){if(s.length===0)return null;var h;return s.objectMode?h=s.buffer.shift():!m||m>=s.length?(h=s.decoder?s.buffer.join(""):s.buffer.length===1?s.buffer.first():s.buffer.concat(s.length),s.buffer.clear()):h=s.buffer.consume(m,s.decoder),h}function fe(m){var s=m._readableState;he("endReadable",s.endEmitted),s.endEmitted||(s.ended=!0,l.nextTick(pe,s,m))}function pe(m,s){if(he("endReadableNT",m.endEmitted,m.length),!m.endEmitted&&m.length===0&&(m.endEmitted=!0,s.readable=!1,s.emit("end"),m.autoDestroy)){var h=s._writableState;(!h||h.autoDestroy&&h.finished)&&s.destroy()}}function ve(m,s){for(var h=0,y=m.length;h<y;h++)if(m[h]===s)return h;return-1}a.exports=T;var Ie;T.ReadableState=w;var he;o("events").EventEmitter;var ke=function(m,s){return m.listeners(s).length},be=o("./internal/streams/stream"),Le=o("buffer").Buffer,W=f.Uint8Array||function(){},Y=o("util");he=Y&&Y.debuglog?Y.debuglog("stream"):function(){};var J,U,H,X=o("./internal/streams/buffer_list"),re=o("./internal/streams/destroy"),ae=o("./internal/streams/state"),A=ae.getHighWaterMark,P=o("../errors").codes,Z=P.ERR_INVALID_ARG_TYPE,oe=P.ERR_STREAM_PUSH_AFTER_EOF,$=P.ERR_METHOD_NOT_IMPLEMENTED,z=P.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;o("inherits")(T,be);var te=re.errorOrDestroy,ce=["error","close","destroy","pause","resume"];Object.defineProperty(T.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState!==void 0&&this._readableState.destroyed},set:function(m){this._readableState&&(this._readableState.destroyed=m)}}),T.prototype.destroy=re.destroy,T.prototype._undestroy=re.undestroy,T.prototype._destroy=function(m,s){s(m)},T.prototype.push=function(m,s){var h,y=this._readableState;return y.objectMode?h=!0:typeof m=="string"&&(s=s||y.defaultEncoding,s!==y.encoding&&(m=Le.from(m,s),s=""),h=!0),v(this,m,s,!1,h)},T.prototype.unshift=function(m){return v(this,m,null,!0,!1)},T.prototype.isPaused=function(){return this._readableState.flowing===!1},T.prototype.setEncoding=function(m){J||(J=o("string_decoder/").StringDecoder);var s=new J(m);this._readableState.decoder=s,this._readableState.encoding=this._readableState.decoder.encoding;for(var h=this._readableState.buffer.head,y="";h!==null;)y+=s.write(h.data),h=h.next;return this._readableState.buffer.clear(),y!==""&&this._readableState.buffer.push(y),this._readableState.length=y.length,this},T.prototype.read=function(m){he("read",m),m=parseInt(m,10);var s=this._readableState,h=m;if(m!==0&&(s.emittedReadable=!1),m===0&&s.needReadable&&((s.highWaterMark===0?0<s.length:s.length>=s.highWaterMark)||s.ended))return he("read: emitReadable",s.length,s.ended),s.length===0&&s.ended?fe(this):_(this),null;if(m=N(m,s),m===0&&s.ended)return s.length===0&&fe(this),null;var y=s.needReadable;he("need readable",y),(s.length===0||s.length-m<s.highWaterMark)&&(y=!0,he("length less than watermark",y)),s.ended||s.reading?(y=!1,he("reading or ended",y)):y&&(he("do read"),s.reading=!0,s.sync=!0,s.length===0&&(s.needReadable=!0),this._read(s.highWaterMark),s.sync=!1,!s.reading&&(m=N(h,s)));var D;return D=0<m?ue(m,s):null,D===null?(s.needReadable=s.length<=s.highWaterMark,m=0):(s.length-=m,s.awaitDrain=0),s.length===0&&(!s.ended&&(s.needReadable=!0),h!==m&&s.ended&&fe(this)),D!==null&&this.emit("data",D),D},T.prototype._read=function(){te(this,new $("_read()"))},T.prototype.pipe=function(m,s){function h(He,nt){he("onunpipe"),He===me&&nt&&nt.hasUnpiped===!1&&(nt.hasUnpiped=!0,D())}function y(){he("onend"),m.end()}function D(){he("cleanup"),m.removeListener("close",le),m.removeListener("finish",ye),m.removeListener("drain",at),m.removeListener("error",Q),m.removeListener("unpipe",h),me.removeListener("end",y),me.removeListener("end",Te),me.removeListener("data",G),Je=!0,_e.awaitDrain&&(!m._writableState||m._writableState.needDrain)&&at()}function G(He){he("ondata");var nt=m.write(He);he("dest.write",nt),nt===!1&&((_e.pipesCount===1&&_e.pipes===m||1<_e.pipesCount&&ve(_e.pipes,m)!==-1)&&!Je&&(he("false write response, pause",_e.awaitDrain),_e.awaitDrain++),me.pause())}function Q(He){he("onerror",He),Te(),m.removeListener("error",Q),ke(m,"error")===0&&te(m,He)}function le(){m.removeListener("finish",ye),Te()}function ye(){he("onfinish"),m.removeListener("close",le),Te()}function Te(){he("unpipe"),me.unpipe(m)}var me=this,_e=this._readableState;switch(_e.pipesCount){case 0:_e.pipes=m;break;case 1:_e.pipes=[_e.pipes,m];break;default:_e.pipes.push(m)}_e.pipesCount+=1,he("pipe count=%d opts=%j",_e.pipesCount,s);var je=(!s||s.end!==!1)&&m!==l.stdout&&m!==l.stderr,ut=je?y:Te;_e.endEmitted?l.nextTick(ut):me.once("end",ut),m.on("unpipe",h);var at=x(me);m.on("drain",at);var Je=!1;return me.on("data",G),d(m,"error",Q),m.once("close",le),m.once("finish",ye),m.emit("pipe",me),_e.flowing||(he("pipe resume"),me.resume()),m},T.prototype.unpipe=function(m){var s=this._readableState,h={hasUnpiped:!1};if(s.pipesCount===0)return this;if(s.pipesCount===1)return m&&m!==s.pipes?this:(m||(m=s.pipes),s.pipes=null,s.pipesCount=0,s.flowing=!1,m&&m.emit("unpipe",this,h),this);if(!m){var y=s.pipes,D=s.pipesCount;s.pipes=null,s.pipesCount=0,s.flowing=!1;for(var G=0;G<D;G++)y[G].emit("unpipe",this,{hasUnpiped:!1});return this}var Q=ve(s.pipes,m);return Q===-1?this:(s.pipes.splice(Q,1),s.pipesCount-=1,s.pipesCount===1&&(s.pipes=s.pipes[0]),m.emit("unpipe",this,h),this)},T.prototype.on=function(m,s){var h=be.prototype.on.call(this,m,s),y=this._readableState;return m==="data"?(y.readableListening=0<this.listenerCount("readable"),y.flowing!==!1&&this.resume()):m=="readable"&&!y.endEmitted&&!y.readableListening&&(y.readableListening=y.needReadable=!0,y.flowing=!1,y.emittedReadable=!1,he("on readable",y.length,y.reading),y.length?_(this):!y.reading&&l.nextTick(L,this)),h},T.prototype.addListener=T.prototype.on,T.prototype.removeListener=function(m,s){var h=be.prototype.removeListener.call(this,m,s);return m==="readable"&&l.nextTick(K,this),h},T.prototype.removeAllListeners=function(m){var s=be.prototype.removeAllListeners.apply(this,arguments);return(m==="readable"||m===void 0)&&l.nextTick(K,this),s},T.prototype.resume=function(){var m=this._readableState;return m.flowing||(he("resume"),m.flowing=!m.readableListening,B(this,m)),m.paused=!1,this},T.prototype.pause=function(){return he("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(he("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},T.prototype.wrap=function(m){var s=this,h=this._readableState,y=!1;for(var D in m.on("end",function(){if(he("wrapped end"),h.decoder&&!h.ended){var Q=h.decoder.end();Q&&Q.length&&s.push(Q)}s.push(null)}),m.on("data",function(Q){if(he("wrapped data"),h.decoder&&(Q=h.decoder.write(Q)),!(h.objectMode&&Q==null)&&(h.objectMode||Q&&Q.length)){var le=s.push(Q);le||(y=!0,m.pause())}}),m)this[D]===void 0&&typeof m[D]=="function"&&(this[D]=function(Q){return function(){return m[Q].apply(m,arguments)}}(D));for(var G=0;G<ce.length;G++)m.on(ce[G],this.emit.bind(this,ce[G]));return this._read=function(Q){he("wrapped _read",Q),y&&(y=!1,m.resume())},this},typeof Symbol=="function"&&(T.prototype[Symbol.asyncIterator]=function(){return U===void 0&&(U=o("./internal/streams/async_iterator")),U(this)}),Object.defineProperty(T.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(T.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(T.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(m){this._readableState&&(this._readableState.flowing=m)}}),T._fromList=ue,Object.defineProperty(T.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),typeof Symbol=="function"&&(T.from=function(m,s){return H===void 0&&(H=o("./internal/streams/from")),H(T,m,s)})}).call(this)}).call(this,o("_process"),typeof Ke>"u"?typeof self>"u"?typeof window>"u"?{}:window:self:Ke)},{"../errors":15,"./_stream_duplex":16,"./internal/streams/async_iterator":21,"./internal/streams/buffer_list":22,"./internal/streams/destroy":23,"./internal/streams/from":25,"./internal/streams/state":27,"./internal/streams/stream":28,_process:12,buffer:3,events:7,inherits:10,"string_decoder/":31,util:2}],19:[function(o,a){function l(S,N){var g=this._transformState;g.transforming=!1;var _=g.writecb;if(_===null)return this.emit("error",new T);g.writechunk=null,g.writecb=null,N!=null&&this.push(N),_(S);var R=this._readableState;R.reading=!1,(R.needReadable||R.length<R.highWaterMark)&&this._read(R.highWaterMark)}function f(S){return this instanceof f?(F.call(this,S),this._transformState={afterTransform:l.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,S&&(typeof S.transform=="function"&&(this._transform=S.transform),typeof S.flush=="function"&&(this._flush=S.flush)),void this.on("prefinish",p)):new f(S)}function p(){var S=this;typeof this._flush!="function"||this._readableState.destroyed?b(this,null,null):this._flush(function(N,g){b(S,N,g)})}function b(S,N,g){if(N)return S.emit("error",N);if(g!=null&&S.push(g),S._writableState.length)throw new C;if(S._transformState.transforming)throw new v;return S.push(null)}a.exports=f;var d=o("../errors").codes,w=d.ERR_METHOD_NOT_IMPLEMENTED,T=d.ERR_MULTIPLE_CALLBACK,v=d.ERR_TRANSFORM_ALREADY_TRANSFORMING,C=d.ERR_TRANSFORM_WITH_LENGTH_0,F=o("./_stream_duplex");o("inherits")(f,F),f.prototype.push=function(S,N){return this._transformState.needTransform=!1,F.prototype.push.call(this,S,N)},f.prototype._transform=function(S,N,g){g(new w("_transform()"))},f.prototype._write=function(S,N,g){var _=this._transformState;if(_.writecb=g,_.writechunk=S,_.writeencoding=N,!_.transforming){var R=this._readableState;(_.needTransform||R.needReadable||R.length<R.highWaterMark)&&this._read(R.highWaterMark)}},f.prototype._read=function(){var S=this._transformState;S.writechunk===null||S.transforming?S.needTransform=!0:(S.transforming=!0,this._transform(S.writechunk,S.writeencoding,S.afterTransform))},f.prototype._destroy=function(S,N){F.prototype._destroy.call(this,S,function(g){N(g)})}},{"../errors":15,"./_stream_duplex":16,inherits:10}],20:[function(o,a){(function(l,f){(function(){function p($){var z=this;this.next=null,this.entry=null,this.finish=function(){fe(z,$)}}function b($){return he.from($)}function d($){return he.isBuffer($)||$ instanceof ke}function w(){}function T($,z,te){pe=pe||o("./_stream_duplex"),$=$||{},typeof te!="boolean"&&(te=z instanceof pe),this.objectMode=!!$.objectMode,te&&(this.objectMode=this.objectMode||!!$.writableObjectMode),this.highWaterMark=W(this,$,"writableHighWaterMark",te),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var ce=$.decodeStrings===!1;this.decodeStrings=!ce,this.defaultEncoding=$.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(m){M(z,m)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=$.emitClose!==!1,this.autoDestroy=!!$.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new p(this)}function v($){pe=pe||o("./_stream_duplex");var z=this instanceof pe;return z||oe.call(v,this)?(this._writableState=new T($,this,z),this.writable=!0,$&&(typeof $.write=="function"&&(this._write=$.write),typeof $.writev=="function"&&(this._writev=$.writev),typeof $.destroy=="function"&&(this._destroy=$.destroy),typeof $.final=="function"&&(this._final=$.final)),void Ie.call(this)):new v($)}function C($,z){var te=new A;Z($,te),l.nextTick(z,te)}function F($,z,te,ce){var m;return te===null?m=new ae:typeof te!="string"&&!z.objectMode&&(m=new J("chunk",["string","Buffer"],te)),!m||(Z($,m),l.nextTick(ce,m),!1)}function S($,z,te){return $.objectMode||$.decodeStrings===!1||typeof z!="string"||(z=he.from(z,te)),z}function N($,z,te,ce,m,s){if(!te){var h=S(z,ce,m);ce!==h&&(te=!0,m="buffer",ce=h)}var y=z.objectMode?1:ce.length;z.length+=y;var D=z.length<z.highWaterMark;if(D||(z.needDrain=!0),z.writing||z.corked){var G=z.lastBufferedRequest;z.lastBufferedRequest={chunk:ce,encoding:m,isBuf:te,callback:s,next:null},G?G.next=z.lastBufferedRequest:z.bufferedRequest=z.lastBufferedRequest,z.bufferedRequestCount+=1}else g($,z,!1,y,ce,m,s);return D}function g($,z,te,ce,m,s,h){z.writelen=ce,z.writecb=h,z.writing=!0,z.sync=!0,z.destroyed?z.onwrite(new re("write")):te?$._writev(m,z.onwrite):$._write(m,s,z.onwrite),z.sync=!1}function _($,z,te,ce,m){--z.pendingcb,te?(l.nextTick(m,ce),l.nextTick(ne,$,z),$._writableState.errorEmitted=!0,Z($,ce)):(m(ce),$._writableState.errorEmitted=!0,Z($,ce),ne($,z))}function R($){$.writing=!1,$.writecb=null,$.length-=$.writelen,$.writelen=0}function M($,z){var te=$._writableState,ce=te.sync,m=te.writecb;if(typeof m!="function")throw new H;if(R(te),z)_($,te,ce,z,m);else{var s=L(te)||$.destroyed;s||te.corked||te.bufferProcessing||!te.bufferedRequest||K($,te),ce?l.nextTick(I,$,te,s,m):I($,te,s,m)}}function I($,z,te,ce){te||x($,z),z.pendingcb--,ce(),ne($,z)}function x($,z){z.length===0&&z.needDrain&&(z.needDrain=!1,$.emit("drain"))}function K($,z){z.bufferProcessing=!0;var te=z.bufferedRequest;if($._writev&&te&&te.next){var ce=z.bufferedRequestCount,m=Array(ce),s=z.corkedRequestsFree;s.entry=te;for(var h=0,y=!0;te;)m[h]=te,te.isBuf||(y=!1),te=te.next,h+=1;m.allBuffers=y,g($,z,!0,z.length,m,"",s.finish),z.pendingcb++,z.lastBufferedRequest=null,s.next?(z.corkedRequestsFree=s.next,s.next=null):z.corkedRequestsFree=new p(z),z.bufferedRequestCount=0}else{for(;te;){var D=te.chunk,G=te.encoding,Q=te.callback,le=z.objectMode?1:D.length;if(g($,z,!1,le,D,G,Q),te=te.next,z.bufferedRequestCount--,z.writing)break}te===null&&(z.lastBufferedRequest=null)}z.bufferedRequest=te,z.bufferProcessing=!1}function L($){return $.ending&&$.length===0&&$.bufferedRequest===null&&!$.finished&&!$.writing}function B($,z){$._final(function(te){z.pendingcb--,te&&Z($,te),z.prefinished=!0,$.emit("prefinish"),ne($,z)})}function O($,z){z.prefinished||z.finalCalled||(typeof $._final!="function"||z.destroyed?(z.prefinished=!0,$.emit("prefinish")):(z.pendingcb++,z.finalCalled=!0,l.nextTick(B,$,z)))}function ne($,z){var te=L(z);if(te&&(O($,z),z.pendingcb===0&&(z.finished=!0,$.emit("finish"),z.autoDestroy))){var ce=$._readableState;(!ce||ce.autoDestroy&&ce.endEmitted)&&$.destroy()}return te}function ue($,z,te){z.ending=!0,ne($,z),te&&(z.finished?l.nextTick(te):$.once("finish",te)),z.ended=!0,$.writable=!1}function fe($,z,te){var ce=$.entry;for($.entry=null;ce;){var m=ce.callback;z.pendingcb--,m(te),ce=ce.next}z.corkedRequestsFree.next=$}a.exports=v;var pe;v.WritableState=T;var ve={deprecate:o("util-deprecate")},Ie=o("./internal/streams/stream"),he=o("buffer").Buffer,ke=f.Uint8Array||function(){},be=o("./internal/streams/destroy"),Le=o("./internal/streams/state"),W=Le.getHighWaterMark,Y=o("../errors").codes,J=Y.ERR_INVALID_ARG_TYPE,U=Y.ERR_METHOD_NOT_IMPLEMENTED,H=Y.ERR_MULTIPLE_CALLBACK,X=Y.ERR_STREAM_CANNOT_PIPE,re=Y.ERR_STREAM_DESTROYED,ae=Y.ERR_STREAM_NULL_VALUES,A=Y.ERR_STREAM_WRITE_AFTER_END,P=Y.ERR_UNKNOWN_ENCODING,Z=be.errorOrDestroy;o("inherits")(v,Ie),T.prototype.getBuffer=function(){for(var $=this.bufferedRequest,z=[];$;)z.push($),$=$.next;return z},function(){try{Object.defineProperty(T.prototype,"buffer",{get:ve.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}}();var oe;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(oe=Function.prototype[Symbol.hasInstance],Object.defineProperty(v,Symbol.hasInstance,{value:function($){return!!oe.call(this,$)||this===v&&$&&$._writableState instanceof T}})):oe=function($){return $ instanceof this},v.prototype.pipe=function(){Z(this,new X)},v.prototype.write=function($,z,te){var ce=this._writableState,m=!1,s=!ce.objectMode&&d($);return s&&!he.isBuffer($)&&($=b($)),typeof z=="function"&&(te=z,z=null),s?z="buffer":!z&&(z=ce.defaultEncoding),typeof te!="function"&&(te=w),ce.ending?C(this,te):(s||F(this,ce,$,te))&&(ce.pendingcb++,m=N(this,ce,s,$,z,te)),m},v.prototype.cork=function(){this._writableState.corked++},v.prototype.uncork=function(){var $=this._writableState;$.corked&&($.corked--,!$.writing&&!$.corked&&!$.bufferProcessing&&$.bufferedRequest&&K(this,$))},v.prototype.setDefaultEncoding=function($){if(typeof $=="string"&&($=$.toLowerCase()),!(-1<["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf(($+"").toLowerCase())))throw new P($);return this._writableState.defaultEncoding=$,this},Object.defineProperty(v.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(v.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),v.prototype._write=function($,z,te){te(new U("_write()"))},v.prototype._writev=null,v.prototype.end=function($,z,te){var ce=this._writableState;return typeof $=="function"?(te=$,$=null,z=null):typeof z=="function"&&(te=z,z=null),$!=null&&this.write($,z),ce.corked&&(ce.corked=1,this.uncork()),ce.ending||ue(this,ce,te),this},Object.defineProperty(v.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(v.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState!==void 0&&this._writableState.destroyed},set:function($){this._writableState&&(this._writableState.destroyed=$)}}),v.prototype.destroy=be.destroy,v.prototype._undestroy=be.undestroy,v.prototype._destroy=function($,z){z($)}}).call(this)}).call(this,o("_process"),typeof Ke>"u"?typeof self>"u"?typeof window>"u"?{}:window:self:Ke)},{"../errors":15,"./_stream_duplex":16,"./internal/streams/destroy":23,"./internal/streams/state":27,"./internal/streams/stream":28,_process:12,buffer:3,inherits:10,"util-deprecate":32}],21:[function(o,a){(function(l){(function(){function f(x,K,L){return K in x?Object.defineProperty(x,K,{value:L,enumerable:!0,configurable:!0,writable:!0}):x[K]=L,x}function p(x,K){return{value:x,done:K}}function b(x){var K=x[C];if(K!==null){var L=x[R].read();L!==null&&(x[g]=null,x[C]=null,x[F]=null,K(p(L,!1)))}}function d(x){l.nextTick(b,x)}function w(x,K){return function(L,B){x.then(function(){return K[N]?void L(p(void 0,!0)):void K[_](L,B)},B)}}var T,v=o("./end-of-stream"),C=Symbol("lastResolve"),F=Symbol("lastReject"),S=Symbol("error"),N=Symbol("ended"),g=Symbol("lastPromise"),_=Symbol("handlePromise"),R=Symbol("stream"),M=Object.getPrototypeOf(function(){}),I=Object.setPrototypeOf((T={get stream(){return this[R]},next:function(){var x=this,K=this[S];if(K!==null)return Promise.reject(K);if(this[N])return Promise.resolve(p(void 0,!0));if(this[R].destroyed)return new Promise(function(ne,ue){l.nextTick(function(){x[S]?ue(x[S]):ne(p(void 0,!0))})});var L,B=this[g];if(B)L=new Promise(w(B,this));else{var O=this[R].read();if(O!==null)return Promise.resolve(p(O,!1));L=new Promise(this[_])}return this[g]=L,L}},f(T,Symbol.asyncIterator,function(){return this}),f(T,"return",function(){var x=this;return new Promise(function(K,L){x[R].destroy(null,function(B){return B?void L(B):void K(p(void 0,!0))})})}),T),M);a.exports=function(x){var K,L=Object.create(I,(K={},f(K,R,{value:x,writable:!0}),f(K,C,{value:null,writable:!0}),f(K,F,{value:null,writable:!0}),f(K,S,{value:null,writable:!0}),f(K,N,{value:x._readableState.endEmitted,writable:!0}),f(K,_,{value:function(B,O){var ne=L[R].read();ne?(L[g]=null,L[C]=null,L[F]=null,B(p(ne,!1))):(L[C]=B,L[F]=O)},writable:!0}),K));return L[g]=null,v(x,function(B){if(B&&B.code!=="ERR_STREAM_PREMATURE_CLOSE"){var O=L[F];return O!==null&&(L[g]=null,L[C]=null,L[F]=null,O(B)),void(L[S]=B)}var ne=L[C];ne!==null&&(L[g]=null,L[C]=null,L[F]=null,ne(p(void 0,!0))),L[N]=!0}),x.on("readable",d.bind(null,L)),L}}).call(this)}).call(this,o("_process"))},{"./end-of-stream":24,_process:12}],22:[function(o,a){function l(g,_){var R=Object.keys(g);if(Object.getOwnPropertySymbols){var M=Object.getOwnPropertySymbols(g);_&&(M=M.filter(function(I){return Object.getOwnPropertyDescriptor(g,I).enumerable})),R.push.apply(R,M)}return R}function f(g){for(var _,R=1;R<arguments.length;R++)_=arguments[R]==null?{}:arguments[R],R%2?l(Object(_),!0).forEach(function(M){p(g,M,_[M])}):Object.getOwnPropertyDescriptors?Object.defineProperties(g,Object.getOwnPropertyDescriptors(_)):l(Object(_)).forEach(function(M){Object.defineProperty(g,M,Object.getOwnPropertyDescriptor(_,M))});return g}function p(g,_,R){return _ in g?Object.defineProperty(g,_,{value:R,enumerable:!0,configurable:!0,writable:!0}):g[_]=R,g}function b(g,_){if(!(g instanceof _))throw new TypeError("Cannot call a class as a function")}function d(g,_){for(var R,M=0;M<_.length;M++)R=_[M],R.enumerable=R.enumerable||!1,R.configurable=!0,"value"in R&&(R.writable=!0),Object.defineProperty(g,R.key,R)}function w(g,_,R){return _&&d(g.prototype,_),g}function T(g,_,R){C.prototype.copy.call(g,_,R)}var v=o("buffer"),C=v.Buffer,F=o("util"),S=F.inspect,N=S&&S.custom||"inspect";a.exports=function(){function g(){b(this,g),this.head=null,this.tail=null,this.length=0}return w(g,[{key:"push",value:function(_){var R={data:_,next:null};0<this.length?this.tail.next=R:this.head=R,this.tail=R,++this.length}},{key:"unshift",value:function(_){var R={data:_,next:this.head};this.length===0&&(this.tail=R),this.head=R,++this.length}},{key:"shift",value:function(){if(this.length!==0){var _=this.head.data;return this.head=this.length===1?this.tail=null:this.head.next,--this.length,_}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(_){if(this.length===0)return"";for(var R=this.head,M=""+R.data;R=R.next;)M+=_+R.data;return M}},{key:"concat",value:function(_){if(this.length===0)return C.alloc(0);for(var R=C.allocUnsafe(_>>>0),M=this.head,I=0;M;)T(M.data,R,I),I+=M.data.length,M=M.next;return R}},{key:"consume",value:function(_,R){var M;return _<this.head.data.length?(M=this.head.data.slice(0,_),this.head.data=this.head.data.slice(_)):_===this.head.data.length?M=this.shift():M=R?this._getString(_):this._getBuffer(_),M}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(_){var R=this.head,M=1,I=R.data;for(_-=I.length;R=R.next;){var x=R.data,K=_>x.length?x.length:_;if(I+=K===x.length?x:x.slice(0,_),_-=K,_===0){K===x.length?(++M,this.head=R.next?R.next:this.tail=null):(this.head=R,R.data=x.slice(K));break}++M}return this.length-=M,I}},{key:"_getBuffer",value:function(_){var R=C.allocUnsafe(_),M=this.head,I=1;for(M.data.copy(R),_-=M.data.length;M=M.next;){var x=M.data,K=_>x.length?x.length:_;if(x.copy(R,R.length-_,0,K),_-=K,_===0){K===x.length?(++I,this.head=M.next?M.next:this.tail=null):(this.head=M,M.data=x.slice(K));break}++I}return this.length-=I,R}},{key:N,value:function(_,R){return S(this,f({},R,{depth:0,customInspect:!1}))}}]),g}()},{buffer:3,util:2}],23:[function(o,a){(function(l){(function(){function f(d,w){b(d,w),p(d)}function p(d){d._writableState&&!d._writableState.emitClose||d._readableState&&!d._readableState.emitClose||d.emit("close")}function b(d,w){d.emit("error",w)}a.exports={destroy:function(d,w){var T=this,v=this._readableState&&this._readableState.destroyed,C=this._writableState&&this._writableState.destroyed;return v||C?(w?w(d):d&&(this._writableState?!this._writableState.errorEmitted&&(this._writableState.errorEmitted=!0,l.nextTick(b,this,d)):l.nextTick(b,this,d)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(d||null,function(F){!w&&F?T._writableState?T._writableState.errorEmitted?l.nextTick(p,T):(T._writableState.errorEmitted=!0,l.nextTick(f,T,F)):l.nextTick(f,T,F):w?(l.nextTick(p,T),w(F)):l.nextTick(p,T)}),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(d,w){var T=d._readableState,v=d._writableState;T&&T.autoDestroy||v&&v.autoDestroy?d.destroy(w):d.emit("error",w)}}}).call(this)}).call(this,o("_process"))},{_process:12}],24:[function(o,a){function l(w){var T=!1;return function(){if(!T){T=!0;for(var v=arguments.length,C=Array(v),F=0;F<v;F++)C[F]=arguments[F];w.apply(this,C)}}}function f(){}function p(w){return w.setHeader&&typeof w.abort=="function"}function b(w,T,v){if(typeof T=="function")return b(w,null,T);T||(T={}),v=l(v||f);var C=T.readable||T.readable!==!1&&w.readable,F=T.writable||T.writable!==!1&&w.writable,S=function(){w.writable||g()},N=w._writableState&&w._writableState.finished,g=function(){F=!1,N=!0,C||v.call(w)},_=w._readableState&&w._readableState.endEmitted,R=function(){C=!1,_=!0,F||v.call(w)},M=function(K){v.call(w,K)},I=function(){var K;return C&&!_?(w._readableState&&w._readableState.ended||(K=new d),v.call(w,K)):F&&!N?(w._writableState&&w._writableState.ended||(K=new d),v.call(w,K)):void 0},x=function(){w.req.on("finish",g)};return p(w)?(w.on("complete",g),w.on("abort",I),w.req?x():w.on("request",x)):F&&!w._writableState&&(w.on("end",S),w.on("close",S)),w.on("end",R),w.on("finish",g),T.error!==!1&&w.on("error",M),w.on("close",I),function(){w.removeListener("complete",g),w.removeListener("abort",I),w.removeListener("request",x),w.req&&w.req.removeListener("finish",g),w.removeListener("end",S),w.removeListener("close",S),w.removeListener("finish",g),w.removeListener("end",R),w.removeListener("error",M),w.removeListener("close",I)}}var d=o("../../../errors").codes.ERR_STREAM_PREMATURE_CLOSE;a.exports=b},{"../../../errors":15}],25:[function(o,a){a.exports=function(){throw new Error("Readable.from is not available in the browser")}},{}],26:[function(o,a){function l(N){var g=!1;return function(){g||(g=!0,N.apply(void 0,arguments))}}function f(N){if(N)throw N}function p(N){return N.setHeader&&typeof N.abort=="function"}function b(N,g,_,R){R=l(R);var M=!1;N.on("close",function(){M=!0}),v===void 0&&(v=o("./end-of-stream")),v(N,{readable:g,writable:_},function(x){return x?R(x):(M=!0,void R())});var I=!1;return function(x){if(!M)return I?void 0:(I=!0,p(N)?N.abort():typeof N.destroy=="function"?N.destroy():void R(x||new S("pipe")))}}function d(N){N()}function w(N,g){return N.pipe(g)}function T(N){return N.length&&typeof N[N.length-1]=="function"?N.pop():f}var v,C=o("../../../errors").codes,F=C.ERR_MISSING_ARGS,S=C.ERR_STREAM_DESTROYED;a.exports=function(){for(var N=arguments.length,g=Array(N),_=0;_<N;_++)g[_]=arguments[_];var R=T(g);if(Array.isArray(g[0])&&(g=g[0]),2>g.length)throw new F("streams");var M,I=g.map(function(x,K){var L=K<g.length-1;return b(x,L,0<K,function(B){M||(M=B),B&&I.forEach(d),L||(I.forEach(d),R(M))})});return g.reduce(w)}},{"../../../errors":15,"./end-of-stream":24}],27:[function(o,a){function l(p,b,d){return p.highWaterMark==null?b?p[d]:null:p.highWaterMark}var f=o("../../../errors").codes.ERR_INVALID_OPT_VALUE;a.exports={getHighWaterMark:function(p,b,d,w){var T=l(b,w,d);if(T!=null){if(!(isFinite(T)&&t(T)===T)||0>T){var v=w?d:"highWaterMark";throw new f(v,T)}return t(T)}return p.objectMode?16:16384}}},{"../../../errors":15}],28:[function(o,a){a.exports=o("events").EventEmitter},{events:7}],29:[function(o,a,l){l=a.exports=o("./lib/_stream_readable.js"),l.Stream=l,l.Readable=l,l.Writable=o("./lib/_stream_writable.js"),l.Duplex=o("./lib/_stream_duplex.js"),l.Transform=o("./lib/_stream_transform.js"),l.PassThrough=o("./lib/_stream_passthrough.js"),l.finished=o("./lib/internal/streams/end-of-stream.js"),l.pipeline=o("./lib/internal/streams/pipeline.js")},{"./lib/_stream_duplex.js":16,"./lib/_stream_passthrough.js":17,"./lib/_stream_readable.js":18,"./lib/_stream_transform.js":19,"./lib/_stream_writable.js":20,"./lib/internal/streams/end-of-stream.js":24,"./lib/internal/streams/pipeline.js":26}],30:[function(o,a,l){function f(w,T){for(var v in w)T[v]=w[v]}function p(w,T,v){return d(w,T,v)}/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var b=o("buffer"),d=b.Buffer;d.from&&d.alloc&&d.allocUnsafe&&d.allocUnsafeSlow?a.exports=b:(f(b,l),l.Buffer=p),p.prototype=Object.create(d.prototype),f(d,p),p.from=function(w,T,v){if(typeof w=="number")throw new TypeError("Argument must not be a number");return d(w,T,v)},p.alloc=function(w,T,v){if(typeof w!="number")throw new TypeError("Argument must be a number");var C=d(w);return T===void 0?C.fill(0):typeof v=="string"?C.fill(T,v):C.fill(T),C},p.allocUnsafe=function(w){if(typeof w!="number")throw new TypeError("Argument must be a number");return d(w)},p.allocUnsafeSlow=function(w){if(typeof w!="number")throw new TypeError("Argument must be a number");return b.SlowBuffer(w)}},{buffer:3}],31:[function(o,a,l){function f(I){if(!I)return"utf8";for(var x;;)switch(I){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return I;default:if(x)return;I=(""+I).toLowerCase(),x=!0}}function p(I){var x=f(I);if(typeof x!="string"&&(R.isEncoding===M||!M(I)))throw new Error("Unknown encoding: "+I);return x||I}function b(I){this.encoding=p(I);var x;switch(this.encoding){case"utf16le":this.text=C,this.end=F,x=4;break;case"utf8":this.fillLast=v,x=4;break;case"base64":this.text=S,this.end=N,x=3;break;default:return this.write=g,void(this.end=_)}this.lastNeed=0,this.lastTotal=0,this.lastChar=R.allocUnsafe(x)}function d(I){return 127>=I?0:I>>5==6?2:I>>4==14?3:I>>3==30?4:I>>6==2?-1:-2}function w(I,x,K){var L=x.length-1;if(L<K)return 0;var B=d(x[L]);return 0<=B?(0<B&&(I.lastNeed=B-1),B):--L<K||B===-2?0:(B=d(x[L]),0<=B?(0<B&&(I.lastNeed=B-2),B):--L<K||B===-2?0:(B=d(x[L]),0<=B?(0<B&&(B===2?B=0:I.lastNeed=B-3),B):0))}function T(I,x){if((192&x[0])!=128)return I.lastNeed=0,"";if(1<I.lastNeed&&1<x.length){if((192&x[1])!=128)return I.lastNeed=1,"";if(2<I.lastNeed&&2<x.length&&(192&x[2])!=128)return I.lastNeed=2,""}}function v(I){var x=this.lastTotal-this.lastNeed,K=T(this,I);return K===void 0?this.lastNeed<=I.length?(I.copy(this.lastChar,x,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(I.copy(this.lastChar,x,0,I.length),void(this.lastNeed-=I.length)):K}function C(I,x){if((I.length-x)%2==0){var K=I.toString("utf16le",x);if(K){var L=K.charCodeAt(K.length-1);if(55296<=L&&56319>=L)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=I[I.length-2],this.lastChar[1]=I[I.length-1],K.slice(0,-1)}return K}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=I[I.length-1],I.toString("utf16le",x,I.length-1)}function F(I){var x=I&&I.length?this.write(I):"";if(this.lastNeed){var K=this.lastTotal-this.lastNeed;return x+this.lastChar.toString("utf16le",0,K)}return x}function S(I,x){var K=(I.length-x)%3;return K==0?I.toString("base64",x):(this.lastNeed=3-K,this.lastTotal=3,K==1?this.lastChar[0]=I[I.length-1]:(this.lastChar[0]=I[I.length-2],this.lastChar[1]=I[I.length-1]),I.toString("base64",x,I.length-K))}function N(I){var x=I&&I.length?this.write(I):"";return this.lastNeed?x+this.lastChar.toString("base64",0,3-this.lastNeed):x}function g(I){return I.toString(this.encoding)}function _(I){return I&&I.length?this.write(I):""}var R=o("safe-buffer").Buffer,M=R.isEncoding||function(I){switch(I=""+I,I&&I.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};l.StringDecoder=b,b.prototype.write=function(I){if(I.length===0)return"";var x,K;if(this.lastNeed){if(x=this.fillLast(I),x===void 0)return"";K=this.lastNeed,this.lastNeed=0}else K=0;return K<I.length?x?x+this.text(I,K):this.text(I,K):x||""},b.prototype.end=function(I){var x=I&&I.length?this.write(I):"";return this.lastNeed?x+"":x},b.prototype.text=function(I,x){var K=w(this,I,x);if(!this.lastNeed)return I.toString("utf8",x);this.lastTotal=K;var L=I.length-(K-this.lastNeed);return I.copy(this.lastChar,0,L),I.toString("utf8",x,L)},b.prototype.fillLast=function(I){return this.lastNeed<=I.length?(I.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(I.copy(this.lastChar,this.lastTotal-this.lastNeed,0,I.length),void(this.lastNeed-=I.length))}},{"safe-buffer":30}],32:[function(o,a){(function(l){(function(){function f(p){try{if(!l.localStorage)return!1}catch{return!1}var b=l.localStorage[p];return b!=null&&(b+"").toLowerCase()==="true"}a.exports=function(p,b){function d(){if(!w){if(f("throwDeprecation"))throw new Error(b);f("traceDeprecation")?console.trace(b):console.warn(b),w=!0}return p.apply(this,arguments)}if(f("noDeprecation"))return p;var w=!1;return d}}).call(this)}).call(this,typeof Ke>"u"?typeof self>"u"?typeof window>"u"?{}:window:self:Ke)},{}],"/":[function(o,a){function l(N){return N.replace(/a=ice-options:trickle\s\n/g,"")}function f(N){console.warn(N)}/*! simple-peer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */const p=o("debug")("simple-peer"),b=o("get-browser-rtc"),d=o("randombytes"),w=o("readable-stream"),T=o("queue-microtask"),v=o("err-code"),{Buffer:C}=o("buffer"),F=65536;class S extends w.Duplex{constructor(g){if(g=Object.assign({allowHalfOpen:!1},g),super(g),this._id=d(4).toString("hex").slice(0,7),this._debug("new peer %o",g),this.channelName=g.initiator?g.channelName||d(20).toString("hex"):null,this.initiator=g.initiator||!1,this.channelConfig=g.channelConfig||S.channelConfig,this.channelNegotiated=this.channelConfig.negotiated,this.config=Object.assign({},S.config,g.config),this.offerOptions=g.offerOptions||{},this.answerOptions=g.answerOptions||{},this.sdpTransform=g.sdpTransform||(_=>_),this.streams=g.streams||(g.stream?[g.stream]:[]),this.trickle=g.trickle===void 0||g.trickle,this.allowHalfTrickle=g.allowHalfTrickle!==void 0&&g.allowHalfTrickle,this.iceCompleteTimeout=g.iceCompleteTimeout||5e3,this.destroyed=!1,this.destroying=!1,this._connected=!1,this.remoteAddress=void 0,this.remoteFamily=void 0,this.remotePort=void 0,this.localAddress=void 0,this.localFamily=void 0,this.localPort=void 0,this._wrtc=g.wrtc&&typeof g.wrtc=="object"?g.wrtc:b(),!this._wrtc)throw v(typeof window>"u"?new Error("No WebRTC support: Specify `opts.wrtc` option in this environment"):new Error("No WebRTC support: Not a supported browser"),"ERR_WEBRTC_SUPPORT");this._pcReady=!1,this._channelReady=!1,this._iceComplete=!1,this._iceCompleteTimer=null,this._channel=null,this._pendingCandidates=[],this._isNegotiating=!1,this._firstNegotiation=!0,this._batchedNegotiation=!1,this._queuedNegotiation=!1,this._sendersAwaitingStable=[],this._senderMap=new Map,this._closingInterval=null,this._remoteTracks=[],this._remoteStreams=[],this._chunk=null,this._cb=null,this._interval=null;try{this._pc=new this._wrtc.RTCPeerConnection(this.config)}catch(_){return void this.destroy(v(_,"ERR_PC_CONSTRUCTOR"))}this._isReactNativeWebrtc=typeof this._pc._peerConnectionId=="number",this._pc.oniceconnectionstatechange=()=>{this._onIceStateChange()},this._pc.onicegatheringstatechange=()=>{this._onIceStateChange()},this._pc.onconnectionstatechange=()=>{this._onConnectionStateChange()},this._pc.onsignalingstatechange=()=>{this._onSignalingStateChange()},this._pc.onicecandidate=_=>{this._onIceCandidate(_)},typeof this._pc.peerIdentity=="object"&&this._pc.peerIdentity.catch(_=>{this.destroy(v(_,"ERR_PC_PEER_IDENTITY"))}),this.initiator||this.channelNegotiated?this._setupData({channel:this._pc.createDataChannel(this.channelName,this.channelConfig)}):this._pc.ondatachannel=_=>{this._setupData(_)},this.streams&&this.streams.forEach(_=>{this.addStream(_)}),this._pc.ontrack=_=>{this._onTrack(_)},this._debug("initial negotiation"),this._needsNegotiation(),this._onFinishBound=()=>{this._onFinish()},this.once("finish",this._onFinishBound)}get bufferSize(){return this._channel&&this._channel.bufferedAmount||0}get connected(){return this._connected&&this._channel.readyState==="open"}address(){return{port:this.localPort,family:this.localFamily,address:this.localAddress}}signal(g){if(!this.destroying){if(this.destroyed)throw v(new Error("cannot signal after peer is destroyed"),"ERR_DESTROYED");if(typeof g=="string")try{g=JSON.parse(g)}catch{g={}}this._debug("signal()"),g.renegotiate&&this.initiator&&(this._debug("got request to renegotiate"),this._needsNegotiation()),g.transceiverRequest&&this.initiator&&(this._debug("got request for transceiver"),this.addTransceiver(g.transceiverRequest.kind,g.transceiverRequest.init)),g.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(g.candidate):this._pendingCandidates.push(g.candidate)),g.sdp&&this._pc.setRemoteDescription(new this._wrtc.RTCSessionDescription(g)).then(()=>{this.destroyed||(this._pendingCandidates.forEach(_=>{this._addIceCandidate(_)}),this._pendingCandidates=[],this._pc.remoteDescription.type==="offer"&&this._createAnswer())}).catch(_=>{this.destroy(v(_,"ERR_SET_REMOTE_DESCRIPTION"))}),g.sdp||g.candidate||g.renegotiate||g.transceiverRequest||this.destroy(v(new Error("signal() called with invalid signal data"),"ERR_SIGNALING"))}}_addIceCandidate(g){const _=new this._wrtc.RTCIceCandidate(g);this._pc.addIceCandidate(_).catch(R=>{!_.address||_.address.endsWith(".local")?f("Ignoring unsupported ICE candidate."):this.destroy(v(R,"ERR_ADD_ICE_CANDIDATE"))})}send(g){if(!this.destroying){if(this.destroyed)throw v(new Error("cannot send after peer is destroyed"),"ERR_DESTROYED");this._channel.send(g)}}addTransceiver(g,_){if(!this.destroying){if(this.destroyed)throw v(new Error("cannot addTransceiver after peer is destroyed"),"ERR_DESTROYED");if(this._debug("addTransceiver()"),this.initiator)try{this._pc.addTransceiver(g,_),this._needsNegotiation()}catch(R){this.destroy(v(R,"ERR_ADD_TRANSCEIVER"))}else this.emit("signal",{type:"transceiverRequest",transceiverRequest:{kind:g,init:_}})}}addStream(g){if(!this.destroying){if(this.destroyed)throw v(new Error("cannot addStream after peer is destroyed"),"ERR_DESTROYED");this._debug("addStream()"),g.getTracks().forEach(_=>{this.addTrack(_,g)})}}addTrack(g,_){if(this.destroying)return;if(this.destroyed)throw v(new Error("cannot addTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("addTrack()");const R=this._senderMap.get(g)||new Map;let M=R.get(_);if(!M)M=this._pc.addTrack(g,_),R.set(_,M),this._senderMap.set(g,R),this._needsNegotiation();else throw M.removed?v(new Error("Track has been removed. You should enable/disable tracks that you want to re-add."),"ERR_SENDER_REMOVED"):v(new Error("Track has already been added to that stream."),"ERR_SENDER_ALREADY_ADDED")}replaceTrack(g,_,R){if(this.destroying)return;if(this.destroyed)throw v(new Error("cannot replaceTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("replaceTrack()");const M=this._senderMap.get(g),I=M?M.get(R):null;if(!I)throw v(new Error("Cannot replace track that was never added."),"ERR_TRACK_NOT_ADDED");_&&this._senderMap.set(_,M),I.replaceTrack==null?this.destroy(v(new Error("replaceTrack is not supported in this browser"),"ERR_UNSUPPORTED_REPLACETRACK")):I.replaceTrack(_)}removeTrack(g,_){if(this.destroying)return;if(this.destroyed)throw v(new Error("cannot removeTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSender()");const R=this._senderMap.get(g),M=R?R.get(_):null;if(!M)throw v(new Error("Cannot remove track that was never added."),"ERR_TRACK_NOT_ADDED");try{M.removed=!0,this._pc.removeTrack(M)}catch(I){I.name==="NS_ERROR_UNEXPECTED"?this._sendersAwaitingStable.push(M):this.destroy(v(I,"ERR_REMOVE_TRACK"))}this._needsNegotiation()}removeStream(g){if(!this.destroying){if(this.destroyed)throw v(new Error("cannot removeStream after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSenders()"),g.getTracks().forEach(_=>{this.removeTrack(_,g)})}}_needsNegotiation(){this._debug("_needsNegotiation"),this._batchedNegotiation||(this._batchedNegotiation=!0,T(()=>{this._batchedNegotiation=!1,this.initiator||!this._firstNegotiation?(this._debug("starting batched negotiation"),this.negotiate()):this._debug("non-initiator initial negotiation request discarded"),this._firstNegotiation=!1}))}negotiate(){if(!this.destroying){if(this.destroyed)throw v(new Error("cannot negotiate after peer is destroyed"),"ERR_DESTROYED");this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),setTimeout(()=>{this._createOffer()},0)):this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("requesting negotiation from initiator"),this.emit("signal",{type:"renegotiate",renegotiate:!0})),this._isNegotiating=!0}}destroy(g){this._destroy(g,()=>{})}_destroy(g,_){this.destroyed||this.destroying||(this.destroying=!0,this._debug("destroying (error: %s)",g&&(g.message||g)),T(()=>{if(this.destroyed=!0,this.destroying=!1,this._debug("destroy (error: %s)",g&&(g.message||g)),this.readable=this.writable=!1,this._readableState.ended||this.push(null),this._writableState.finished||this.end(),this._connected=!1,this._pcReady=!1,this._channelReady=!1,this._remoteTracks=null,this._remoteStreams=null,this._senderMap=null,clearInterval(this._closingInterval),this._closingInterval=null,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._onFinishBound&&this.removeListener("finish",this._onFinishBound),this._onFinishBound=null,this._channel){try{this._channel.close()}catch{}this._channel.onmessage=null,this._channel.onopen=null,this._channel.onclose=null,this._channel.onerror=null}if(this._pc){try{this._pc.close()}catch{}this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ontrack=null,this._pc.ondatachannel=null}this._pc=null,this._channel=null,g&&this.emit("error",g),this.emit("close"),_()}))}_setupData(g){if(!g.channel)return this.destroy(v(new Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL"));this._channel=g.channel,this._channel.binaryType="arraybuffer",typeof this._channel.bufferedAmountLowThreshold=="number"&&(this._channel.bufferedAmountLowThreshold=F),this.channelName=this._channel.label,this._channel.onmessage=R=>{this._onChannelMessage(R)},this._channel.onbufferedamountlow=()=>{this._onChannelBufferedAmountLow()},this._channel.onopen=()=>{this._onChannelOpen()},this._channel.onclose=()=>{this._onChannelClose()},this._channel.onerror=R=>{const M=R.error instanceof Error?R.error:new Error(`Datachannel error: ${R.message} ${R.filename}:${R.lineno}:${R.colno}`);this.destroy(v(M,"ERR_DATA_CHANNEL"))};let _=!1;this._closingInterval=setInterval(()=>{this._channel&&this._channel.readyState==="closing"?(_&&this._onChannelClose(),_=!0):_=!1},5e3)}_read(){}_write(g,_,R){if(this.destroyed)return R(v(new Error("cannot write after peer is destroyed"),"ERR_DATA_CHANNEL"));if(this._connected){try{this.send(g)}catch(M){return this.destroy(v(M,"ERR_DATA_CHANNEL"))}this._channel.bufferedAmount>F?(this._debug("start backpressure: bufferedAmount %d",this._channel.bufferedAmount),this._cb=R):R(null)}else this._debug("write before connect"),this._chunk=g,this._cb=R}_onFinish(){if(!this.destroyed){const g=()=>{setTimeout(()=>this.destroy(),1e3)};this._connected?g():this.once("connect",g)}}_startIceCompleteTimeout(){this.destroyed||this._iceCompleteTimer||(this._debug("started iceComplete timeout"),this._iceCompleteTimer=setTimeout(()=>{this._iceComplete||(this._iceComplete=!0,this._debug("iceComplete timeout completed"),this.emit("iceTimeout"),this.emit("_iceComplete"))},this.iceCompleteTimeout))}_createOffer(){this.destroyed||this._pc.createOffer(this.offerOptions).then(g=>{if(this.destroyed)return;this.trickle||this.allowHalfTrickle||(g.sdp=l(g.sdp)),g.sdp=this.sdpTransform(g.sdp);const _=()=>{if(!this.destroyed){const R=this._pc.localDescription||g;this._debug("signal"),this.emit("signal",{type:R.type,sdp:R.sdp})}};this._pc.setLocalDescription(g).then(()=>{this._debug("createOffer success"),this.destroyed||(this.trickle||this._iceComplete?_():this.once("_iceComplete",_))}).catch(R=>{this.destroy(v(R,"ERR_SET_LOCAL_DESCRIPTION"))})}).catch(g=>{this.destroy(v(g,"ERR_CREATE_OFFER"))})}_requestMissingTransceivers(){this._pc.getTransceivers&&this._pc.getTransceivers().forEach(g=>{g.mid||!g.sender.track||g.requested||(g.requested=!0,this.addTransceiver(g.sender.track.kind))})}_createAnswer(){this.destroyed||this._pc.createAnswer(this.answerOptions).then(g=>{if(this.destroyed)return;this.trickle||this.allowHalfTrickle||(g.sdp=l(g.sdp)),g.sdp=this.sdpTransform(g.sdp);const _=()=>{if(!this.destroyed){const R=this._pc.localDescription||g;this._debug("signal"),this.emit("signal",{type:R.type,sdp:R.sdp}),this.initiator||this._requestMissingTransceivers()}};this._pc.setLocalDescription(g).then(()=>{this.destroyed||(this.trickle||this._iceComplete?_():this.once("_iceComplete",_))}).catch(R=>{this.destroy(v(R,"ERR_SET_LOCAL_DESCRIPTION"))})}).catch(g=>{this.destroy(v(g,"ERR_CREATE_ANSWER"))})}_onConnectionStateChange(){this.destroyed||this._pc.connectionState==="failed"&&this.destroy(v(new Error("Connection failed."),"ERR_CONNECTION_FAILURE"))}_onIceStateChange(){if(this.destroyed)return;const g=this._pc.iceConnectionState,_=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",g,_),this.emit("iceStateChange",g,_),(g==="connected"||g==="completed")&&(this._pcReady=!0,this._maybeReady()),g==="failed"&&this.destroy(v(new Error("Ice connection failed."),"ERR_ICE_CONNECTION_FAILURE")),g==="closed"&&this.destroy(v(new Error("Ice connection closed."),"ERR_ICE_CONNECTION_CLOSED"))}getStats(g){const _=R=>(Object.prototype.toString.call(R.values)==="[object Array]"&&R.values.forEach(M=>{Object.assign(R,M)}),R);this._pc.getStats.length===0||this._isReactNativeWebrtc?this._pc.getStats().then(R=>{const M=[];R.forEach(I=>{M.push(_(I))}),g(null,M)},R=>g(R)):0<this._pc.getStats.length?this._pc.getStats(R=>{if(this.destroyed)return;const M=[];R.result().forEach(I=>{const x={};I.names().forEach(K=>{x[K]=I.stat(K)}),x.id=I.id,x.type=I.type,x.timestamp=I.timestamp,M.push(_(x))}),g(null,M)},R=>g(R)):g(null,[])}_maybeReady(){if(this._debug("maybeReady pc %s channel %s",this._pcReady,this._channelReady),this._connected||this._connecting||!this._pcReady||!this._channelReady)return;this._connecting=!0;const g=()=>{this.destroyed||this.getStats((_,R)=>{if(this.destroyed)return;_&&(R=[]);const M={},I={},x={};let K=!1;R.forEach(B=>{(B.type==="remotecandidate"||B.type==="remote-candidate")&&(M[B.id]=B),(B.type==="localcandidate"||B.type==="local-candidate")&&(I[B.id]=B),(B.type==="candidatepair"||B.type==="candidate-pair")&&(x[B.id]=B)});const L=B=>{K=!0;let O=I[B.localCandidateId];O&&(O.ip||O.address)?(this.localAddress=O.ip||O.address,this.localPort=+O.port):O&&O.ipAddress?(this.localAddress=O.ipAddress,this.localPort=+O.portNumber):typeof B.googLocalAddress=="string"&&(O=B.googLocalAddress.split(":"),this.localAddress=O[0],this.localPort=+O[1]),this.localAddress&&(this.localFamily=this.localAddress.includes(":")?"IPv6":"IPv4");let ne=M[B.remoteCandidateId];ne&&(ne.ip||ne.address)?(this.remoteAddress=ne.ip||ne.address,this.remotePort=+ne.port):ne&&ne.ipAddress?(this.remoteAddress=ne.ipAddress,this.remotePort=+ne.portNumber):typeof B.googRemoteAddress=="string"&&(ne=B.googRemoteAddress.split(":"),this.remoteAddress=ne[0],this.remotePort=+ne[1]),this.remoteAddress&&(this.remoteFamily=this.remoteAddress.includes(":")?"IPv6":"IPv4"),this._debug("connect local: %s:%s remote: %s:%s",this.localAddress,this.localPort,this.remoteAddress,this.remotePort)};if(R.forEach(B=>{B.type==="transport"&&B.selectedCandidatePairId&&L(x[B.selectedCandidatePairId]),(B.type==="googCandidatePair"&&B.googActiveConnection==="true"||(B.type==="candidatepair"||B.type==="candidate-pair")&&B.selected)&&L(B)}),!K&&(!Object.keys(x).length||Object.keys(I).length))return void setTimeout(g,100);if(this._connecting=!1,this._connected=!0,this._chunk){try{this.send(this._chunk)}catch(O){return this.destroy(v(O,"ERR_DATA_CHANNEL"))}this._chunk=null,this._debug('sent chunk from "write before connect"');const B=this._cb;this._cb=null,B(null)}typeof this._channel.bufferedAmountLowThreshold!="number"&&(this._interval=setInterval(()=>this._onInterval(),150),this._interval.unref&&this._interval.unref()),this._debug("connect"),this.emit("connect")})};g()}_onInterval(){this._cb&&this._channel&&!(this._channel.bufferedAmount>F)&&this._onChannelBufferedAmountLow()}_onSignalingStateChange(){this.destroyed||(this._pc.signalingState==="stable"&&(this._isNegotiating=!1,this._debug("flushing sender queue",this._sendersAwaitingStable),this._sendersAwaitingStable.forEach(g=>{this._pc.removeTrack(g),this._queuedNegotiation=!0}),this._sendersAwaitingStable=[],this._queuedNegotiation?(this._debug("flushing negotiation queue"),this._queuedNegotiation=!1,this._needsNegotiation()):(this._debug("negotiated"),this.emit("negotiated"))),this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState))}_onIceCandidate(g){this.destroyed||(g.candidate&&this.trickle?this.emit("signal",{type:"candidate",candidate:{candidate:g.candidate.candidate,sdpMLineIndex:g.candidate.sdpMLineIndex,sdpMid:g.candidate.sdpMid}}):!g.candidate&&!this._iceComplete&&(this._iceComplete=!0,this.emit("_iceComplete")),g.candidate&&this._startIceCompleteTimeout())}_onChannelMessage(g){if(this.destroyed)return;let _=g.data;_ instanceof ArrayBuffer&&(_=C.from(_)),this.push(_)}_onChannelBufferedAmountLow(){if(!this.destroyed&&this._cb){this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);const g=this._cb;this._cb=null,g(null)}}_onChannelOpen(){this._connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())}_onChannelClose(){this.destroyed||(this._debug("on channel close"),this.destroy())}_onTrack(g){this.destroyed||g.streams.forEach(_=>{this._debug("on track"),this.emit("track",g.track,_),this._remoteTracks.push({track:g.track,stream:_}),this._remoteStreams.some(R=>R.id===_.id)||(this._remoteStreams.push(_),T(()=>{this._debug("on stream"),this.emit("stream",_)}))})}_debug(){const g=[].slice.call(arguments);g[0]="["+this._id+"] "+g[0],p.apply(null,g)}}S.WEBRTC_SUPPORT=!!b(),S.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"},S.channelConfig={},a.exports=S},{buffer:3,debug:4,"err-code":6,"get-browser-rtc":8,"queue-microtask":13,randombytes:14,"readable-stream":29}]},{},[])("/")})})(xo);var Yu=xo.exports;const Vu=Bs(Yu),_t={RECONNECT_OFFER:"reconnect_offer",RECONNECT_ANSWER:"reconnect_answer",RECONNECT_REJECTION:"reconnect_rejection",PATH_QUERY:"path_query",PATH_RESPONSE:"path_response"},on={IDLE:"idle",QUERYING_PATH:"querying_path",PATH_FOUND:"path_found",SENDING_OFFER:"sending_offer",WAITING_ANSWER:"waiting_answer",CONNECTING:"connecting",CONNECTED:"connected",FAILED:"failed",REJECTED:"rejected"};class Qu{constructor(e,t,n,i){this.identity=e,this.router=t,this.peerManager=n,this.peerPersistence=i,this.pendingReconnects=new Map,this.pathQueryResponses=new Map,this.activeQueries=new Map,this.config={reconnectTimeout:3e4,pathQueryTimeout:5e3,answerTimeout:25e3,maxConcurrentReconnects:5,pathQueryTTL:7,offerTTL:10,cleanupInterval:6e4},this.stats={totalAttempts:0,successful:0,failed:0,rejected:0,timedOut:0,pathNotFound:0,offersReceived:0,answersReceived:0},this.registerHandlers(),this.startCleanup()}registerHandlers(){this.router.on(_t.RECONNECT_OFFER,e=>this.handleReconnectOffer(e)),this.router.on(_t.RECONNECT_ANSWER,e=>this.handleReconnectAnswer(e)),this.router.on(_t.RECONNECT_REJECTION,e=>this.handleReconnectRejection(e)),this.router.on(_t.PATH_QUERY,e=>this.handlePathQuery(e)),this.router.on(_t.PATH_RESPONSE,e=>this.handlePathResponse(e))}async reconnectViaMesh(e,t){if(this.stats.totalAttempts++,!e||!t)return{success:!1,reason:"invalid_parameters"};if(e===this.identity.uuid)return{success:!1,reason:"cannot_connect_to_self"};if(this.peerManager.peers.has(e))return{success:!1,reason:"already_connected"};if(this.pendingReconnects.size>=this.config.maxConcurrentReconnects)return{success:!1,reason:"too_many_concurrent_attempts"};try{if(!await this.findPathToTarget(e,this.config.pathQueryTimeout))return this.stats.pathNotFound++,this.peerPersistence&&await this.peerPersistence.incrementReconnectionAttempts(e),{success:!1,reason:"no_path_found"};const i=await this.createReconnectionPeer(!0,e,t),o=await this.sendOfferAndWaitForAnswer(i,e,t);return o.success?(this.stats.successful++,this.peerPersistence&&await this.peerPersistence.updateLastSeen(e)):(this.stats.failed++,this.peerPersistence&&await this.peerPersistence.incrementReconnectionAttempts(e)),o}catch(n){return console.error("[ReconnectionManager] Reconnection error:",n),this.stats.failed++,this.peerPersistence&&await this.peerPersistence.incrementReconnectionAttempts(e),{success:!1,reason:"error",error:n.message}}}async findPathToTarget(e,t=5e3){const n=this.generateId("query");return new Promise((i,o)=>{this.activeQueries.set(n,{targetPeerId:e,resolve:i,reject:o,startTime:Date.now()});const a=setTimeout(()=>{const f=this.pathQueryResponses.get(n),p=f&&f.size>0;this.activeQueries.delete(n),this.pathQueryResponses.delete(n),i(p)},t);this.activeQueries.get(n).timeout=a;const l=this.router.createMessage(_t.PATH_QUERY,{queryId:n,targetPeerId:e,queryOrigin:this.identity.uuid},{ttl:this.config.pathQueryTTL,routingHint:"broadcast"});this.router.routeMessage(l)})}handlePathQuery(e){const{queryId:t,targetPeerId:n,queryOrigin:i}=e.payload;if(i===this.identity.uuid)return;if(this.peerManager.peers.has(n)){const a=this.router.createMessage(_t.PATH_RESPONSE,{queryId:t,targetPeerId:n,relayPeerId:this.identity.uuid,relayName:this.identity.displayName,hopCount:e.hopCount||0},{targetPeerId:i,ttl:10});this.router.routeMessage(a)}}handlePathResponse(e){const{queryId:t,relayPeerId:n,relayName:i,hopCount:o}=e.payload;this.pathQueryResponses.has(t)||this.pathQueryResponses.set(t,new Set),this.pathQueryResponses.get(t).add({relayPeerId:n,relayName:i,hopCount:o,timestamp:Date.now()});const a=this.activeQueries.get(t);a&&(clearTimeout(a.timeout),a.resolve(!0),this.activeQueries.delete(t),setTimeout(()=>{this.pathQueryResponses.delete(t)},1e4))}async createReconnectionPeer(e,t,n){return new Promise((i,o)=>{const a=new Vu({initiator:e,trickle:!0,config:yt});let l=!1;a.on("signal",f=>{e&&f.type==="offer"&&!l&&(l=!0,i(a))}),a.on("error",f=>{console.error("[ReconnectionManager] Peer error:",f),!l&&e&&o(f)}),e||i(a),setTimeout(()=>{e&&!l&&o(new Error("Offer generation timeout"))},1e4)})}async sendOfferAndWaitForAnswer(e,t,n){const i=this.generateId("reconnect");return new Promise((o,a)=>{this.pendingReconnects.set(i,{targetPeerId:t,targetName:n,peer:e,resolve:o,reject:a,state:on.SENDING_OFFER,startTime:Date.now()});const l=setTimeout(()=>{this.stats.timedOut++,e.destroy(),this.pendingReconnects.delete(i),o({success:!1,reason:"timeout"})},this.config.reconnectTimeout);this.pendingReconnects.get(i).timeout=l,e.on("signal",f=>{if(f.type==="offer"){const p=this.router.createMessage(_t.RECONNECT_OFFER,{reconnectId:i,offer:btoa(JSON.stringify(f)),requesterPeerId:this.identity.uuid,requesterName:this.identity.displayName,timestamp:Date.now()},{targetPeerId:t,ttl:this.config.offerTTL,routingHint:"relay"});this.router.routeMessage(p);const b=this.pendingReconnects.get(i);b&&(b.state=on.WAITING_ANSWER)}}),e.on("connect",()=>{const f=this.pendingReconnects.get(i);f&&(clearTimeout(f.timeout),f.state=on.CONNECTED),this.peerManager.registerReconnectedPeer(t,n,e),this.pendingReconnects.delete(i),o({success:!0,method:"mesh_relay"})}),e.on("error",f=>{console.error("[ReconnectionManager] Peer connection error:",f);const p=this.pendingReconnects.get(i);p&&clearTimeout(p.timeout),this.pendingReconnects.delete(i),o({success:!1,reason:"peer_error",error:f.message})}),e.on("close",()=>{const f=this.pendingReconnects.get(i);f&&f.state!==on.CONNECTED&&(clearTimeout(f.timeout),this.pendingReconnects.delete(i),o({success:!1,reason:"connection_closed"}))})})}async handleReconnectOffer(e){const{reconnectId:t,offer:n,requesterPeerId:i,requesterName:o,timestamp:a}=e.payload;this.stats.offersReceived++;const l=Array.from(this.pendingReconnects.values()).find(f=>f.targetPeerId===i);if(l)if(this.identity.uuid>i){l.peer.destroy(),clearTimeout(l.timeout);for(const[p,b]of this.pendingReconnects.entries())if(b===l){this.pendingReconnects.delete(p);break}}else{this.sendRejection(t,i,"collision_detected");return}if(!this.shouldAcceptReconnection(i)){this.sendRejection(t,i,"declined");return}if(this.peerManager.peers.has(i)){this.sendRejection(t,i,"already_connected");return}try{const f=JSON.parse(atob(n)),p=await this.createReconnectionPeer(!1,i,o);p.on("connect",()=>{this.peerManager.registerReconnectedPeer(i,o,p),this.peerPersistence&&this.peerPersistence.updateLastSeen(i)}),p.on("error",b=>{console.error(`[ReconnectionManager] Error reconnecting with ${o}:`,b)}),p.on("signal",b=>{if(b.type==="answer"){const d=this.router.createMessage(_t.RECONNECT_ANSWER,{reconnectId:t,answer:btoa(JSON.stringify(b)),acceptorPeerId:this.identity.uuid,acceptorName:this.identity.displayName},{targetPeerId:i,ttl:this.config.offerTTL});this.router.routeMessage(d)}}),p.signal(f)}catch(f){console.error("[ReconnectionManager] Error handling offer:",f),this.sendRejection(t,i,"error")}}async handleReconnectAnswer(e){const{reconnectId:t,answer:n,acceptorPeerId:i,acceptorName:o}=e.payload;this.stats.answersReceived++;const a=this.pendingReconnects.get(t);if(a)try{const l=JSON.parse(atob(n));a.peer.signal(l),a.state=on.CONNECTING}catch(l){console.error("[ReconnectionManager] Error handling answer:",l),a.peer.destroy(),clearTimeout(a.timeout),this.pendingReconnects.delete(t),a.resolve&&a.resolve({success:!1,reason:"answer_error",error:l.message})}}handleReconnectRejection(e){const{reconnectId:t,reason:n}=e.payload;this.stats.rejected++;const i=this.pendingReconnects.get(t);i&&(i.peer.destroy(),clearTimeout(i.timeout),i.resolve&&i.resolve({success:!1,reason:"rejected",rejectionReason:n}),this.pendingReconnects.delete(t))}shouldAcceptReconnection(e){if(e===this.identity.uuid||this.peerManager.peers.has(e)||this.identity.uuid<e)return!1;const t=this.peerManager.getConnectedPeerCount(),n=this.peerManager.maxConnections||6;return!(t>=n)}sendRejection(e,t,n){const i=this.router.createMessage(_t.RECONNECT_REJECTION,{reconnectId:e,reason:n,rejectorPeerId:this.identity.uuid},{targetPeerId:t,ttl:10});this.router.routeMessage(i)}generateId(e="reconnect"){return`${e}-${this.identity.uuid.substring(0,8)}-${Date.now()}-${Math.random().toString(36).substr(2,6)}`}startCleanup(){this.cleanupTimer=setInterval(()=>{this.cleanup()},this.config.cleanupInterval)}cleanup(){const e=Date.now();for(const[t,n]of this.pathQueryResponses.entries()){const i=Math.min(...Array.from(n).map(o=>o.timestamp));e-i>6e4&&this.pathQueryResponses.delete(t)}for(const[t,n]of this.activeQueries.entries())e-n.startTime>3e4&&(clearTimeout(n.timeout),n.resolve(!1),this.activeQueries.delete(t));for(const[t,n]of this.pendingReconnects.entries())e-n.startTime>this.config.reconnectTimeout+1e4&&(clearTimeout(n.timeout),n.peer.destroy(),this.pendingReconnects.delete(t))}getStats(){return{...this.stats,pendingReconnects:this.pendingReconnects.size,activeQueries:this.activeQueries.size,successRate:this.stats.totalAttempts>0?(this.stats.successful/this.stats.totalAttempts*100).toFixed(1)+"%":"N/A"}}getState(){return{pendingReconnects:Array.from(this.pendingReconnects.entries()).map(([e,t])=>({reconnectId:e,targetPeerId:t.targetPeerId,targetName:t.targetName,state:t.state,elapsed:Date.now()-t.startTime})),activeQueries:Array.from(this.activeQueries.entries()).map(([e,t])=>({queryId:e,targetPeerId:t.targetPeerId,elapsed:Date.now()-t.startTime})),pathQueryResponses:Array.from(this.pathQueryResponses.entries()).map(([e,t])=>({queryId:e,responseCount:t.size,relays:Array.from(t).map(n=>n.relayName)}))}}stop(){this.cleanupTimer&&clearInterval(this.cleanupTimer);for(const[e,t]of this.pendingReconnects.entries())clearTimeout(t.timeout),t.peer.destroy(),t.resolve&&t.resolve({success:!1,reason:"stopped"});this.pendingReconnects.clear();for(const[e,t]of this.activeQueries.entries())clearTimeout(t.timeout),t.resolve(!1);this.activeQueries.clear(),this.pathQueryResponses.clear()}}const Qe={PERIODIC_INTERVAL:12e4,RECONNECTION_COOLDOWN:6e4,RECONNECTION_DELAY_MIN:1e3,RECONNECTION_DELAY_MAX:3e3,ANNOUNCEMENT_CACHE_SIZE:1e3,ANNOUNCEMENT_CACHE_TTL:3e5,CLEANUP_INTERVAL:6e4,DEFAULT_ANNOUNCEMENT_TTL:7,IP_CHANGE_ANNOUNCEMENT_TTL:10,MIN_PEERS_FOR_PERIODIC:1,REASONS:{REJOIN:"rejoin",IP_CHANGE:"ip_change",PERIODIC:"periodic",COLD_START_RECOVERY:"cold_start_recovery"}};class Xu{constructor(e,t,n,i,o){this.identity=e,this.router=t,this.peerManager=n,this.reconnectionAuth=i,this.peerPersistence=o,this.recentAnnouncements=new Map,this.reconnectAttempts=new Map,this.announcementInterval=null,this.stats={announcementsSent:0,announcementsReceived:0,duplicatesIgnored:0,reconnectionsInitiated:0,reconnectionsFailed:0},this.startCleanup()}initialize(){this.router.on("peer_announcement",e=>this.handlePeerAnnouncement(e)),this.router.on("ip_change_announcement",e=>this.handleIpChange(e))}async announcePresence(e=Qe.REASONS.REJOIN){try{const t=Array.from(this.peerManager.peers.keys()).filter(f=>{const p=this.peerManager.peers.get(f);return p&&p.status==="connected"}),n=this.getBestRelayPeer(),o={...await this.reconnectionAuth.createAnnouncement({reason:e,peerId:this.identity.peerId||this.identity.uuid,displayName:this.identity.displayName,timestamp:Date.now(),connectedPeers:t}),connectionHint:{preferredRelay:n,connectedPeers:t.slice(0,5)}},a=e===Qe.REASONS.IP_CHANGE?Qe.IP_CHANGE_ANNOUNCEMENT_TTL:Qe.DEFAULT_ANNOUNCEMENT_TTL,l=this.router.createMessage("peer_announcement",o,{ttl:a,routingHint:"broadcast"});return await this.router.routeMessage(l),this.stats.announcementsSent++,!0}catch(t){return console.error("[AnnouncementManager] Failed to announce presence:",t),!1}}async handlePeerAnnouncement(e){try{this.stats.announcementsReceived++;const t=e.payload,n=t.peerId,i=t.displayName||"Unknown";if(n===this.identity.peerId||n===this.identity.uuid)return;if(this.isDuplicateAnnouncement(n,t)){this.stats.duplicatesIgnored++;return}this.recordAnnouncement(n,t);const o=await this.reconnectionAuth.verifyAnnouncement(t);if(!o.valid){o.reason==="invalid_signature"&&console.error("[AnnouncementManager] SECURITY: Invalid signature detected - possible impersonation attempt");return}const a=await this.peerPersistence.getPeer(n);if(!this.shouldReconnectToPeer(n,a)||!this.shouldInitiate(n))return;const l=Qe.RECONNECTION_DELAY_MIN+Math.random()*(Qe.RECONNECTION_DELAY_MAX-Qe.RECONNECTION_DELAY_MIN);setTimeout(()=>{this.initiateReconnection(n,i,t.connectionHint)},l)}catch(t){console.error("[AnnouncementManager] Error handling peer announcement:",t)}}async announceIpChange(){try{const e=`ip-change-${Date.now()}`,t=Array.from(this.peerManager.peers.keys()).filter(l=>{const f=this.peerManager.peers.get(l);return f&&f.status==="connected"}),n=this.getBestRelayPeer(),o={...await this.reconnectionAuth.createAnnouncement({reason:Qe.REASONS.IP_CHANGE,peerId:this.identity.peerId||this.identity.uuid,displayName:this.identity.displayName,timestamp:Date.now(),challenge:e,connectedPeers:t}),connectionHint:{preferredRelay:n,connectedPeers:t.slice(0,5)}},a=this.router.createMessage("ip_change_announcement",o,{ttl:Qe.IP_CHANGE_ANNOUNCEMENT_TTL,routingHint:"broadcast"});return await this.router.routeMessage(a),this.stats.announcementsSent++,!0}catch(e){return console.error("[AnnouncementManager] Failed to announce IP change:",e),!1}}async handleIpChange(e){try{const t=e.payload,n=t.peerId,i=t.displayName||"Unknown";if(n===this.identity.peerId||n===this.identity.uuid)return;if(this.isDuplicateAnnouncement(n,t)){this.stats.duplicatesIgnored++;return}if(this.recordAnnouncement(n,t),!(await this.reconnectionAuth.verifyAnnouncement(t)).valid)return;const a=this.peerManager.peers.get(n);if(a&&a.status==="connected")return;const l=await this.peerPersistence.getPeer(n);if(!this.shouldReconnectToPeer(n,l)||!this.shouldInitiate(n))return;const f=Qe.RECONNECTION_DELAY_MIN/2+Math.random()*Qe.RECONNECTION_DELAY_MIN;setTimeout(()=>{this.initiateReconnection(n,i,t.connectionHint)},f)}catch(t){console.error("[AnnouncementManager] Error handling IP change:",t)}}startPeriodicAnnouncements(e=Qe.PERIODIC_INTERVAL){this.stopPeriodicAnnouncements(),this.announcementInterval=setInterval(async()=>{this.peerManager.getConnectedPeerCount()>=Qe.MIN_PEERS_FOR_PERIODIC&&await this.announcePresence(Qe.REASONS.PERIODIC)},e)}stopPeriodicAnnouncements(){this.announcementInterval&&(clearInterval(this.announcementInterval),this.announcementInterval=null)}shouldReconnectToPeer(e,t){const n=this.peerManager.peers.get(e);if(n&&(n.status==="connected"||n.status==="connecting"))return!1;const i=this.peerManager.getConnectedPeerCount(),o=this.peerManager.maxConnections||6;if(i>=o)return!1;const a=this.reconnectAttempts.get(e);return!(a&&Date.now()-a<Qe.RECONNECTION_COOLDOWN||t&&t.blacklistUntil&&t.blacklistUntil>Date.now())}shouldInitiate(e){return(this.identity.peerId||this.identity.uuid)<e}async initiateReconnection(e,t,n=null){try{this.reconnectAttempts.set(e,Date.now()),this.stats.reconnectionsInitiated++,await this.peerPersistence.updateLastSeen(e),typeof this.peerManager.reconnectToPeer=="function"?await this.peerManager.reconnectToPeer(e,t,n):this.peerManager.onReconnectionNeeded&&this.peerManager.onReconnectionNeeded(e,t,n)}catch(i){console.error(`[AnnouncementManager] Failed to reconnect to ${t}:`,i),this.stats.reconnectionsFailed++,await this.peerPersistence.incrementReconnectionAttempts(e)}}getBestRelayPeer(){let e=null,t=-1;for(const[n,i]of this.peerManager.peers.entries()){if(i.status!=="connected")continue;let o=100;if(i.latency&&(o-=Math.min(50,i.latency/10)),i.connectionType==="host"?o+=20:i.connectionType==="srflx"&&(o+=10),i.connectedAt){const a=Date.now()-i.connectedAt;o+=Math.min(20,a/6e4)}o>t&&(t=o,e=n)}return e}wasRecentlyConnected(e){const t=this.peerManager.peers.get(e);return!t||!t.disconnectedAt?!1:Date.now()-t.disconnectedAt<3e5}isDuplicateAnnouncement(e,t){const n=this.recentAnnouncements.get(e);return n?n.signature===t.signature||n.nonce===t.nonce||Math.abs(n.timestamp-t.timestamp)<1e3:!1}recordAnnouncement(e,t){this.recentAnnouncements.set(e,{timestamp:t.timestamp,signature:t.signature,nonce:t.nonce,recordedAt:Date.now()}),this.recentAnnouncements.size>Qe.ANNOUNCEMENT_CACHE_SIZE&&this.pruneOldestAnnouncements(100)}pruneOldestAnnouncements(e){const t=Array.from(this.recentAnnouncements.entries()).sort((n,i)=>n[1].recordedAt-i[1].recordedAt);for(let n=0;n<e&&n<t.length;n++)this.recentAnnouncements.delete(t[n][0])}cleanupOldAnnouncements(){const e=Date.now();for(const[t,n]of this.recentAnnouncements.entries())e-n.recordedAt>Qe.ANNOUNCEMENT_CACHE_TTL&&this.recentAnnouncements.delete(t)}startCleanup(){this.cleanupTimer=setInterval(()=>{this.cleanupOldAnnouncements()},Qe.CLEANUP_INTERVAL)}getStats(){return{...this.stats,cachedAnnouncements:this.recentAnnouncements.size,reconnectCooldowns:this.reconnectAttempts.size,periodicActive:!!this.announcementInterval}}destroy(){this.stopPeriodicAnnouncements(),this.cleanupTimer&&(clearInterval(this.cleanupTimer),this.cleanupTimer=null),this.recentAnnouncements.clear(),this.reconnectAttempts.clear()}}const Ae={KEYS:{PEERS_INDEX:"mesh:peers:index",PEER_PREFIX:"mesh:peer:",METADATA:"mesh:peers:metadata",ENCRYPTION_KEY:"mesh:encryption:key",SCHEMA_VERSION:"mesh:schema:version"},MAX_PEERS:100,MAX_STORAGE_MB:5,CLEANUP_THRESHOLD:.8,RETENTION:{ACTIVE_DAYS:7,INACTIVE_DAYS:30,FAILED_ATTEMPTS:5,BLACKLIST_DURATION:24*60*60*1e3},CURRENT_VERSION:"1.0.0"};class Ju{constructor(){this.masterKey=null,this.algorithm={name:"AES-GCM",length:256}}async getMasterKey(){if(this.masterKey)return this.masterKey;const e=localStorage.getItem(Ae.KEYS.ENCRYPTION_KEY);if(e){const t=JSON.parse(e);this.masterKey=await crypto.subtle.importKey("jwk",t,this.algorithm,!0,["encrypt","decrypt"])}else{this.masterKey=await crypto.subtle.generateKey(this.algorithm,!0,["encrypt","decrypt"]);const t=await crypto.subtle.exportKey("jwk",this.masterKey);localStorage.setItem(Ae.KEYS.ENCRYPTION_KEY,JSON.stringify(t))}return this.masterKey}async encrypt(e){const t=await this.getMasterKey(),n=crypto.getRandomValues(new Uint8Array(12)),i=new TextEncoder().encode(e),o=await crypto.subtle.encrypt({name:"AES-GCM",iv:n},t,i),a=new Uint8Array(n.length+o.byteLength);return a.set(n),a.set(new Uint8Array(o),n.length),btoa(String.fromCharCode(...a))}async decrypt(e){try{const t=await this.getMasterKey(),n=Uint8Array.from(atob(e),l=>l.charCodeAt(0)),i=n.slice(0,12),o=n.slice(12),a=await crypto.subtle.decrypt({name:"AES-GCM",iv:i},t,o);return new TextDecoder().decode(a)}catch(t){return console.error("[Encryption] Decryption failed:",t),null}}clearKey(){this.masterKey=null,localStorage.removeItem(Ae.KEYS.ENCRYPTION_KEY)}}const kr=new Ju;class Zu{constructor(){this.initialized=!1}async initialize(){this.initialized||(await this.checkAndMigrate(),await this.loadMetadata(),this.initialized=!0)}async storePeer(e){try{await this.initialize();const t={...e};e.sharedSecret&&(t.encryptedSecret=await kr.encrypt(e.sharedSecret),delete t.sharedSecret),t.dataVersion=Ae.CURRENT_VERSION;const n=Ae.KEYS.PEER_PREFIX+e.peerId;return localStorage.setItem(n,JSON.stringify(t)),await this.addToIndex(e.peerId),await this.updateMetadata(),!0}catch(t){return console.error("[PeerPersistence] Failed to store peer:",t),!1}}async getPeer(e){try{await this.initialize();const t=Ae.KEYS.PEER_PREFIX+e,n=localStorage.getItem(t);if(!n)return null;const i=JSON.parse(n);return i.encryptedSecret&&(i.sharedSecret=await kr.decrypt(i.encryptedSecret),delete i.encryptedSecret),i}catch(t){return console.error("[PeerPersistence] Failed to get peer:",t),null}}async removePeer(e){try{await this.initialize();const t=Ae.KEYS.PEER_PREFIX+e;return localStorage.removeItem(t),await this.removeFromIndex(e),await this.updateMetadata(),!0}catch(t){return console.error("[PeerPersistence] Failed to remove peer:",t),!1}}async updateLastSeen(e){const t=await this.getPeer(e);return t?(t.lastSeen=Date.now(),await this.storePeer(t)):!1}async updateConnectionQuality(e,t){const n=await this.getPeer(e);return n?(n.connectionQuality={...n.connectionQuality,...t,lastMeasured:Date.now()},n.lastConnected=Date.now(),n.reconnectionAttempts=0,await this.storePeer(n)):!1}async incrementReconnectionAttempts(e){const t=await this.getPeer(e);return t?(t.reconnectionAttempts=(t.reconnectionAttempts||0)+1,!(t.connectionQuality&&t.connectionQuality.successfulConnections>0)&&t.reconnectionAttempts>=Ae.RETENTION.FAILED_ATTEMPTS&&(t.blacklistUntil=Date.now()+Ae.RETENTION.BLACKLIST_DURATION),await this.storePeer(t)):!1}async updatePeerPublicKey(e,t){const n=await this.getPeer(e);return n?(n.publicKey=JSON.stringify(t),await this.storePeer(n)):!1}async updatePeerSharedSecret(e,t){const n=await this.getPeer(e);return n?(n.sharedSecret=t,await this.storePeer(n)):!1}async updatePeer(e,t){const n=await this.getPeer(e);return n?(Object.assign(n,t),await this.storePeer(n)):!1}async getAllPeerIds(){await this.initialize();const e=localStorage.getItem(Ae.KEYS.PEERS_INDEX);return e?JSON.parse(e):[]}async queryPeers(e={}){const{sortBy:t="lastSeen",order:n="desc",limit:i=null,minQuality:o=0,maxAge:a=null,excludeBlacklisted:l=!0}=e;await this.initialize();const f=await this.getAllPeerIds(),p=[],b=Date.now();for(const d of f){const w=await this.getPeer(d);if(!w||l&&w.blacklistUntil&&w.blacklistUntil>b||a&&b-w.lastSeen>a)continue;const T=this.calculateQualityScore(w);T<o||p.push({...w,_qualityScore:T})}return p.sort((d,w)=>{let T=0;switch(t){case"quality":T=(w._qualityScore||0)-(d._qualityScore||0);break;case"lastConnected":T=(w.lastConnected||0)-(d.lastConnected||0);break;case"lastSeen":default:T=(w.lastSeen||0)-(d.lastSeen||0);break}return n==="asc"?-T:T}),i?p.slice(0,i):p}async getReconnectionCandidates(e={}){const{limit:t=10,maxAge:n=7*24*60*60*1e3,minQuality:i=0}=e,a=(await this.queryPeers({sortBy:"quality",limit:t*2,maxAge:n,minQuality:i,excludeBlacklisted:!0})).map(l=>({peer:l,score:this.calculateReconnectionScore(l),reason:this.getReconnectionReason(l)}));return a.sort((l,f)=>f.score-l.score),a.slice(0,t)}calculateQualityScore(e){let t=0;const n=e.connectionQuality;return n?(n.latency!==null&&n.latency!==void 0&&(n.latency<50?t+=40:n.latency<100?t+=35:n.latency<200?t+=25:n.latency<500?t+=15:n.latency<1e3&&(t+=5)),n.successRate!==null&&n.successRate!==void 0&&(t+=Math.floor(n.successRate*30)),n.connectionType&&(n.connectionType==="host"?t+=20:n.connectionType==="srflx"?t+=12:n.connectionType==="relay"&&(t+=5)),n.avgUptime!==null&&n.avgUptime!==void 0&&(n.avgUptime>600?t+=10:n.avgUptime>300?t+=7:n.avgUptime>60&&(t+=4)),Math.min(100,Math.max(0,t))):0}calculateReconnectionScore(e){const t=Date.now(),n=e.connectionQuality||{};let i=this.calculateQualityScore(e)*.4;const o=(t-e.lastSeen)/(1e3*60*60*24);if(o<1?i+=30:o<3?i+=20:o<7&&(i+=10),n.successfulConnections){const l=Math.min(20,n.successfulConnections*2);i+=l}const a=e.reconnectionAttempts/(n.totalConnections||1);return a<.1?i+=10:a<.3&&(i+=5),i-=e.reconnectionAttempts*5,Math.min(100,Math.max(0,i))}getReconnectionReason(e){const t=e.connectionQuality||{},n=[];return t.latency&&t.latency<100&&n.push("low-latency"),t.connectionType==="host"&&n.push("direct-connection"),t.successRate>.8&&n.push("reliable"),(Date.now()-e.lastSeen)/(1e3*60*60*24)<1&&n.push("recently-active"),n.length>0?n.join(", "):"available"}async cleanupStalePeers(){await this.initialize();const e=Date.now(),t=await this.getAllPeerIds();let n=0;for(const o of t){const a=await this.getPeer(o);if(!a)continue;let l=!1;(e-a.lastSeen)/(1e3*60*60*24)>Ae.RETENTION.INACTIVE_DAYS&&(l=!0),a.reconnectionAttempts>=Ae.RETENTION.FAILED_ATTEMPTS&&(!a.blacklistUntil||a.blacklistUntil<e)&&(l=!0),l&&(await this.removePeer(o),n++)}const i=await this.getAllPeerIds();if(i.length>Ae.MAX_PEERS){const o=i.length-Ae.MAX_PEERS;await this.cleanupLRU(o),n+=o}return await this.updateMetadata({lastCleanup:e}),n}async cleanupLRU(e){const t=await this.queryPeers({sortBy:"lastSeen",order:"asc",limit:e});let n=0;for(const i of t)await this.removePeer(i.peerId),n++;return n}async clearExpiredBlacklists(){await this.initialize();const e=Date.now(),t=await this.getAllPeerIds();let n=0;for(const i of t){const o=await this.getPeer(i);o&&o.blacklistUntil&&o.blacklistUntil<e&&(o.blacklistUntil=null,o.reconnectionAttempts=0,await this.storePeer(o),n++)}return n}async getStorageStats(){await this.initialize();const e=await this.getAllPeerIds();let t=0;for(const i of e){const o=Ae.KEYS.PEER_PREFIX+i,a=localStorage.getItem(o);a&&(t+=a.length*2)}const n=await this.getMetadata();return{peerCount:e.length,estimatedSizeBytes:t,estimatedSizeMB:(t/1024/1024).toFixed(2),maxPeers:Ae.MAX_PEERS,utilizationPercent:(e.length/Ae.MAX_PEERS*100).toFixed(1),lastCleanup:n.lastCleanup}}async needsCleanup(){const e=await this.getStorageStats(),t=await this.getMetadata();return e.peerCount>=Ae.MAX_PEERS*Ae.CLEANUP_THRESHOLD||(Date.now()-t.lastCleanup)/(1e3*60*60*24)>1}async addToIndex(e){const t=await this.getAllPeerIds();t.includes(e)||(t.push(e),localStorage.setItem(Ae.KEYS.PEERS_INDEX,JSON.stringify(t)))}async removeFromIndex(e){const n=(await this.getAllPeerIds()).filter(i=>i!==e);localStorage.setItem(Ae.KEYS.PEERS_INDEX,JSON.stringify(n))}async loadMetadata(){const e=localStorage.getItem(Ae.KEYS.METADATA);if(e)return JSON.parse(e);const t={lastCleanup:Date.now(),totalPeers:0,estimatedSize:0,statistics:{totalReconnections:0,successfulReconnections:0,failedReconnections:0}};return localStorage.setItem(Ae.KEYS.METADATA,JSON.stringify(t)),t}async getMetadata(){return await this.loadMetadata()}async updateMetadata(e={}){const t=await this.loadMetadata(),n=await this.getStorageStats(),i={...t,...e,totalPeers:n.peerCount,estimatedSize:n.estimatedSizeBytes};localStorage.setItem(Ae.KEYS.METADATA,JSON.stringify(i))}async checkAndMigrate(){const e=localStorage.getItem(Ae.KEYS.SCHEMA_VERSION);if(!e){localStorage.setItem(Ae.KEYS.SCHEMA_VERSION,Ae.CURRENT_VERSION);return}e!==Ae.CURRENT_VERSION&&await this.migrate(e,Ae.CURRENT_VERSION)}async migrate(e,t){localStorage.setItem(Ae.KEYS.SCHEMA_VERSION,t)}async clearAll(){const e=await this.getAllPeerIds();for(const t of e){const n=Ae.KEYS.PEER_PREFIX+t;localStorage.removeItem(n)}localStorage.removeItem(Ae.KEYS.PEERS_INDEX),localStorage.removeItem(Ae.KEYS.METADATA),kr.clearKey()}async exportData(){await this.initialize();const e=await this.getAllPeerIds(),t=[];for(const n of e){const i=await this.getPeer(n);if(i){const o={...i};delete o.sharedSecret,t.push(o)}}return{version:Ae.CURRENT_VERSION,exportDate:Date.now(),peers:t}}async importData(e){let t=0;for(const n of e.peers)try{await this.storePeer(n),t++}catch(i){console.error("[PeerPersistence] Failed to import peer:",i)}return t}}const ft={RECENT_PEERS:{MAX_AGE_MS:5*60*1e3,MAX_ATTEMPTS:5,TIMEOUT_MS:1e4},KNOCK:{MAX_ATTEMPTS:3,TIMEOUT_MS:5e3,ENABLED:!0},ALL_PEERS:{MAX_AGE_MS:24*60*60*1e3,MAX_ATTEMPTS:10,TIMEOUT_MS:15e3},FALLBACK:{CHECK_SAVED_PASSPHRASE:!1,SHOW_PAIRING_UI:!0},WARM_MESH:{DELAY_MS:2e3,WAIT_FOR_MESH_MS:1e4},MAX_TOTAL_TIME_MS:4e4};class ef{constructor(e,t,n,i=null,o=null){this.identity=e,this.peerManager=t,this.peerPersistence=n,this.directReconnect=i,this.announcements=o,this.isRecovering=!1,this.recoveryStartTime=null,this.currentLayer=null,this.attemptLog=[]}async handleColdStart(){if(this.isRecovering)return{success:!1,reason:"recovery_in_progress"};this.isRecovering=!0,this.recoveryStartTime=Date.now(),this.attemptLog=[];try{this.currentLayer="recent_peers";const e=await this.tryRecentPeers();if(e.connected>0)return this.logAttempt("recent_peers",!0,e.connected),await this.useWarmMeshForRest(),this.isRecovering=!1,{success:!0,method:"recent_peers",connected:e.connected,duration:Date.now()-this.recoveryStartTime};if(this.logAttempt("recent_peers",!1,0),ft.KNOCK.ENABLED){this.currentLayer="knock_protocol";const i=await this.tryKnockProtocol();if(i.connected>0)return this.logAttempt("knock_protocol",!0,i.connected),await this.useWarmMeshForRest(),this.isRecovering=!1,{success:!0,method:"knock_protocol",connected:i.connected,duration:Date.now()-this.recoveryStartTime};this.logAttempt("knock_protocol",!1,0)}this.currentLayer="all_known_peers";const t=await this.tryAllKnownPeers();if(t.connected>0)return this.logAttempt("all_known_peers",!0,t.connected),await this.useWarmMeshForRest(),this.isRecovering=!1,{success:!0,method:"all_known_peers",connected:t.connected,duration:Date.now()-this.recoveryStartTime};this.logAttempt("all_known_peers",!1,0),this.currentLayer="initial_pairing";const n=await this.fallbackToInitialPairing();return n.success?(this.logAttempt("initial_pairing",!0,1),this.isRecovering=!1,{success:!0,method:n.method||"initial_pairing",fallbackRequired:!0,duration:Date.now()-this.recoveryStartTime}):(this.currentLayer="failed",this.logAttempt("complete_failure",!1,0),this.printRecoveryLog(),this.isRecovering=!1,{success:!1,reason:"all_methods_failed",fallbackRequired:!0,duration:Date.now()-this.recoveryStartTime})}catch(e){return console.error("[ColdStart] Recovery error:",e),this.isRecovering=!1,{success:!1,reason:"recovery_exception",error:e.message}}}async tryRecentPeers(){const e=await this.getRecentlyConnectedPeers(ft.RECENT_PEERS.MAX_AGE_MS);if(e.length===0)return{connected:0,peers:[]};const t=e.slice(0,ft.RECENT_PEERS.MAX_ATTEMPTS);return await this.tryDirectReconnections(t,ft.RECENT_PEERS.TIMEOUT_MS)}async tryKnockProtocol(e=null,t=ft.KNOCK.TIMEOUT_MS){if(e||(e=(await this.getRecentlyConnectedPeers(ft.RECENT_PEERS.MAX_AGE_MS)).slice(0,ft.KNOCK.MAX_ATTEMPTS)),e.length===0)return{connected:0};const n=e.map(a=>this.sendKnock(a,t).catch(l=>({success:!1,reason:"exception",error:l,peerId:a.peerId}))),o=(await Promise.allSettled(n)).filter(a=>a.status==="fulfilled"&&a.value.success).map(a=>a.value);if(o.length>0){const a=e.filter(l=>o.some(f=>f.peerId===l.peerId));return await this.tryDirectReconnections(a,t*2)}return{connected:0}}async sendKnock(e,t){return new Promise(n=>{const i=new RTCPeerConnection(yt),o=setTimeout(()=>{i.close(),n({success:!1,reason:"knock_timeout"})},t);i.oniceconnectionstatechange=()=>{i.iceConnectionState==="connected"?(clearTimeout(o),i.close(),n({success:!0,peerId:e.peerId})):(i.iceConnectionState==="failed"||i.iceConnectionState==="closed")&&(clearTimeout(o),i.close(),n({success:!1,reason:"knock_failed",state:i.iceConnectionState}))},i.createDataChannel("knock"),e.cachedCandidates&&e.cachedCandidates.length>0?i.createOffer().then(a=>i.setLocalDescription(a)).then(()=>{e.cachedCandidates.forEach(a=>{try{i.addIceCandidate(new RTCIceCandidate(a))}catch{}})}).catch(a=>{clearTimeout(o),i.close(),n({success:!1,reason:"knock_error",error:a.message})}):i.createOffer().then(a=>i.setLocalDescription(a)).catch(a=>{clearTimeout(o),i.close(),n({success:!1,reason:"no_cached_data",error:a.message})})})}async tryAllKnownPeers(){const e=await this.getAllKnownPeers();if(e.length===0)return{connected:0,peers:[]};const t=e.slice(0,ft.ALL_PEERS.MAX_ATTEMPTS);return await this.tryDirectReconnections(t,ft.ALL_PEERS.TIMEOUT_MS)}async tryDirectReconnections(e,t){if(e.length===0)return{connected:0,peers:[]};if(this.directReconnect){const n=e.map(a=>this.directReconnect.attemptDirectReconnection(a.peerId,t).then(l=>({...l,peerId:a.peerId,peerName:a.displayName})).catch(l=>({success:!1,reason:"exception",error:l.message,peerId:a.peerId}))),o=(await Promise.allSettled(n)).filter(a=>a.status==="fulfilled"&&a.value.success).map(a=>a.value);return o.length>0?(setTimeout(()=>{this.useWarmMeshForRest()},ft.WARM_MESH.DELAY_MS),{connected:o.length,peers:o}):{connected:0,peers:[]}}return await this.tryBasicReconnection(e,t)}async tryBasicReconnection(e,t){const n=e.map(a=>this.attemptBasicConnection(a,t).catch(l=>({success:!1,reason:"exception",error:l.message,peerId:a.peerId}))),o=(await Promise.allSettled(n)).filter(a=>a.status==="fulfilled"&&a.value.success).map(a=>a.value);return o.length>0?{connected:o.length,peers:o}:{connected:0,peers:[]}}async attemptBasicConnection(e,t){return new Promise(n=>{const i=setTimeout(()=>{n({success:!1,reason:"timeout",peerId:e.peerId})},t);clearTimeout(i),n({success:!1,reason:"no_signaling_available",peerId:e.peerId})})}async useWarmMeshForRest(){if(this.announcements)try{await this.announcements.announcePresence("cold_start_recovery")}catch(e){console.error("[ColdStart] Failed to announce presence:",e)}await new Promise(e=>setTimeout(e,ft.WARM_MESH.WAIT_FOR_MESH_MS))}async fallbackToInitialPairing(){return this.showManualPairingUI(),{success:!1,reason:"manual_intervention_required"}}showManualPairingUI(){if(typeof window>"u")return;const e=new CustomEvent("show-pairing-ui",{detail:{reason:"cold_start_failed",attemptLog:this.attemptLog,duration:Date.now()-this.recoveryStartTime}});window.dispatchEvent(e)}async getRecentlyConnectedPeers(e=3e5){try{const t=await this.peerPersistence.getReconnectionCandidates({limit:20,maxAge:e,minQuality:0});return t.length===0?[]:t.map(i=>i.peer).map(i=>({...i,_coldStartScore:this.calculateColdStartScore(i)})).sort((i,o)=>o._coldStartScore-i._coldStartScore)}catch(t){return console.error("[ColdStart] Error getting recent peers:",t),[]}}async getAllKnownPeers(){try{const e=ft.ALL_PEERS.MAX_AGE_MS,t=await this.peerPersistence.getReconnectionCandidates({limit:50,maxAge:e,minQuality:0});return t.length===0?[]:t.map(i=>i.peer).map(i=>({...i,_coldStartScore:this.calculateColdStartScore(i)})).sort((i,o)=>o._coldStartScore-i._coldStartScore)}catch(e){return console.error("[ColdStart] Error getting all known peers:",e),[]}}calculateColdStartScore(e){let t=0;const i=Date.now()-(e.lastConnected||e.lastSeen||0);i<3e5?t+=50:i<6e5?t+=40:i<18e5?t+=30:i<36e5?t+=20:i<72e5&&(t+=10);const o=e.connectionQuality||{};o.connectionType==="host"?t+=30:o.connectionType==="srflx"?t+=20:o.connectionType==="relay"&&(t+=5),o.successRate!==void 0&&o.successRate!==null&&(t+=Math.floor(o.successRate*15)),e.cachedCandidates&&e.cachedCandidates.length>0&&(t+=5);const a=e.reconnectionAttempts||0;return t-=a*2,Math.min(100,Math.max(0,t))}logAttempt(e,t,n){const i={layer:e,success:t,connected:n,timestamp:Date.now(),elapsed:Date.now()-this.recoveryStartTime};this.attemptLog.push(i)}printRecoveryLog(){}getStats(){return{isRecovering:this.isRecovering,currentLayer:this.currentLayer,attemptLog:this.attemptLog,totalAttempts:this.attemptLog.length,successfulAttempts:this.attemptLog.filter(e=>e.success).length,elapsedTime:this.recoveryStartTime?Date.now()-this.recoveryStartTime:0}}}const tf={TIMEOUTS:{DIRECT:2e3,MESH_RELAY:2e4,TOTAL_PER_PEER:22e3},WARM_START:{MAX_PEERS_TO_RECONNECT:10,PARALLEL_ATTEMPTS:!1,EARLY_EXIT_THRESHOLD:null,ANNOUNCEMENT_DELAY:1e3,TOPOLOGY_DISCOVERY_TIMEOUT:5e3},COLD_START:{MAX_DURATION:4e4,AUTO_FALLBACK:!0},POST_RECONNECTION:{ENABLE_PERIODIC_ANNOUNCEMENTS:!0,ENABLE_TOPOLOGY_DISCOVERY:!0,UPDATE_PERSISTENCE:!0,ENABLE_PERIODIC_RECONNECTION:!0},PERIODIC_RECONNECTION:{INTERVAL:3e5,MAX_ATTEMPTS_PER_CYCLE:3,MIN_CONNECTIONS_TO_ENABLE:1,SKIP_IF_RECONNECTING:!0},LIMITS:{MIN_PEERS_FOR_WARM_START:1,CONNECTION_CHECK_RETRIES:3,CONNECTION_CHECK_DELAY:500},STATS:{TRACK_ATTEMPTS:!0,TRACK_DURATIONS:!0,TRACK_SUCCESS_RATES:!0}};class nf{constructor(e,t,n,i,o,a={}){this.identity=e,this.router=t,this.peerManager=n,this.peerPersistence=i,this.reconnectionAuth=o,this.config={...tf,...a},this.directReconnect=new Gu(e,n,i),this.meshReconnect=new Qu(e,t,n,i),this.announcements=new Xu(e,t,n,o,i),this.coldStart=new ef(e,n,i,this.directReconnect,this.announcements),this.topology=null,this.stats={totalAttempts:0,successfulReconnections:0,failedReconnections:0,coldStarts:0,warmStarts:0,totalDuration:0,averageDuration:0,lastReconnectionTime:null,methodBreakdown:{direct_cached:0,mesh_relay:0,cold_start:0,failed:0}},this.isReconnecting=!1,this.lastReconnectionResult=null,this.periodicReconnectTimer=null}async reconnectToMesh(){if(this.isReconnecting)return{success:!1,method:"concurrent_attempt_blocked",peersConnected:0,duration:0,attempts:[]};this.isReconnecting=!0,this.stats.totalAttempts++;const e=Date.now(),t={success:!1,method:null,peersConnected:0,duration:0,attempts:[]};try{const n=await this.getCurrentConnectionCount();if(n===0){this.stats.coldStarts++,t.attempts.push("cold_start");const l=await this.coldStart.handleColdStart();return l.success?(t.success=!0,t.method=l.method||"cold_start",t.peersConnected=l.connected||1,t.duration=Date.now()-e,this.stats.successfulReconnections++,this.stats.methodBreakdown.cold_start++,await this.postReconnectionSetup()):(t.success=!1,t.method="cold_start_failed",t.fallbackRequired=l.fallbackRequired||!0,t.duration=Date.now()-e,this.stats.failedReconnections++,this.stats.methodBreakdown.failed++,this.config.COLD_START.AUTO_FALLBACK&&l.fallbackRequired&&await this.coldStart.fallbackToInitialPairing()),this.isReconnecting=!1,this.lastReconnectionResult=t,this.updateStatistics(t),t}if(this.stats.warmStarts++,t.attempts.push("announcement"),await new Promise(l=>setTimeout(l,this.config.WARM_START.ANNOUNCEMENT_DELAY)),await this.announcements.announcePresence("rejoin"),this.topology&&this.config.WARM_START.ENABLE_TOPOLOGY_DISCOVERY){t.attempts.push("topology_discovery");try{await Promise.race([this.topology.discoverTopology(),new Promise((l,f)=>setTimeout(()=>f(new Error("topology_timeout")),this.config.WARM_START.TOPOLOGY_DISCOVERY_TIMEOUT))])}catch{}}const i=await this.getDesiredPeers();if(i.length===0)return t.success=!0,t.method="warm_reconnection",t.peersConnected=n,t.duration=Date.now()-e,this.isReconnecting=!1,this.lastReconnectionResult=t,this.updateStatistics(t),t;t.attempts.push("peer_reconnection");let o=0;const a=Math.min(i.length,this.config.WARM_START.MAX_PEERS_TO_RECONNECT);for(let l=0;l<a;l++){const f=i[l];if(this.peerManager.peers.has(f.peerId))continue;const p=await this.reconnectToPeer(f);if(p.success&&(o++,this.stats.methodBreakdown[p.method]!==void 0&&this.stats.methodBreakdown[p.method]++,this.config.WARM_START.EARLY_EXIT_THRESHOLD&&o>=this.config.WARM_START.EARLY_EXIT_THRESHOLD))break}t.success=!0,t.method="warm_reconnection",t.peersConnected=o,t.duration=Date.now()-e,o>0&&this.stats.successfulReconnections++}catch(n){console.error("[MasterReconnection] Unexpected error:",n),t.success=!1,t.method="error",t.error=n.message,t.duration=Date.now()-e,this.stats.failedReconnections++,this.stats.methodBreakdown.failed++}finally{this.isReconnecting=!1,this.lastReconnectionResult=t,this.updateStatistics(t)}return t}async reconnectToPeer(e){const t=Date.now(),n=[{name:"direct_cached",timeout:this.config.TIMEOUTS.DIRECT,fn:()=>this.directReconnect.attemptDirectReconnection(e.peerId,this.config.TIMEOUTS.DIRECT)},{name:"mesh_relay",timeout:this.config.TIMEOUTS.MESH_RELAY,fn:()=>this.meshReconnect.reconnectViaMesh(e.peerId,e.displayName)}];for(const i of n){try{if((await i.fn()).success)return{success:!0,method:i.name,duration:Date.now()-t}}catch{}if(Date.now()-t>=this.config.TIMEOUTS.TOTAL_PER_PEER)break}return{success:!1,reason:"all_strategies_failed",duration:Date.now()-t}}async handlePeerDisconnected(e){try{const t=await this.peerPersistence.getPeer(e);if(!t)return;await new Promise(o=>setTimeout(o,1e3));const n=this.peerManager.peers.get(e);if(n&&n.status==="connected")return;n&&(n.peer&&!n.peer.destroyed&&n.peer.destroy(),this.peerManager.peers.delete(e)),(await this.meshReconnect.reconnectViaMesh(e,t.displayName)).success||await this.peerPersistence.incrementReconnectionAttempts(e)}catch(t){console.error(`[MasterReconnection] Error handling peer disconnection for ${e.substring(0,8)}:`,t)}}async handleIpChange(){try{return await this.announcements.announceIpChange(),await new Promise(e=>setTimeout(e,3e3)),!0}catch(e){return console.error("[MasterReconnection] IP change announcement failed:",e),!1}}async getDesiredPeers(){try{const e=await this.peerPersistence.getReconnectionCandidates({limit:20,maxAge:6048e5,minQuality:20});return e.length===0?[]:e.map(t=>t.peer)}catch(e){return console.error("[MasterReconnection] Error getting desired peers:",e),[]}}async postReconnectionSetup(){try{if(this.config.POST_RECONNECTION.ENABLE_PERIODIC_ANNOUNCEMENTS&&this.announcements.startPeriodicAnnouncements(),this.topology&&this.config.POST_RECONNECTION.ENABLE_TOPOLOGY_DISCOVERY&&await this.topology.discoverTopology().catch(()=>{}),this.config.POST_RECONNECTION.UPDATE_PERSISTENCE){const e=this.peerManager.getAllConnectedPeers?this.peerManager.getAllConnectedPeers():this.peerManager.peers;for(const[t,n]of e)n.status==="connected"&&await this.peerPersistence.updateLastSeen(t)}this.config.POST_RECONNECTION.ENABLE_PERIODIC_RECONNECTION&&this.startPeriodicReconnection()}catch(e){console.error("[MasterReconnection] Post-reconnection setup error:",e)}}startPeriodicReconnection(){if(this.periodicReconnectTimer)return;const e=this.config.PERIODIC_RECONNECTION.INTERVAL;this.periodicReconnectTimer=setInterval(async()=>{try{if(this.config.PERIODIC_RECONNECTION.SKIP_IF_RECONNECTING&&this.isReconnecting||await this.getCurrentConnectionCount()<this.config.PERIODIC_RECONNECTION.MIN_CONNECTIONS_TO_ENABLE)return;const i=(await this.getDesiredPeers()).filter(l=>!this.peerManager.peers.has(l.peerId));if(i.length===0)return;const o=Math.min(i.length,this.config.PERIODIC_RECONNECTION.MAX_ATTEMPTS_PER_CYCLE);let a=0;for(let l=0;l<o;l++){const f=i[l];if(this.peerManager.peers.has(f.peerId))continue;(await this.reconnectToPeer(f)).success&&a++}}catch(t){console.error("[MasterReconnection] Periodic reconnection error:",t)}},e)}stopPeriodicReconnection(){this.periodicReconnectTimer&&(clearInterval(this.periodicReconnectTimer),this.periodicReconnectTimer=null)}getStats(){return{totalAttempts:this.stats.totalAttempts,successfulReconnections:this.stats.successfulReconnections,failedReconnections:this.stats.failedReconnections,coldStarts:this.stats.coldStarts,warmStarts:this.stats.warmStarts,averageDuration:this.stats.averageDuration,lastReconnectionTime:this.stats.lastReconnectionTime,successRate:this.stats.totalAttempts>0?(this.stats.successfulReconnections/this.stats.totalAttempts*100).toFixed(1)+"%":"N/A",methodBreakdown:{...this.stats.methodBreakdown},lastResult:this.lastReconnectionResult,directReconnection:this.directReconnect.getStatistics?this.directReconnect.getStatistics():null,meshRelay:this.meshReconnect.getStats(),announcements:this.announcements.getStats(),coldStart:this.coldStart.getStats(),topology:this.topology?this.topology.getStats():null}}updateStatistics(e){this.stats.lastReconnectionTime=Date.now(),this.stats.totalDuration+=e.duration,this.stats.totalAttempts>0&&(this.stats.averageDuration=Math.round(this.stats.totalDuration/this.stats.totalAttempts))}async getCurrentConnectionCount(){let e=0;for(let t=0;t<this.config.LIMITS.CONNECTION_CHECK_RETRIES&&(e=this.peerManager.getConnectedPeerCount?this.peerManager.getConnectedPeerCount():Array.from(this.peerManager.peers.values()).filter(n=>n.status==="connected").length,!(e>0||t===this.config.LIMITS.CONNECTION_CHECK_RETRIES-1));t++)await new Promise(n=>setTimeout(n,this.config.LIMITS.CONNECTION_CHECK_DELAY));return e}isCurrentlyReconnecting(){return this.isReconnecting}getLastReconnectionResult(){return this.lastReconnectionResult}destroy(){try{this.stopPeriodicReconnection(),this.announcements.stopPeriodicAnnouncements(),this.topology&&typeof this.topology.stopTopologyDiscovery=="function"&&this.topology.stopTopologyDiscovery(),typeof this.coldStart.destroy=="function"&&this.coldStart.destroy(),typeof this.meshReconnect.stop=="function"&&this.meshReconnect.stop(),typeof this.directReconnect.stopMonitoring=="function"&&this.directReconnect.stopMonitoring()}catch(e){console.error("[MasterReconnection] Error during cleanup:",e)}}}const Ve={ANNOUNCEMENT_VALIDITY_WINDOW:5*60*1e3,CLOCK_DRIFT_TOLERANCE:60*1e3,RECONNECTION_TIMEOUT:30*1e3,NONCE_CACHE_SIZE:1e4,NONCE_CACHE_TTL:60*60*1e3,SEQUENCE_STORAGE_KEY:"mesh_sequence_numbers",KEY_ROTATION_PERIOD:90*24*60*60*1e3,SESSION_KEY_ROTATION:24*60*60*1e3,IDENTITY_STORAGE_KEY:"mesh_reconnection_identity",PEER_TRUST_STORAGE_KEY:"mesh_peer_trust",MAX_RELAY_HOPS:3,RELAY_TIMEOUT:10*1e3,SIGNATURE_ALGORITHM:"Ed25519",KEY_AGREEMENT_CURVE:"P-256",STORAGE_ENCRYPTION_ALGORITHM:"AES-GCM"};class rf{constructor(){this.cache=new Map,this.maxSize=Ve.NONCE_CACHE_SIZE,this.expiryMs=Ve.NONCE_CACHE_TTL,this.cleanupTimer=setInterval(()=>this.cleanup(),5*60*1e3)}has(e){const t=this.cache.has(e);if(t){const n=this.cache.get(e);if(Date.now()-n>this.expiryMs)return this.cache.delete(e),!1}return t}add(e){this.cache.size>=this.maxSize&&this.evictOldest(),this.cache.set(e,Date.now())}cleanup(){const e=Date.now();let t=0;for(const[n,i]of this.cache.entries())e-i>this.expiryMs&&(this.cache.delete(n),t++);t>0&&console.log(`[NonceCache] Cleaned ${t} expired nonces`)}evictOldest(){const e=Array.from(this.cache.entries()).sort((t,n)=>t[1]-n[1]);e.length>0&&this.cache.delete(e[0][0])}destroy(){this.cleanupTimer&&clearInterval(this.cleanupTimer)}}class Ye{static async isEd25519Supported(){try{return!!await crypto.subtle.generateKey({name:"Ed25519"},!1,["sign","verify"])}catch{return!1}}static async generateSigningKeyPair(){if(!await Ye.isEd25519Supported())return console.warn("[Crypto] Ed25519 not natively supported, using ECDSA P-256 fallback"),await Ye.generateECDSAKeyPair();const t=await crypto.subtle.generateKey({name:"Ed25519"},!0,["sign","verify"]);return{algorithm:"Ed25519",publicKey:await crypto.subtle.exportKey("jwk",t.publicKey),privateKey:await crypto.subtle.exportKey("jwk",t.privateKey)}}static async generateECDSAKeyPair(){const e=await crypto.subtle.generateKey({name:"ECDSA",namedCurve:"P-256"},!0,["sign","verify"]);return{algorithm:"ECDSA-P256",publicKey:await crypto.subtle.exportKey("jwk",e.publicKey),privateKey:await crypto.subtle.exportKey("jwk",e.privateKey)}}static async generateDHKeyPair(){const e=await crypto.subtle.generateKey({name:"ECDH",namedCurve:Ve.KEY_AGREEMENT_CURVE},!0,["deriveKey","deriveBits"]);return{publicKey:await crypto.subtle.exportKey("jwk",e.publicKey),privateKey:await crypto.subtle.exportKey("jwk",e.privateKey)}}static async sign(e,t,n){const i=await crypto.subtle.importKey("jwk",t,n==="Ed25519"?{name:"Ed25519"}:{name:"ECDSA",namedCurve:"P-256"},!1,["sign"]),o=new TextEncoder().encode(typeof e=="string"?e:JSON.stringify(e)),a=await crypto.subtle.sign(n==="Ed25519"?{name:"Ed25519"}:{name:"ECDSA",hash:"SHA-256"},i,o);return Array.from(new Uint8Array(a)).map(l=>l.toString(16).padStart(2,"0")).join("")}static async verify(e,t,n,i){try{const o=await crypto.subtle.importKey("jwk",n,i==="Ed25519"?{name:"Ed25519"}:{name:"ECDSA",namedCurve:"P-256"},!1,["verify"]),a=new TextEncoder().encode(typeof e=="string"?e:JSON.stringify(e)),l=new Uint8Array(t.match(/.{2}/g).map(p=>parseInt(p,16)));return await crypto.subtle.verify(i==="Ed25519"?{name:"Ed25519"}:{name:"ECDSA",hash:"SHA-256"},o,l,a)}catch(o){return console.error("[Crypto] Verification failed:",o),!1}}static async deriveSharedSecret(e,t){const n=await crypto.subtle.importKey("jwk",e,{name:"ECDH",namedCurve:Ve.KEY_AGREEMENT_CURVE},!1,["deriveBits"]),i=await crypto.subtle.importKey("jwk",t,{name:"ECDH",namedCurve:Ve.KEY_AGREEMENT_CURVE},!1,[]),o=await crypto.subtle.deriveBits({name:"ECDH",public:i},n,256);return Array.from(new Uint8Array(o)).map(a=>a.toString(16).padStart(2,"0")).join("")}static generateNonce(){const e=crypto.getRandomValues(new Uint8Array(32));return Array.from(e).map(t=>t.toString(16).padStart(2,"0")).join("")}static async generateFingerprint(e){const t=JSON.stringify(e),n=new TextEncoder().encode(t),i=await crypto.subtle.digest("SHA-256",n);return Array.from(new Uint8Array(i)).map(a=>a.toString(10).padStart(3,"0")).join(" ").match(/.{1,15}/g)}static async deriveStorageKey(){const e=[navigator.userAgent,navigator.language,screen.width+"x"+screen.height,new Date().getTimezoneOffset(),"mesh-reconnection-v1"].join("|"),t=new TextEncoder().encode(e),n=await crypto.subtle.digest("SHA-256",t);return await crypto.subtle.importKey("raw",n,Ve.STORAGE_ENCRYPTION_ALGORITHM,!1,["encrypt","decrypt"])}static async encryptForStorage(e){const t=await Ye.deriveStorageKey(),n=crypto.getRandomValues(new Uint8Array(12)),i=typeof e=="string"?e:JSON.stringify(e),o=new TextEncoder().encode(i),a=await crypto.subtle.encrypt({name:Ve.STORAGE_ENCRYPTION_ALGORITHM,iv:n},t,o);return{iv:Array.from(n),data:Array.from(new Uint8Array(a))}}static async decryptFromStorage(e){const t=await Ye.deriveStorageKey(),n=new Uint8Array(e.iv),i=new Uint8Array(e.data),o=await crypto.subtle.decrypt({name:Ve.STORAGE_ENCRYPTION_ALGORITHM,iv:n},t,i);return JSON.parse(new TextDecoder().decode(o))}}class sf{constructor(){this.trustedPeers=new Map,this.load()}async addPeer(e,t,n){if(this.trustedPeers.has(e)){const i=this.trustedPeers.get(e),o=JSON.stringify(i.signPublicKey),a=JSON.stringify(t);if(o!==a)throw console.error("[TrustStore] PUBLIC KEY MISMATCH DETECTED!"),console.error(`Peer ${e} is using a different key than before.`),console.error("This could indicate a man-in-the-middle attack!"),new Error("PUBLIC_KEY_MISMATCH");i.lastSeen=Date.now(),this.trustedPeers.set(e,i)}else this.trustedPeers.set(e,{signPublicKey:t,algorithm:n,firstSeen:Date.now(),lastSeen:Date.now()}),console.log(`[TrustStore] Added new trusted peer: ${e}`);await this.save()}getPeer(e){return this.trustedPeers.get(e)}isTrusted(e){return this.trustedPeers.has(e)}async removePeer(e){this.trustedPeers.delete(e),await this.save(),console.log(`[TrustStore] Removed peer: ${e}`)}async getFingerprint(e){const t=this.trustedPeers.get(e);return t?await Ye.generateFingerprint(t.signPublicKey):null}load(){try{const e=localStorage.getItem(Ve.PEER_TRUST_STORAGE_KEY);if(e){const t=JSON.parse(e);this.trustedPeers=new Map(Object.entries(t)),console.log(`[TrustStore] Loaded ${this.trustedPeers.size} trusted peers`)}}catch(e){console.error("[TrustStore] Failed to load:",e)}}async save(){try{const e=Object.fromEntries(this.trustedPeers.entries()),t=await Ye.encryptForStorage(e);localStorage.setItem(Ve.PEER_TRUST_STORAGE_KEY,JSON.stringify(t))}catch(e){console.error("[TrustStore] Failed to save:",e)}}async clear(){this.trustedPeers.clear(),await this.save(),console.log("[TrustStore] Cleared all trusted peers")}}class of{constructor(){this.sequences=new Map,this.load()}get(e){return this.sequences.get(e)||0}update(e,t){const n=this.get(e);return t<=n?(console.warn(`[Sequence] Sequence number not incremented for ${e}: ${t} <= ${n}`),!1):(this.sequences.set(e,t),this.save(),!0)}load(){try{const e=localStorage.getItem(Ve.SEQUENCE_STORAGE_KEY);e&&(this.sequences=new Map(Object.entries(JSON.parse(e))))}catch(e){console.error("[Sequence] Failed to load:",e)}}save(){try{const e=Object.fromEntries(this.sequences.entries());localStorage.setItem(Ve.SEQUENCE_STORAGE_KEY,JSON.stringify(e))}catch(e){console.error("[Sequence] Failed to save:",e)}}clear(){this.sequences.clear(),this.save()}}class af{constructor(e){this.identity=e,this.signKeyPair=null,this.dhKeyPair=null,this.algorithm=null,this.sequenceCounter=0,this.nonceCache=new rf,this.trustStore=new sf,this.sequenceTracker=new of,this.sessionKeys=new Map}async initialize(){console.log("[ReconnectionAuth] Initializing..."),await this.loadOrCreateIdentity(),await this.checkKeyRotation(),console.log(`[ReconnectionAuth] Ready (algorithm: ${this.algorithm})`)}async loadOrCreateIdentity(){try{const e=localStorage.getItem(Ve.IDENTITY_STORAGE_KEY);if(e){const t=JSON.parse(e),n=await Ye.decryptFromStorage(t);this.signKeyPair={publicKey:n.signPublicKey,privateKey:n.signPrivateKey},this.dhKeyPair={publicKey:n.dhPublicKey,privateKey:n.dhPrivateKey},this.algorithm=n.algorithm,this.sequenceCounter=n.sequenceCounter||0,this.created=n.created,console.log("[ReconnectionAuth] Loaded existing identity")}else{const t=await Ye.generateSigningKeyPair(),n=await Ye.generateDHKeyPair();this.signKeyPair={publicKey:t.publicKey,privateKey:t.privateKey},this.dhKeyPair={publicKey:n.publicKey,privateKey:n.privateKey},this.algorithm=t.algorithm,this.sequenceCounter=0,this.created=Date.now(),await this.saveIdentity(),console.log("[ReconnectionAuth] Created new identity")}}catch(e){throw console.error("[ReconnectionAuth] Failed to load/create identity:",e),e}}async saveIdentity(){try{const e={signPublicKey:this.signKeyPair.publicKey,signPrivateKey:this.signKeyPair.privateKey,dhPublicKey:this.dhKeyPair.publicKey,dhPrivateKey:this.dhKeyPair.privateKey,algorithm:this.algorithm,sequenceCounter:this.sequenceCounter,created:this.created},t=await Ye.encryptForStorage(e);localStorage.setItem(Ve.IDENTITY_STORAGE_KEY,JSON.stringify(t))}catch(e){console.error("[ReconnectionAuth] Failed to save identity:",e)}}async checkKeyRotation(){Date.now()-this.created>Ve.KEY_ROTATION_PERIOD&&console.log("[ReconnectionAuth] Key rotation needed")}async exchangeIdentity(e,t){console.log(`[ReconnectionAuth] Exchanging identity with ${t}`);const n={type:"identity_exchange",peerId:this.identity.peerId,displayName:this.identity.displayName,signPublicKey:this.signKeyPair.publicKey,dhPublicKey:this.dhKeyPair.publicKey,algorithm:this.algorithm,timestamp:Date.now()},i=JSON.stringify({peerId:n.peerId,signPublicKey:n.signPublicKey,dhPublicKey:n.dhPublicKey,timestamp:n.timestamp});return n.signature=await Ye.sign(i,this.signKeyPair.privateKey,this.algorithm),e.send(JSON.stringify(n)),n}async handleIdentityExchange(e,t){console.log(`[ReconnectionAuth] Received identity exchange from ${t}`);const n=JSON.stringify({peerId:e.peerId,signPublicKey:e.signPublicKey,dhPublicKey:e.dhPublicKey,timestamp:e.timestamp});if(!await Ye.verify(n,e.signature,e.signPublicKey,e.algorithm))return console.error("[ReconnectionAuth] Invalid identity signature from",t),{valid:!1,reason:"invalid_signature"};try{await this.trustStore.addPeer(e.peerId,e.signPublicKey,e.algorithm)}catch(a){if(a.message==="PUBLIC_KEY_MISMATCH")return{valid:!1,reason:"key_mismatch",securityAlert:!0};throw a}const o=await Ye.deriveSharedSecret(this.dhKeyPair.privateKey,e.dhPublicKey);return this.sessionKeys.set(e.peerId,{sharedSecret:o,dhPublicKey:e.dhPublicKey,established:Date.now()}),console.log(`[ReconnectionAuth] Identity exchange successful with ${e.peerId}`),{valid:!0,peerId:e.peerId}}async createAnnouncement(e=[]){this.sequenceCounter++,await this.saveIdentity();const t={type:"peer_reconnection",peerId:this.identity.peerId,displayName:this.identity.displayName,timestamp:Date.now(),nonce:Ye.generateNonce(),sequenceNum:this.sequenceCounter,previousConnections:e},n=JSON.stringify(t,Object.keys(t).sort());return t.signature=await Ye.sign(n,this.signKeyPair.privateKey,this.algorithm),t.algorithm=this.algorithm,t}async verifyAnnouncement(e){if(!this.trustStore.isTrusted(e.peerId))return{valid:!1,reason:"unknown_peer",suggestion:"This peer must establish initial connection first"};const t=this.trustStore.getPeer(e.peerId),n=Date.now()-e.timestamp,i=Ve.ANNOUNCEMENT_VALIDITY_WINDOW+Ve.CLOCK_DRIFT_TOLERANCE;if(n>i||n<-6e4)return{valid:!1,reason:"timestamp_out_of_range",age:n,maxAge:i};if(this.nonceCache.has(e.nonce))return{valid:!1,reason:"nonce_reused",details:"This announcement was already seen (replay attack?)"};const a=this.sequenceTracker.get(e.peerId);if(e.sequenceNum<=a)return{valid:!1,reason:"sequence_number_not_incremented",expected:`> ${a}`,received:e.sequenceNum};const l={...e};delete l.signature,delete l.algorithm;const f=JSON.stringify(l,Object.keys(l).sort());return await Ye.verify(f,e.signature,t.signPublicKey,t.algorithm)?(this.nonceCache.add(e.nonce),this.sequenceTracker.update(e.peerId,e.sequenceNum),console.log(`[ReconnectionAuth]  Valid announcement from ${e.peerId}`),{valid:!0,peerId:e.peerId,displayName:e.displayName}):{valid:!1,reason:"invalid_signature",details:"Cryptographic signature verification failed"}}async createRelayEnvelope(e){const t={type:"relayed_announcement",relayedBy:this.identity.peerId,relayTimestamp:Date.now(),originalAnnouncement:e},n=JSON.stringify({type:t.type,relayedBy:t.relayedBy,relayTimestamp:t.relayTimestamp,originalHash:await this.hashAnnouncement(e)});return t.relaySignature=await Ye.sign(n,this.signKeyPair.privateKey,this.algorithm),t.algorithm=this.algorithm,t}async verifyRelayedAnnouncement(e,t=0){if(t>=Ve.MAX_RELAY_HOPS)return{valid:!1,reason:"relay_chain_too_long",maxHops:Ve.MAX_RELAY_HOPS};if(!this.trustStore.isTrusted(e.relayedBy))return{valid:!1,reason:"untrusted_relay",relayPeer:e.relayedBy};const n=this.trustStore.getPeer(e.relayedBy),i=JSON.stringify({type:e.type,relayedBy:e.relayedBy,relayTimestamp:e.relayTimestamp,originalHash:await this.hashAnnouncement(e.originalAnnouncement)});if(!await Ye.verify(i,e.relaySignature,n.signPublicKey,n.algorithm))return{valid:!1,reason:"invalid_relay_signature",relayPeer:e.relayedBy};const a=Date.now()-e.relayTimestamp;if(a>Ve.ANNOUNCEMENT_VALIDITY_WINDOW)return{valid:!1,reason:"relay_too_old",age:a};if(e.relayTimestamp<e.originalAnnouncement.timestamp)return{valid:!1,reason:"relay_before_original"};const l=await this.verifyAnnouncement(e.originalAnnouncement);return l.valid?(console.log(`[ReconnectionAuth]  Valid relayed announcement from ${e.originalAnnouncement.peerId} via ${e.relayedBy}`),{valid:!0,peerId:e.originalAnnouncement.peerId,displayName:e.originalAnnouncement.displayName,relayedBy:e.relayedBy,relayDepth:t+1}):l}async hashAnnouncement(e){const t=JSON.stringify(e,Object.keys(e).sort()),n=new TextEncoder().encode(t),i=await crypto.subtle.digest("SHA-256",n);return Array.from(new Uint8Array(i)).map(o=>o.toString(16).padStart(2,"0")).join("")}async getOurFingerprint(){return await Ye.generateFingerprint(this.signKeyPair.publicKey)}async getPeerFingerprint(e){return await this.trustStore.getFingerprint(e)}destroy(){this.nonceCache.destroy()}}class cf{constructor(e){this.reconnector=e,this.lastConnectionType=null,this.lastKnownIP=null,this.ipChangeCount=0,this.connectionTypeChangeCount=0,this.onlineCount=0,this.offlineCount=0,this.lastIpChangeTime=null,this.lastOnlineTime=null,this.lastOfflineTime=null,this.startTime=Date.now(),this.ipCheckInterval=null,this.changeTimeout=null,this.connectionChangeListener=null,this.onlineListener=null,this.offlineListener=null,this.hasNetworkInfo=!!navigator.connection,this.hasWebRTC=!!(window.RTCPeerConnection||window.webkitRTCPeerConnection),console.log("[NetworkDetector] Initialized with features:",{networkInfo:this.hasNetworkInfo,webRTC:this.hasWebRTC,onLine:navigator.onLine})}initialize(){console.log("[NetworkDetector] Starting network change monitoring..."),this.setupListeners(),this.lastConnectionType=this.getConnectionType(),console.log("[NetworkDetector] Initial connection type:",this.lastConnectionType),this.hasWebRTC?(this.ipCheckInterval=setInterval(()=>{this.checkPublicIP()},12e4),setTimeout(()=>{this.checkPublicIP()},2e3)):console.warn("[NetworkDetector] WebRTC not available, IP change detection disabled"),navigator.onLine?this.lastOnlineTime=Date.now():this.lastOfflineTime=Date.now()}setupListeners(){if(this.hasNetworkInfo){const e=navigator.connection;this.connectionChangeListener=()=>{this.changeTimeout&&clearTimeout(this.changeTimeout),this.changeTimeout=setTimeout(()=>{this.handleNetworkChange()},1e3)},e.addEventListener("change",this.connectionChangeListener),console.log("[NetworkDetector] Listening for connection changes")}else console.warn("[NetworkDetector] Network Information API not available"),console.warn("[NetworkDetector] Falling back to online/offline events only");this.onlineListener=()=>{this.handleOnline()},window.addEventListener("online",this.onlineListener),this.offlineListener=()=>{this.handleOffline()},window.addEventListener("offline",this.offlineListener),console.log("[NetworkDetector] Listening for online/offline events")}async handleNetworkChange(){console.log("[NetworkDetector] Network connection changed");const e=this.getConnectionType(),t=this.lastConnectionType;if(e!==t&&(console.log(`[NetworkDetector] Connection type changed: ${t}  ${e}`),this.lastConnectionType=e,this.connectionTypeChangeCount++,this.hasNetworkInfo)){const n=navigator.connection;console.log("[NetworkDetector] Connection details:",{effectiveType:n.effectiveType,downlink:n.downlink?`${n.downlink} Mbps`:"unknown",rtt:n.rtt?`${n.rtt} ms`:"unknown",saveData:n.saveData||!1})}if(!navigator.onLine){console.log("[NetworkDetector] Skipping IP check (offline)");return}await new Promise(n=>setTimeout(n,2e3)),await this.checkPublicIP()}async getPublicIP(){if(!this.hasWebRTC)return null;try{const e=window.RTCPeerConnection||window.webkitRTCPeerConnection,t=new e({iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"}]});t.createDataChannel("");const n=await t.createOffer();return await t.setLocalDescription(n),new Promise(i=>{const o=setTimeout(()=>{t.close(),i(null)},5e3);t.onicecandidate=a=>{if(a.candidate){const l=a.candidate.candidate,f=/([0-9]{1,3}(\.[0-9]{1,3}){3})/,p=/([a-f0-9:]+:+[a-f0-9]+)/i;let b=l.match(f);if(b||(b=l.match(p)),b&&b[0]){const d=b[0];!d.startsWith("192.168.")&&!d.startsWith("10.")&&!d.match(/^172\.(1[6-9]|2[0-9]|3[0-1])\./)&&(clearTimeout(o),t.close(),i(d))}}},t.onicegatheringstatechange=()=>{t.iceGatheringState==="complete"&&(clearTimeout(o),t.close(),i(null))}})}catch(e){return console.error("[NetworkDetector] Failed to get public IP:",e),null}}async checkPublicIP(){console.log("[NetworkDetector] Checking public IP...");const e=await this.getPublicIP();if(!e){console.warn("[NetworkDetector] Could not determine public IP");return}console.log("[NetworkDetector] Current IP:",e);const t=localStorage.getItem("lastKnownPublicIP");if(t&&t!==e)if(console.log(`[NetworkDetector]  IP CHANGED: ${t}  ${e}`),localStorage.setItem("lastKnownPublicIP",e),this.lastKnownIP=e,this.ipChangeCount++,this.lastIpChangeTime=Date.now(),this.reconnector&&typeof this.reconnector.handleIpChange=="function"){console.log("[NetworkDetector] Triggering IP change announcement...");try{await this.reconnector.handleIpChange()}catch(n){console.error("[NetworkDetector] Error handling IP change:",n)}}else console.warn("[NetworkDetector] No reconnector.handleIpChange() method available");else t?console.log(`[NetworkDetector] IP unchanged: ${e}`):(console.log(`[NetworkDetector] Initial IP recorded: ${e}`),localStorage.setItem("lastKnownPublicIP",e),this.lastKnownIP=e)}async handleOnline(){if(console.log("[NetworkDetector]  Back online"),this.onlineCount++,this.lastOnlineTime=Date.now(),this.lastOfflineTime){const t=Date.now()-this.lastOfflineTime,n=(t/1e3).toFixed(1);console.log(`[NetworkDetector] Was offline for ${n}s (${t}ms)`)}const e=this.getConnectionType();console.log(`[NetworkDetector] Connection type: ${e}`),await new Promise(t=>setTimeout(t,2e3)),await this.checkPublicIP()}handleOffline(){if(console.log("[NetworkDetector]  Went offline"),this.offlineCount++,this.lastOfflineTime=Date.now(),this.lastOnlineTime){const e=Date.now()-this.lastOnlineTime,t=(e/1e3).toFixed(1);console.log(`[NetworkDetector] Was online for ${t}s (${e}ms)`)}}getConnectionType(){if(!this.hasNetworkInfo)return"unknown";const e=navigator.connection;return e.type&&e.type!=="unknown"?e.type:e.effectiveType?e.effectiveType:"unknown"}getStats(){const e=Date.now(),t=e-this.startTime,n=this.lastOnlineTime?e-this.lastOnlineTime:0,i=this.lastOfflineTime?e-this.lastOfflineTime:0,o={};if(this.hasNetworkInfo&&navigator.connection){const a=navigator.connection;o.effectiveType=a.effectiveType,o.type=a.type,o.downlink=a.downlink,o.rtt=a.rtt,o.saveData=a.saveData}return{isOnline:navigator.onLine,currentConnectionType:this.getConnectionType(),lastKnownIP:localStorage.getItem("lastKnownPublicIP"),connectionInfo:o,ipChangeCount:this.ipChangeCount,connectionTypeChangeCount:this.connectionTypeChangeCount,onlineCount:this.onlineCount,offlineCount:this.offlineCount,lastIpChangeTime:this.lastIpChangeTime,lastOnlineTime:this.lastOnlineTime,lastOfflineTime:this.lastOfflineTime,startTime:this.startTime,totalUptime:t,currentOnlineDuration:navigator.onLine?n:0,currentOfflineDuration:navigator.onLine?0:i,features:{networkInfo:this.hasNetworkInfo,webRTC:this.hasWebRTC,onlineAPI:!0}}}getStatusSummary(){const e=this.getStats(),t=[];t.push(`Network Status: ${e.isOnline?" ONLINE":" OFFLINE"}`),t.push(`Connection Type: ${e.currentConnectionType}`),e.lastKnownIP&&t.push(`Public IP: ${e.lastKnownIP}`),e.ipChangeCount>0&&t.push(`IP Changes: ${e.ipChangeCount}`),e.connectionTypeChangeCount>0&&t.push(`Connection Changes: ${e.connectionTypeChangeCount}`);const n=(e.totalUptime/1e3).toFixed(0);return t.push(`Uptime: ${n}s`),t.join(`
`)}destroy(){console.log("[NetworkDetector] Cleaning up..."),this.ipCheckInterval&&(clearInterval(this.ipCheckInterval),this.ipCheckInterval=null),this.changeTimeout&&(clearTimeout(this.changeTimeout),this.changeTimeout=null),this.connectionChangeListener&&this.hasNetworkInfo&&(navigator.connection.removeEventListener("change",this.connectionChangeListener),this.connectionChangeListener=null),this.onlineListener&&(window.removeEventListener("online",this.onlineListener),this.onlineListener=null),this.offlineListener&&(window.removeEventListener("offline",this.offlineListener),this.offlineListener=null),console.log("[NetworkDetector] Cleanup complete")}}class lf{constructor(e){this.identity=e,this.peers=new Map,this.onMessage=null,this.onPeerConnect=null,this.onPeerDisconnect=null,this.onPeerUpdate=null,this.router=new ju(e),this.introManager=new $u(e,6),this.latencyManager=new Hu(e),this.connectionManager=new qu(e),this.securityManager=new Wu,this.reconnectionEnabled=!0,this.reconnectionReady=!1,this._initPromise=this.initializeReconnectionSystem(),this.router.setPeerManager(this),this.introManager.setPeerManager(this),this.introManager.setRouter(this.router),this.latencyManager.setPeerManager(this),this.latencyManager.setRouter(this.router),this.connectionManager.setPeerManager(this),this.router.on("chat",t=>this.handleChatMessage(t)),this.router.on("name_change",t=>this.handleNameChange(t)),this.router.on("peer_introduction",t=>this.introManager.handleIntroduction(t)),this.router.on("relay_signal",t=>this.introManager.handleRelaySignal(t)),this.router.on("ping",t=>this.latencyManager.handlePing(t)),this.router.on("pong",t=>this.latencyManager.handlePong(t)),this.reconnectionEnabled}async initializeReconnectionSystem(){try{this.peerPersistence=new Zu({storagePrefix:"mesh",maxPeers:100,cleanupStrategy:"hybrid"}),await this.peerPersistence.initialize(),this.reconnectionAuth=new af({peerId:this.identity.uuid,displayName:this.identity.displayName}),await this.reconnectionAuth.initialize(),this.masterReconnect=new nf(this.identity,this.router,this,this.peerPersistence,this.reconnectionAuth);const e={handleIpChange:async()=>await this.masterReconnect.handleIpChange()};return this.networkDetector=new cf(e),this.networkDetector.initialize(),this.registerReconnectionHandlers(),this.reconnectionReady=!0,this.masterReconnect.announcements.startPeriodicAnnouncements(12e4),!0}catch(e){return console.error("[Mesh] Failed to initialize reconnection system:",e),this.reconnectionEnabled=!1,this.reconnectionReady=!1,!1}}registerReconnectionHandlers(){this.router.on("peer_announcement",e=>{this.masterReconnect&&this.masterReconnect.announcements&&this.masterReconnect.announcements.handlePeerAnnouncement(e)}),this.router.on("ip_change_announcement",e=>{this.masterReconnect&&this.masterReconnect.announcements&&this.masterReconnect.announcements.handleIpChange(e)}),this.router.on("reconnect_offer",e=>{this.masterReconnect&&this.masterReconnect.meshReconnect&&this.masterReconnect.meshReconnect.handleReconnectOffer(e)}),this.router.on("reconnect_answer",e=>{this.masterReconnect&&this.masterReconnect.meshReconnect&&this.masterReconnect.meshReconnect.handleReconnectAnswer(e)}),this.router.on("reconnect_rejection",e=>{this.masterReconnect&&this.masterReconnect.meshReconnect&&this.masterReconnect.meshReconnect.handleReconnectRejection(e)}),this.router.on("path_query",e=>{this.masterReconnect&&this.masterReconnect.meshReconnect&&this.masterReconnect.meshReconnect.handlePathQuery(e)}),this.router.on("path_response",e=>{this.masterReconnect&&this.masterReconnect.meshReconnect&&this.masterReconnect.meshReconnect.handlePathResponse(e)}),this.masterReconnect.topology&&(this.router.on("topology_request",e=>{this.masterReconnect.topology.handleTopologyRequest(e)}),this.router.on("topology_response",e=>{this.masterReconnect.topology.handleTopologyResponse(e)})),this.router.on("reconnection_offer",async e=>{await this.handleReconnectionOffer(e)}),this.router.on("reconnection_answer",async e=>{await this.handleReconnectionAnswer(e)}),this.router.on("identity_exchange",async e=>{var t,n;if(this.reconnectionAuth)try{if((await this.reconnectionAuth.handleIdentityExchange(e.payload,e.senderId)).valid&&this.peerPersistence){const o=(t=this.reconnectionAuth.trustStore)==null?void 0:t.getPeer(e.senderId),a=(n=this.reconnectionAuth.sessionKeys)==null?void 0:n.get(e.senderId);o&&o.signPublicKey&&await this.peerPersistence.updatePeerPublicKey(e.senderId,o.signPublicKey),a&&a.sharedSecret&&await this.peerPersistence.updatePeerSharedSecret(e.senderId,a.sharedSecret)}}catch(i){console.error("[Mesh] Error handling identity exchange:",i)}})}async createOffer(){return new Promise(e=>{const t=new kt({initiator:!0,trickle:!1,config:yt,sdpTransform:n=>n.replace(/a=ice-options:trickle\s?\n/g,"")});t.on("signal",n=>{const i={signal:n,uuid:this.identity.uuid,displayName:this.identity.displayName},o=btoa(JSON.stringify(i));e(o)}),t._tempPeer=!0,this._setupPeerHandlers(t)})}async acceptOffer(e){return new Promise((t,n)=>{try{const i=JSON.parse(atob(e)),{signal:o,uuid:a,displayName:l}=i;if(this.securityManager.isBanned(a)){n(new Error("Peer is banned"));return}this.reconnectionEnabled&&this.reconnectionReady&&this.peerPersistence&&this.peerPersistence.storePeer({peerId:a,userId:a,displayName:l,firstSeen:Date.now(),lastSeen:Date.now(),lastConnected:null,publicKey:null,connectionQuality:{latency:null,successRate:0,connectionType:"pending",lastMeasured:Date.now(),totalConnections:0,successfulConnections:0,avgUptime:0},reconnectionAttempts:0,metadata:{storedDuringSignaling:!0}}).catch(p=>{console.error(`[Mesh] Failed to store peer intent for ${a.substring(0,8)}:`,p)});const f=new kt({initiator:!1,trickle:!1,config:yt,sdpTransform:p=>p.replace(/a=ice-options:trickle\s?\n/g,"")});f.on("signal",p=>{const b={signal:p,uuid:this.identity.uuid,displayName:this.identity.displayName},d=btoa(JSON.stringify(b));t(d)}),this.peers.set(a,{peer:f,displayName:l,status:"connecting",latency:null,connectedAt:Date.now(),connectionType:null}),this._setupPeerHandlers(f,a),f.signal(o)}catch(i){n(i)}})}acceptAnswer(e){try{const t=JSON.parse(atob(e)),{signal:n,uuid:i,displayName:o}=t;if(this.securityManager.isBanned(i))throw new Error("Peer is banned");let a=null;for(const[l,f]of this.peers.entries())if(l==="_temp"&&f.peer._tempPeer){a=f.peer,this.peers.delete(l);break}if(!a){for(const[l,f]of this.peers.entries())if(f.peer._tempPeer){a=f.peer,this.peers.delete(l);break}}if(a)this.peers.set(i,{peer:a,displayName:o,status:"connecting",latency:null,connectedAt:Date.now(),connectionType:null}),a._peerUUID=i,a.signal(n);else throw new Error("No pending peer connection found")}catch(t){throw console.error("[Mesh] Accept answer error:",t),t}}async createIntroducedConnection(e,t,n){if(this.peers.has(e))return!1;const i=new kt({initiator:!0,trickle:!1,config:yt,sdpTransform:o=>o.replace(/a=ice-options:trickle\s?\n/g,"")});return i.on("signal",o=>{const a=this.router.createMessage("relay_signal",{signalType:"offer",signal:o,fromPeerId:this.identity.uuid,fromName:this.identity.displayName,introductionId:n},{targetPeerId:e,ttl:5});this.router.routeMessage(a)}),this.peers.set(e,{peer:i,displayName:t,status:"connecting",latency:null,connectedAt:Date.now(),connectionType:null}),this._setupPeerHandlers(i,e),!0}async handleRelayedSignal(e,t,n,i,o){if(i==="offer"){const a=new kt({initiator:!1,trickle:!1,config:yt,sdpTransform:l=>l.replace(/a=ice-options:trickle\s?\n/g,"")});a.on("signal",l=>{const f=this.router.createMessage("relay_signal",{signalType:"answer",signal:l,fromPeerId:this.identity.uuid,fromName:this.identity.displayName,introductionId:o},{targetPeerId:e,ttl:5});this.router.routeMessage(f)}),this.peers.set(e,{peer:a,displayName:t,status:"connecting",latency:null,connectedAt:Date.now(),connectionType:null}),this._setupPeerHandlers(a,e),a.signal(n)}else if(i==="answer"){const a=this.peers.get(e);a&&a.peer&&a.peer.signal(n)}}_setupPeerHandlers(e,t=null){e.on("connect",async()=>{var i;const n=t||e._peerUUID;if(n&&this.peers.has(n)){const o=this.peers.get(n);if(o.status="connected",o.connectedAt=Date.now(),this.peers.set(n,o),this.reconnectionEnabled&&!this.reconnectionReady&&this._initPromise)try{await this._initPromise}catch(a){console.error("[Mesh] Reconnection system initialization failed during peer connect:",a)}if(e._pc&&this.reconnectionEnabled&&this.reconnectionReady&&this.masterReconnect&&e._pc.addEventListener("iceconnectionstatechange",()=>{e._pc.iceConnectionState==="disconnected"&&setTimeout(()=>{e._pc&&e._pc.iceConnectionState==="disconnected"&&this.masterReconnect.handlePeerDisconnected(n)},3e3)}),this.reconnectionEnabled&&this.reconnectionReady&&this.peerPersistence&&await this.storePeerForReconnection(n,o,e),this.reconnectionEnabled&&this.reconnectionReady&&this.reconnectionAuth)try{await this.reconnectionAuth.exchangeIdentity(e,n);const a=(i=this.reconnectionAuth.trustStore)==null?void 0:i.getPeer(n);a&&a.signPublicKey&&this.peerPersistence&&await this.peerPersistence.updatePeerPublicKey(n,a.signPublicKey),await this.exchangeReconnectionCredentials(e,n)}catch(a){console.error(`[Mesh] Failed to exchange identity with ${n.substring(0,8)}:`,a)}this.onPeerConnect&&this.onPeerConnect(n,o.displayName),setTimeout(()=>{this.latencyManager.pingPeer(n)},2e3)}}),e.on("data",n=>{try{const i=JSON.parse(n.toString()),o=t||e._peerUUID;if(!this.securityManager.validateMessageStructure(i)||o&&!this.securityManager.checkRateLimit(o))return;this.router.routeMessage(i,o)}catch(i){console.error("[Mesh] Error parsing message:",i)}}),e.on("close",async()=>{const n=t||e._peerUUID;n&&this.peers.has(n)&&(this.reconnectionEnabled&&this.peerPersistence&&await this.peerPersistence.updateLastSeen(n),this.peers.delete(n),this.onPeerDisconnect&&this.onPeerDisconnect(n))}),e.on("error",n=>{console.error("[Mesh] Peer error:",n);const i=t||e._peerUUID;if(i&&this.peers.has(i)){const o=this.peers.get(i);o.status="error",this.peers.set(i,o),this.reconnectionEnabled&&this.peerPersistence&&this.peerPersistence.incrementReconnectionAttempts(i)}}),t||this.peers.set("_temp",{peer:e,displayName:"Connecting...",status:"connecting",latency:null,connectedAt:Date.now(),connectionType:null})}handleChatMessage(e){if(this.onMessage){const t=this.identity.getPeerDisplayName(e.senderId,e.senderName),n=e.payload.format||"plain";this.onMessage(e.senderId,t,e.payload.text,n)}}handleNameChange(e){const t=e.senderId,n=e.payload.newName;if(this.peers.has(t)){const i=this.peers.get(t);i.displayName=n,this.peers.set(t,i),this.onPeerUpdate&&this.onPeerUpdate(t,n)}}sendMessage(e,t="markdown"){const n=this.securityManager.sanitizeMessage(e,t),i=this.router.createMessage("chat",{text:n,format:t,version:"1.0"},{routingHint:"broadcast"});this.router.routeMessage(i)}broadcastNameChange(){const e=this.router.createMessage("name_change",{newName:this.identity.displayName},{routingHint:"broadcast"});this.router.routeMessage(e)}getConnectedPeers(){return Array.from(this.peers.entries()).filter(([e,t])=>t.status==="connected"&&e!=="_temp").map(([e,t])=>({uuid:e,displayName:this.identity.getPeerDisplayName(e,t.displayName),originalDisplayName:t.displayName,latency:t.latency,uptime:t.connectedAt?Math.floor((Date.now()-t.connectedAt)/1e3):0,quality:this.connectionManager.calculateQualityScore(e)}))}getConnectedPeerCount(){return Array.from(this.peers.values()).filter(e=>e.status==="connected").length}async exchangeReconnectionCredentials(e,t){try{const n=new kt({initiator:!0,trickle:!1,config:yt,sdpTransform:a=>a.replace(/a=ice-options:trickle\s?\n/g,"")}),i=await new Promise((a,l)=>{const f=setTimeout(()=>l(new Error("Offer generation timeout")),1e4);n.on("signal",p=>{clearTimeout(f),a(p)}),n.on("error",p=>{clearTimeout(f),l(p)})});n.destroy();const o=this.router.createMessage("reconnection_offer",{offer:i,timestamp:Date.now()},{targetPeerId:t,ttl:5});this.router.routeMessage(o),this.pendingReconnectionOffers||(this.pendingReconnectionOffers=new Map),this.pendingReconnectionOffers.set(t,{offer:i,timestamp:Date.now()})}catch(n){console.error(`[Mesh] Failed to exchange reconnection credentials with ${t.substring(0,8)}:`,n)}}async handleReconnectionOffer(e){try{const{offer:t}=e.payload,n=e.senderId,i=new kt({initiator:!1,trickle:!1,config:yt,sdpTransform:f=>f.replace(/a=ice-options:trickle\s?\n/g,"")}),o=await new Promise((f,p)=>{const b=setTimeout(()=>p(new Error("Answer generation timeout")),1e4);i.on("signal",d=>{clearTimeout(b),f(d)}),i.on("error",d=>{clearTimeout(b),p(d)}),i.signal(t)});i.destroy();const a=this.router.createMessage("reconnection_answer",{answer:o,timestamp:Date.now()},{targetPeerId:n,ttl:5});this.router.routeMessage(a);const l={theirOffer:t,ourAnswer:o,timestamp:Date.now()};await this.peerPersistence.updatePeer(n,{reconnectionCredentials:l})}catch(t){console.error(`[Mesh] Failed to handle reconnection offer from ${e.senderId.substring(0,8)}:`,t)}}async handleReconnectionAnswer(e){var t;try{const{answer:n}=e.payload,i=e.senderId,o=(t=this.pendingReconnectionOffers)==null?void 0:t.get(i);if(!o)return;const a={ourOffer:o.offer,theirAnswer:n,timestamp:Date.now()};await this.peerPersistence.updatePeer(i,{reconnectionCredentials:a}),this.pendingReconnectionOffers.delete(i)}catch(n){console.error(`[Mesh] Failed to handle reconnection answer from ${e.senderId.substring(0,8)}:`,n)}}async storePeerForReconnection(e,t,n){try{const i=[];let o=null,a=null;n._pc&&n._pc.localDescription&&n._pc.remoteDescription&&(n.initiator?(o={type:n._pc.localDescription.type,sdp:n._pc.localDescription.sdp},a={type:n._pc.remoteDescription.type,sdp:n._pc.remoteDescription.sdp}):(a={type:n._pc.localDescription.type,sdp:n._pc.localDescription.sdp},o={type:n._pc.remoteDescription.type,sdp:n._pc.remoteDescription.sdp}));const l={peerId:e,userId:e,displayName:t.displayName,lastSeen:Date.now(),lastConnected:Date.now(),publicKey:null,lastKnownIP:null,iceServers:yt.iceServers,cachedCandidates:i,lastOffer:o,lastAnswer:a,wasInitiator:n.initiator||!1,connectionQuality:{latency:t.latency||null,successRate:1,connectionType:t.connectionType||"unknown",lastMeasured:Date.now(),totalConnections:1,successfulConnections:1,avgUptime:0},metadata:{connectedAt:t.connectedAt}};await this.peerPersistence.storePeer(l)}catch(i){console.error("[Mesh] Failed to store peer for reconnection:",i)}}async reconnectToMesh(){if(!this.reconnectionReady&&this._initPromise&&await this._initPromise,!this.reconnectionEnabled)return{success:!1,reason:"disabled"};if(!this.masterReconnect)return console.error("[Mesh] Reconnection system not properly initialized"),{success:!1,reason:"not_initialized"};try{return await this.masterReconnect.reconnectToMesh()}catch(e){return console.error("[Mesh] Reconnection failed:",e),{success:!1,reason:"exception",error:e}}}async reconnectToPeer(e,t,n=null){if(!this.reconnectionReady&&this._initPromise&&await this._initPromise,!this.reconnectionEnabled||!this.masterReconnect)return{success:!1,reason:"disabled"};const i=this.peers.get(e);if(i&&(i.status==="connected"||i.status==="connecting"))return{success:!1,reason:"already_connected"};try{return await this.masterReconnect.meshReconnect.reconnectViaMesh(e,t)}catch(o){return console.error(`[Mesh] Failed to reconnect to peer ${e.substring(0,8)}:`,o),{success:!1,reason:"exception",error:o}}}async announcePresence(e="manual"){if(!this.reconnectionEnabled||!this.masterReconnect)return!1;try{return await this.masterReconnect.announcements.announcePresence(e),!0}catch(t){return console.error("[Mesh] Failed to announce presence:",t),!1}}getReconnectionStats(){return!this.reconnectionEnabled||!this.masterReconnect?null:{master:this.masterReconnect.getStats(),persistence:{totalPeers:this.peerPersistence.getStats().totalPeers,needsCleanup:this.peerPersistence.needsCleanup()},network:this.networkDetector?this.networkDetector.getStats():null}}async registerReconnectedPeer(e,t,n){this.peers.set(e,{peer:n,displayName:t,status:"connecting",latency:null,connectedAt:Date.now(),connectionType:null}),this._setupPeerHandlers(n,e)}getAllConnectedPeers(){return this.peers}getStats(){const e={peers:this.getConnectedPeerCount(),router:this.router.getStats(),latency:this.latencyManager.getStats(),connection:this.connectionManager.getConnectionStats(),security:this.securityManager.getStats()};return this.reconnectionEnabled&&(e.reconnection=this.getReconnectionStats()),e}destroy(){this.router.stop(),this.introManager.stop(),this.latencyManager.stop(),this.connectionManager.stop(),this.reconnectionEnabled&&(this.masterReconnect&&this.masterReconnect.destroy(),this.networkDetector&&this.networkDetector.destroy());for(const[e,t]of this.peers.entries())t.peer&&!t.peer.destroyed&&t.peer.destroy();this.peers.clear()}}function gi(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var Ut=gi();function Lo(r){Ut=r}var gn={exec:()=>null};function Pe(r,e=""){let t=typeof r=="string"?r:r.source,n={replace:(i,o)=>{let a=typeof o=="string"?o:o.source;return a=a.replace(it.caret,"$1"),t=t.replace(i,a),n},getRegex:()=>new RegExp(t,e)};return n}var uf=(()=>{try{return!!new RegExp("(?<=1)(?<!1)")}catch{return!1}})(),it={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] +\S/,listReplaceTask:/^\[[ xX]\] +/,listTaskCheckbox:/\[[ xX]\]/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:r=>new RegExp(`^( {0,3}${r})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:r=>new RegExp(`^ {0,${Math.min(3,r-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:r=>new RegExp(`^ {0,${Math.min(3,r-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:r=>new RegExp(`^ {0,${Math.min(3,r-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:r=>new RegExp(`^ {0,${Math.min(3,r-1)}}#`),htmlBeginRegex:r=>new RegExp(`^ {0,${Math.min(3,r-1)}}<(?:[a-z].*>|!--)`,"i")},ff=/^(?:[ \t]*(?:\n|$))+/,hf=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,df=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,Tn=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,pf=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,yi=/(?:[*+-]|\d{1,9}[.)])/,Do=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,Fo=Pe(Do).replace(/bull/g,yi).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),gf=Pe(Do).replace(/bull/g,yi).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),mi=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,yf=/^[^\n]+/,wi=/(?!\s*\])(?:\\[\s\S]|[^\[\]\\])+/,mf=Pe(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",wi).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),wf=Pe(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,yi).getRegex(),tr="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",_i=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,_f=Pe("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",_i).replace("tag",tr).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),Bo=Pe(mi).replace("hr",Tn).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",tr).getRegex(),bf=Pe(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",Bo).getRegex(),bi={blockquote:bf,code:hf,def:mf,fences:df,heading:pf,hr:Tn,html:_f,lheading:Fo,list:wf,newline:ff,paragraph:Bo,table:gn,text:yf},Ts=Pe("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",Tn).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",tr).getRegex(),Ef={...bi,lheading:gf,table:Ts,paragraph:Pe(mi).replace("hr",Tn).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",Ts).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",tr).getRegex()},vf={...bi,html:Pe(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",_i).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:gn,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:Pe(mi).replace("hr",Tn).replace("heading",` *#{1,6} *[^
]`).replace("lheading",Fo).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},Tf=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,Rf=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,Uo=/^( {2,}|\\)\n(?!\s*$)/,Sf=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,nr=/[\p{P}\p{S}]/u,Ei=/[\s\p{P}\p{S}]/u,jo=/[^\s\p{P}\p{S}]/u,Cf=Pe(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,Ei).getRegex(),$o=/(?!~)[\p{P}\p{S}]/u,Af=/(?!~)[\s\p{P}\p{S}]/u,If=/(?:[^\s\p{P}\p{S}]|~)/u,Pf=Pe(/link|precode-code|html/,"g").replace("link",/\[(?:[^\[\]`]|(?<a>`+)[^`]+\k<a>(?!`))*?\]\((?:\\[\s\S]|[^\\\(\)]|\((?:\\[\s\S]|[^\\\(\)])*\))*\)/).replace("precode-",uf?"(?<!`)()":"(^^|[^`])").replace("code",/(?<b>`+)[^`]+\k<b>(?!`)/).replace("html",/<(?! )[^<>]*?>/).getRegex(),Ho=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,kf=Pe(Ho,"u").replace(/punct/g,nr).getRegex(),Nf=Pe(Ho,"u").replace(/punct/g,$o).getRegex(),qo="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",Of=Pe(qo,"gu").replace(/notPunctSpace/g,jo).replace(/punctSpace/g,Ei).replace(/punct/g,nr).getRegex(),Mf=Pe(qo,"gu").replace(/notPunctSpace/g,If).replace(/punctSpace/g,Af).replace(/punct/g,$o).getRegex(),xf=Pe("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,jo).replace(/punctSpace/g,Ei).replace(/punct/g,nr).getRegex(),Lf=Pe(/\\(punct)/,"gu").replace(/punct/g,nr).getRegex(),Df=Pe(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),Ff=Pe(_i).replace("(?:-->|$)","-->").getRegex(),Bf=Pe("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",Ff).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),zn=/(?:\[(?:\\[\s\S]|[^\[\]\\])*\]|\\[\s\S]|`+[^`]*?`+(?!`)|[^\[\]\\`])*?/,Uf=Pe(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",zn).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),Wo=Pe(/^!?\[(label)\]\[(ref)\]/).replace("label",zn).replace("ref",wi).getRegex(),Ko=Pe(/^!?\[(ref)\](?:\[\])?/).replace("ref",wi).getRegex(),jf=Pe("reflink|nolink(?!\\()","g").replace("reflink",Wo).replace("nolink",Ko).getRegex(),Rs=/[hH][tT][tT][pP][sS]?|[fF][tT][pP]/,vi={_backpedal:gn,anyPunctuation:Lf,autolink:Df,blockSkip:Pf,br:Uo,code:Rf,del:gn,emStrongLDelim:kf,emStrongRDelimAst:Of,emStrongRDelimUnd:xf,escape:Tf,link:Uf,nolink:Ko,punctuation:Cf,reflink:Wo,reflinkSearch:jf,tag:Bf,text:Sf,url:gn},$f={...vi,link:Pe(/^!?\[(label)\]\((.*?)\)/).replace("label",zn).getRegex(),reflink:Pe(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",zn).getRegex()},Jr={...vi,emStrongRDelimAst:Mf,emStrongLDelim:Nf,url:Pe(/^((?:protocol):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/).replace("protocol",Rs).replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\[\s\S]|[^\\])*?(?:\\[\s\S]|[^\s~\\]))\1(?=[^~]|$)/,text:Pe(/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|protocol:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/).replace("protocol",Rs).getRegex()},Hf={...Jr,br:Pe(Uo).replace("{2,}","*").getRegex(),text:Pe(Jr.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},In={normal:bi,gfm:Ef,pedantic:vf},an={normal:vi,gfm:Jr,breaks:Hf,pedantic:$f},qf={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Ss=r=>qf[r];function Rt(r,e){if(e){if(it.escapeTest.test(r))return r.replace(it.escapeReplace,Ss)}else if(it.escapeTestNoEncode.test(r))return r.replace(it.escapeReplaceNoEncode,Ss);return r}function Cs(r){try{r=encodeURI(r).replace(it.percentDecode,"%")}catch{return null}return r}function As(r,e){var o;let t=r.replace(it.findPipe,(a,l,f)=>{let p=!1,b=l;for(;--b>=0&&f[b]==="\\";)p=!p;return p?"|":" |"}),n=t.split(it.splitPipe),i=0;if(n[0].trim()||n.shift(),n.length>0&&!((o=n.at(-1))!=null&&o.trim())&&n.pop(),e)if(n.length>e)n.splice(e);else for(;n.length<e;)n.push("");for(;i<n.length;i++)n[i]=n[i].trim().replace(it.slashPipe,"|");return n}function cn(r,e,t){let n=r.length;if(n===0)return"";let i=0;for(;i<n&&r.charAt(n-i-1)===e;)i++;return r.slice(0,n-i)}function Wf(r,e){if(r.indexOf(e[1])===-1)return-1;let t=0;for(let n=0;n<r.length;n++)if(r[n]==="\\")n++;else if(r[n]===e[0])t++;else if(r[n]===e[1]&&(t--,t<0))return n;return t>0?-2:-1}function Is(r,e,t,n,i){let o=e.href,a=e.title||null,l=r[1].replace(i.other.outputLinkReplace,"$1");n.state.inLink=!0;let f={type:r[0].charAt(0)==="!"?"image":"link",raw:t,href:o,title:a,text:l,tokens:n.inlineTokens(l)};return n.state.inLink=!1,f}function Kf(r,e,t){let n=r.match(t.other.indentCodeCompensation);if(n===null)return e;let i=n[1];return e.split(`
`).map(o=>{let a=o.match(t.other.beginningSpace);if(a===null)return o;let[l]=a;return l.length>=i.length?o.slice(i.length):o}).join(`
`)}var Gn=class{constructor(r){Me(this,"options");Me(this,"rules");Me(this,"lexer");this.options=r||Ut}space(r){let e=this.rules.block.newline.exec(r);if(e&&e[0].length>0)return{type:"space",raw:e[0]}}code(r){let e=this.rules.block.code.exec(r);if(e){let t=e[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:e[0],codeBlockStyle:"indented",text:this.options.pedantic?t:cn(t,`
`)}}}fences(r){let e=this.rules.block.fences.exec(r);if(e){let t=e[0],n=Kf(t,e[3]||"",this.rules);return{type:"code",raw:t,lang:e[2]?e[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):e[2],text:n}}}heading(r){let e=this.rules.block.heading.exec(r);if(e){let t=e[2].trim();if(this.rules.other.endingHash.test(t)){let n=cn(t,"#");(this.options.pedantic||!n||this.rules.other.endingSpaceChar.test(n))&&(t=n.trim())}return{type:"heading",raw:e[0],depth:e[1].length,text:t,tokens:this.lexer.inline(t)}}}hr(r){let e=this.rules.block.hr.exec(r);if(e)return{type:"hr",raw:cn(e[0],`
`)}}blockquote(r){let e=this.rules.block.blockquote.exec(r);if(e){let t=cn(e[0],`
`).split(`
`),n="",i="",o=[];for(;t.length>0;){let a=!1,l=[],f;for(f=0;f<t.length;f++)if(this.rules.other.blockquoteStart.test(t[f]))l.push(t[f]),a=!0;else if(!a)l.push(t[f]);else break;t=t.slice(f);let p=l.join(`
`),b=p.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");n=n?`${n}
${p}`:p,i=i?`${i}
${b}`:b;let d=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(b,o,!0),this.lexer.state.top=d,t.length===0)break;let w=o.at(-1);if((w==null?void 0:w.type)==="code")break;if((w==null?void 0:w.type)==="blockquote"){let T=w,v=T.raw+`
`+t.join(`
`),C=this.blockquote(v);o[o.length-1]=C,n=n.substring(0,n.length-T.raw.length)+C.raw,i=i.substring(0,i.length-T.text.length)+C.text;break}else if((w==null?void 0:w.type)==="list"){let T=w,v=T.raw+`
`+t.join(`
`),C=this.list(v);o[o.length-1]=C,n=n.substring(0,n.length-w.raw.length)+C.raw,i=i.substring(0,i.length-T.raw.length)+C.raw,t=v.substring(o.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:n,tokens:o,text:i}}}list(r){var t,n;let e=this.rules.block.list.exec(r);if(e){let i=e[1].trim(),o=i.length>1,a={type:"list",raw:"",ordered:o,start:o?+i.slice(0,-1):"",loose:!1,items:[]};i=o?`\\d{1,9}\\${i.slice(-1)}`:`\\${i}`,this.options.pedantic&&(i=o?i:"[*+-]");let l=this.rules.other.listItemRegex(i),f=!1;for(;r;){let b=!1,d="",w="";if(!(e=l.exec(r))||this.rules.block.hr.test(r))break;d=e[0],r=r.substring(d.length);let T=e[2].split(`
`,1)[0].replace(this.rules.other.listReplaceTabs,S=>" ".repeat(3*S.length)),v=r.split(`
`,1)[0],C=!T.trim(),F=0;if(this.options.pedantic?(F=2,w=T.trimStart()):C?F=e[1].length+1:(F=e[2].search(this.rules.other.nonSpaceChar),F=F>4?1:F,w=T.slice(F),F+=e[1].length),C&&this.rules.other.blankLine.test(v)&&(d+=v+`
`,r=r.substring(v.length+1),b=!0),!b){let S=this.rules.other.nextBulletRegex(F),N=this.rules.other.hrRegex(F),g=this.rules.other.fencesBeginRegex(F),_=this.rules.other.headingBeginRegex(F),R=this.rules.other.htmlBeginRegex(F);for(;r;){let M=r.split(`
`,1)[0],I;if(v=M,this.options.pedantic?(v=v.replace(this.rules.other.listReplaceNesting,"  "),I=v):I=v.replace(this.rules.other.tabCharGlobal,"    "),g.test(v)||_.test(v)||R.test(v)||S.test(v)||N.test(v))break;if(I.search(this.rules.other.nonSpaceChar)>=F||!v.trim())w+=`
`+I.slice(F);else{if(C||T.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||g.test(T)||_.test(T)||N.test(T))break;w+=`
`+v}!C&&!v.trim()&&(C=!0),d+=M+`
`,r=r.substring(M.length+1),T=I.slice(F)}}a.loose||(f?a.loose=!0:this.rules.other.doubleBlankLine.test(d)&&(f=!0)),a.items.push({type:"list_item",raw:d,task:!!this.options.gfm&&this.rules.other.listIsTask.test(w),loose:!1,text:w,tokens:[]}),a.raw+=d}let p=a.items.at(-1);if(p)p.raw=p.raw.trimEnd(),p.text=p.text.trimEnd();else return;a.raw=a.raw.trimEnd();for(let b of a.items){if(this.lexer.state.top=!1,b.tokens=this.lexer.blockTokens(b.text,[]),b.task){if(b.text=b.text.replace(this.rules.other.listReplaceTask,""),((t=b.tokens[0])==null?void 0:t.type)==="text"||((n=b.tokens[0])==null?void 0:n.type)==="paragraph"){b.tokens[0].raw=b.tokens[0].raw.replace(this.rules.other.listReplaceTask,""),b.tokens[0].text=b.tokens[0].text.replace(this.rules.other.listReplaceTask,"");for(let w=this.lexer.inlineQueue.length-1;w>=0;w--)if(this.rules.other.listIsTask.test(this.lexer.inlineQueue[w].src)){this.lexer.inlineQueue[w].src=this.lexer.inlineQueue[w].src.replace(this.rules.other.listReplaceTask,"");break}}let d=this.rules.other.listTaskCheckbox.exec(b.raw);if(d){let w={type:"checkbox",raw:d[0]+" ",checked:d[0]!=="[ ]"};b.checked=w.checked,a.loose?b.tokens[0]&&["paragraph","text"].includes(b.tokens[0].type)&&"tokens"in b.tokens[0]&&b.tokens[0].tokens?(b.tokens[0].raw=w.raw+b.tokens[0].raw,b.tokens[0].text=w.raw+b.tokens[0].text,b.tokens[0].tokens.unshift(w)):b.tokens.unshift({type:"paragraph",raw:w.raw,text:w.raw,tokens:[w]}):b.tokens.unshift(w)}}if(!a.loose){let d=b.tokens.filter(T=>T.type==="space"),w=d.length>0&&d.some(T=>this.rules.other.anyLine.test(T.raw));a.loose=w}}if(a.loose)for(let b of a.items){b.loose=!0;for(let d of b.tokens)d.type==="text"&&(d.type="paragraph")}return a}}html(r){let e=this.rules.block.html.exec(r);if(e)return{type:"html",block:!0,raw:e[0],pre:e[1]==="pre"||e[1]==="script"||e[1]==="style",text:e[0]}}def(r){let e=this.rules.block.def.exec(r);if(e){let t=e[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),n=e[2]?e[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",i=e[3]?e[3].substring(1,e[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):e[3];return{type:"def",tag:t,raw:e[0],href:n,title:i}}}table(r){var a;let e=this.rules.block.table.exec(r);if(!e||!this.rules.other.tableDelimiter.test(e[2]))return;let t=As(e[1]),n=e[2].replace(this.rules.other.tableAlignChars,"").split("|"),i=(a=e[3])!=null&&a.trim()?e[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],o={type:"table",raw:e[0],header:[],align:[],rows:[]};if(t.length===n.length){for(let l of n)this.rules.other.tableAlignRight.test(l)?o.align.push("right"):this.rules.other.tableAlignCenter.test(l)?o.align.push("center"):this.rules.other.tableAlignLeft.test(l)?o.align.push("left"):o.align.push(null);for(let l=0;l<t.length;l++)o.header.push({text:t[l],tokens:this.lexer.inline(t[l]),header:!0,align:o.align[l]});for(let l of i)o.rows.push(As(l,o.header.length).map((f,p)=>({text:f,tokens:this.lexer.inline(f),header:!1,align:o.align[p]})));return o}}lheading(r){let e=this.rules.block.lheading.exec(r);if(e)return{type:"heading",raw:e[0],depth:e[2].charAt(0)==="="?1:2,text:e[1],tokens:this.lexer.inline(e[1])}}paragraph(r){let e=this.rules.block.paragraph.exec(r);if(e){let t=e[1].charAt(e[1].length-1)===`
`?e[1].slice(0,-1):e[1];return{type:"paragraph",raw:e[0],text:t,tokens:this.lexer.inline(t)}}}text(r){let e=this.rules.block.text.exec(r);if(e)return{type:"text",raw:e[0],text:e[0],tokens:this.lexer.inline(e[0])}}escape(r){let e=this.rules.inline.escape.exec(r);if(e)return{type:"escape",raw:e[0],text:e[1]}}tag(r){let e=this.rules.inline.tag.exec(r);if(e)return!this.lexer.state.inLink&&this.rules.other.startATag.test(e[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(e[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(e[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(e[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:e[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:e[0]}}link(r){let e=this.rules.inline.link.exec(r);if(e){let t=e[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(t)){if(!this.rules.other.endAngleBracket.test(t))return;let o=cn(t.slice(0,-1),"\\");if((t.length-o.length)%2===0)return}else{let o=Wf(e[2],"()");if(o===-2)return;if(o>-1){let a=(e[0].indexOf("!")===0?5:4)+e[1].length+o;e[2]=e[2].substring(0,o),e[0]=e[0].substring(0,a).trim(),e[3]=""}}let n=e[2],i="";if(this.options.pedantic){let o=this.rules.other.pedanticHrefTitle.exec(n);o&&(n=o[1],i=o[3])}else i=e[3]?e[3].slice(1,-1):"";return n=n.trim(),this.rules.other.startAngleBracket.test(n)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(t)?n=n.slice(1):n=n.slice(1,-1)),Is(e,{href:n&&n.replace(this.rules.inline.anyPunctuation,"$1"),title:i&&i.replace(this.rules.inline.anyPunctuation,"$1")},e[0],this.lexer,this.rules)}}reflink(r,e){let t;if((t=this.rules.inline.reflink.exec(r))||(t=this.rules.inline.nolink.exec(r))){let n=(t[2]||t[1]).replace(this.rules.other.multipleSpaceGlobal," "),i=e[n.toLowerCase()];if(!i){let o=t[0].charAt(0);return{type:"text",raw:o,text:o}}return Is(t,i,t[0],this.lexer,this.rules)}}emStrong(r,e,t=""){let n=this.rules.inline.emStrongLDelim.exec(r);if(!(!n||n[3]&&t.match(this.rules.other.unicodeAlphaNumeric))&&(!(n[1]||n[2])||!t||this.rules.inline.punctuation.exec(t))){let i=[...n[0]].length-1,o,a,l=i,f=0,p=n[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(p.lastIndex=0,e=e.slice(-1*r.length+i);(n=p.exec(e))!=null;){if(o=n[1]||n[2]||n[3]||n[4]||n[5]||n[6],!o)continue;if(a=[...o].length,n[3]||n[4]){l+=a;continue}else if((n[5]||n[6])&&i%3&&!((i+a)%3)){f+=a;continue}if(l-=a,l>0)continue;a=Math.min(a,a+l+f);let b=[...n[0]][0].length,d=r.slice(0,i+n.index+b+a);if(Math.min(i,a)%2){let T=d.slice(1,-1);return{type:"em",raw:d,text:T,tokens:this.lexer.inlineTokens(T)}}let w=d.slice(2,-2);return{type:"strong",raw:d,text:w,tokens:this.lexer.inlineTokens(w)}}}}codespan(r){let e=this.rules.inline.code.exec(r);if(e){let t=e[2].replace(this.rules.other.newLineCharGlobal," "),n=this.rules.other.nonSpaceChar.test(t),i=this.rules.other.startingSpaceChar.test(t)&&this.rules.other.endingSpaceChar.test(t);return n&&i&&(t=t.substring(1,t.length-1)),{type:"codespan",raw:e[0],text:t}}}br(r){let e=this.rules.inline.br.exec(r);if(e)return{type:"br",raw:e[0]}}del(r){let e=this.rules.inline.del.exec(r);if(e)return{type:"del",raw:e[0],text:e[2],tokens:this.lexer.inlineTokens(e[2])}}autolink(r){let e=this.rules.inline.autolink.exec(r);if(e){let t,n;return e[2]==="@"?(t=e[1],n="mailto:"+t):(t=e[1],n=t),{type:"link",raw:e[0],text:t,href:n,tokens:[{type:"text",raw:t,text:t}]}}}url(r){var t;let e;if(e=this.rules.inline.url.exec(r)){let n,i;if(e[2]==="@")n=e[0],i="mailto:"+n;else{let o;do o=e[0],e[0]=((t=this.rules.inline._backpedal.exec(e[0]))==null?void 0:t[0])??"";while(o!==e[0]);n=e[0],e[1]==="www."?i="http://"+e[0]:i=e[0]}return{type:"link",raw:e[0],text:n,href:i,tokens:[{type:"text",raw:n,text:n}]}}}inlineText(r){let e=this.rules.inline.text.exec(r);if(e){let t=this.lexer.state.inRawBlock;return{type:"text",raw:e[0],text:e[0],escaped:t}}}},mt=class Zr{constructor(e){Me(this,"tokens");Me(this,"options");Me(this,"state");Me(this,"inlineQueue");Me(this,"tokenizer");this.tokens=[],this.tokens.links=Object.create(null),this.options=e||Ut,this.options.tokenizer=this.options.tokenizer||new Gn,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let t={other:it,block:In.normal,inline:an.normal};this.options.pedantic?(t.block=In.pedantic,t.inline=an.pedantic):this.options.gfm&&(t.block=In.gfm,this.options.breaks?t.inline=an.breaks:t.inline=an.gfm),this.tokenizer.rules=t}static get rules(){return{block:In,inline:an}}static lex(e,t){return new Zr(t).lex(e)}static lexInline(e,t){return new Zr(t).inlineTokens(e)}lex(e){e=e.replace(it.carriageReturn,`
`),this.blockTokens(e,this.tokens);for(let t=0;t<this.inlineQueue.length;t++){let n=this.inlineQueue[t];this.inlineTokens(n.src,n.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(e,t=[],n=!1){var i,o,a;for(this.options.pedantic&&(e=e.replace(it.tabCharGlobal,"    ").replace(it.spaceLine,""));e;){let l;if((o=(i=this.options.extensions)==null?void 0:i.block)!=null&&o.some(p=>(l=p.call({lexer:this},e,t))?(e=e.substring(l.raw.length),t.push(l),!0):!1))continue;if(l=this.tokenizer.space(e)){e=e.substring(l.raw.length);let p=t.at(-1);l.raw.length===1&&p!==void 0?p.raw+=`
`:t.push(l);continue}if(l=this.tokenizer.code(e)){e=e.substring(l.raw.length);let p=t.at(-1);(p==null?void 0:p.type)==="paragraph"||(p==null?void 0:p.type)==="text"?(p.raw+=(p.raw.endsWith(`
`)?"":`
`)+l.raw,p.text+=`
`+l.text,this.inlineQueue.at(-1).src=p.text):t.push(l);continue}if(l=this.tokenizer.fences(e)){e=e.substring(l.raw.length),t.push(l);continue}if(l=this.tokenizer.heading(e)){e=e.substring(l.raw.length),t.push(l);continue}if(l=this.tokenizer.hr(e)){e=e.substring(l.raw.length),t.push(l);continue}if(l=this.tokenizer.blockquote(e)){e=e.substring(l.raw.length),t.push(l);continue}if(l=this.tokenizer.list(e)){e=e.substring(l.raw.length),t.push(l);continue}if(l=this.tokenizer.html(e)){e=e.substring(l.raw.length),t.push(l);continue}if(l=this.tokenizer.def(e)){e=e.substring(l.raw.length);let p=t.at(-1);(p==null?void 0:p.type)==="paragraph"||(p==null?void 0:p.type)==="text"?(p.raw+=(p.raw.endsWith(`
`)?"":`
`)+l.raw,p.text+=`
`+l.raw,this.inlineQueue.at(-1).src=p.text):this.tokens.links[l.tag]||(this.tokens.links[l.tag]={href:l.href,title:l.title},t.push(l));continue}if(l=this.tokenizer.table(e)){e=e.substring(l.raw.length),t.push(l);continue}if(l=this.tokenizer.lheading(e)){e=e.substring(l.raw.length),t.push(l);continue}let f=e;if((a=this.options.extensions)!=null&&a.startBlock){let p=1/0,b=e.slice(1),d;this.options.extensions.startBlock.forEach(w=>{d=w.call({lexer:this},b),typeof d=="number"&&d>=0&&(p=Math.min(p,d))}),p<1/0&&p>=0&&(f=e.substring(0,p+1))}if(this.state.top&&(l=this.tokenizer.paragraph(f))){let p=t.at(-1);n&&(p==null?void 0:p.type)==="paragraph"?(p.raw+=(p.raw.endsWith(`
`)?"":`
`)+l.raw,p.text+=`
`+l.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=p.text):t.push(l),n=f.length!==e.length,e=e.substring(l.raw.length);continue}if(l=this.tokenizer.text(e)){e=e.substring(l.raw.length);let p=t.at(-1);(p==null?void 0:p.type)==="text"?(p.raw+=(p.raw.endsWith(`
`)?"":`
`)+l.raw,p.text+=`
`+l.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=p.text):t.push(l);continue}if(e){let p="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(p);break}else throw new Error(p)}}return this.state.top=!0,t}inline(e,t=[]){return this.inlineQueue.push({src:e,tokens:t}),t}inlineTokens(e,t=[]){var f,p,b,d,w;let n=e,i=null;if(this.tokens.links){let T=Object.keys(this.tokens.links);if(T.length>0)for(;(i=this.tokenizer.rules.inline.reflinkSearch.exec(n))!=null;)T.includes(i[0].slice(i[0].lastIndexOf("[")+1,-1))&&(n=n.slice(0,i.index)+"["+"a".repeat(i[0].length-2)+"]"+n.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(i=this.tokenizer.rules.inline.anyPunctuation.exec(n))!=null;)n=n.slice(0,i.index)+"++"+n.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);let o;for(;(i=this.tokenizer.rules.inline.blockSkip.exec(n))!=null;)o=i[2]?i[2].length:0,n=n.slice(0,i.index+o)+"["+"a".repeat(i[0].length-o-2)+"]"+n.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);n=((p=(f=this.options.hooks)==null?void 0:f.emStrongMask)==null?void 0:p.call({lexer:this},n))??n;let a=!1,l="";for(;e;){a||(l=""),a=!1;let T;if((d=(b=this.options.extensions)==null?void 0:b.inline)!=null&&d.some(C=>(T=C.call({lexer:this},e,t))?(e=e.substring(T.raw.length),t.push(T),!0):!1))continue;if(T=this.tokenizer.escape(e)){e=e.substring(T.raw.length),t.push(T);continue}if(T=this.tokenizer.tag(e)){e=e.substring(T.raw.length),t.push(T);continue}if(T=this.tokenizer.link(e)){e=e.substring(T.raw.length),t.push(T);continue}if(T=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(T.raw.length);let C=t.at(-1);T.type==="text"&&(C==null?void 0:C.type)==="text"?(C.raw+=T.raw,C.text+=T.text):t.push(T);continue}if(T=this.tokenizer.emStrong(e,n,l)){e=e.substring(T.raw.length),t.push(T);continue}if(T=this.tokenizer.codespan(e)){e=e.substring(T.raw.length),t.push(T);continue}if(T=this.tokenizer.br(e)){e=e.substring(T.raw.length),t.push(T);continue}if(T=this.tokenizer.del(e)){e=e.substring(T.raw.length),t.push(T);continue}if(T=this.tokenizer.autolink(e)){e=e.substring(T.raw.length),t.push(T);continue}if(!this.state.inLink&&(T=this.tokenizer.url(e))){e=e.substring(T.raw.length),t.push(T);continue}let v=e;if((w=this.options.extensions)!=null&&w.startInline){let C=1/0,F=e.slice(1),S;this.options.extensions.startInline.forEach(N=>{S=N.call({lexer:this},F),typeof S=="number"&&S>=0&&(C=Math.min(C,S))}),C<1/0&&C>=0&&(v=e.substring(0,C+1))}if(T=this.tokenizer.inlineText(v)){e=e.substring(T.raw.length),T.raw.slice(-1)!=="_"&&(l=T.raw.slice(-1)),a=!0;let C=t.at(-1);(C==null?void 0:C.type)==="text"?(C.raw+=T.raw,C.text+=T.text):t.push(T);continue}if(e){let C="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(C);break}else throw new Error(C)}}return t}},Yn=class{constructor(r){Me(this,"options");Me(this,"parser");this.options=r||Ut}space(r){return""}code({text:r,lang:e,escaped:t}){var o;let n=(o=(e||"").match(it.notSpaceStart))==null?void 0:o[0],i=r.replace(it.endingNewline,"")+`
`;return n?'<pre><code class="language-'+Rt(n)+'">'+(t?i:Rt(i,!0))+`</code></pre>
`:"<pre><code>"+(t?i:Rt(i,!0))+`</code></pre>
`}blockquote({tokens:r}){return`<blockquote>
${this.parser.parse(r)}</blockquote>
`}html({text:r}){return r}def(r){return""}heading({tokens:r,depth:e}){return`<h${e}>${this.parser.parseInline(r)}</h${e}>
`}hr(r){return`<hr>
`}list(r){let e=r.ordered,t=r.start,n="";for(let a=0;a<r.items.length;a++){let l=r.items[a];n+=this.listitem(l)}let i=e?"ol":"ul",o=e&&t!==1?' start="'+t+'"':"";return"<"+i+o+`>
`+n+"</"+i+`>
`}listitem(r){return`<li>${this.parser.parse(r.tokens)}</li>
`}checkbox({checked:r}){return"<input "+(r?'checked="" ':"")+'disabled="" type="checkbox"> '}paragraph({tokens:r}){return`<p>${this.parser.parseInline(r)}</p>
`}table(r){let e="",t="";for(let i=0;i<r.header.length;i++)t+=this.tablecell(r.header[i]);e+=this.tablerow({text:t});let n="";for(let i=0;i<r.rows.length;i++){let o=r.rows[i];t="";for(let a=0;a<o.length;a++)t+=this.tablecell(o[a]);n+=this.tablerow({text:t})}return n&&(n=`<tbody>${n}</tbody>`),`<table>
<thead>
`+e+`</thead>
`+n+`</table>
`}tablerow({text:r}){return`<tr>
${r}</tr>
`}tablecell(r){let e=this.parser.parseInline(r.tokens),t=r.header?"th":"td";return(r.align?`<${t} align="${r.align}">`:`<${t}>`)+e+`</${t}>
`}strong({tokens:r}){return`<strong>${this.parser.parseInline(r)}</strong>`}em({tokens:r}){return`<em>${this.parser.parseInline(r)}</em>`}codespan({text:r}){return`<code>${Rt(r,!0)}</code>`}br(r){return"<br>"}del({tokens:r}){return`<del>${this.parser.parseInline(r)}</del>`}link({href:r,title:e,tokens:t}){let n=this.parser.parseInline(t),i=Cs(r);if(i===null)return n;r=i;let o='<a href="'+r+'"';return e&&(o+=' title="'+Rt(e)+'"'),o+=">"+n+"</a>",o}image({href:r,title:e,text:t,tokens:n}){n&&(t=this.parser.parseInline(n,this.parser.textRenderer));let i=Cs(r);if(i===null)return Rt(t);r=i;let o=`<img src="${r}" alt="${t}"`;return e&&(o+=` title="${Rt(e)}"`),o+=">",o}text(r){return"tokens"in r&&r.tokens?this.parser.parseInline(r.tokens):"escaped"in r&&r.escaped?r.text:Rt(r.text)}},Ti=class{strong({text:e}){return e}em({text:e}){return e}codespan({text:e}){return e}del({text:e}){return e}html({text:e}){return e}text({text:e}){return e}link({text:e}){return""+e}image({text:e}){return""+e}br(){return""}checkbox({raw:e}){return e}},wt=class ei{constructor(e){Me(this,"options");Me(this,"renderer");Me(this,"textRenderer");this.options=e||Ut,this.options.renderer=this.options.renderer||new Yn,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new Ti}static parse(e,t){return new ei(t).parse(e)}static parseInline(e,t){return new ei(t).parseInline(e)}parse(e){var n,i;let t="";for(let o=0;o<e.length;o++){let a=e[o];if((i=(n=this.options.extensions)==null?void 0:n.renderers)!=null&&i[a.type]){let f=a,p=this.options.extensions.renderers[f.type].call({parser:this},f);if(p!==!1||!["space","hr","heading","code","table","blockquote","list","html","def","paragraph","text"].includes(f.type)){t+=p||"";continue}}let l=a;switch(l.type){case"space":{t+=this.renderer.space(l);break}case"hr":{t+=this.renderer.hr(l);break}case"heading":{t+=this.renderer.heading(l);break}case"code":{t+=this.renderer.code(l);break}case"table":{t+=this.renderer.table(l);break}case"blockquote":{t+=this.renderer.blockquote(l);break}case"list":{t+=this.renderer.list(l);break}case"checkbox":{t+=this.renderer.checkbox(l);break}case"html":{t+=this.renderer.html(l);break}case"def":{t+=this.renderer.def(l);break}case"paragraph":{t+=this.renderer.paragraph(l);break}case"text":{t+=this.renderer.text(l);break}default:{let f='Token with "'+l.type+'" type was not found.';if(this.options.silent)return console.error(f),"";throw new Error(f)}}}return t}parseInline(e,t=this.renderer){var i,o;let n="";for(let a=0;a<e.length;a++){let l=e[a];if((o=(i=this.options.extensions)==null?void 0:i.renderers)!=null&&o[l.type]){let p=this.options.extensions.renderers[l.type].call({parser:this},l);if(p!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(l.type)){n+=p||"";continue}}let f=l;switch(f.type){case"escape":{n+=t.text(f);break}case"html":{n+=t.html(f);break}case"link":{n+=t.link(f);break}case"image":{n+=t.image(f);break}case"checkbox":{n+=t.checkbox(f);break}case"strong":{n+=t.strong(f);break}case"em":{n+=t.em(f);break}case"codespan":{n+=t.codespan(f);break}case"br":{n+=t.br(f);break}case"del":{n+=t.del(f);break}case"text":{n+=t.text(f);break}default:{let p='Token with "'+f.type+'" type was not found.';if(this.options.silent)return console.error(p),"";throw new Error(p)}}}return n}},Nn,pn=(Nn=class{constructor(r){Me(this,"options");Me(this,"block");this.options=r||Ut}preprocess(r){return r}postprocess(r){return r}processAllTokens(r){return r}emStrongMask(r){return r}provideLexer(){return this.block?mt.lex:mt.lexInline}provideParser(){return this.block?wt.parse:wt.parseInline}},Me(Nn,"passThroughHooks",new Set(["preprocess","postprocess","processAllTokens","emStrongMask"])),Me(Nn,"passThroughHooksRespectAsync",new Set(["preprocess","postprocess","processAllTokens"])),Nn),zf=class{constructor(...r){Me(this,"defaults",gi());Me(this,"options",this.setOptions);Me(this,"parse",this.parseMarkdown(!0));Me(this,"parseInline",this.parseMarkdown(!1));Me(this,"Parser",wt);Me(this,"Renderer",Yn);Me(this,"TextRenderer",Ti);Me(this,"Lexer",mt);Me(this,"Tokenizer",Gn);Me(this,"Hooks",pn);this.use(...r)}walkTokens(r,e){var n,i;let t=[];for(let o of r)switch(t=t.concat(e.call(this,o)),o.type){case"table":{let a=o;for(let l of a.header)t=t.concat(this.walkTokens(l.tokens,e));for(let l of a.rows)for(let f of l)t=t.concat(this.walkTokens(f.tokens,e));break}case"list":{let a=o;t=t.concat(this.walkTokens(a.items,e));break}default:{let a=o;(i=(n=this.defaults.extensions)==null?void 0:n.childTokens)!=null&&i[a.type]?this.defaults.extensions.childTokens[a.type].forEach(l=>{let f=a[l].flat(1/0);t=t.concat(this.walkTokens(f,e))}):a.tokens&&(t=t.concat(this.walkTokens(a.tokens,e)))}}return t}use(...r){let e=this.defaults.extensions||{renderers:{},childTokens:{}};return r.forEach(t=>{let n={...t};if(n.async=this.defaults.async||n.async||!1,t.extensions&&(t.extensions.forEach(i=>{if(!i.name)throw new Error("extension name required");if("renderer"in i){let o=e.renderers[i.name];o?e.renderers[i.name]=function(...a){let l=i.renderer.apply(this,a);return l===!1&&(l=o.apply(this,a)),l}:e.renderers[i.name]=i.renderer}if("tokenizer"in i){if(!i.level||i.level!=="block"&&i.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");let o=e[i.level];o?o.unshift(i.tokenizer):e[i.level]=[i.tokenizer],i.start&&(i.level==="block"?e.startBlock?e.startBlock.push(i.start):e.startBlock=[i.start]:i.level==="inline"&&(e.startInline?e.startInline.push(i.start):e.startInline=[i.start]))}"childTokens"in i&&i.childTokens&&(e.childTokens[i.name]=i.childTokens)}),n.extensions=e),t.renderer){let i=this.defaults.renderer||new Yn(this.defaults);for(let o in t.renderer){if(!(o in i))throw new Error(`renderer '${o}' does not exist`);if(["options","parser"].includes(o))continue;let a=o,l=t.renderer[a],f=i[a];i[a]=(...p)=>{let b=l.apply(i,p);return b===!1&&(b=f.apply(i,p)),b||""}}n.renderer=i}if(t.tokenizer){let i=this.defaults.tokenizer||new Gn(this.defaults);for(let o in t.tokenizer){if(!(o in i))throw new Error(`tokenizer '${o}' does not exist`);if(["options","rules","lexer"].includes(o))continue;let a=o,l=t.tokenizer[a],f=i[a];i[a]=(...p)=>{let b=l.apply(i,p);return b===!1&&(b=f.apply(i,p)),b}}n.tokenizer=i}if(t.hooks){let i=this.defaults.hooks||new pn;for(let o in t.hooks){if(!(o in i))throw new Error(`hook '${o}' does not exist`);if(["options","block"].includes(o))continue;let a=o,l=t.hooks[a],f=i[a];pn.passThroughHooks.has(o)?i[a]=p=>{if(this.defaults.async&&pn.passThroughHooksRespectAsync.has(o))return(async()=>{let d=await l.call(i,p);return f.call(i,d)})();let b=l.call(i,p);return f.call(i,b)}:i[a]=(...p)=>{if(this.defaults.async)return(async()=>{let d=await l.apply(i,p);return d===!1&&(d=await f.apply(i,p)),d})();let b=l.apply(i,p);return b===!1&&(b=f.apply(i,p)),b}}n.hooks=i}if(t.walkTokens){let i=this.defaults.walkTokens,o=t.walkTokens;n.walkTokens=function(a){let l=[];return l.push(o.call(this,a)),i&&(l=l.concat(i.call(this,a))),l}}this.defaults={...this.defaults,...n}}),this}setOptions(r){return this.defaults={...this.defaults,...r},this}lexer(r,e){return mt.lex(r,e??this.defaults)}parser(r,e){return wt.parse(r,e??this.defaults)}parseMarkdown(r){return(e,t)=>{let n={...t},i={...this.defaults,...n},o=this.onError(!!i.silent,!!i.async);if(this.defaults.async===!0&&n.async===!1)return o(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof e>"u"||e===null)return o(new Error("marked(): input parameter is undefined or null"));if(typeof e!="string")return o(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(e)+", string expected"));if(i.hooks&&(i.hooks.options=i,i.hooks.block=r),i.async)return(async()=>{let a=i.hooks?await i.hooks.preprocess(e):e,l=await(i.hooks?await i.hooks.provideLexer():r?mt.lex:mt.lexInline)(a,i),f=i.hooks?await i.hooks.processAllTokens(l):l;i.walkTokens&&await Promise.all(this.walkTokens(f,i.walkTokens));let p=await(i.hooks?await i.hooks.provideParser():r?wt.parse:wt.parseInline)(f,i);return i.hooks?await i.hooks.postprocess(p):p})().catch(o);try{i.hooks&&(e=i.hooks.preprocess(e));let a=(i.hooks?i.hooks.provideLexer():r?mt.lex:mt.lexInline)(e,i);i.hooks&&(a=i.hooks.processAllTokens(a)),i.walkTokens&&this.walkTokens(a,i.walkTokens);let l=(i.hooks?i.hooks.provideParser():r?wt.parse:wt.parseInline)(a,i);return i.hooks&&(l=i.hooks.postprocess(l)),l}catch(a){return o(a)}}}onError(r,e){return t=>{if(t.message+=`
Please report this to https://github.com/markedjs/marked.`,r){let n="<p>An error occurred:</p><pre>"+Rt(t.message+"",!0)+"</pre>";return e?Promise.resolve(n):n}if(e)return Promise.reject(t);throw t}}},Ft=new zf;function Oe(r,e){return Ft.parse(r,e)}Oe.options=Oe.setOptions=function(r){return Ft.setOptions(r),Oe.defaults=Ft.defaults,Lo(Oe.defaults),Oe};Oe.getDefaults=gi;Oe.defaults=Ut;Oe.use=function(...r){return Ft.use(...r),Oe.defaults=Ft.defaults,Lo(Oe.defaults),Oe};Oe.walkTokens=function(r,e){return Ft.walkTokens(r,e)};Oe.parseInline=Ft.parseInline;Oe.Parser=wt;Oe.parser=wt.parse;Oe.Renderer=Yn;Oe.TextRenderer=Ti;Oe.Lexer=mt;Oe.lexer=mt.lex;Oe.Tokenizer=Gn;Oe.Hooks=pn;Oe.parse=Oe;Oe.options;Oe.setOptions;Oe.use;Oe.walkTokens;Oe.parseInline;wt.parse;mt.lex;/*! @license DOMPurify 3.3.0 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.3.0/LICENSE */const{entries:zo,setPrototypeOf:Ps,isFrozen:Gf,getPrototypeOf:Yf,getOwnPropertyDescriptor:Vf}=Object;let{freeze:st,seal:dt,create:ti}=Object,{apply:ni,construct:ri}=typeof Reflect<"u"&&Reflect;st||(st=function(e){return e});dt||(dt=function(e){return e});ni||(ni=function(e,t){for(var n=arguments.length,i=new Array(n>2?n-2:0),o=2;o<n;o++)i[o-2]=arguments[o];return e.apply(t,i)});ri||(ri=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return new e(...n)});const Pn=ot(Array.prototype.forEach),Qf=ot(Array.prototype.lastIndexOf),ks=ot(Array.prototype.pop),ln=ot(Array.prototype.push),Xf=ot(Array.prototype.splice),jn=ot(String.prototype.toLowerCase),Nr=ot(String.prototype.toString),Or=ot(String.prototype.match),un=ot(String.prototype.replace),Jf=ot(String.prototype.indexOf),Zf=ot(String.prototype.trim),gt=ot(Object.prototype.hasOwnProperty),rt=ot(RegExp.prototype.test),fn=eh(TypeError);function ot(r){return function(e){e instanceof RegExp&&(e.lastIndex=0);for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return ni(r,e,n)}}function eh(r){return function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return ri(r,t)}}function Re(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:jn;Ps&&Ps(r,null);let n=e.length;for(;n--;){let i=e[n];if(typeof i=="string"){const o=t(i);o!==i&&(Gf(e)||(e[n]=o),i=o)}r[i]=!0}return r}function th(r){for(let e=0;e<r.length;e++)gt(r,e)||(r[e]=null);return r}function St(r){const e=ti(null);for(const[t,n]of zo(r))gt(r,t)&&(Array.isArray(n)?e[t]=th(n):n&&typeof n=="object"&&n.constructor===Object?e[t]=St(n):e[t]=n);return e}function hn(r,e){for(;r!==null;){const n=Vf(r,e);if(n){if(n.get)return ot(n.get);if(typeof n.value=="function")return ot(n.value)}r=Yf(r)}function t(){return null}return t}const Ns=st(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","search","section","select","shadow","slot","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),Mr=st(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","enterkeyhint","exportparts","filter","font","g","glyph","glyphref","hkern","image","inputmode","line","lineargradient","marker","mask","metadata","mpath","part","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),xr=st(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),nh=st(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),Lr=st(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),rh=st(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),Os=st(["#text"]),Ms=st(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","exportparts","face","for","headers","height","hidden","high","href","hreflang","id","inert","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","part","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","slot","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),Dr=st(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","mask-type","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),xs=st(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),kn=st(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),ih=dt(/\{\{[\w\W]*|[\w\W]*\}\}/gm),sh=dt(/<%[\w\W]*|[\w\W]*%>/gm),oh=dt(/\$\{[\w\W]*/gm),ah=dt(/^data-[\-\w.\u00B7-\uFFFF]+$/),ch=dt(/^aria-[\-\w]+$/),Go=dt(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),lh=dt(/^(?:\w+script|data):/i),uh=dt(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),Yo=dt(/^html$/i),fh=dt(/^[a-z][.\w]*(-[.\w]+)+$/i);var Ls=Object.freeze({__proto__:null,ARIA_ATTR:ch,ATTR_WHITESPACE:uh,CUSTOM_ELEMENT:fh,DATA_ATTR:ah,DOCTYPE_NAME:Yo,ERB_EXPR:sh,IS_ALLOWED_URI:Go,IS_SCRIPT_OR_DATA:lh,MUSTACHE_EXPR:ih,TMPLIT_EXPR:oh});const dn={element:1,text:3,progressingInstruction:7,comment:8,document:9},hh=function(){return typeof window>"u"?null:window},dh=function(e,t){if(typeof e!="object"||typeof e.createPolicy!="function")return null;let n=null;const i="data-tt-policy-suffix";t&&t.hasAttribute(i)&&(n=t.getAttribute(i));const o="dompurify"+(n?"#"+n:"");try{return e.createPolicy(o,{createHTML(a){return a},createScriptURL(a){return a}})}catch{return console.warn("TrustedTypes policy "+o+" could not be created."),null}},Ds=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function Vo(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:hh();const e=ge=>Vo(ge);if(e.version="3.3.0",e.removed=[],!r||!r.document||r.document.nodeType!==dn.document||!r.Element)return e.isSupported=!1,e;let{document:t}=r;const n=t,i=n.currentScript,{DocumentFragment:o,HTMLTemplateElement:a,Node:l,Element:f,NodeFilter:p,NamedNodeMap:b=r.NamedNodeMap||r.MozNamedAttrMap,HTMLFormElement:d,DOMParser:w,trustedTypes:T}=r,v=f.prototype,C=hn(v,"cloneNode"),F=hn(v,"remove"),S=hn(v,"nextSibling"),N=hn(v,"childNodes"),g=hn(v,"parentNode");if(typeof a=="function"){const ge=t.createElement("template");ge.content&&ge.content.ownerDocument&&(t=ge.content.ownerDocument)}let _,R="";const{implementation:M,createNodeIterator:I,createDocumentFragment:x,getElementsByTagName:K}=t,{importNode:L}=n;let B=Ds();e.isSupported=typeof zo=="function"&&typeof g=="function"&&M&&M.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:O,ERB_EXPR:ne,TMPLIT_EXPR:ue,DATA_ATTR:fe,ARIA_ATTR:pe,IS_SCRIPT_OR_DATA:ve,ATTR_WHITESPACE:Ie,CUSTOM_ELEMENT:he}=Ls;let{IS_ALLOWED_URI:ke}=Ls,be=null;const Le=Re({},[...Ns,...Mr,...xr,...Lr,...Os]);let W=null;const Y=Re({},[...Ms,...Dr,...xs,...kn]);let J=Object.seal(ti(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),U=null,H=null;const X=Object.seal(ti(null,{tagCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeCheck:{writable:!0,configurable:!1,enumerable:!0,value:null}}));let re=!0,ae=!0,A=!1,P=!0,Z=!1,oe=!0,$=!1,z=!1,te=!1,ce=!1,m=!1,s=!1,h=!0,y=!1;const D="user-content-";let G=!0,Q=!1,le={},ye=null;const Te=Re({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let me=null;const _e=Re({},["audio","video","img","source","image","track"]);let je=null;const ut=Re({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),at="http://www.w3.org/1998/Math/MathML",Je="http://www.w3.org/2000/svg",He="http://www.w3.org/1999/xhtml";let nt=He,nn=!1,Nt=null;const ir=Re({},[at,Je,He],Nr);let jt=Re({},["mi","mo","mn","ms","mtext"]),Ot=Re({},["annotation-xml"]);const $t=Re({},["title","style","font","a","script"]);let et=null;const rn=["application/xhtml+xml","text/html"],sr="text/html";let De=null,Pt=null;const E=t.createElement("form"),c=function(j){return j instanceof RegExp||j instanceof Function},u=function(){let j=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(Pt&&Pt===j)){if((!j||typeof j!="object")&&(j={}),j=St(j),et=rn.indexOf(j.PARSER_MEDIA_TYPE)===-1?sr:j.PARSER_MEDIA_TYPE,De=et==="application/xhtml+xml"?Nr:jn,be=gt(j,"ALLOWED_TAGS")?Re({},j.ALLOWED_TAGS,De):Le,W=gt(j,"ALLOWED_ATTR")?Re({},j.ALLOWED_ATTR,De):Y,Nt=gt(j,"ALLOWED_NAMESPACES")?Re({},j.ALLOWED_NAMESPACES,Nr):ir,je=gt(j,"ADD_URI_SAFE_ATTR")?Re(St(ut),j.ADD_URI_SAFE_ATTR,De):ut,me=gt(j,"ADD_DATA_URI_TAGS")?Re(St(_e),j.ADD_DATA_URI_TAGS,De):_e,ye=gt(j,"FORBID_CONTENTS")?Re({},j.FORBID_CONTENTS,De):Te,U=gt(j,"FORBID_TAGS")?Re({},j.FORBID_TAGS,De):St({}),H=gt(j,"FORBID_ATTR")?Re({},j.FORBID_ATTR,De):St({}),le=gt(j,"USE_PROFILES")?j.USE_PROFILES:!1,re=j.ALLOW_ARIA_ATTR!==!1,ae=j.ALLOW_DATA_ATTR!==!1,A=j.ALLOW_UNKNOWN_PROTOCOLS||!1,P=j.ALLOW_SELF_CLOSE_IN_ATTR!==!1,Z=j.SAFE_FOR_TEMPLATES||!1,oe=j.SAFE_FOR_XML!==!1,$=j.WHOLE_DOCUMENT||!1,ce=j.RETURN_DOM||!1,m=j.RETURN_DOM_FRAGMENT||!1,s=j.RETURN_TRUSTED_TYPE||!1,te=j.FORCE_BODY||!1,h=j.SANITIZE_DOM!==!1,y=j.SANITIZE_NAMED_PROPS||!1,G=j.KEEP_CONTENT!==!1,Q=j.IN_PLACE||!1,ke=j.ALLOWED_URI_REGEXP||Go,nt=j.NAMESPACE||He,jt=j.MATHML_TEXT_INTEGRATION_POINTS||jt,Ot=j.HTML_INTEGRATION_POINTS||Ot,J=j.CUSTOM_ELEMENT_HANDLING||{},j.CUSTOM_ELEMENT_HANDLING&&c(j.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(J.tagNameCheck=j.CUSTOM_ELEMENT_HANDLING.tagNameCheck),j.CUSTOM_ELEMENT_HANDLING&&c(j.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(J.attributeNameCheck=j.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),j.CUSTOM_ELEMENT_HANDLING&&typeof j.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(J.allowCustomizedBuiltInElements=j.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),Z&&(ae=!1),m&&(ce=!0),le&&(be=Re({},Os),W=[],le.html===!0&&(Re(be,Ns),Re(W,Ms)),le.svg===!0&&(Re(be,Mr),Re(W,Dr),Re(W,kn)),le.svgFilters===!0&&(Re(be,xr),Re(W,Dr),Re(W,kn)),le.mathMl===!0&&(Re(be,Lr),Re(W,xs),Re(W,kn))),j.ADD_TAGS&&(typeof j.ADD_TAGS=="function"?X.tagCheck=j.ADD_TAGS:(be===Le&&(be=St(be)),Re(be,j.ADD_TAGS,De))),j.ADD_ATTR&&(typeof j.ADD_ATTR=="function"?X.attributeCheck=j.ADD_ATTR:(W===Y&&(W=St(W)),Re(W,j.ADD_ATTR,De))),j.ADD_URI_SAFE_ATTR&&Re(je,j.ADD_URI_SAFE_ATTR,De),j.FORBID_CONTENTS&&(ye===Te&&(ye=St(ye)),Re(ye,j.FORBID_CONTENTS,De)),G&&(be["#text"]=!0),$&&Re(be,["html","head","body"]),be.table&&(Re(be,["tbody"]),delete U.tbody),j.TRUSTED_TYPES_POLICY){if(typeof j.TRUSTED_TYPES_POLICY.createHTML!="function")throw fn('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof j.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw fn('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');_=j.TRUSTED_TYPES_POLICY,R=_.createHTML("")}else _===void 0&&(_=dh(T,i)),_!==null&&typeof R=="string"&&(R=_.createHTML(""));st&&st(j),Pt=j}},k=Re({},[...Mr,...xr,...nh]),q=Re({},[...Lr,...rh]),V=function(j){let se=g(j);(!se||!se.tagName)&&(se={namespaceURI:nt,tagName:"template"});const de=jn(j.tagName),$e=jn(se.tagName);return Nt[j.namespaceURI]?j.namespaceURI===Je?se.namespaceURI===He?de==="svg":se.namespaceURI===at?de==="svg"&&($e==="annotation-xml"||jt[$e]):!!k[de]:j.namespaceURI===at?se.namespaceURI===He?de==="math":se.namespaceURI===Je?de==="math"&&Ot[$e]:!!q[de]:j.namespaceURI===He?se.namespaceURI===Je&&!Ot[$e]||se.namespaceURI===at&&!jt[$e]?!1:!q[de]&&($t[de]||!k[de]):!!(et==="application/xhtml+xml"&&Nt[j.namespaceURI]):!1},ee=function(j){ln(e.removed,{element:j});try{g(j).removeChild(j)}catch{F(j)}},we=function(j,se){try{ln(e.removed,{attribute:se.getAttributeNode(j),from:se})}catch{ln(e.removed,{attribute:null,from:se})}if(se.removeAttribute(j),j==="is")if(ce||m)try{ee(se)}catch{}else try{se.setAttribute(j,"")}catch{}},Ue=function(j){let se=null,de=null;if(te)j="<remove></remove>"+j;else{const Ge=Or(j,/^[\r\n\t ]+/);de=Ge&&Ge[0]}et==="application/xhtml+xml"&&nt===He&&(j='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+j+"</body></html>");const $e=_?_.createHTML(j):j;if(nt===He)try{se=new w().parseFromString($e,et)}catch{}if(!se||!se.documentElement){se=M.createDocument(nt,"template",null);try{se.documentElement.innerHTML=nn?R:$e}catch{}}const tt=se.body||se.documentElement;return j&&de&&tt.insertBefore(t.createTextNode(de),tt.childNodes[0]||null),nt===He?K.call(se,$?"html":"body")[0]:$?se.documentElement:tt},Fe=function(j){return I.call(j.ownerDocument||j,j,p.SHOW_ELEMENT|p.SHOW_COMMENT|p.SHOW_TEXT|p.SHOW_PROCESSING_INSTRUCTION|p.SHOW_CDATA_SECTION,null)},Be=function(j){return j instanceof d&&(typeof j.nodeName!="string"||typeof j.textContent!="string"||typeof j.removeChild!="function"||!(j.attributes instanceof b)||typeof j.removeAttribute!="function"||typeof j.setAttribute!="function"||typeof j.namespaceURI!="string"||typeof j.insertBefore!="function"||typeof j.hasChildNodes!="function")},Ne=function(j){return typeof l=="function"&&j instanceof l};function vt(ge,j,se){Pn(ge,de=>{de.call(e,j,se,Pt)})}const Ai=function(j){let se=null;if(vt(B.beforeSanitizeElements,j,null),Be(j))return ee(j),!0;const de=De(j.nodeName);if(vt(B.uponSanitizeElement,j,{tagName:de,allowedTags:be}),oe&&j.hasChildNodes()&&!Ne(j.firstElementChild)&&rt(/<[/\w!]/g,j.innerHTML)&&rt(/<[/\w!]/g,j.textContent)||j.nodeType===dn.progressingInstruction||oe&&j.nodeType===dn.comment&&rt(/<[/\w]/g,j.data))return ee(j),!0;if(!(X.tagCheck instanceof Function&&X.tagCheck(de))&&(!be[de]||U[de])){if(!U[de]&&Pi(de)&&(J.tagNameCheck instanceof RegExp&&rt(J.tagNameCheck,de)||J.tagNameCheck instanceof Function&&J.tagNameCheck(de)))return!1;if(G&&!ye[de]){const $e=g(j)||j.parentNode,tt=N(j)||j.childNodes;if(tt&&$e){const Ge=tt.length;for(let ct=Ge-1;ct>=0;--ct){const Tt=C(tt[ct],!0);Tt.__removalCount=(j.__removalCount||0)+1,$e.insertBefore(Tt,S(j))}}}return ee(j),!0}return j instanceof f&&!V(j)||(de==="noscript"||de==="noembed"||de==="noframes")&&rt(/<\/no(script|embed|frames)/i,j.innerHTML)?(ee(j),!0):(Z&&j.nodeType===dn.text&&(se=j.textContent,Pn([O,ne,ue],$e=>{se=un(se,$e," ")}),j.textContent!==se&&(ln(e.removed,{element:j.cloneNode()}),j.textContent=se)),vt(B.afterSanitizeElements,j,null),!1)},Ii=function(j,se,de){if(h&&(se==="id"||se==="name")&&(de in t||de in E))return!1;if(!(ae&&!H[se]&&rt(fe,se))){if(!(re&&rt(pe,se))){if(!(X.attributeCheck instanceof Function&&X.attributeCheck(se,j))){if(!W[se]||H[se]){if(!(Pi(j)&&(J.tagNameCheck instanceof RegExp&&rt(J.tagNameCheck,j)||J.tagNameCheck instanceof Function&&J.tagNameCheck(j))&&(J.attributeNameCheck instanceof RegExp&&rt(J.attributeNameCheck,se)||J.attributeNameCheck instanceof Function&&J.attributeNameCheck(se,j))||se==="is"&&J.allowCustomizedBuiltInElements&&(J.tagNameCheck instanceof RegExp&&rt(J.tagNameCheck,de)||J.tagNameCheck instanceof Function&&J.tagNameCheck(de))))return!1}else if(!je[se]){if(!rt(ke,un(de,Ie,""))){if(!((se==="src"||se==="xlink:href"||se==="href")&&j!=="script"&&Jf(de,"data:")===0&&me[j])){if(!(A&&!rt(ve,un(de,Ie,"")))){if(de)return!1}}}}}}}return!0},Pi=function(j){return j!=="annotation-xml"&&Or(j,he)},ki=function(j){vt(B.beforeSanitizeAttributes,j,null);const{attributes:se}=j;if(!se||Be(j))return;const de={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:W,forceKeepAttr:void 0};let $e=se.length;for(;$e--;){const tt=se[$e],{name:Ge,namespaceURI:ct,value:Tt}=tt,Ht=De(Ge),or=Tt;let Ze=Ge==="value"?or:Zf(or);if(de.attrName=Ht,de.attrValue=Ze,de.keepAttr=!0,de.forceKeepAttr=void 0,vt(B.uponSanitizeAttribute,j,de),Ze=de.attrValue,y&&(Ht==="id"||Ht==="name")&&(we(Ge,j),Ze=D+Ze),oe&&rt(/((--!?|])>)|<\/(style|title|textarea)/i,Ze)){we(Ge,j);continue}if(Ht==="attributename"&&Or(Ze,"href")){we(Ge,j);continue}if(de.forceKeepAttr)continue;if(!de.keepAttr){we(Ge,j);continue}if(!P&&rt(/\/>/i,Ze)){we(Ge,j);continue}Z&&Pn([O,ne,ue],Oi=>{Ze=un(Ze,Oi," ")});const Ni=De(j.nodeName);if(!Ii(Ni,Ht,Ze)){we(Ge,j);continue}if(_&&typeof T=="object"&&typeof T.getAttributeType=="function"&&!ct)switch(T.getAttributeType(Ni,Ht)){case"TrustedHTML":{Ze=_.createHTML(Ze);break}case"TrustedScriptURL":{Ze=_.createScriptURL(Ze);break}}if(Ze!==or)try{ct?j.setAttributeNS(ct,Ge,Ze):j.setAttribute(Ge,Ze),Be(j)?ee(j):ks(e.removed)}catch{we(Ge,j)}}vt(B.afterSanitizeAttributes,j,null)},ea=function ge(j){let se=null;const de=Fe(j);for(vt(B.beforeSanitizeShadowDOM,j,null);se=de.nextNode();)vt(B.uponSanitizeShadowNode,se,null),Ai(se),ki(se),se.content instanceof o&&ge(se.content);vt(B.afterSanitizeShadowDOM,j,null)};return e.sanitize=function(ge){let j=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},se=null,de=null,$e=null,tt=null;if(nn=!ge,nn&&(ge="<!-->"),typeof ge!="string"&&!Ne(ge))if(typeof ge.toString=="function"){if(ge=ge.toString(),typeof ge!="string")throw fn("dirty is not a string, aborting")}else throw fn("toString is not a function");if(!e.isSupported)return ge;if(z||u(j),e.removed=[],typeof ge=="string"&&(Q=!1),Q){if(ge.nodeName){const Tt=De(ge.nodeName);if(!be[Tt]||U[Tt])throw fn("root node is forbidden and cannot be sanitized in-place")}}else if(ge instanceof l)se=Ue("<!---->"),de=se.ownerDocument.importNode(ge,!0),de.nodeType===dn.element&&de.nodeName==="BODY"||de.nodeName==="HTML"?se=de:se.appendChild(de);else{if(!ce&&!Z&&!$&&ge.indexOf("<")===-1)return _&&s?_.createHTML(ge):ge;if(se=Ue(ge),!se)return ce?null:s?R:""}se&&te&&ee(se.firstChild);const Ge=Fe(Q?ge:se);for(;$e=Ge.nextNode();)Ai($e),ki($e),$e.content instanceof o&&ea($e.content);if(Q)return ge;if(ce){if(m)for(tt=x.call(se.ownerDocument);se.firstChild;)tt.appendChild(se.firstChild);else tt=se;return(W.shadowroot||W.shadowrootmode)&&(tt=L.call(n,tt,!0)),tt}let ct=$?se.outerHTML:se.innerHTML;return $&&be["!doctype"]&&se.ownerDocument&&se.ownerDocument.doctype&&se.ownerDocument.doctype.name&&rt(Yo,se.ownerDocument.doctype.name)&&(ct="<!DOCTYPE "+se.ownerDocument.doctype.name+`>
`+ct),Z&&Pn([O,ne,ue],Tt=>{ct=un(ct,Tt," ")}),_&&s?_.createHTML(ct):ct},e.setConfig=function(){let ge=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};u(ge),z=!0},e.clearConfig=function(){Pt=null,z=!1},e.isValidAttribute=function(ge,j,se){Pt||u({});const de=De(ge),$e=De(j);return Ii(de,$e,se)},e.addHook=function(ge,j){typeof j=="function"&&ln(B[ge],j)},e.removeHook=function(ge,j){if(j!==void 0){const se=Qf(B[ge],j);return se===-1?void 0:Xf(B[ge],se,1)[0]}return ks(B[ge])},e.removeHooks=function(ge){B[ge]=[]},e.removeAllHooks=function(){B=Ds()},e}var ii=Vo();Oe.setOptions({breaks:!0,gfm:!0,headerIds:!1,mangle:!1});const ph={ALLOWED_TAGS:["p","br","span","div","strong","em","b","i","u","s","del","code","pre","a","ul","ol","li","blockquote","h1","h2","h3","h4","h5","h6","table","thead","tbody","tr","th","td","hr"],ALLOWED_ATTR:["href","class","target","rel"],ALLOW_DATA_ATTR:!1,ALLOWED_URI_REGEXP:/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i,ADD_ATTR:["target"],FORBID_TAGS:["script","style","iframe","object","embed","form","input","button"],FORBID_ATTR:["onerror","onload","onclick","onmouseover"]};ii.addHook("afterSanitizeAttributes",r=>{r.tagName==="A"&&(r.setAttribute("target","_blank"),r.setAttribute("rel","noopener noreferrer"))});function Ri(r,e={}){if(typeof r!="string"||!r.trim())return"";try{const t=Oe.parse(r,e);return ii.sanitize(t,ph)}catch(t){return console.error("[Markdown] Rendering error:",t),ii.sanitize(r)}}function gh(r){return typeof r!="string"||!r.trim()?!1:[/^#{1,6}\s/m,/\*\*[^*]+\*\*/,/\*[^*]+\*/,/`[^`]+`/,/^\s*[-*+]\s/m,/^\s*\d+\.\s/m,/^\s*>/m,/\[.+\]\(.+\)/,/~~.+~~/].some(t=>t.test(r))}function yh(r){const e=document.createElement("div");return e.textContent=r,e.innerHTML}function Qo(r){return typeof r!="string"||!r.trim()?"":r.split(`
`).map((n,i,o)=>{let a=yh(n);return a=a.replace(/^(#{1,6})\s+(.+)$/g,(l,f,p)=>{const b=f.length;return`<span class="md-h${b}"><span class="md-syntax">${f} </span><span class="md-h${b}-text">${p}</span></span>`}),a=a.replace(/\*\*([^*]+)\*\*/g,'<span class="md-bold"><span class="md-syntax">**</span><span class="md-bold-text">$1</span><span class="md-syntax">**</span></span>'),a=a.replace(new RegExp("(?<!\\*)\\*([^*]+)\\*(?!\\*)","g"),'<span class="md-italic"><span class="md-syntax">*</span><span class="md-italic-text">$1</span><span class="md-syntax">*</span></span>'),a=a.replace(/~~([^~]+)~~/g,'<span class="md-strikethrough"><span class="md-syntax">~~</span><span class="md-strikethrough-text">$1</span><span class="md-syntax">~~</span></span>'),a=a.replace(/`([^`]+)`/g,'<span class="md-code"><span class="md-syntax">`</span><span class="md-code-text">$1</span><span class="md-syntax">`</span></span>'),a=a.replace(/\[([^\]]+)\]\(([^)]+)\)/g,'<span class="md-link"><span class="md-syntax">[</span><span class="md-link-text">$1</span><span class="md-syntax">](</span><span class="md-link-url">$2</span><span class="md-syntax">)</span></span>'),a=a.replace(/^(\s*[-*+])\s+(.+)$/g,'<span class="md-list"><span class="md-syntax">$1 </span><span class="md-list-text">$2</span></span>'),a=a.replace(/^(\s*\d+\.)\s+(.+)$/g,'<span class="md-list"><span class="md-syntax">$1 </span><span class="md-list-text">$2</span></span>'),a=a.replace(/^(&gt;)\s+(.+)$/g,'<span class="md-blockquote"><span class="md-syntax">&gt; </span><span class="md-blockquote-text">$2</span></span>'),a=a.replace(/^(```)(.*)$/g,'<span class="md-codeblock"><span class="md-syntax">$1</span><span class="md-codeblock-lang">$2</span></span>'),!a.trim()&&i<o.length-1?'<div class="md-line-break">&nbsp;</div>':a.includes('class="md-')?a:a?`<div class="md-line">${a}</div>`:""}).filter(Boolean).join("")}class mh{constructor(e,t={}){if(this.textarea=document.getElementById(e),!this.textarea)throw new Error(`Textarea with id "${e}" not found`);this.debounceDelay=t.debounceDelay||300,this.onChange=t.onChange||null,this.debounceTimer=null,this.previewElement=null,this.init()}init(){this.createPreviewElement(),this.attachEventListeners()}createPreviewElement(){const e=this.textarea.closest(".message-input-wrapper");e&&(this.previewElement=document.createElement("div"),this.previewElement.className="message-preview styled-markdown",this.previewElement.setAttribute("aria-hidden","true"),e.appendChild(this.previewElement))}attachEventListeners(){this.textarea.addEventListener("input",()=>this.handleInput()),this.textarea.addEventListener("scroll",()=>this.syncScroll(),{passive:!0}),this.textarea.addEventListener("focus",()=>this.handleFocus()),this.textarea.addEventListener("blur",()=>this.handleBlur())}handleInput(){this.autoResize(),this.debounceTimer&&clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>{this.updatePreview(),this.onChange&&this.onChange(this.textarea.value)},this.debounceDelay)}handleFocus(){this.textarea.parentElement.classList.add("focused"),this.updatePreview()}handleBlur(){this.textarea.parentElement.classList.remove("focused")}syncScroll(){if(!this.previewElement)return;const e=this.textarea.scrollTop,t=this.textarea.scrollLeft;this.previewElement.style.transform=`translate(-${t}px, -${e}px)`}autoResize(){this.textarea.style.height="auto";const t=Math.min(this.textarea.scrollHeight,144);this.textarea.style.height=t+"px"}updatePreview(){if(!this.previewElement)return;const e=this.textarea.value;if(!e.trim()){this.previewElement.innerHTML="",this.previewElement.classList.remove("active"),this.textarea.classList.remove("preview-active");return}try{const t=Qo(e);this.previewElement.innerHTML=t,this.previewElement.classList.add("active"),this.textarea.classList.add("preview-active")}catch(t){console.error("[MarkdownInput] Preview error:",t),this.previewElement.innerHTML=""}}render(e){return!e||typeof e!="string"?"":Ri(e)}clearPreview(){this.previewElement&&(this.previewElement.innerHTML="",this.previewElement.classList.remove("active")),this.textarea&&this.textarea.classList.remove("preview-active")}getValue(){return this.textarea.value}setValue(e){this.textarea.value=e,this.autoResize(),this.updatePreview()}clear(){this.textarea.value="",this.clearPreview()}destroy(){this.debounceTimer&&clearTimeout(this.debounceTimer),this.previewElement&&this.previewElement.remove()}}const lt=new ra,We=new lf(lt);window.mesh=We;window.identity=lt;const ie=r=>document.getElementById(r);function wh(){const r=localStorage.getItem("theme"),e=window.matchMedia("(prefers-color-scheme: dark)").matches;Xo(r||(e?"dark":"light"))}function Xo(r){document.documentElement.setAttribute("data-theme",r),localStorage.setItem("theme",r);const e=ie("btnThemeToggle").querySelector("i");r==="dark"?e.className="ti ti-sun":e.className="ti ti-moon"}function _h(){const e=(document.documentElement.getAttribute("data-theme")||"dark")==="dark"?"light":"dark";Xo(e)}function Si(r){if(!r||r.trim()==="")return"??";const e=r.trim().split(/\s+/);return e.length===1?e[0].substring(0,2).toUpperCase():(e[0][0]+e[e.length-1][0]).toUpperCase()}function Jo(){const r=ie("userAvatar");r.textContent=Si(lt.displayName)}function bh(){ie("connectionModal").classList.remove("hidden"),ie("connectionChoice").classList.remove("hidden"),ie("initiatorFlow").classList.add("hidden"),ie("joinerFlow").classList.add("hidden")}function Ci(){ie("connectionModal").classList.add("hidden"),ie("connectionChoice").classList.remove("hidden"),ie("initiatorFlow").classList.add("hidden"),ie("joinerFlow").classList.add("hidden"),ie("joinerAnswerStep").classList.add("hidden"),ie("offerInput").value="",ie("answerInput").value=""}ie("connectionModal").addEventListener("click",r=>{r.target===ie("connectionModal")&&Ci()});function Eh(){const r=ie("sidebar"),e=ie("sidebarOverlay");r.classList.add("mobile-open"),e.classList.add("active"),document.body.classList.add("sidebar-open"),r.setAttribute("aria-hidden","false")}function tn(){const r=ie("sidebar"),e=ie("sidebarOverlay");r.classList.remove("mobile-open"),e.classList.remove("active"),document.body.classList.remove("sidebar-open"),r.setAttribute("aria-hidden","true")}function vh(){ie("sidebar").classList.contains("mobile-open")?tn():Eh()}function Zo(){const r=ie("btnMobileMenu");window.innerWidth<=768?r.classList.remove("hidden"):(r.classList.add("hidden"),tn())}window.addEventListener("resize",Zo);Zo();document.addEventListener("keydown",r=>{r.key==="Escape"&&ie("sidebar").classList.contains("mobile-open")&&tn()});ie("displayName").textContent=lt.displayName;ie("userUUID").textContent=lt.uuid.substring(0,16)+"...";Jo();We.onPeerConnect=(r,e)=>{qe(`${e} joined the mesh`,"system"),rr(),Ah()};We.onPeerDisconnect=r=>{const e=lt.getPeerDisplayName(r,"Peer");qe(`${e} left the mesh`,"system"),rr()};We.onPeerUpdate=(r,e)=>{We.peers.get(r)&&qe(`${e} changed their display name`,"system"),rr()};We.onMessage=(r,e,t,n)=>{const i=lt.getPeerDisplayName(r,e);qe(`${i}: ${t}`,"peer",r,n)};function rr(){const r=We.getConnectedPeers(),e=ie("peersList"),t=ie("peerCount");if(t.textContent=r.length,r.length===0){e.innerHTML='<div class="no-peers">No peers connected yet</div>';return}e.innerHTML=r.map(n=>{let i="latency-excellent",o="Unknown";n.latency!==null&&n.latency!==void 0&&(o=`${n.latency}ms`,n.latency<100?i="latency-excellent":n.latency<200?i="latency-good":n.latency<500?i="latency-fair":i="latency-poor");const a=n.uptime>60?`${Math.floor(n.uptime/60)}m`:`${n.uptime}s`,l=Si(n.displayName);return`
        <div class="peer-item" data-uuid="${n.uuid}">
          <div class="peer-tooltip">
            <div class="tooltip-row">
              <span class="tooltip-label">Original Name:</span>
              <span class="tooltip-value">${n.originalDisplayName}</span>
            </div>
            ${n.displayName!==n.originalDisplayName?`
            <div class="tooltip-row">
              <span class="tooltip-label">Your Rename:</span>
              <span class="tooltip-value">${n.displayName}</span>
            </div>
            `:""}
            <div class="tooltip-row">
              <span class="tooltip-label">UUID:</span>
              <span class="tooltip-value">${n.uuid.substring(0,8)}</span>
            </div>
            <div class="tooltip-row">
              <span class="tooltip-label">Quality Score:</span>
              <span class="tooltip-value">${n.quality}/100</span>
            </div>
            <div class="tooltip-row">
              <span class="tooltip-label">Uptime:</span>
              <span class="tooltip-value">${a}</span>
            </div>
          </div>
          <div class="peer-avatar">
            ${l}
            <div class="peer-status"></div>
          </div>
          <div class="peer-info">
            <div class="peer-name" data-uuid="${n.uuid}">
              <span>${n.displayName}</span>
              <i class="ti ti-edit"></i>
            </div>
            <div class="peer-stats">
              <div class="peer-uuid">${n.uuid.substring(0,8)}...</div>
              ${n.latency!==null&&n.latency!==void 0?`<div class="latency-badge ${i}">${o}</div>`:""}
              <div class="quality-badge">${n.quality}</div>
            </div>
          </div>
        </div>
      `}).join(""),e.querySelectorAll(".peer-name").forEach(n=>{n.addEventListener("click",()=>{const i=n.dataset.uuid,o=r.find(a=>a.uuid===i);o&&Th(i,o.displayName,o.originalDisplayName)})})}function Th(r,e,t){const n=prompt(`Rename peer locally:

Original name: ${t}
Current custom name: ${e===t?"(none)":e}`,e);n!==null&&n.trim()&&(n===t?lt.setPeerRename(r,""):lt.setPeerRename(r,n),rr())}ie("btnEditName").onclick=()=>{const r=prompt("Enter your new display name:",lt.displayName);r&&r.trim()&&(lt.setDisplayName(r.trim()),ie("displayName").textContent=lt.displayName,Jo(),We.broadcastNameChange(),qe(`You changed your name to ${lt.displayName}`,"system"))};ie("userIdentity").onclick=r=>{r.target.closest(".btn-edit-identity")||ie("btnEditName").click()};function Rh(){const r=new Date,e=new Date;e.setHours(0,0,0,0);const t=new Date(r);t.setHours(0,0,0,0);const n=r.getHours().toString().padStart(2,"0"),i=r.getMinutes().toString().padStart(2,"0"),o=`${n}:${i}`;if(t.getTime()!==e.getTime()){const a=(r.getMonth()+1).toString().padStart(2,"0"),l=r.getDate().toString().padStart(2,"0"),f=r.getFullYear();return`${a}/${l}/${f} ${o}`}return o}function Sh(r,e){const t=document.createElement("div");return t.className="message-avatar",e==="peer"&&t.classList.add("peer-avatar-msg"),t.textContent=Si(r),t}function qe(r,e="sent",t=null,n="plain"){const i=ie("messages");if(e==="system"){const C=document.createElement("div");C.className="message system",C.textContent=r,i.appendChild(C),i.scrollTop=i.scrollHeight;return}let o="Unknown",a=r;const l=r.indexOf(": ");l>0&&(o=r.substring(0,l),a=r.substring(l+2));const f=document.createElement("div");f.className="message-group",t&&(f.dataset.uuid=t),n&&(f.dataset.format=n,f.dataset.rawText=a);const p=Sh(o,e),b=document.createElement("div");b.className="message-content";const d=document.createElement("div");d.className="message-header";const w=document.createElement("span");w.className="message-author",w.textContent=o;const T=document.createElement("span");if(T.className="message-timestamp",T.textContent=Rh(),d.appendChild(w),d.appendChild(T),n==="markdown"&&gh(a)){const C=document.createElement("button");C.className="btn-toggle-raw",C.setAttribute("aria-label","Toggle raw markdown"),C.setAttribute("title","View raw markdown"),C.innerHTML='<i class="ti ti-code"></i>',C.addEventListener("click",()=>Ch(f)),d.appendChild(C)}const v=document.createElement("div");if(v.className="message-text",n==="markdown")try{const C=Ri(a);v.innerHTML=C,v.classList.add("markdown-rendered")}catch(C){console.error("[App] Markdown rendering error:",C),v.textContent=a}else v.textContent=a;b.appendChild(d),b.appendChild(v),f.appendChild(p),f.appendChild(b),i.appendChild(f),i.scrollTop=i.scrollHeight}function Ch(r){const e=r.querySelector(".message-text"),t=r.dataset.rawText,n=r.querySelector(".btn-toggle-raw");if(!e||!t||!n)return;if(e.classList.contains("showing-raw")){const o=Ri(t);e.innerHTML=o,e.classList.remove("showing-raw","styled-markdown"),e.classList.add("markdown-rendered"),n.innerHTML='<i class="ti ti-code"></i>',n.setAttribute("title","View raw markdown")}else{const o=Qo(t);e.innerHTML=o,e.classList.add("showing-raw","styled-markdown"),e.classList.remove("markdown-rendered"),n.innerHTML='<i class="ti ti-eye"></i>',n.setAttribute("title","View rendered markdown")}}function Ah(){ie("messageInput").disabled=!1,ie("btnSend").disabled=!1}ie("btnNewConnection").onclick=()=>{bh()};ie("btnClearData").onclick=()=>{if(confirm(`Are you sure you want to clear ALL data? This will:

 Delete your identity
 Delete all saved peers
 Delete all reconnection data
 Clear all settings

This action cannot be undone. The page will reload after clearing.`))try{const r=localStorage.length;localStorage.clear(),qe(`All data cleared (${r} items). Reloading...`,"system"),setTimeout(()=>{window.location.reload()},1e3)}catch(r){console.error("[App] Error clearing data:",r),alert("Error clearing data: "+r.message)}};ie("btnCloseModal").onclick=()=>{Ci()};ie("btnInvite").onclick=async()=>{ie("connectionChoice").classList.add("hidden"),ie("btnInvite").disabled=!0,ie("initiatorFlow").classList.remove("hidden"),ie("offerLoader").classList.remove("hidden"),ie("offerOutput").classList.add("hidden"),ie("btnCopyOffer").classList.add("hidden");const r=await We.createOffer();ie("offerLoader").classList.add("hidden"),ie("offerOutput").value=r,ie("offerOutput").classList.remove("hidden"),ie("btnCopyOffer").classList.remove("hidden"),qe("Invitation generated. Waiting for peer to respond...","system"),setTimeout(()=>{ie("btnInvite").disabled=!1},1e3)};ie("btnJoin").onclick=()=>{ie("connectionChoice").classList.add("hidden"),ie("btnJoin").disabled=!0,ie("joinerFlow").classList.remove("hidden"),setTimeout(()=>{ie("btnJoin").disabled=!1},1e3)};ie("btnCopyOffer").onclick=async()=>{try{await navigator.clipboard.writeText(ie("offerOutput").value),ie("btnCopyOffer").innerHTML='<i class="ti ti-check"></i><span>Copied!</span>',setTimeout(()=>{ie("btnCopyOffer").innerHTML='<i class="ti ti-copy"></i><span>Copy Code</span>'},2e3)}catch{ie("offerOutput").select(),alert("Please copy manually (Ctrl+C)")}};ie("btnProcessOffer").onclick=async()=>{const r=ie("offerInput").value.trim();if(!r){alert("Please paste an offer");return}try{ie("joinerAnswerStep").classList.remove("hidden"),ie("answerLoader").classList.remove("hidden"),ie("answerOutput").classList.add("hidden"),ie("btnCopyAnswer").classList.add("hidden");const e=await We.acceptOffer(r);ie("answerLoader").classList.add("hidden"),ie("answerOutput").value=e,ie("answerOutput").classList.remove("hidden"),ie("btnCopyAnswer").classList.remove("hidden"),qe("Response generated. Share it with the inviter...","system"),setTimeout(()=>{ie("offerInput").value="",ie("joinerAnswerStep").classList.add("hidden")},3e4)}catch{alert("Invalid offer format")}};ie("btnCopyAnswer").onclick=async()=>{try{await navigator.clipboard.writeText(ie("answerOutput").value),ie("btnCopyAnswer").innerHTML='<i class="ti ti-check"></i><span>Copied!</span>',setTimeout(()=>{ie("btnCopyAnswer").innerHTML='<i class="ti ti-copy"></i><span>Copy Code</span>'},2e3)}catch{ie("answerOutput").select(),alert("Please copy manually (Ctrl+C)")}};ie("btnAcceptAnswer").onclick=()=>{const r=ie("answerInput").value.trim();if(!r){alert("Please paste a response");return}try{We.acceptAnswer(r),qe("Processing response... connecting to peer...","system"),ie("answerInput").value="",setTimeout(()=>{Ci()},2e3)}catch(e){alert("Invalid response format: "+e.message)}};let si;ie("btnSend").onclick=()=>{const r=ie("messageInput").value.trim();r&&We.getConnectedPeers().length>0&&(We.sendMessage(r,"markdown"),qe(`You: ${r}`,"sent",null,"markdown"),ie("messageInput").value="",si&&si.clearPreview(),window.innerWidth<=768&&tn())};ie("messageInput").addEventListener("keydown",r=>{const e=window.innerWidth<=768;if(r.key==="Enter"){if(e)return;r.shiftKey||(r.preventDefault(),ie("btnSend").click())}});ie("btnThemeToggle").onclick=()=>{_h()};ie("btnMobileMenu").onclick=()=>{vh()};ie("sidebarOverlay").addEventListener("click",()=>{tn()});ie("btnCloseSidebar").addEventListener("click",()=>{tn()});class Ih{constructor(){this.deferredPrompt=null,this.installButton=ie("btnInstallApp"),this.isInstalled=this.checkIfInstalled(),this.init()}checkIfInstalled(){const e=window.matchMedia("(display-mode: standalone)").matches,t=window.navigator.standalone===!0;return e||t}init(){this.isInstalled||(window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),this.deferredPrompt=e,this.showInstallButton()}),window.addEventListener("appinstalled",()=>{this.handleInstallSuccess()}),this.installButton.addEventListener("click",()=>{this.handleInstallClick()}),this.deferredPrompt&&this.showInstallButton())}showInstallButton(){this.installButton.classList.remove("hidden"),this.installButton.classList.add("pulse"),setTimeout(()=>{this.installButton.classList.remove("pulse")},6e3)}hideInstallButton(){this.installButton.classList.add("hidden"),this.installButton.classList.remove("pulse","installing","success","error")}async handleInstallClick(){if(!this.deferredPrompt){console.error("No deferred prompt available"),this.showError("Installation not available");return}try{this.installButton.classList.remove("pulse"),this.installButton.classList.add("installing"),this.updateButtonContent("ti ti-loader","Installing..."),this.deferredPrompt.prompt();const{outcome:e}=await this.deferredPrompt.userChoice;e==="accepted"?(this.installButton.classList.remove("installing"),this.installButton.classList.add("success"),this.updateButtonContent("ti ti-check","Installed!"),setTimeout(()=>{this.hideInstallButton()},2e3)):(this.installButton.classList.remove("installing"),this.updateButtonContent("ti ti-download","Install App"),setTimeout(()=>{this.installButton.classList.add("pulse")},500)),this.deferredPrompt=null}catch(e){console.error("Error during installation:",e),this.showError("Installation failed")}}showError(e){this.installButton.classList.remove("installing","success"),this.installButton.classList.add("error"),this.updateButtonContent("ti ti-alert-circle",e),setTimeout(()=>{this.installButton.classList.remove("error"),this.updateButtonContent("ti ti-download","Install App"),this.deferredPrompt&&this.installButton.classList.add("pulse")},2e3)}handleInstallSuccess(){this.installButton.classList.remove("installing","pulse"),this.installButton.classList.add("success"),this.updateButtonContent("ti ti-check","Installed!"),qe("App installed successfully! You can now use it offline.","system"),setTimeout(()=>{this.hideInstallButton()},2e3)}updateButtonContent(e,t){const n=this.installButton.querySelector("i"),i=this.installButton.querySelector("span");n&&(n.className=e),i&&(i.textContent=t)}}"serviceWorker"in navigator&&navigator.serviceWorker.addEventListener("controllerchange",()=>{qe("New version installed. Reloading...","system"),setTimeout(()=>{window.location.reload()},1e3)});async function Fs(){const r=Date.now();try{if(!We.reconnectionReady)try{await We._initPromise}catch(i){console.error("[App] Reconnection system initialization failed:",i),qe('Reconnection system unavailable. Click "New Connection" to connect.',"system");return}if(!We.reconnectionEnabled||!We.masterReconnect){qe('Reconnection disabled. Click "New Connection" to connect.',"system");return}if(!navigator.onLine){qe("You are offline. Reconnection will start when back online.","system");return}qe("Reconnecting to mesh network...","system");const e=Date.now(),t=await We.reconnectToMesh(),n=Date.now()-e;if(t.fallbackRequired||t.method==="cold_start_failed"){const i=Date.now()-r,o=n<1e3?`${n}ms`:`${(n/1e3).toFixed(1)}s`;t.peersAttempted>0?qe(`Reconnection failed: ${t.peersAttempted} saved peer(s) unreachable (${o}). Click "New Connection" to connect.`,"system"):qe('No saved connections found. Click "New Connection" to pair with peers.',"system")}else if(t.peersConnected>0){const i=Date.now()-r,o=n<1e3?`${n}ms`:`${(n/1e3).toFixed(1)}s`;let a="";t.method==="mesh_relay"||t.method==="warm_reconnection"?a=" via mesh relay":t.method==="direct_cached"?a=" directly":t.method==="cold_start"&&(a=" from cold start"),qe(`Reconnected to ${t.peersConnected} peer(s)${a} (${o})`,"system"),ie("messageInput").disabled=!1,ie("btnSend").disabled=!1}else{const i=Date.now()-r,o=n<1e3?`${n}ms`:`${(n/1e3).toFixed(1)}s`;qe(`Reconnection completed (${o}): No peers available. Click "New Connection" to pair.`,"system")}}catch(e){const t=Date.now()-r;console.error(`[App] Reconnection failed after ${t}ms:`,e),qe('Reconnection error. Click "New Connection" to connect manually.',"system")}}window.showReconnectionStats=()=>{const r=We.getReconnectionStats();if(!r)return;const e=[];return e.push("=".repeat(50)),e.push("RECONNECTION SYSTEM STATISTICS"),e.push("=".repeat(50)),r.master&&(e.push(`
Master Strategy:`),e.push("  Total attempts: "+r.master.totalReconnectionAttempts),e.push("  Successful: "+r.master.successfulReconnections),e.push("  Failed: "+r.master.failedReconnections),e.push("  Success rate: "+(r.master.totalReconnectionAttempts>0?`${(r.master.successfulReconnections/r.master.totalReconnectionAttempts*100).toFixed(1)}%`:"N/A"))),r.persistence&&(e.push(`
Persistence:`),e.push("  Total saved peers: "+r.persistence.totalPeers),e.push("  Needs cleanup: "+r.persistence.needsCleanup)),r.network&&(e.push(`
Network:`),e.push("  IP changes: "+r.network.ipChangeCount),e.push("  Connection type: "+r.network.currentConnectionType),e.push("  Online: "+r.network.isOnline)),e.push(`
`+"=".repeat(50)),e.join(`
`)};async function Ph(){if(!We.peerPersistence)return"Peer persistence not available";const r=await We.peerPersistence.getReconnectionCandidates({limit:20,maxAge:7*24*60*60*1e3});if(r.length===0)return"No saved peers found";const e=[`Saved Peers (${r.length}):`];for(const t of r.slice(0,10)){const n=t.peer,i=new Date(n.lastSeen).toLocaleString(),o=We.peers.has(n.peerId)?"Connected":"Disconnected";e.push(`${o} ${n.displayName} (score: ${t.score})`),e.push(`   Last seen: ${i}`)}return e.join(`
`)}window.showSavedPeers=Ph;wh();new Ih;ie("messageInput").disabled=!0;ie("btnSend").disabled=!0;lt.isNew&&qe("Welcome! Your identity has been created.","system");try{si=new mh("messageInput",{debounceDelay:300})}catch(r){console.error("[App] Failed to initialize markdown input:",r)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Fs):Fs();
